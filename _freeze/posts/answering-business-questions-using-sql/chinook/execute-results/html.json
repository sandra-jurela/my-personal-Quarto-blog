{
  "hash": "c0c5110f9fe5ed72ec9f8dc9a6d3d7ad",
  "result": {
    "markdown": "---\ntitle: \"Answering Business Questions Using SQL\"\ndescription: |\n  My SQL project for the \"Intermediate SQL for Data Analysis\" course at Dataquest.\ndate: 2022-02-15\ncategories:\n  - SQL\n  - SQLite\n  - Dataquest\n  - data visualization\n  - R\nimage: images/media_type.png\nmessage: true\n---\n\n\n## Introduction\n\nThe aim of this project is to explore a modified version of the [Chinook database](https://github.com/lerocha/chinook-database) using SQL and answer some business questions. The Chinook database represents a fictional digital media shop, based on real data from an iTunes Library and manually generated data. The database is provided as a **SQLite database** file called **chinook.db**.\n\nHere's a schema diagram for the Chinook database:\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](images/chinook-schema.svg)\n:::\n:::\n\n\n## Connecting to the Database and Data Overview\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(DBI)\n\ndb <- dbConnect(RSQLite::SQLite(), dbname = \"data/chinook.db\")\n```\n:::\n\n\nListing all tables in the Chinook database.\n\n\n::: {.cell max.print='null'}\n\n```{.sql .cell-code}\nSELECT\n  name,\n  type\nFROM sqlite_master\nWHERE type IN (\"table\", \"view\")\n```\n\n\n<div class=\"knitsql-table\">\n\n\nTable: 11 records\n\n|name           |type  |\n|:--------------|:-----|\n|album          |table |\n|artist         |table |\n|customer       |table |\n|employee       |table |\n|genre          |table |\n|invoice        |table |\n|invoice_line   |table |\n|media_type     |table |\n|playlist       |table |\n|playlist_track |table |\n|track          |table |\n\n</div>\n:::\n\n\nThe database consists of 11 tables containing information about artists, albums, media tracks, playlists, invoices, customers, and shop employees. Let's start by getting familiar with our data from the main tables:\n\n`employee` table\n\n\n::: {.cell output.var='employee'}\n\n```{.sql .cell-code}\nSELECT *\nFROM employee\nLIMIT 5\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"employee_id\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"last_name\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"first_name\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"title\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"reports_to\"],\"name\":[5],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"birthdate\"],\"name\":[6],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"hire_date\"],\"name\":[7],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"address\"],\"name\":[8],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"city\"],\"name\":[9],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"state\"],\"name\":[10],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"country\"],\"name\":[11],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"postal_code\"],\"name\":[12],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"phone\"],\"name\":[13],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"fax\"],\"name\":[14],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"email\"],\"name\":[15],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"1\",\"2\":\"Adams\",\"3\":\"Andrew\",\"4\":\"General Manager\",\"5\":\"NA\",\"6\":\"1962-02-18 00:00:00\",\"7\":\"2016-08-14 00:00:00\",\"8\":\"11120 Jasper Ave NW\",\"9\":\"Edmonton\",\"10\":\"AB\",\"11\":\"Canada\",\"12\":\"T5K 2N1\",\"13\":\"+1 (780) 428-9482\",\"14\":\"+1 (780) 428-3457\",\"15\":\"andrew@chinookcorp.com\"},{\"1\":\"2\",\"2\":\"Edwards\",\"3\":\"Nancy\",\"4\":\"Sales Manager\",\"5\":\"1\",\"6\":\"1958-12-08 00:00:00\",\"7\":\"2016-05-01 00:00:00\",\"8\":\"825 8 Ave SW\",\"9\":\"Calgary\",\"10\":\"AB\",\"11\":\"Canada\",\"12\":\"T2P 2T3\",\"13\":\"+1 (403) 262-3443\",\"14\":\"+1 (403) 262-3322\",\"15\":\"nancy@chinookcorp.com\"},{\"1\":\"3\",\"2\":\"Peacock\",\"3\":\"Jane\",\"4\":\"Sales Support Agent\",\"5\":\"2\",\"6\":\"1973-08-29 00:00:00\",\"7\":\"2017-04-01 00:00:00\",\"8\":\"1111 6 Ave SW\",\"9\":\"Calgary\",\"10\":\"AB\",\"11\":\"Canada\",\"12\":\"T2P 5M5\",\"13\":\"+1 (403) 262-3443\",\"14\":\"+1 (403) 262-6712\",\"15\":\"jane@chinookcorp.com\"},{\"1\":\"4\",\"2\":\"Park\",\"3\":\"Margaret\",\"4\":\"Sales Support Agent\",\"5\":\"2\",\"6\":\"1947-09-19 00:00:00\",\"7\":\"2017-05-03 00:00:00\",\"8\":\"683 10 Street SW\",\"9\":\"Calgary\",\"10\":\"AB\",\"11\":\"Canada\",\"12\":\"T2P 5G3\",\"13\":\"+1 (403) 263-4423\",\"14\":\"+1 (403) 263-4289\",\"15\":\"margaret@chinookcorp.com\"},{\"1\":\"5\",\"2\":\"Johnson\",\"3\":\"Steve\",\"4\":\"Sales Support Agent\",\"5\":\"2\",\"6\":\"1965-03-03 00:00:00\",\"7\":\"2017-10-17 00:00:00\",\"8\":\"7727B 41 Ave\",\"9\":\"Calgary\",\"10\":\"AB\",\"11\":\"Canada\",\"12\":\"T3B 1Y7\",\"13\":\"1 (780) 836-9987\",\"14\":\"1 (780) 836-9543\",\"15\":\"steve@chinookcorp.com\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n`customer` table\n\n\n::: {.cell output.var='customer'}\n\n```{.sql .cell-code}\nSELECT *\nFROM customer\nLIMIT 5\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"customer_id\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"first_name\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"last_name\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"company\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"address\"],\"name\":[5],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"city\"],\"name\":[6],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"state\"],\"name\":[7],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"country\"],\"name\":[8],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"postal_code\"],\"name\":[9],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"phone\"],\"name\":[10],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"fax\"],\"name\":[11],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"email\"],\"name\":[12],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"support_rep_id\"],\"name\":[13],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1\",\"2\":\"Luís\",\"3\":\"Gonçalves\",\"4\":\"Embraer - Empresa Brasileira de Aeronáutica S.A.\",\"5\":\"Av. Brigadeiro Faria Lima, 2170\",\"6\":\"São José dos Campos\",\"7\":\"SP\",\"8\":\"Brazil\",\"9\":\"12227-000\",\"10\":\"+55 (12) 3923-5555\",\"11\":\"+55 (12) 3923-5566\",\"12\":\"luisg@embraer.com.br\",\"13\":\"3\"},{\"1\":\"2\",\"2\":\"Leonie\",\"3\":\"Köhler\",\"4\":\"NA\",\"5\":\"Theodor-Heuss-Straße 34\",\"6\":\"Stuttgart\",\"7\":\"NA\",\"8\":\"Germany\",\"9\":\"70174\",\"10\":\"+49 0711 2842222\",\"11\":\"NA\",\"12\":\"leonekohler@surfeu.de\",\"13\":\"5\"},{\"1\":\"3\",\"2\":\"François\",\"3\":\"Tremblay\",\"4\":\"NA\",\"5\":\"1498 rue Bélanger\",\"6\":\"Montréal\",\"7\":\"QC\",\"8\":\"Canada\",\"9\":\"H2G 1A7\",\"10\":\"+1 (514) 721-4711\",\"11\":\"NA\",\"12\":\"ftremblay@gmail.com\",\"13\":\"3\"},{\"1\":\"4\",\"2\":\"Bjørn\",\"3\":\"Hansen\",\"4\":\"NA\",\"5\":\"Ullevålsveien 14\",\"6\":\"Oslo\",\"7\":\"NA\",\"8\":\"Norway\",\"9\":\"0171\",\"10\":\"+47 22 44 22 22\",\"11\":\"NA\",\"12\":\"bjorn.hansen@yahoo.no\",\"13\":\"4\"},{\"1\":\"5\",\"2\":\"František\",\"3\":\"Wichterlová\",\"4\":\"JetBrains s.r.o.\",\"5\":\"Klanova 9/506\",\"6\":\"Prague\",\"7\":\"NA\",\"8\":\"Czech Republic\",\"9\":\"14700\",\"10\":\"+420 2 4172 5555\",\"11\":\"+420 2 4172 5555\",\"12\":\"frantisekw@jetbrains.com\",\"13\":\"4\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n`invoice` table\n\n\n::: {.cell output.var='invoice'}\n\n```{.sql .cell-code}\nSELECT *\nFROM invoice\nLIMIT 5\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"invoice_id\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"customer_id\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"invoice_date\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"billing_address\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"billing_city\"],\"name\":[5],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"billing_state\"],\"name\":[6],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"billing_country\"],\"name\":[7],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"billing_postal_code\"],\"name\":[8],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"total\"],\"name\":[9],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1\",\"2\":\"18\",\"3\":\"2017-01-03 00:00:00\",\"4\":\"627 Broadway\",\"5\":\"New York\",\"6\":\"NY\",\"7\":\"USA\",\"8\":\"10012-2612\",\"9\":\"15.84\"},{\"1\":\"2\",\"2\":\"30\",\"3\":\"2017-01-03 00:00:00\",\"4\":\"230 Elgin Street\",\"5\":\"Ottawa\",\"6\":\"ON\",\"7\":\"Canada\",\"8\":\"K2P 1L7\",\"9\":\"9.90\"},{\"1\":\"3\",\"2\":\"40\",\"3\":\"2017-01-05 00:00:00\",\"4\":\"8, Rue Hanovre\",\"5\":\"Paris\",\"6\":\"None\",\"7\":\"France\",\"8\":\"75002\",\"9\":\"1.98\"},{\"1\":\"4\",\"2\":\"18\",\"3\":\"2017-01-06 00:00:00\",\"4\":\"627 Broadway\",\"5\":\"New York\",\"6\":\"NY\",\"7\":\"USA\",\"8\":\"10012-2612\",\"9\":\"7.92\"},{\"1\":\"5\",\"2\":\"27\",\"3\":\"2017-01-07 00:00:00\",\"4\":\"1033 N Park Ave\",\"5\":\"Tucson\",\"6\":\"AZ\",\"7\":\"USA\",\"8\":\"85719\",\"9\":\"16.83\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n`invoice_line` table\n\n\n::: {.cell output.var='invoice_line'}\n\n```{.sql .cell-code}\nSELECT *\nFROM invoice_line\nLIMIT 30\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"invoice_line_id\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"invoice_id\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"track_id\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"unit_price\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"quantity\"],\"name\":[5],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1\",\"2\":\"1\",\"3\":\"1158\",\"4\":\"0.99\",\"5\":\"1\"},{\"1\":\"2\",\"2\":\"1\",\"3\":\"1159\",\"4\":\"0.99\",\"5\":\"1\"},{\"1\":\"3\",\"2\":\"1\",\"3\":\"1160\",\"4\":\"0.99\",\"5\":\"1\"},{\"1\":\"4\",\"2\":\"1\",\"3\":\"1161\",\"4\":\"0.99\",\"5\":\"1\"},{\"1\":\"5\",\"2\":\"1\",\"3\":\"1162\",\"4\":\"0.99\",\"5\":\"1\"},{\"1\":\"6\",\"2\":\"1\",\"3\":\"1163\",\"4\":\"0.99\",\"5\":\"1\"},{\"1\":\"7\",\"2\":\"1\",\"3\":\"1164\",\"4\":\"0.99\",\"5\":\"1\"},{\"1\":\"8\",\"2\":\"1\",\"3\":\"1165\",\"4\":\"0.99\",\"5\":\"1\"},{\"1\":\"9\",\"2\":\"1\",\"3\":\"1166\",\"4\":\"0.99\",\"5\":\"1\"},{\"1\":\"10\",\"2\":\"1\",\"3\":\"1167\",\"4\":\"0.99\",\"5\":\"1\"},{\"1\":\"11\",\"2\":\"1\",\"3\":\"1168\",\"4\":\"0.99\",\"5\":\"1\"},{\"1\":\"12\",\"2\":\"1\",\"3\":\"1169\",\"4\":\"0.99\",\"5\":\"1\"},{\"1\":\"13\",\"2\":\"1\",\"3\":\"1170\",\"4\":\"0.99\",\"5\":\"1\"},{\"1\":\"14\",\"2\":\"1\",\"3\":\"1171\",\"4\":\"0.99\",\"5\":\"1\"},{\"1\":\"15\",\"2\":\"1\",\"3\":\"1172\",\"4\":\"0.99\",\"5\":\"1\"},{\"1\":\"16\",\"2\":\"1\",\"3\":\"1173\",\"4\":\"0.99\",\"5\":\"1\"},{\"1\":\"17\",\"2\":\"2\",\"3\":\"3476\",\"4\":\"0.99\",\"5\":\"1\"},{\"1\":\"18\",\"2\":\"2\",\"3\":\"482\",\"4\":\"0.99\",\"5\":\"1\"},{\"1\":\"19\",\"2\":\"2\",\"3\":\"2701\",\"4\":\"0.99\",\"5\":\"1\"},{\"1\":\"20\",\"2\":\"2\",\"3\":\"1641\",\"4\":\"0.99\",\"5\":\"1\"},{\"1\":\"21\",\"2\":\"2\",\"3\":\"1119\",\"4\":\"0.99\",\"5\":\"1\"},{\"1\":\"22\",\"2\":\"2\",\"3\":\"2324\",\"4\":\"0.99\",\"5\":\"1\"},{\"1\":\"23\",\"2\":\"2\",\"3\":\"201\",\"4\":\"0.99\",\"5\":\"1\"},{\"1\":\"24\",\"2\":\"2\",\"3\":\"819\",\"4\":\"0.99\",\"5\":\"1\"},{\"1\":\"25\",\"2\":\"2\",\"3\":\"392\",\"4\":\"0.99\",\"5\":\"1\"},{\"1\":\"26\",\"2\":\"2\",\"3\":\"2651\",\"4\":\"0.99\",\"5\":\"1\"},{\"1\":\"27\",\"2\":\"3\",\"3\":\"2516\",\"4\":\"0.99\",\"5\":\"1\"},{\"1\":\"28\",\"2\":\"3\",\"3\":\"2646\",\"4\":\"0.99\",\"5\":\"1\"},{\"1\":\"29\",\"2\":\"4\",\"3\":\"3448\",\"4\":\"0.99\",\"5\":\"1\"},{\"1\":\"30\",\"2\":\"4\",\"3\":\"2560\",\"4\":\"0.99\",\"5\":\"1\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n`track` table\n\n\n::: {.cell output.var='track'}\n\n```{.sql .cell-code}\nSELECT *\nFROM track\nLIMIT 20\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"track_id\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"name\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"album_id\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"media_type_id\"],\"name\":[4],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"genre_id\"],\"name\":[5],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"composer\"],\"name\":[6],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"milliseconds\"],\"name\":[7],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"bytes\"],\"name\":[8],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"unit_price\"],\"name\":[9],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1\",\"2\":\"For Those About To Rock (We Salute You)\",\"3\":\"1\",\"4\":\"1\",\"5\":\"1\",\"6\":\"Angus Young, Malcolm Young, Brian Johnson\",\"7\":\"343719\",\"8\":\"11170334\",\"9\":\"0.99\"},{\"1\":\"2\",\"2\":\"Balls to the Wall\",\"3\":\"2\",\"4\":\"2\",\"5\":\"1\",\"6\":\"NA\",\"7\":\"342562\",\"8\":\"5510424\",\"9\":\"0.99\"},{\"1\":\"3\",\"2\":\"Fast As a Shark\",\"3\":\"3\",\"4\":\"2\",\"5\":\"1\",\"6\":\"F. Baltes, S. Kaufman, U. Dirkscneider & W. Hoffman\",\"7\":\"230619\",\"8\":\"3990994\",\"9\":\"0.99\"},{\"1\":\"4\",\"2\":\"Restless and Wild\",\"3\":\"3\",\"4\":\"2\",\"5\":\"1\",\"6\":\"F. Baltes, R.A. Smith-Diesel, S. Kaufman, U. Dirkscneider & W. Hoffman\",\"7\":\"252051\",\"8\":\"4331779\",\"9\":\"0.99\"},{\"1\":\"5\",\"2\":\"Princess of the Dawn\",\"3\":\"3\",\"4\":\"2\",\"5\":\"1\",\"6\":\"Deaffy & R.A. Smith-Diesel\",\"7\":\"375418\",\"8\":\"6290521\",\"9\":\"0.99\"},{\"1\":\"6\",\"2\":\"Put The Finger On You\",\"3\":\"1\",\"4\":\"1\",\"5\":\"1\",\"6\":\"Angus Young, Malcolm Young, Brian Johnson\",\"7\":\"205662\",\"8\":\"6713451\",\"9\":\"0.99\"},{\"1\":\"7\",\"2\":\"Let's Get It Up\",\"3\":\"1\",\"4\":\"1\",\"5\":\"1\",\"6\":\"Angus Young, Malcolm Young, Brian Johnson\",\"7\":\"233926\",\"8\":\"7636561\",\"9\":\"0.99\"},{\"1\":\"8\",\"2\":\"Inject The Venom\",\"3\":\"1\",\"4\":\"1\",\"5\":\"1\",\"6\":\"Angus Young, Malcolm Young, Brian Johnson\",\"7\":\"210834\",\"8\":\"6852860\",\"9\":\"0.99\"},{\"1\":\"9\",\"2\":\"Snowballed\",\"3\":\"1\",\"4\":\"1\",\"5\":\"1\",\"6\":\"Angus Young, Malcolm Young, Brian Johnson\",\"7\":\"203102\",\"8\":\"6599424\",\"9\":\"0.99\"},{\"1\":\"10\",\"2\":\"Evil Walks\",\"3\":\"1\",\"4\":\"1\",\"5\":\"1\",\"6\":\"Angus Young, Malcolm Young, Brian Johnson\",\"7\":\"263497\",\"8\":\"8611245\",\"9\":\"0.99\"},{\"1\":\"11\",\"2\":\"C.O.D.\",\"3\":\"1\",\"4\":\"1\",\"5\":\"1\",\"6\":\"Angus Young, Malcolm Young, Brian Johnson\",\"7\":\"199836\",\"8\":\"6566314\",\"9\":\"0.99\"},{\"1\":\"12\",\"2\":\"Breaking The Rules\",\"3\":\"1\",\"4\":\"1\",\"5\":\"1\",\"6\":\"Angus Young, Malcolm Young, Brian Johnson\",\"7\":\"263288\",\"8\":\"8596840\",\"9\":\"0.99\"},{\"1\":\"13\",\"2\":\"Night Of The Long Knives\",\"3\":\"1\",\"4\":\"1\",\"5\":\"1\",\"6\":\"Angus Young, Malcolm Young, Brian Johnson\",\"7\":\"205688\",\"8\":\"6706347\",\"9\":\"0.99\"},{\"1\":\"14\",\"2\":\"Spellbound\",\"3\":\"1\",\"4\":\"1\",\"5\":\"1\",\"6\":\"Angus Young, Malcolm Young, Brian Johnson\",\"7\":\"270863\",\"8\":\"8817038\",\"9\":\"0.99\"},{\"1\":\"15\",\"2\":\"Go Down\",\"3\":\"4\",\"4\":\"1\",\"5\":\"1\",\"6\":\"AC/DC\",\"7\":\"331180\",\"8\":\"10847611\",\"9\":\"0.99\"},{\"1\":\"16\",\"2\":\"Dog Eat Dog\",\"3\":\"4\",\"4\":\"1\",\"5\":\"1\",\"6\":\"AC/DC\",\"7\":\"215196\",\"8\":\"7032162\",\"9\":\"0.99\"},{\"1\":\"17\",\"2\":\"Let There Be Rock\",\"3\":\"4\",\"4\":\"1\",\"5\":\"1\",\"6\":\"AC/DC\",\"7\":\"366654\",\"8\":\"12021261\",\"9\":\"0.99\"},{\"1\":\"18\",\"2\":\"Bad Boy Boogie\",\"3\":\"4\",\"4\":\"1\",\"5\":\"1\",\"6\":\"AC/DC\",\"7\":\"267728\",\"8\":\"8776140\",\"9\":\"0.99\"},{\"1\":\"19\",\"2\":\"Problem Child\",\"3\":\"4\",\"4\":\"1\",\"5\":\"1\",\"6\":\"AC/DC\",\"7\":\"325041\",\"8\":\"10617116\",\"9\":\"0.99\"},{\"1\":\"20\",\"2\":\"Overdose\",\"3\":\"4\",\"4\":\"1\",\"5\":\"1\",\"6\":\"AC/DC\",\"7\":\"369319\",\"8\":\"12066294\",\"9\":\"0.99\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n## 1. Selecting Albums to Purchase\n\nThe Chinook record store has just signed a deal with a new record label, and you've been tasked with selecting the first three albums that will be added to the store, from a list of four. All four albums are by artists that don't have any tracks in the store right now - we have the artist names, and the genre of music they produce:\n\n| Artist Name          | Genre   |\n|----------------------|---------|\n| Regal                | Hip-Hop |\n| Red Tone             | Punk    |\n| Meteor and the Girls | Pop     |\n| Slim Jim Bites       | Blues   |\n\nThe record label specializes in artists from the USA, and they have given Chinook some money to advertise the new albums in the USA, so we're interested in finding out which genres sell the best in the USA.\n\nYou'll need to write a query to find out which genres sell the most tracks in the USA, write up a summary of your findings, and make a recommendation for the three artists whose albums we should purchase for the store.\n\n**Instructions**\n\n1.  Write a query that returns each genre, with the number of tracks sold in the USA:\n\n    -   in absolute numbers\n    -   in percentages.\n\n2.  Write a paragraph that interprets the data and makes a recommendation for the three artists whose albums we should purchase for the store, based on sales of tracks from their genres.\n\n\n::: {.cell max.print='null' output.var='genre_perc'}\n\n```{.sql .cell-code}\nSELECT \n  g.name AS genre,\n  SUM(il.quantity) AS tracks_sold,\n  ROUND(CAST(SUM(il.quantity) AS FLOAT)/\n  (\n    SELECT SUM(il.quantity) \n    FROM invoice i\n    INNER JOIN invoice_line il\n    ON i.invoice_id = il.invoice_id\n    WHERE i.billing_country = 'USA'\n  ) \n  , 4) AS percentage_sold\nFROM invoice i\nINNER JOIN invoice_line il\nON i.invoice_id = il.invoice_id\nINNER JOIN track t \nON il.track_id = t.track_id\nINNER JOIN genre g\nON t.genre_id = g.genre_id\nWHERE i.billing_country = 'USA'\nGROUP BY genre\nORDER BY tracks_sold DESC\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n|genre              | tracks_sold| percentage_sold|\n|:------------------|-----------:|---------------:|\n|Rock               |         561|          0.5338|\n|Alternative & Punk |         130|          0.1237|\n|Metal              |         124|          0.1180|\n|R&B/Soul           |          53|          0.0504|\n|Blues              |          36|          0.0343|\n|Alternative        |          35|          0.0333|\n|Pop                |          22|          0.0209|\n|Latin              |          22|          0.0209|\n|Hip Hop/Rap        |          20|          0.0190|\n|Jazz               |          14|          0.0133|\n|Easy Listening     |          13|          0.0124|\n|Reggae             |           6|          0.0057|\n|Electronica/Dance  |           5|          0.0048|\n|Classical          |           4|          0.0038|\n|Heavy Metal        |           3|          0.0029|\n|Soundtrack         |           2|          0.0019|\n|TV Shows           |           1|          0.0010|\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nlibrary(tidyverse)\ntheme_set(theme_classic())\n\ngenre_of_interest <- c(\"Alternative & Punk\", \"Hip Hop/Rap\", \"Pop\", \"Blues\")\n\ngenre_perc %>% \n  mutate(of_interest = ifelse(genre %in% genre_of_interest, \"yes\", \"no\"),\n         perc_text = scales::percent(percentage_sold, accuracy = 0.1)) %>% \n  ggplot(aes(x=tracks_sold, y=reorder(genre, tracks_sold, sum), fill=of_interest)) + \n  geom_bar(stat = 'identity', width = 0.7) +\n  geom_text(aes(label = perc_text), hjust = -0.2) +\n  labs(title = \"Sold Tracks by Genre, USA\", x = \"Tracks Sold\", y = \"Genre\", \n       fill = \"Genre of Interest\") + \n  scale_fill_manual(values = c(\"gray74\", \"orange\")) +\n  scale_x_continuous(limits = c(0, 600)) +\n  theme(legend.position = \"top\")\n```\n\n::: {.cell-output-display}\n![](chinook_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\nThe most popular genres in the USA are **Rock**, **Alternative & Punk**, and **Metal**, followed with a big gap by all the others. Since our choice is limited by Hip-Hop, Punk, Pop, and Blues genres, and since we have to choose 3 out of 4 albums, we should purchase the new albums by the following artists:\n\n-   Red Tone (Punk)\n-   Slim Jim Bites (Blues)\n-   Meteor and the Girls (Pop)\n\n## 2. Analyzing Employee Sales Performance\n\nEach customer for the Chinook store gets assigned to a sales support agent within the company when they first make a purchase. You have been asked to analyze the purchases of customers belonging to each employee to see if any sales support agent is performing either better or worse than the others.\n\nYou might like to consider whether any extra columns from the employee table explain any variance you see, or whether the variance might instead be indicative of employee performance.\n\n**Instructions**\n\n1.  Write a query that finds the total dollar amount of sales assigned to each sales support agent within the company. Add any extra attributes for that employee that you find are relevant to the analysis.\n\n2.  Write a short statement describing your results, and providing a possible interpretation.\n\n\n::: {.cell}\n\n```{.sql .cell-code}\nSELECT \n  e.first_name || ' ' || e.last_name AS sales_support_agent,\n  e.hire_date,\n  COUNT(DISTINCT c.customer_id) AS customers,\n  SUM(i.total) AS total_sales\nFROM employee e\nINNER JOIN customer c\nON e.employee_id = c.support_rep_id\nINNER JOIN invoice i\nON c.customer_id = i.customer_id\nGROUP BY sales_support_agent\n```\n\n\n<div class=\"knitsql-table\">\n\n\nTable: 3 records\n\n|sales_support_agent |hire_date           | customers| total_sales|\n|:-------------------|:-------------------|---------:|-----------:|\n|Jane Peacock        |2017-04-01 00:00:00 |        21|     1731.51|\n|Margaret Park       |2017-05-03 00:00:00 |        20|     1584.00|\n|Steve Johnson       |2017-10-17 00:00:00 |        18|     1393.92|\n\n</div>\n:::\n\n\nWhile there is a **20% difference in sales** between Jane (the top employee) and Steve (the bottom employee), the difference roughly corresponds with the differences in their hiring dates.\n\n## 3. Analyzing Sales by Country\n\nYour next task is to analyze the sales data for customers from each different country. You have been given guidance to use the country value from the customers table, and ignore the country from the billing address in the invoice table.\n\n**Instructions**\n\n1.  Write a query that collates data on purchases from different countries.\n\n2.  Where a country has only one customer, collect them into an \"Other\" group.\n\n3.  The results should be sorted by the total sales from highest to lowest, with the \"Other\" group at the very bottom.\n\n4.  For each country, include:\n\n    -   total number of customers\n    -   total value of sales\n    -   average value of sales per customer\n    -   average order value\n\n\n::: {.cell max.print='null' output.var='sales_by_country'}\n\n```{.sql .cell-code}\nWITH t1 AS (\n  SELECT\n    CASE\n      WHEN COUNT(DISTINCT c.customer_id) = 1 THEN 'Other'\n      ELSE c.country\n      END AS country,\n    COUNT(DISTINCT c.customer_id) AS customers,\n    SUM(i.total) AS total_sales,\n    SUM(i.total)/COUNT(DISTINCT c.customer_id) AS avg_sales_per_cust,\n    AVG(i.total) AS avg_order\n  FROM customer c\n  INNER JOIN invoice i\n  ON c.customer_id = i.customer_id\n  GROUP BY country\n)\n\nSELECT \n  country,\n  SUM(customers) AS customers,\n  SUM(total_sales) AS total_sales,\n  AVG(avg_sales_per_cust) AS avg_sales_per_cust,\n  AVG(avg_order) AS avg_order\nFROM \n  (\n    SELECT\n      t1.*,\n      CASE \n        WHEN country = 'Other' THEN 1\n        ELSE 0\n        END AS sorted\n    FROM t1\n  )\nGROUP BY country\nORDER BY sorted, total_sales DESC\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n|country        | customers| total_sales| avg_sales_per_cust| avg_order|\n|:--------------|---------:|-----------:|------------------:|---------:|\n|USA            |        13|     1040.49|           80.03769|  7.942672|\n|Canada         |         8|      535.59|           66.94875|  7.047237|\n|Brazil         |         5|      427.68|           85.53600|  7.011147|\n|France         |         5|      389.07|           77.81400|  7.781400|\n|Germany        |         4|      334.62|           83.65500|  8.161463|\n|Czech Republic |         2|      273.24|          136.62000|  9.108000|\n|United Kingdom |         3|      245.52|           81.84000|  8.768571|\n|Portugal       |         2|      185.13|           92.56500|  6.383793|\n|India          |         2|      183.15|           91.57500|  8.721429|\n|Other          |        15|     1094.94|           72.99600|  7.445071|\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nsales_by_country %>% \n  select(country, customers, total_sales) %>% \n  mutate(country = factor(country, levels = c(country)) %>% fct_rev()) %>% \n  mutate(customers = customers/sum(customers),\n         total_sales = total_sales/sum(total_sales)) %>%\n  pivot_longer(-country, names_to = \"variable\", values_to = \"value\") %>% \n  ggplot(aes(x=value, y=country, fill=variable)) +\n  geom_bar(stat = \"identity\", width = 0.65, position = position_dodge(0.8)) +\n  labs(title=\"Share of Customers and Sales by Country\", x=\"share\", fill=\"\") +\n  scale_x_continuous(labels = scales::percent) +\n  scale_fill_manual(values = c(\"gray77\", \"seagreen3\")) +\n  theme(legend.position = \"top\")\n```\n\n::: {.cell-output-display}\n![](chinook_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nsales_by_country %>% \n  select(country, avg_order, avg_sales_per_cust) %>% \n  mutate(country = factor(country, levels = c(country)) %>% fct_rev()) %>% \n  mutate(avg_order = (avg_order - mean(avg_order)) / mean(avg_order),\n         avg_sales_per_cust = (avg_sales_per_cust - mean(avg_sales_per_cust)) / \n                                 mean(avg_sales_per_cust)) %>%\n  rename(`Average Order` = avg_order,\n         `Average Sales per Customer` = avg_sales_per_cust) %>% \n  pivot_longer(-country, names_to = \"variable\", values_to = \"pct_diff_from_mean\") %>% \n  ggplot(aes(x=pct_diff_from_mean, y=country, fill=variable)) +\n  geom_col(width = 0.65, position = position_dodge(0.8)) +\n  facet_wrap(~ variable, scales = \"free_x\") + \n  labs(title=\"Average Order & Average Sales per Customer\", \n       subtitle = \"(Percent Difference from Mean)\", x=\"pct diff from mean\", fill=\"\") +\n  scale_fill_manual(values = c(\"steelblue\", \"lightskyblue2\")) +\n  scale_x_continuous(labels = scales::percent) +\n  theme(legend.position = \"top\")\n```\n\n::: {.cell-output-display}\n![](chinook_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n\n\n\nThe USA has the largest customer base and, consequently, the highest total sales.\n\nBased on the data, there may be opportunity in the following countries:\n\n-   Czech Republic\n-   United Kingdom\n-   India\n\nIt's worth keeping in mind that the amount of data from each of these countries is relatively low. Because of this, we should be cautious spending too much money on new marketing campaigns, as the sample size is not large enough to give us high confidence. A better approach would be to run small campaigns in these countries, collecting and analyzing the new customers to make sure that these trends hold with new customers.\n\n## 4. Albums vs Individual Tracks\n\nThe Chinook store is setup in a way that allows customer to make purchases in one of the two ways:\n\n-   purchase a whole album\n-   purchase a collection of one or more individual tracks.\n\nThe store does not let customers purchase a whole album, and then add individual tracks to that same purchase (unless they do that by choosing each track manually). When customers purchase albums they are charged the same price as if they had purchased each of those tracks separately.\n\nManagement are currently considering changing their purchasing strategy to save money. The strategy they are considering is to purchase only the most popular tracks from each album from record companies, instead of purchasing every track from an album.\n\nWe have been asked to find out what percentage of purchases are individual tracks vs whole albums, so that management can use this data to understand the effect this decision might have on overall revenue.\n\n**Instructions**\n\n1.  Write a query that categorizes each invoice as either an album purchase or not, and calculates the following summary statistics:\n\n    -   Number of invoices\n    -   Percentage of invoices\n\n2.  Write one to two sentences explaining your findings, and making a prospective recommendation on whether the Chinook store should continue to buy full albums from record companies\n\n\n::: {.cell}\n\n```{.sql .cell-code}\nWITH cat_purchase AS (\n  SELECT\n    il.invoice_id,\n    CASE\n      WHEN\n      COUNT(DISTINCT t.album_id) = 1\n      AND \n      COUNT(DISTINCT t.track_id) = c.count_album_tracks\n      THEN 'album'\n      ELSE 'individual track(s)'\n      END AS purchase_type,\n      c.count_album_tracks\n    FROM track t\n    JOIN invoice_line il\n    ON il.track_id = t.track_id\n    JOIN (SELECT COUNT(*) AS count_album_tracks, album_id\n          FROM track\n          GROUP BY album_id) c\n    ON c.album_id = t.album_id\n    GROUP BY invoice_id\n)\n\nSELECT\n  purchase_type,\n  COUNT(*) AS number_of_invoices,\n  ROUND(CAST(COUNT(*) AS float) / CAST(\n    (SELECT COUNT(*)\n    FROM invoice) AS FLOAT), 2) AS percentage_of_invoices\nFROM cat_purchase\nGROUP BY purchase_type\n\n```\n\n\n<div class=\"knitsql-table\">\n\n\nTable: 2 records\n\n|purchase_type       | number_of_invoices| percentage_of_invoices|\n|:-------------------|------------------:|----------------------:|\n|album               |                114|                   0.19|\n|individual track(s) |                500|                   0.81|\n\n</div>\n:::\n\n\nAlbum purchases account for 19% of all purchases. Based on this data, I would recommend against purchasing only the most popular tracks from each album from record companies, since there is a potential of losing a significant portion of revenue.\n\n## 5. Which artist is used in the most playlists?\n\n\n::: {.cell}\n\n```{.sql .cell-code}\nSELECT \n  ar.name AS artist,\n  g.name AS genre,\n  COUNT(DISTINCT pt.playlist_id) AS number_of_playlists,\n  COUNT(DISTINCT t.track_id) AS unique_tracks\nFROM artist ar\nJOIN album al ON ar.artist_id=al.artist_id\nJOIN track t ON al.album_id=t.album_id\nJOIN playlist_track pt ON pt.track_id = t.track_id\nJOIN genre g ON g.genre_id = t.genre_id\nGROUP BY artist, genre\nORDER BY number_of_playlists DESC, unique_tracks DESC\n```\n\n\n<div class=\"knitsql-table\">\n\n\nTable: Displaying records 1 - 10\n\n|artist                                                     |genre     | number_of_playlists| unique_tracks|\n|:----------------------------------------------------------|:---------|-------------------:|-------------:|\n|Eugene Ormandy                                             |Classical |                   7|             3|\n|Berliner Philharmoniker & Herbert Von Karajan              |Classical |                   6|             3|\n|The King's Singers                                         |Classical |                   6|             2|\n|English Concert & Trevor Pinnock                           |Classical |                   6|             2|\n|Academy of St. Martin in the Fields & Sir Neville Marriner |Classical |                   6|             2|\n|Michael Tilson Thomas & San Francisco Symphony             |Classical |                   5|             2|\n|Yo-Yo Ma                                                   |Classical |                   5|             1|\n|Wilhelm Kempff                                             |Classical |                   5|             1|\n|Ton Koopman                                                |Classical |                   5|             1|\n|Sir Georg Solti, Sumi Jo & Wiener Philharmoniker           |Opera     |                   5|             1|\n\n</div>\n:::\n\n\n[Eugene Ormandy](https://en.wikipedia.org/wiki/Eugene_Ormandy) takes the first place with only 3 unique tracks in 7 different playlists. His music belongs to the classical genre, which we have previously seen is one of the least popular genres in the USA.\n\nIf we order this table by number of unique tracks, we get a completely different list.\n\n\n::: {.cell}\n\n```{.sql .cell-code}\nSELECT \n  ar.name AS artist,\n  g.name AS genre,\n  COUNT(DISTINCT pt.playlist_id) AS number_of_playlists,\n  COUNT(DISTINCT t.track_id) AS unique_tracks\nFROM artist ar\nJOIN album al ON ar.artist_id=al.artist_id\nJOIN track t ON al.album_id=t.album_id\nJOIN playlist_track pt ON pt.track_id = t.track_id\nJOIN genre g ON g.genre_id = t.genre_id\nGROUP BY artist, genre\nORDER BY unique_tracks DESC, number_of_playlists DESC\n```\n\n\n<div class=\"knitsql-table\">\n\n\nTable: Displaying records 1 - 10\n\n|artist                  |genre    | number_of_playlists| unique_tracks|\n|:-----------------------|:--------|-------------------:|-------------:|\n|Led Zeppelin            |Rock     |                   3|           114|\n|Metallica               |Metal    |                   4|           112|\n|U2                      |Rock     |                   3|           112|\n|Iron Maiden             |Metal    |                   4|            95|\n|Deep Purple             |Rock     |                   3|            92|\n|Iron Maiden             |Rock     |                   3|            81|\n|Pearl Jam               |Rock     |                   4|            54|\n|Van Halen               |Rock     |                   3|            52|\n|Os Paralamas Do Sucesso |Latin    |                   3|            49|\n|Lost                    |TV Shows |                   2|            48|\n\n</div>\n:::\n\n\n## 6. How many tracks have been purchased vs not purchased?\n\n\n::: {.cell}\n\n```{.sql .cell-code}\nWITH all_and_purchased_tracks AS (\n  SELECT \n    t.track_id AS all_tracks,\n    il.track_id AS purch_tracks\n  FROM track t\n  LEFT JOIN invoice_line il\n  ON t.track_id = il.track_id\n)\n  \nSELECT\n  COUNT(DISTINCT all_tracks) AS total_tracks,\n  COUNT(DISTINCT purch_tracks) AS pirchased,\n  COUNT(DISTINCT all_tracks) - COUNT(DISTINCT purch_tracks) AS not_purchased,\n  ROUND(CAST(COUNT(DISTINCT purch_tracks) AS FLOAT)/COUNT(DISTINCT all_tracks), 3)\n    AS perc_purchased,\n  ROUND(CAST(COUNT(DISTINCT all_tracks) - COUNT(DISTINCT purch_tracks) \n    AS FLOAT)/COUNT(DISTINCT all_tracks), 3)\n    AS perc_not_purchased\nFROM all_and_purchased_tracks\n```\n\n\n<div class=\"knitsql-table\">\n\n\nTable: 1 records\n\n| total_tracks| pirchased| not_purchased| perc_purchased| perc_not_purchased|\n|------------:|---------:|-------------:|--------------:|------------------:|\n|         3503|      1806|          1697|          0.516|              0.484|\n\n</div>\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\npie(c(51.6, 48.4), labels = c(\"purchased\", \"not purchased\"), \n    main = \"Purchased vs not purchased tracks\")\n```\n\n::: {.cell-output-display}\n![](chinook_files/figure-html/unnamed-chunk-24-1.png){width=672}\n:::\n:::\n\n\nAlmost half of all the unique tracks available in the Chinook store were never bought, probably being of unpopular genre or unpopular artists.\n\n## 7. Do protected vs non-protected media types have an effect on popularity?\n\nLet's take a look at the `media_type` table.\n\n\n::: {.cell}\n\n```{.sql .cell-code}\nSELECT *\nFROM media_type\n```\n\n\n<div class=\"knitsql-table\">\n\n\nTable: 5 records\n\n|media_type_id |name                        |\n|:-------------|:---------------------------|\n|1             |MPEG audio file             |\n|2             |Protected AAC audio file    |\n|3             |Protected MPEG-4 video file |\n|4             |Purchased AAC audio file    |\n|5             |AAC audio file              |\n\n</div>\n:::\n\n\nThere are 2 out of 5 media types that are protected.\n\n\n::: {.cell output.var='by_media_type'}\n\n```{.sql .cell-code}\nWITH t AS (\n  SELECT \n    t.track_id,\n    CASE\n      WHEN mt.name LIKE \"%protected%\" THEN \"yes\" ELSE \"no\"\n      END AS protected\n  FROM track t\n  JOIN media_type mt ON mt.media_type_id = t.media_type_id\n)\n\nSELECT \n  protected,\n  COUNT(DISTINCT t.track_id) AS unique_tracks,\n  ROUND(CAST(COUNT(DISTINCT t.track_id) AS FLOAT) / (SELECT COUNT(*) FROM track), 2)\n    AS 'unique_tracks_%',\n  COUNT(DISTINCT il.track_id) AS sold_unique_tracks,\n  COUNT(il.track_id) AS sold_tracks,\n  ROUND(CAST(COUNT(il.track_id) AS FLOAT) / (SELECT COUNT(*) FROM invoice_line), 2)\n    AS 'sold_tracks_%'\nFROM t\nLEFT JOIN invoice_line il ON t.track_id = il.track_id\nGROUP BY protected\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n|protected | unique_tracks| unique_tracks_%| sold_unique_tracks| sold_tracks| sold_tracks_%|\n|:---------|-------------:|---------------:|------------------:|-----------:|-------------:|\n|no        |          3052|            0.87|               1652|        4315|          0.91|\n|yes       |           451|            0.13|                154|         442|          0.09|\n:::\n:::\n\n::: {.cell layout-ncol=\"2\"}\n\n```{.r .cell-code  code-fold=\"true\"}\nby_media_type %>% \n  select(protected, unique_tracks, sold_tracks) %>% \n  rename(unique = unique_tracks, \n         sold = sold_tracks) %>% \n  pivot_longer(-protected, names_to = \"tracks\", values_to = \"count\") %>% \n  mutate(tracks = as.factor(tracks) %>% fct_rev()) %>% \n  group_by(tracks) %>% \n  mutate(pct = count/sum(count) %>% round(2)) %>% \n  ungroup() %>% \n  ggplot(aes(x=tracks, y=count, fill=protected)) +\n  geom_col(width = 0.5, position = \"stack\", color = \"white\") +\n  geom_text(aes(label = count), position = position_stack(vjust = .5),\n            color = \"white\", fontface = \"bold\")+\n  scale_fill_manual(values = c(\"#fbc02d\", \"#03a9f4\")) +\n  theme(legend.position = \"top\")\n```\n\n::: {.cell-output-display}\n![](chinook_files/figure-html/unnamed-chunk-28-1.png){width=384}\n:::\n\n```{.r .cell-code  code-fold=\"true\"}\nby_media_type %>% \n  select(protected, unique_tracks, sold_unique_tracks) %>% \n  rename(unique = unique_tracks, \n         unique_sold = sold_unique_tracks) %>% \n  mutate(unique_unsold = unique - unique_sold) %>% \n  pivot_longer(-protected, names_to = \"tracks\", values_to = \"count\") %>% \n  filter(tracks != \"unique\") %>% \n  group_by(protected) %>% \n  mutate(percentage = scales::percent(count/sum(count), accuracy = 0.1)) %>% \n  ggplot(aes(x=protected, y=count, fill=tracks)) +\n  geom_col(width = 0.5, position = \"fill\", color = \"white\") +\n  scale_fill_manual(values = c(\"seagreen3\", \"tomato\")) +\n  geom_text(aes(label = percentage), position = position_fill(vjust = .5), \n            color = \"white\", fontface = \"bold\") +\n  labs(y=\"proportion\") +\n  theme(legend.position = \"top\")\n```\n\n::: {.cell-output-display}\n![](chinook_files/figure-html/unnamed-chunk-28-2.png){width=384}\n:::\n:::\n\n\nWe can make the following observations:\n\n- Only 13% of all the unique tracks available in the Chinook store are of protected media types.\n- Among all the tracks that were sold, those of protected media types amounts only to 9%.\n- From all the unique tracks of protected media types, only 34,1% were sold, while from those of non-protected ones 54,1%.\n\nWe can conclude that the **tracks of protected media types are much less popular** than those of non-protected.\n",
    "supporting": [
      "chinook_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}