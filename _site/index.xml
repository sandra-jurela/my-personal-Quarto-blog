<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Sandra Jurela</title>
<link>https://sandrajurela.com/index.html</link>
<atom:link href="https://sandrajurela.com/index.xml" rel="self" type="application/rss+xml"/>
<description>This is an extraordinary blog built by Sandra Jurela</description>
<image>
<url>https://sandrajurela.com/img/profile.jpg</url>
<title>Sandra Jurela</title>
<link>https://sandrajurela.com/index.html</link>
</image>
<generator>quarto-1.2.313</generator>
<lastBuildDate>Wed, 08 Jun 2022 22:00:00 GMT</lastBuildDate>
<item>
  <title>Titanic Survival Exercises</title>
  <dc:creator>Sandra Jurela</dc:creator>
  <link>https://sandrajurela.com/posts/titanic-survival-exercises/titanic-survival-exercises.html</link>
  <description><![CDATA[ 




<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>After auditing the HarvardX’s <a href="https://www.edx.org/course/data-science-visualization">Data Science: Visualization</a> course I’ve found this assessment way too interesting and fun. So I decided to put all my new skills together to perform exploratory data analysis on a classic machine learning dataset: Titanic survival! My goal is to provide answers entirely through visualizations.</p>
</section>
<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">Background</h2>
<p>The Titanic was a British ocean liner that struck an iceberg and sunk on its maiden voyage in 1912 from the United Kingdom to New York. More than 1,500 of the estimated 2,224 passengers and crew died in the accident, making this one of the largest maritime disasters ever outside of war. The ship carried a wide range of passengers of all ages and both genders, from luxury travelers in first-class to immigrants in the lower classes. However, not all passengers were equally likely to survive the accident. We use real data about a selection of 891 passengers to learn who was on the Titanic and which passengers were more likely to survive.</p>
</section>
<section id="libraries-customizations-and-data" class="level2">
<h2 class="anchored" data-anchor-id="libraries-customizations-and-data">Libraries, Customizations, and Data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;">library</span>(tidyverse)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;">library</span>(titanic)</span>
<span id="cb1-3"></span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;">options</span>(<span class="at" style="color: #657422;">digits =</span> <span class="dv" style="color: #AD0000;">3</span>)  </span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;">theme_set</span>(<span class="fu" style="color: #4758AB;">theme_classic</span>())</span>
<span id="cb1-6">colors_sex <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"mediumorchid1"</span>, <span class="st" style="color: #20794D;">"dodgerblue"</span>)</span>
<span id="cb1-7">colors_survived <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"gray65"</span>, <span class="st" style="color: #20794D;">"lightgreen"</span>)</span></code></pre></div>
</div>
<p>Defining the <code>titanic</code> dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">titanic <span class="ot" style="color: #003B4F;">&lt;-</span> titanic_train <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb2-2">  <span class="fu" style="color: #4758AB;">select</span>(Survived, Pclass, Sex, Age, SibSp, Parch, Fare) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb2-3">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">Survived =</span> <span class="fu" style="color: #4758AB;">factor</span>(Survived),</span>
<span id="cb2-4">         <span class="at" style="color: #657422;">Pclass =</span> <span class="fu" style="color: #4758AB;">factor</span>(Pclass),</span>
<span id="cb2-5">         <span class="at" style="color: #657422;">Sex =</span> <span class="fu" style="color: #4758AB;">factor</span>(Sex))</span>
<span id="cb2-6"></span>
<span id="cb2-7"><span class="fu" style="color: #4758AB;">head</span>(titanic)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Survived Pclass    Sex Age SibSp Parch  Fare
1        0      3   male  22     1     0  7.25
2        1      1 female  38     1     0 71.28
3        1      3 female  26     0     0  7.92
4        1      1 female  35     1     0 53.10
5        0      3   male  35     0     0  8.05
6        0      3   male  NA     0     0  8.46</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;">str</span>(titanic)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   891 obs. of  7 variables:
 $ Survived: Factor w/ 2 levels "0","1": 1 2 2 2 1 1 1 1 2 2 ...
 $ Pclass  : Factor w/ 3 levels "1","2","3": 3 1 3 1 3 3 1 3 3 2 ...
 $ Sex     : Factor w/ 2 levels "female","male": 2 1 1 1 2 2 2 2 1 1 ...
 $ Age     : num  22 38 26 35 35 NA 54 2 27 14 ...
 $ SibSp   : int  1 1 0 1 0 0 0 3 0 1 ...
 $ Parch   : int  0 0 0 0 0 0 0 1 2 0 ...
 $ Fare    : num  7.25 71.28 7.92 53.1 8.05 ...</code></pre>
</div>
</div>
</section>
<section id="question-1-variable-types" class="level2">
<h2 class="anchored" data-anchor-id="question-1-variable-types">Question 1: Variable Types</h2>
<p>Instructions: Inspect the data and also use <code>?titanic_train</code> to learn more about the variables in the dataset. Match these variables from the dataset to their variable type. There is at least one variable of each type (ordinal categorical, non-ordinal (nominal) categorical, continuous, discrete).</p>
<p>Checking if <code>Age</code> variable is discrete or continuous…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;">unique</span>(titanic<span class="sc" style="color: #5E5E5E;">$</span>Age)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 22.00 38.00 26.00 35.00    NA 54.00  2.00 27.00 14.00  4.00 58.00 20.00
[13] 39.00 55.00 31.00 34.00 15.00 28.00  8.00 19.00 40.00 66.00 42.00 21.00
[25] 18.00  3.00  7.00 49.00 29.00 65.00 28.50  5.00 11.00 45.00 17.00 32.00
[37] 16.00 25.00  0.83 30.00 33.00 23.00 24.00 46.00 59.00 71.00 37.00 47.00
[49] 14.50 70.50 32.50 12.00  9.00 36.50 51.00 55.50 40.50 44.00  1.00 61.00
[61] 56.00 50.00 36.00 45.50 20.50 62.00 41.00 52.00 63.00 23.50  0.92 43.00
[73] 60.00 10.00 64.00 13.00 48.00  0.75 53.00 57.00 80.00 70.00 24.50  6.00
[85]  0.67 30.50  0.42 34.50 74.00</code></pre>
</div>
</div>
<p><code>Age</code> is a continuous variable.</p>
<table class="table">
<thead>
<tr class="header">
<th>Variable</th>
<th>Description</th>
<th>Variable Type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>Survived</code></td>
<td>Passenger Survival Indicator</td>
<td>nominal categorical</td>
</tr>
<tr class="even">
<td><code>Pclass</code></td>
<td>Passenger Class</td>
<td>ordinal categorical</td>
</tr>
<tr class="odd">
<td><code>Sex</code></td>
<td>Sex</td>
<td>nominal categorical</td>
</tr>
<tr class="even">
<td><code>Age</code></td>
<td>Age</td>
<td>continuous</td>
</tr>
<tr class="odd">
<td><code>SibSp</code></td>
<td>Number of Siblings/Spouses Aboard</td>
<td>discrete</td>
</tr>
<tr class="even">
<td><code>Parch</code></td>
<td>Number of Parents/Children Aboard</td>
<td>discrete</td>
</tr>
<tr class="odd">
<td><code>Fare</code></td>
<td>Passenger Fare</td>
<td>continuous</td>
</tr>
</tbody>
</table>
</section>
<section id="question-2-demographics-of-titanic-passengers" class="level2">
<h2 class="anchored" data-anchor-id="question-2-demographics-of-titanic-passengers">Question 2: Demographics of Titanic Passengers</h2>
<p>Instructions: Make density plots of age grouped by sex. Try experimenting with combinations of faceting, alpha blending, stacking and using variable counts on the y-axis to answer the following questions. Some questions may be easier to answer with different versions of the density plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">titanic <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(Age)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb8-3">  <span class="fu" style="color: #4758AB;">geom_density</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">color =</span> Sex), <span class="at" style="color: #657422;">size =</span> <span class="fl" style="color: #AD0000;">0.7</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb8-4">  <span class="fu" style="color: #4758AB;">scale_color_manual</span>(<span class="at" style="color: #657422;">values =</span> colors_sex) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb8-5">  <span class="fu" style="color: #4758AB;">geom_vline</span>(<span class="at" style="color: #657422;">xintercept =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="dv" style="color: #AD0000;">18</span>, <span class="dv" style="color: #AD0000;">35</span>), <span class="at" style="color: #657422;">linetype =</span> <span class="dv" style="color: #AD0000;">2</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb8-6">  <span class="fu" style="color: #4758AB;">geom_text</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> <span class="dv" style="color: #AD0000;">18</span>, <span class="at" style="color: #657422;">y =</span> <span class="fl" style="color: #AD0000;">0.031</span>, <span class="at" style="color: #657422;">label=</span> <span class="st" style="color: #20794D;">"18"</span>, <span class="at" style="color: #657422;">hjust =</span> <span class="fl" style="color: #AD0000;">1.5</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb8-7">  <span class="fu" style="color: #4758AB;">geom_text</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> <span class="dv" style="color: #AD0000;">35</span>, <span class="at" style="color: #657422;">y =</span> <span class="fl" style="color: #AD0000;">0.031</span>, <span class="at" style="color: #657422;">label=</span> <span class="st" style="color: #20794D;">"35"</span>, <span class="at" style="color: #657422;">hjust =</span> <span class="sc" style="color: #5E5E5E;">-</span><span class="fl" style="color: #AD0000;">0.5</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb8-8">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">legend.position =</span> <span class="st" style="color: #20794D;">"top"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb8-9">  <span class="fu" style="color: #4758AB;">ylab</span>(<span class="st" style="color: #20794D;">"density"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/titanic-survival-exercises/titanic-survival-exercises_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">titanic <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb9-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(Age, <span class="at" style="color: #657422;">fill =</span> Sex)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb9-3">  <span class="fu" style="color: #4758AB;">geom_density</span>(<span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.3</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb9-4">  <span class="fu" style="color: #4758AB;">scale_fill_manual</span>(<span class="at" style="color: #657422;">values =</span> colors_sex) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb9-5">  <span class="fu" style="color: #4758AB;">geom_vline</span>(<span class="at" style="color: #657422;">xintercept =</span> <span class="dv" style="color: #AD0000;">17</span>, <span class="at" style="color: #657422;">linetype =</span> <span class="dv" style="color: #AD0000;">2</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb9-6">  <span class="fu" style="color: #4758AB;">geom_text</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> <span class="dv" style="color: #AD0000;">17</span>, <span class="at" style="color: #657422;">y =</span> <span class="fl" style="color: #AD0000;">0.031</span>, <span class="at" style="color: #657422;">label=</span> <span class="st" style="color: #20794D;">"17"</span>, <span class="at" style="color: #657422;">hjust =</span> <span class="fl" style="color: #AD0000;">1.5</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb9-7">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">legend.position =</span> <span class="st" style="color: #20794D;">"top"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb9-8">  <span class="fu" style="color: #4758AB;">ylab</span>(<span class="st" style="color: #20794D;">"density"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/titanic-survival-exercises/titanic-survival-exercises_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-preview="true">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">titanic <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb10-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(Age, ..count.., <span class="at" style="color: #657422;">fill =</span> Sex)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb10-3">  <span class="fu" style="color: #4758AB;">geom_density</span>(<span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.7</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb10-4">  <span class="fu" style="color: #4758AB;">facet_grid</span>(Sex <span class="sc" style="color: #5E5E5E;">~</span> .) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb10-5">  <span class="fu" style="color: #4758AB;">scale_fill_manual</span>(<span class="at" style="color: #657422;">values =</span> colors_sex) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb10-6">  <span class="fu" style="color: #4758AB;">geom_vline</span>(<span class="at" style="color: #657422;">xintercept =</span> <span class="dv" style="color: #AD0000;">40</span>, <span class="at" style="color: #657422;">linetype =</span> <span class="dv" style="color: #AD0000;">2</span>) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb10-7">  <span class="fu" style="color: #4758AB;">geom_text</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> <span class="dv" style="color: #AD0000;">40</span>, <span class="at" style="color: #657422;">y =</span> <span class="dv" style="color: #AD0000;">14</span>, <span class="at" style="color: #657422;">label=</span> <span class="st" style="color: #20794D;">"40"</span>, <span class="at" style="color: #657422;">hjust =</span> <span class="sc" style="color: #5E5E5E;">-</span><span class="fl" style="color: #AD0000;">0.5</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb10-8">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">legend.position =</span> <span class="st" style="color: #20794D;">"top"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/titanic-survival-exercises/titanic-survival-exercises_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Which of the following are true?</p>
<p>Select all correct answers</p>
<ul>
<li>✅ Females and males had the same general shape of age distribution.</li>
<li>✅ } The age distribution was bimodal, with one mode around 25 years of age and a second - - smaller mode around 5 years of age.</li>
<li>❌ There were more females than males.</li>
<li>✅ The count of males of age 40 was higher than the count of females of age 40.</li>
<li>✅ The proportion of males age 18-35 was higher than the proportion of females age 18-35.</li>
<li>✅ The proportion of females under age 17 was higher than the proportion of males under age 17.</li>
<li>❌ The oldest passengers were female.</li>
</ul>
</section>
<section id="question-3-qq-plot-of-age-distribution" class="level2">
<h2 class="anchored" data-anchor-id="question-3-qq-plot-of-age-distribution">Question 3: QQ-plot of Age Distribution</h2>
<p>Instructions: Use <code>geom_qq()</code> to make a QQ-plot of passenger age and add an identity line with <code>geom_abline()</code>. Filter out any individuals with an age of NA first.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">params <span class="ot" style="color: #003B4F;">&lt;-</span> titanic <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb11-2">  <span class="fu" style="color: #4758AB;">filter</span>(<span class="sc" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;">is.na</span>(Age)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb11-3">  <span class="fu" style="color: #4758AB;">summarize</span>(<span class="at" style="color: #657422;">mean =</span> <span class="fu" style="color: #4758AB;">mean</span>(Age), <span class="at" style="color: #657422;">sd =</span> <span class="fu" style="color: #4758AB;">sd</span>(Age))</span>
<span id="cb11-4"></span>
<span id="cb11-5">params</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  mean   sd
1 29.7 14.5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">titanic <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">sample =</span> Age)) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb13-2">  <span class="fu" style="color: #4758AB;">geom_qq</span>(<span class="at" style="color: #657422;">dparams =</span> params) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb13-3">  <span class="fu" style="color: #4758AB;">geom_abline</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/titanic-survival-exercises/titanic-survival-exercises_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<p>Which of the following is the correct plot according to the instructions above?</p>
<ul>
<li>✅ The plot above.</li>
</ul>
</section>
<section id="question-4-survival-by-sex" class="level2">
<h2 class="anchored" data-anchor-id="question-4-survival-by-sex">Question 4: Survival by Sex</h2>
<p>Instructions: To answer the following questions, make barplots of the <code>Survived</code> and <code>Sex</code> variables using <code>geom_bar()</code>. Try plotting one variable and filling by the other variable. You may want to try the default plot, then try adding <code>position = position_dodge()</code> to geom_bar() to make separate bars for each group.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">titanic <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb14-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(Survived, <span class="at" style="color: #657422;">fill =</span> Sex)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb14-3">  <span class="fu" style="color: #4758AB;">geom_bar</span>(<span class="at" style="color: #657422;">width =</span> <span class="fl" style="color: #AD0000;">0.7</span>, <span class="at" style="color: #657422;">color =</span> <span class="st" style="color: #20794D;">"white"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb14-4">  <span class="fu" style="color: #4758AB;">scale_fill_manual</span>(<span class="at" style="color: #657422;">values =</span> colors_sex)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/titanic-survival-exercises/titanic-survival-exercises_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">titanic <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb15-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(Sex, <span class="at" style="color: #657422;">fill =</span> Survived)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb15-3">  <span class="fu" style="color: #4758AB;">geom_bar</span>(<span class="at" style="color: #657422;">width =</span>  <span class="fl" style="color: #AD0000;">0.8</span>, <span class="at" style="color: #657422;">position =</span> <span class="fu" style="color: #4758AB;">position_dodge</span>(<span class="fl" style="color: #AD0000;">0.85</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb15-4">  <span class="fu" style="color: #4758AB;">scale_fill_manual</span>(<span class="at" style="color: #657422;">values =</span> colors_survived)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/titanic-survival-exercises/titanic-survival-exercises_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<p>Which of the following are true?</p>
<p>Select all correct answers.</p>
<ul>
<li>✅ Less than half of passengers survived.</li>
<li>✅ Most of the survivors were female.</li>
<li>❌ Most of the males survived.</li>
<li>✅ Most of the females survived.</li>
</ul>
</section>
<section id="question-5-survival-by-age" class="level2">
<h2 class="anchored" data-anchor-id="question-5-survival-by-age">Question 5: Survival by Age</h2>
<p>Instructions: Make a density plot of age filled by survival status. Change the y-axis to count and set <code>alpha = 0.2</code>.</p>
<p>The following answers were offered for all three questions:</p>
<ul>
<li>0-8</li>
<li>10-18</li>
<li>18-30</li>
<li>30-50</li>
<li>50-70</li>
<li>70-80</li>
</ul>
<section id="which-age-group-is-the-only-group-more-likely-to-survive-than-die" class="level3">
<h3 class="anchored" data-anchor-id="which-age-group-is-the-only-group-more-likely-to-survive-than-die">Which age group is the only group more likely to survive than die?</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">titanic <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb16-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(Age, <span class="at" style="color: #657422;">y =</span> ..count.., <span class="at" style="color: #657422;">fill =</span> Survived)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb16-3">  <span class="fu" style="color: #4758AB;">geom_density</span>(<span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.5</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb16-4">  <span class="fu" style="color: #4758AB;">scale_fill_manual</span>(<span class="at" style="color: #657422;">values =</span> colors_survived) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb16-5">  <span class="fu" style="color: #4758AB;">geom_vline</span>(<span class="at" style="color: #657422;">xintercept =</span> <span class="dv" style="color: #AD0000;">8</span>, <span class="at" style="color: #657422;">linetype =</span> <span class="dv" style="color: #AD0000;">2</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb16-6">  <span class="fu" style="color: #4758AB;">geom_text</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> <span class="dv" style="color: #AD0000;">8</span>, <span class="at" style="color: #657422;">y =</span> <span class="dv" style="color: #AD0000;">14</span>, <span class="at" style="color: #657422;">label=</span> <span class="st" style="color: #20794D;">"8"</span>, <span class="at" style="color: #657422;">hjust =</span> <span class="sc" style="color: #5E5E5E;">-</span><span class="fl" style="color: #AD0000;">0.5</span>))</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/titanic-survival-exercises/titanic-survival-exercises_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>✅ Age group 0-8.</li>
</ul>
</section>
<section id="which-age-group-had-the-most-deaths" class="level3">
<h3 class="anchored" data-anchor-id="which-age-group-had-the-most-deaths">Which age group had the most deaths?</h3>
<p>It’s hard to tell from the previews plot I’ll have to make a new column <code>Age group</code> based on the offered answers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1">titanic2 <span class="ot" style="color: #003B4F;">&lt;-</span> titanic <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb17-2">  <span class="fu" style="color: #4758AB;">filter</span>(<span class="sc" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;">is.na</span>(Age)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb17-3">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="st" style="color: #20794D;">`</span><span class="at" style="color: #657422;">Age group</span><span class="st" style="color: #20794D;">`</span> <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">case_when</span>(</span>
<span id="cb17-4">    Age <span class="sc" style="color: #5E5E5E;">&gt;</span><span class="dv" style="color: #AD0000;">0</span> <span class="sc" style="color: #5E5E5E;">&amp;</span> Age <span class="sc" style="color: #5E5E5E;">&lt;=</span><span class="dv" style="color: #AD0000;">8</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"0-8"</span>,</span>
<span id="cb17-5">    Age <span class="sc" style="color: #5E5E5E;">&gt;=</span><span class="dv" style="color: #AD0000;">10</span> <span class="sc" style="color: #5E5E5E;">&amp;</span> Age <span class="sc" style="color: #5E5E5E;">&lt;=</span><span class="dv" style="color: #AD0000;">18</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"10-18"</span>,</span>
<span id="cb17-6">    Age <span class="sc" style="color: #5E5E5E;">&gt;=</span><span class="dv" style="color: #AD0000;">18</span> <span class="sc" style="color: #5E5E5E;">&amp;</span> Age <span class="sc" style="color: #5E5E5E;">&lt;=</span><span class="dv" style="color: #AD0000;">30</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"18-30"</span>,</span>
<span id="cb17-7">    Age <span class="sc" style="color: #5E5E5E;">&gt;=</span><span class="dv" style="color: #AD0000;">30</span> <span class="sc" style="color: #5E5E5E;">&amp;</span> Age <span class="sc" style="color: #5E5E5E;">&lt;=</span><span class="dv" style="color: #AD0000;">50</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"30-50"</span>,</span>
<span id="cb17-8">    Age <span class="sc" style="color: #5E5E5E;">&gt;=</span><span class="dv" style="color: #AD0000;">50</span> <span class="sc" style="color: #5E5E5E;">&amp;</span> Age <span class="sc" style="color: #5E5E5E;">&lt;=</span><span class="dv" style="color: #AD0000;">70</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"50-70"</span>,</span>
<span id="cb17-9">    Age <span class="sc" style="color: #5E5E5E;">&gt;=</span><span class="dv" style="color: #AD0000;">70</span> <span class="sc" style="color: #5E5E5E;">&amp;</span> Age <span class="sc" style="color: #5E5E5E;">&lt;=</span><span class="dv" style="color: #AD0000;">80</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"70-80"</span>))</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">titanic2 <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb18-2">  <span class="fu" style="color: #4758AB;">filter</span>(<span class="sc" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;">is.na</span>(<span class="st" style="color: #20794D;">`</span><span class="at" style="color: #657422;">Age group</span><span class="st" style="color: #20794D;">`</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb18-3">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="st" style="color: #20794D;">`</span><span class="at" style="color: #657422;">Age group</span><span class="st" style="color: #20794D;">`</span>, <span class="at" style="color: #657422;">fill =</span> Survived)) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb18-4">  <span class="fu" style="color: #4758AB;">geom_bar</span>(<span class="at" style="color: #657422;">width =</span> <span class="fl" style="color: #AD0000;">0.7</span>, <span class="at" style="color: #657422;">color =</span> <span class="st" style="color: #20794D;">"white"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb18-5">  <span class="fu" style="color: #4758AB;">scale_fill_manual</span>(<span class="at" style="color: #657422;">values =</span> colors_survived)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/titanic-survival-exercises/titanic-survival-exercises_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<ul>
<li>✅ Age group 18-30.</li>
</ul>
</section>
<section id="which-age-group-had-the-highest-proportion-of-deaths" class="level3">
<h3 class="anchored" data-anchor-id="which-age-group-had-the-highest-proportion-of-deaths">Which age group had the highest proportion of deaths?</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1">titanic2 <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb19-2">  <span class="fu" style="color: #4758AB;">filter</span>(<span class="sc" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;">is.na</span>(<span class="st" style="color: #20794D;">`</span><span class="at" style="color: #657422;">Age group</span><span class="st" style="color: #20794D;">`</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb19-3">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="st" style="color: #20794D;">`</span><span class="at" style="color: #657422;">Age group</span><span class="st" style="color: #20794D;">`</span>, <span class="at" style="color: #657422;">fill =</span> Survived)) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb19-4">  <span class="fu" style="color: #4758AB;">geom_bar</span>(<span class="at" style="color: #657422;">position =</span> <span class="st" style="color: #20794D;">"fill"</span>, <span class="at" style="color: #657422;">width =</span> <span class="fl" style="color: #AD0000;">0.7</span>, <span class="at" style="color: #657422;">color =</span> <span class="st" style="color: #20794D;">"white"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb19-5">  <span class="fu" style="color: #4758AB;">scale_fill_manual</span>(<span class="at" style="color: #657422;">values =</span> colors_survived)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/titanic-survival-exercises/titanic-survival-exercises_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<ul>
<li>✅ Age group 70-80</li>
</ul>
</section>
</section>
<section id="question-6-survival-by-fare" class="level2">
<h2 class="anchored" data-anchor-id="question-6-survival-by-fare">Question 6: Survival by Fare</h2>
<p>Instructions: Filter the data to remove individuals who paid a fare of 0. Make a boxplot of fare grouped by survival status. Try a log2 transformation of fares. Add the data points with jitter and alpha blending.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="fu" style="color: #4758AB;">set.seed</span>(<span class="dv" style="color: #AD0000;">123</span>)</span>
<span id="cb20-2"></span>
<span id="cb20-3">titanic <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(Fare <span class="sc" style="color: #5E5E5E;">!=</span> <span class="dv" style="color: #AD0000;">0</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb20-4">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(Survived, Fare)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb20-5">  <span class="fu" style="color: #4758AB;">geom_boxplot</span>(<span class="at" style="color: #657422;">fill =</span> colors_survived, <span class="at" style="color: #657422;">width =</span> <span class="fl" style="color: #AD0000;">0.5</span>, <span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.5</span>) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb20-6">  <span class="fu" style="color: #4758AB;">geom_jitter</span>(<span class="at" style="color: #657422;">width =</span> <span class="fl" style="color: #AD0000;">0.1</span>, <span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.2</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb20-7">  <span class="fu" style="color: #4758AB;">scale_y_continuous</span>(<span class="at" style="color: #657422;">trans =</span> <span class="st" style="color: #20794D;">"log2"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/titanic-survival-exercises/titanic-survival-exercises_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<p>Which of the following are true?</p>
<p>Select all correct answers.</p>
<ul>
<li>✅ Passengers who survived generally payed higher fares than those who did not survive.</li>
<li>❌ The interquartile range for fares was smaller for passengers who survived.</li>
<li>✅ The median fare was lower for passengers who did not survive.</li>
<li>❌ Only one individual paid a fare around $500. That individual survived. (3 individuals survived)</li>
<li>✅ Most individuals who paid a fare around $8 did not survive.</li>
</ul>
</section>
<section id="question-7-survival-by-passenger-class" class="level2">
<h2 class="anchored" data-anchor-id="question-7-survival-by-passenger-class">Question 7: Survival by Passenger Class</h2>
<p>Instructions: The <code>Pclass</code> variable corresponds to the passenger class. Make three barplots. For the first, make a basic barplot of passenger class filled by survival. For the second, make the same barplot but use the argument <code>position = position_fill()</code> to show relative proportions in each group instead of counts. For the third, make a barplot of survival filled by passenger class using <code>position = position_fill()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1">titanic <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(Pclass, <span class="at" style="color: #657422;">fill =</span> Pclass)) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb21-3">  <span class="fu" style="color: #4758AB;">geom_bar</span>(<span class="at" style="color: #657422;">width =</span> <span class="fl" style="color: #AD0000;">0.7</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb21-4">  <span class="fu" style="color: #4758AB;">geom_text</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">label =</span> ..count..), <span class="at" style="color: #657422;">stat =</span> <span class="st" style="color: #20794D;">"count"</span>, <span class="at" style="color: #657422;">vjust =</span> <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb21-5">  <span class="fu" style="color: #4758AB;">expand_limits</span>(<span class="at" style="color: #657422;">y =</span> <span class="dv" style="color: #AD0000;">530</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb21-6">  <span class="fu" style="color: #4758AB;">ylab</span>(<span class="st" style="color: #20794D;">"count"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/titanic-survival-exercises/titanic-survival-exercises_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1">titanic <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb22-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(Pclass, <span class="at" style="color: #657422;">fill =</span> Survived)) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb22-3">  <span class="fu" style="color: #4758AB;">geom_bar</span>(<span class="at" style="color: #657422;">width =</span> <span class="fl" style="color: #AD0000;">0.7</span>, <span class="at" style="color: #657422;">position =</span> <span class="fu" style="color: #4758AB;">position_fill</span>(), <span class="at" style="color: #657422;">color =</span> <span class="st" style="color: #20794D;">"white"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb22-4">  <span class="fu" style="color: #4758AB;">scale_fill_manual</span>(<span class="at" style="color: #657422;">values =</span> colors_survived)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/titanic-survival-exercises/titanic-survival-exercises_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1">titanic <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb23-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(Pclass, <span class="at" style="color: #657422;">fill =</span> Survived)) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb23-3">  <span class="fu" style="color: #4758AB;">geom_bar</span>(<span class="at" style="color: #657422;">width =</span> <span class="fl" style="color: #AD0000;">0.8</span>, <span class="at" style="color: #657422;">position =</span> <span class="fu" style="color: #4758AB;">position_dodge</span>(<span class="fl" style="color: #AD0000;">0.85</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb23-4">  <span class="fu" style="color: #4758AB;">scale_fill_manual</span>(<span class="at" style="color: #657422;">values =</span> colors_survived)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/titanic-survival-exercises/titanic-survival-exercises_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1">titanic <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb24-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(Survived, <span class="at" style="color: #657422;">fill =</span> Pclass)) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb24-3">  <span class="fu" style="color: #4758AB;">geom_bar</span>(<span class="at" style="color: #657422;">width =</span> <span class="fl" style="color: #AD0000;">0.7</span>, <span class="at" style="color: #657422;">position =</span> <span class="fu" style="color: #4758AB;">position_fill</span>(), <span class="at" style="color: #657422;">color =</span> <span class="st" style="color: #20794D;">"white"</span>) </span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/titanic-survival-exercises/titanic-survival-exercises_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<p>Which of the following are true?</p>
<p>Select all correct answers.</p>
<ul>
<li>✅ There were more third class passengers than passengers in the first two classes combined.</li>
<li>❌ There were the fewest passengers in first class, second-most passengers in second class, and most passengers in third class.</li>
<li>✅ Survival proportion was highest for first class passengers, followed by second class. Third-class had the lowest survival proportion.</li>
<li>✅ Most passengers in first class survived. Most passengers in other classes did not survive.</li>
<li>❌ The majority of survivors were from first class.</li>
<li>✅ The majority of those who did not survive were from third class.</li>
</ul>
</section>
<section id="question-8-survival-by-age-sex-and-passenger-class" class="level2">
<h2 class="anchored" data-anchor-id="question-8-survival-by-age-sex-and-passenger-class">Question 8: Survival by Age, Sex and Passenger Class</h2>
<p>Instructions: Create a grid of density plots for age, filled by survival status, with count on the y-axis, faceted by sex and passenger class.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1">titanic <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb25-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(Age, ..count.., <span class="at" style="color: #657422;">fill =</span> Pclass)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb25-3">  <span class="fu" style="color: #4758AB;">geom_density</span>(<span class="at" style="color: #657422;">alpha=</span><span class="fl" style="color: #AD0000;">0.5</span>) </span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/titanic-survival-exercises/titanic-survival-exercises_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1">titanic <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb26-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(Age, ..count.., <span class="at" style="color: #657422;">fill =</span> Survived)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb26-3">  <span class="fu" style="color: #4758AB;">geom_density</span>(<span class="at" style="color: #657422;">alpha=</span><span class="fl" style="color: #AD0000;">0.5</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb26-4">  <span class="fu" style="color: #4758AB;">facet_grid</span>((Sex <span class="sc" style="color: #5E5E5E;">~</span> Pclass)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb26-5">  <span class="fu" style="color: #4758AB;">scale_fill_manual</span>(<span class="at" style="color: #657422;">values =</span> colors_survived) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb26-6">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">panel.border =</span> <span class="fu" style="color: #4758AB;">element_rect</span>(<span class="at" style="color: #657422;">colour =</span> <span class="st" style="color: #20794D;">"black"</span>, <span class="at" style="color: #657422;">fill =</span> <span class="cn" style="color: #8f5902;">NA</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb26-7">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">legend.position =</span> <span class="st" style="color: #20794D;">"top"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/titanic-survival-exercises/titanic-survival-exercises_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Which of the following are true?</p>
<p>Select all correct answers.</p>
<ul>
<li>✅ The largest group of passengers was third-class males.</li>
<li>❌ The age distribution is the same across passenger classes.</li>
<li>❌ The gender distribution is the same across passenger classes.</li>
<li>✅ Most first-class and second-class females survived.</li>
<li>✅ Almost all second-class males did not survive, with the exception of children.</li>
</ul>
<p><br></p>
<p>That’s all. Thanks for reading!</p>


</section>

 ]]></description>
  <category>R</category>
  <category>ggplot2</category>
  <category>data visualization</category>
  <guid>https://sandrajurela.com/posts/titanic-survival-exercises/titanic-survival-exercises.html</guid>
  <pubDate>Wed, 08 Jun 2022 22:00:00 GMT</pubDate>
  <media:content url="https://sandrajurela.com/posts/titanic-survival-exercises/images/preview.png" medium="image" type="image/png" height="103" width="144"/>
</item>
<item>
  <title>Customer Analysis – Advanced Plots With {ggplot2}</title>
  <dc:creator>Sandra Jurela</dc:creator>
  <link>https://sandrajurela.com/posts/ustomer-analysis-advanced-plots-with-ggplot2/customer-analysis-advanced-plots-with-ggplot2.html</link>
  <description><![CDATA[ 




<section id="part-i---getting-wrangling-data-from-the-database" class="level2">
<h2 class="anchored" data-anchor-id="part-i---getting-wrangling-data-from-the-database">Part I - Getting &amp; wrangling data from the database</h2>
<p>The <strong>Bike Sales</strong> Database represents a <strong>bicycle manufacturer</strong>, including tables for products (bikes), customers (bike shops), and transactions (orders).</p>
<p>It consists of 3 tables:</p>
<ul>
<li><p><strong><code>bikes</code></strong> table, which includes bicycle models, descriptions, and unit prices that are produced by the manufacturer.</p></li>
<li><p><strong><code>bikeshops</code></strong> table, which includes customers that the bicycle manufacturer has sold to.</p></li>
<li><p><strong><code>orderlines</code></strong> table, which includes transactional data such as order ID, order line, date, customer, product, and quantity sold.</p></li>
</ul>
<p><strong><code>bike_sales</code></strong> database is the local Postgres database stored on my machine.</p>
<section id="entity-relationship-diagram" class="level3">
<h3 class="anchored" data-anchor-id="entity-relationship-diagram">Entity Relationship Diagram</h3>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://sandrajurela.com/posts/ustomer-analysis-advanced-plots-with-ggplot2/images/bike_sales_erd.png" class="img-fluid figure-img" width="718"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="setting-up-the-programming-environment" class="level3">
<h3 class="anchored" data-anchor-id="setting-up-the-programming-environment">Setting up the programming environment</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;"># loading packages</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;">library</span>(DBI)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;">library</span>(RPostgres)  </span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;">library</span>(tidyverse)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;">library</span>(lubridate)</span></code></pre></div>
</div>
<p>The <code>sql</code> engine uses the <code>DBI</code> package to execute SQL queries, print their results, and optionally assign the results to a data frame. To use the <code>sql</code> engine, we first need to establish a DBI connection to a database.</p>
</section>
<section id="creating-a-connection-to-the-bike_sales-database" class="level3">
<h3 class="anchored" data-anchor-id="creating-a-connection-to-the-bike_sales-database">Creating a connection to the <code>bike_sales</code> database</h3>
<div class="cell">

</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">mycon <span class="ot" style="color: #003B4F;">&lt;-</span> DBI<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">dbConnect</span>(RPostgres<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">Postgres</span>(), </span>
<span id="cb2-2">                        <span class="at" style="color: #657422;">dbname =</span> <span class="st" style="color: #20794D;">"bike_sales"</span>, </span>
<span id="cb2-3">                        <span class="at" style="color: #657422;">host =</span> <span class="st" style="color: #20794D;">"localhost"</span>,  </span>
<span id="cb2-4">                        <span class="at" style="color: #657422;">port =</span> <span class="st" style="color: #20794D;">"5432"</span>,  </span>
<span id="cb2-5">                        <span class="at" style="color: #657422;">user =</span> <span class="fu" style="color: #4758AB;">getOption</span>(<span class="st" style="color: #20794D;">"database_userid"</span>),</span>
<span id="cb2-6">                        <span class="at" style="color: #657422;">password =</span> <span class="fu" style="color: #4758AB;">getOption</span>(<span class="st" style="color: #20794D;">"database_password"</span>))</span></code></pre></div>
</div>
<p>Check <a href="https://db.rstudio.com/best-practices/managing-credentials/#using-options">here</a> how to hide credentials using <code>options()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">mycon</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;PqConnection&gt; bike_sales@localhost:5432</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;"># list the database table names</span></span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;">dbListTables</span>(mycon)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "bikeshops"  "bikes"      "orderlines"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;"># read the bikeshops table</span></span>
<span id="cb7-2"><span class="fu" style="color: #4758AB;">dbReadTable</span>(mycon, <span class="st" style="color: #20794D;">"bikeshops"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">head</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  bikeshop.id                bikeshop.name       location
1           1 Pittsburgh Mountain Machines Pittsburgh, PA
2           2     Ithaca Mountain Climbers     Ithaca, NY
3           3      Columbus Race Equipment   Columbus, OH
4           4               Detroit Cycles    Detroit, MI
5           5             Cincinnati Speed Cincinnati, OH
6           6    Louisville Race Equipment Louisville, KY</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="co" style="color: #5E5E5E;"># read the bikes table</span></span>
<span id="cb9-2"><span class="fu" style="color: #4758AB;">dbReadTable</span>(mycon, <span class="st" style="color: #20794D;">"bikes"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">head</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  bike.id                          model                description price
1       1        Supersix Evo Black Inc. Road - Elite Road - Carbon 12790
2       2       Supersix Evo Hi-Mod Team Road - Elite Road - Carbon 10660
3       3 Supersix Evo Hi-Mod Dura Ace 1 Road - Elite Road - Carbon  7990
4       4 Supersix Evo Hi-Mod Dura Ace 2 Road - Elite Road - Carbon  5330
5       5     Supersix Evo Hi-Mod Utegra Road - Elite Road - Carbon  4260
6       6               Supersix Evo Red Road - Elite Road - Carbon  3940</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="co" style="color: #5E5E5E;"># read the orderlines table</span></span>
<span id="cb11-2"><span class="fu" style="color: #4758AB;">dbReadTable</span>(mycon, <span class="st" style="color: #20794D;">"orderlines"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">head</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  order.id order.line order.date customer.id product.id quantity
1        1          1 2011-01-07           2         48        1
2        1          2 2011-01-07           2         52        1
3        2          1 2011-01-10          10         76        1
4        2          2 2011-01-10          10         52        1
5        3          1 2011-01-10           6          2        1
6        3          2 2011-01-10           6         50        1</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="co" style="color: #5E5E5E;"># a simple query example</span></span>
<span id="cb13-2"><span class="fu" style="color: #4758AB;">dbGetQuery</span>(mycon, </span>
<span id="cb13-3">          <span class="st" style="color: #20794D;">"SELECT model, price </span></span>
<span id="cb13-4"><span class="st" style="color: #20794D;">           FROM bikes WHERE price &gt; 10000 </span></span>
<span id="cb13-5"><span class="st" style="color: #20794D;">           ORDER BY price DESC"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                     model price
1  Supersix Evo Black Inc. 12790
2    Scalpel-Si Black Inc. 12790
3  Habit Hi-Mod Black Inc. 12250
4          F-Si Black Inc. 11190
5 Supersix Evo Hi-Mod Team 10660</code></pre>
</div>
</div>
</section>
<section id="joining-the-tables" class="level3">
<h3 class="anchored" data-anchor-id="joining-the-tables">Joining the tables</h3>
<p>In all three tables there are dots in column names. This is not a good practice and I first had to figure out how to join the tables without an error! Here is the solution:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">bike_orderlines_joined <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">dbGetQuery</span>(mycon, </span>
<span id="cb15-2"></span>
<span id="cb15-3"><span class="st" style="color: #20794D;">'SELECT * </span></span>
<span id="cb15-4"><span class="st" style="color: #20794D;">FROM orderlines </span></span>
<span id="cb15-5"><span class="st" style="color: #20794D;">LEFT JOIN bikes</span></span>
<span id="cb15-6"><span class="st" style="color: #20794D;">ON orderlines."product.id" = bikes."bike.id"</span></span>
<span id="cb15-7"><span class="st" style="color: #20794D;">LEFT JOIN bikeshops</span></span>
<span id="cb15-8"><span class="st" style="color: #20794D;">ON orderlines."customer.id" = bikeshops."bikeshop.id"'</span>)</span>
<span id="cb15-9"></span>
<span id="cb15-10"><span class="fu" style="color: #4758AB;">head</span>(bike_orderlines_joined)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  order.id order.line order.date customer.id product.id quantity bike.id
1        1          1 2011-01-07           2         48        1      48
2        1          2 2011-01-07           2         52        1      52
3        2          1 2011-01-10          10         76        1      76
4        2          2 2011-01-10          10         52        1      52
5        3          1 2011-01-10           6          2        1       2
6        3          2 2011-01-10           6         50        1      50
                     model                       description price bikeshop.id
1          Jekyll Carbon 2 Mountain - Over Mountain - Carbon  6070           2
2         Trigger Carbon 2 Mountain - Over Mountain - Carbon  5970           2
3      Beast of the East 1       Mountain - Trail - Aluminum  2770          10
4         Trigger Carbon 2 Mountain - Over Mountain - Carbon  5970          10
5 Supersix Evo Hi-Mod Team        Road - Elite Road - Carbon 10660           6
6          Jekyll Carbon 4 Mountain - Over Mountain - Carbon  3200           6
              bikeshop.name        location
1  Ithaca Mountain Climbers      Ithaca, NY
2  Ithaca Mountain Climbers      Ithaca, NY
3         Kansas City 29ers Kansas City, KS
4         Kansas City 29ers Kansas City, KS
5 Louisville Race Equipment  Louisville, KY
6 Louisville Race Equipment  Louisville, KY</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="fu" style="color: #4758AB;">glimpse</span>(bike_orderlines_joined)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 15,644
Columns: 13
$ order.id      &lt;dbl&gt; 1, 1, 2, 2, 3, 3, 3, 3, 3, 4, 5, 5, 5, 5, 6, 6, 6, 6, 7,…
$ order.line    &lt;dbl&gt; 1, 2, 1, 2, 1, 2, 3, 4, 5, 1, 1, 2, 3, 4, 1, 2, 3, 4, 1,…
$ order.date    &lt;date&gt; 2011-01-07, 2011-01-07, 2011-01-10, 2011-01-10, 2011-01…
$ customer.id   &lt;dbl&gt; 2, 2, 10, 10, 6, 6, 6, 6, 6, 22, 8, 8, 8, 8, 16, 16, 16,…
$ product.id    &lt;dbl&gt; 48, 52, 76, 52, 2, 50, 1, 4, 34, 26, 96, 66, 35, 72, 45,…
$ quantity      &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1,…
$ bike.id       &lt;dbl&gt; 48, 52, 76, 52, 2, 50, 1, 4, 34, 26, 96, 66, 35, 72, 45,…
$ model         &lt;chr&gt; "Jekyll Carbon 2", "Trigger Carbon 2", "Beast of the Eas…
$ description   &lt;chr&gt; "Mountain - Over Mountain - Carbon", "Mountain - Over Mo…
$ price         &lt;dbl&gt; 6070, 5970, 2770, 5970, 10660, 3200, 12790, 5330, 1570, …
$ bikeshop.id   &lt;dbl&gt; 2, 2, 10, 10, 6, 6, 6, 6, 6, 22, 8, 8, 8, 8, 16, 16, 16,…
$ bikeshop.name &lt;chr&gt; "Ithaca Mountain Climbers", "Ithaca Mountain Climbers", …
$ location      &lt;chr&gt; "Ithaca, NY", "Ithaca, NY", "Kansas City, KS", "Kansas C…</code></pre>
</div>
</div>
<p>Here I wanted to show how to query a database in an R code chunk. Alternatively, I could have run SQL code in an R Markdown code chunk and send the query output to an R dataframe with <code>output.var</code> = “bike_orderlines_joined” in the code chunk options. I have already shown this method in the first three posts.</p>
<p>The alternative solution would look like this:</p>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb19-1">```{sql connection = mycon, output.var = "bike_orderlines_joined"}</span>
<span id="cb19-2"></span>
<span id="cb19-3">SELECT * </span>
<span id="cb19-4">FROM orderlines </span>
<span id="cb19-5">LEFT JOIN bikes</span>
<span id="cb19-6">ON orderlines."product.id" = bikes."bike.id"</span>
<span id="cb19-7">LEFT JOIN bikeshops</span>
<span id="cb19-8">ON orderlines."customer.id" = bikeshops."bikeshop.id"</span></code></pre></div>
<p>Now that I have joined the tables I am going to disconnect from the database.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="fu" style="color: #4758AB;">dbDisconnect</span>(mycon)</span></code></pre></div>
</div>
</section>
<section id="data-wrangling" class="level3">
<h3 class="anchored" data-anchor-id="data-wrangling">Data wrangling</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1">bike_orderlines <span class="ot" style="color: #003B4F;">&lt;-</span> bike_orderlines_joined <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-2">  <span class="co" style="color: #5E5E5E;"># rename columns - replacing "." with "_"</span></span>
<span id="cb21-3">  <span class="fu" style="color: #4758AB;">set_names</span>(<span class="fu" style="color: #4758AB;">names</span>(.) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">str_replace_all</span>(<span class="st" style="color: #20794D;">"</span><span class="sc" style="color: #5E5E5E;">\\</span><span class="st" style="color: #20794D;">."</span>, <span class="st" style="color: #20794D;">"_"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-4">  <span class="co" style="color: #5E5E5E;"># remove the unnecessary columns </span></span>
<span id="cb21-5">  <span class="fu" style="color: #4758AB;">select</span>(<span class="sc" style="color: #5E5E5E;">-</span><span class="fu" style="color: #4758AB;">c</span>(customer_id, product_id, bike_id, bikeshop_id)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-6">  <span class="co" style="color: #5E5E5E;"># separate description into category_1, category_2, and frame_material</span></span>
<span id="cb21-7">  <span class="fu" style="color: #4758AB;">separate</span>(description, </span>
<span id="cb21-8">           <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"category_1"</span>, <span class="st" style="color: #20794D;">"category_2"</span>, <span class="st" style="color: #20794D;">"frame_material"</span>),</span>
<span id="cb21-9">           <span class="at" style="color: #657422;">sep =</span> <span class="st" style="color: #20794D;">" - "</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-10">  <span class="co" style="color: #5E5E5E;"># separate location into city and state</span></span>
<span id="cb21-11">  <span class="fu" style="color: #4758AB;">separate</span>(location,</span>
<span id="cb21-12">           <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"city"</span>, <span class="st" style="color: #20794D;">"state"</span>),</span>
<span id="cb21-13">           <span class="at" style="color: #657422;">sep =</span> <span class="st" style="color: #20794D;">", "</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb21-14">  <span class="co" style="color: #5E5E5E;"># create a new column total_price</span></span>
<span id="cb21-15">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">total_price =</span> price <span class="sc" style="color: #5E5E5E;">*</span> quantity) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-16">  <span class="co" style="color: #5E5E5E;"># reorder columns</span></span>
<span id="cb21-17">  <span class="fu" style="color: #4758AB;">select</span>(<span class="fu" style="color: #4758AB;">contains</span>(<span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"date"</span>, <span class="st" style="color: #20794D;">"id"</span>, <span class="st" style="color: #20794D;">"order"</span>)),</span>
<span id="cb21-18">         quantity, price, total_price,</span>
<span id="cb21-19">         <span class="fu" style="color: #4758AB;">everything</span>()) </span>
<span id="cb21-20"></span>
<span id="cb21-21">bike_orderlines <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">head</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  order_date order_id order_line quantity price total_price
1 2011-01-07        1          1        1  6070        6070
2 2011-01-07        1          2        1  5970        5970
3 2011-01-10        2          1        1  2770        2770
4 2011-01-10        2          2        1  5970        5970
5 2011-01-10        3          1        1 10660       10660
6 2011-01-10        3          2        1  3200        3200
                     model category_1    category_2 frame_material
1          Jekyll Carbon 2   Mountain Over Mountain         Carbon
2         Trigger Carbon 2   Mountain Over Mountain         Carbon
3      Beast of the East 1   Mountain         Trail       Aluminum
4         Trigger Carbon 2   Mountain Over Mountain         Carbon
5 Supersix Evo Hi-Mod Team       Road    Elite Road         Carbon
6          Jekyll Carbon 4   Mountain Over Mountain         Carbon
              bikeshop_name        city state
1  Ithaca Mountain Climbers      Ithaca    NY
2  Ithaca Mountain Climbers      Ithaca    NY
3         Kansas City 29ers Kansas City    KS
4         Kansas City 29ers Kansas City    KS
5 Louisville Race Equipment  Louisville    KY
6 Louisville Race Equipment  Louisville    KY</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1">bike_orderlines <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">glimpse</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 15,644
Columns: 13
$ order_date     &lt;date&gt; 2011-01-07, 2011-01-07, 2011-01-10, 2011-01-10, 2011-0…
$ order_id       &lt;dbl&gt; 1, 1, 2, 2, 3, 3, 3, 3, 3, 4, 5, 5, 5, 5, 6, 6, 6, 6, 7…
$ order_line     &lt;dbl&gt; 1, 2, 1, 2, 1, 2, 3, 4, 5, 1, 1, 2, 3, 4, 1, 2, 3, 4, 1…
$ quantity       &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1…
$ price          &lt;dbl&gt; 6070, 5970, 2770, 5970, 10660, 3200, 12790, 5330, 1570,…
$ total_price    &lt;dbl&gt; 6070, 5970, 2770, 5970, 10660, 3200, 12790, 5330, 1570,…
$ model          &lt;chr&gt; "Jekyll Carbon 2", "Trigger Carbon 2", "Beast of the Ea…
$ category_1     &lt;chr&gt; "Mountain", "Mountain", "Mountain", "Mountain", "Road",…
$ category_2     &lt;chr&gt; "Over Mountain", "Over Mountain", "Trail", "Over Mounta…
$ frame_material &lt;chr&gt; "Carbon", "Carbon", "Aluminum", "Carbon", "Carbon", "Ca…
$ bikeshop_name  &lt;chr&gt; "Ithaca Mountain Climbers", "Ithaca Mountain Climbers",…
$ city           &lt;chr&gt; "Ithaca", "Ithaca", "Kansas City", "Kansas City", "Loui…
$ state          &lt;chr&gt; "NY", "NY", "KS", "KS", "KY", "KY", "KY", "KY", "KY", "…</code></pre>
</div>
</div>
</section>
</section>
<section id="part-ii---advanced-plots-with-ggplot2" class="level1">
<h1>Part II - Advanced plots with <code>ggplot2</code></h1>
<p>I will continue to work with the <code>bike_orderlines</code> dataframe and create two useful plots.</p>
<section id="lollipop-chart-top-n-customers" class="level2">
<h2 class="anchored" data-anchor-id="lollipop-chart-top-n-customers">Lollipop Chart: Top N Customers</h2>
<p>Question: How much purchasing power is in top 10 customers?</p>
<p>Goal is to visualize top N customers in terms of Revenue, including cumulative percentage.</p>
<section id="data-manipulation" class="level3">
<h3 class="anchored" data-anchor-id="data-manipulation">Data manipulation</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1">n <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="dv" style="color: #AD0000;">10</span></span>
<span id="cb25-2"></span>
<span id="cb25-3">top_customers <span class="ot" style="color: #003B4F;">&lt;-</span> bike_orderlines <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb25-4">  <span class="fu" style="color: #4758AB;">select</span>(bikeshop_name, total_price) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb25-5">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">bikeshop_name =</span> <span class="fu" style="color: #4758AB;">as_factor</span>(bikeshop_name) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">fct_lump_n</span>(<span class="at" style="color: #657422;">n =</span> n, <span class="at" style="color: #657422;">w =</span> total_price)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb25-6">  <span class="fu" style="color: #4758AB;">group_by</span>(bikeshop_name) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb25-7">  <span class="fu" style="color: #4758AB;">summarise</span>(<span class="at" style="color: #657422;">revenue =</span> <span class="fu" style="color: #4758AB;">sum</span>(total_price)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb25-8">  <span class="fu" style="color: #4758AB;">ungroup</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb25-9">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">bikeshop_name =</span> bikeshop_name <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">fct_reorder</span>(revenue)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb25-10">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">bikeshop_name =</span> bikeshop_name <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">fct_relevel</span>(<span class="st" style="color: #20794D;">"Other"</span>, <span class="at" style="color: #657422;">after =</span> <span class="dv" style="color: #AD0000;">0</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb25-11">  <span class="fu" style="color: #4758AB;">arrange</span>(<span class="fu" style="color: #4758AB;">desc</span>(bikeshop_name)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb25-12">  <span class="co" style="color: #5E5E5E;"># revenue text</span></span>
<span id="cb25-13">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">revenue_text =</span> scales<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">dollar</span>(revenue, <span class="at" style="color: #657422;">scale =</span> <span class="fl" style="color: #AD0000;">1e-06</span>, <span class="at" style="color: #657422;">suffix =</span> <span class="st" style="color: #20794D;">"M"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb25-14">  <span class="co" style="color: #5E5E5E;"># cumulative percent</span></span>
<span id="cb25-15">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">cum_pct =</span> <span class="fu" style="color: #4758AB;">cumsum</span>(revenue) <span class="sc" style="color: #5E5E5E;">/</span> <span class="fu" style="color: #4758AB;">sum</span>(revenue)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb25-16">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">cum_pct_text =</span> scales<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">percent</span>(cum_pct)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb25-17">  <span class="co" style="color: #5E5E5E;"># rank</span></span>
<span id="cb25-18">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">rank =</span> <span class="fu" style="color: #4758AB;">row_number</span>()) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb25-19">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">rank =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(rank <span class="sc" style="color: #5E5E5E;">==</span> <span class="fu" style="color: #4758AB;">max</span>(rank), <span class="cn" style="color: #8f5902;">NA_integer_</span>, rank)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb25-20">  <span class="co" style="color: #5E5E5E;"># label text</span></span>
<span id="cb25-21">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">label_text =</span> <span class="fu" style="color: #4758AB;">str_glue</span>(<span class="st" style="color: #20794D;">"Rank: {rank}</span><span class="sc" style="color: #5E5E5E;">\n</span><span class="st" style="color: #20794D;">Rev: {revenue_text}</span><span class="sc" style="color: #5E5E5E;">\n</span><span class="st" style="color: #20794D;">CumPct: {cum_pct_text}"</span>)) </span>
<span id="cb25-22"></span>
<span id="cb25-23">top_customers</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 7
   bikeshop_name                 revenue revenue…¹ cum_pct cum_p…²  rank label…³
   &lt;fct&gt;                           &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;   &lt;int&gt; &lt;glue&gt; 
 1 Kansas City 29ers            11535455 $11.54M     0.162 16.2%       1 Rank: …
 2 Denver Bike Shop              7697670 $7.70M      0.271 27.1%       2 Rank: …
 3 Ithaca Mountain Climbers      6299335 $6.30M      0.359 35.9%       3 Rank: …
 4 Phoenix Bi-peds               4168535 $4.17M      0.418 41.8%       4 Rank: …
 5 Oklahoma City Race Equipment  3450040 $3.45M      0.467 46.7%       5 Rank: …
 6 Las Vegas Cycles              3073615 $3.07M      0.510 51.0%       6 Rank: …
 7 New Orleans Velocipedes       2761825 $2.76M      0.549 54.9%       7 Rank: …
 8 Wichita Speed                 2380385 $2.38M      0.582 58.2%       8 Rank: …
 9 Miami Race Equipment          2057130 $2.06M      0.611 61.1%       9 Rank: …
10 Minneapolis Bike Shop         2023220 $2.02M      0.640 64.0%      10 Rank: …
11 Other                        25585120 $25.59M     1     100.0%     NA Rank: …
# … with abbreviated variable names ¹​revenue_text, ²​cum_pct_text, ³​label_text</code></pre>
</div>
</div>
</section>
<section id="data-visualization" class="level3">
<h3 class="anchored" data-anchor-id="data-visualization">Data visualization</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1">top_customers <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb27-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(revenue, bikeshop_name)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb27-3">  <span class="co" style="color: #5E5E5E;"># geometries</span></span>
<span id="cb27-4">  <span class="fu" style="color: #4758AB;">geom_segment</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">xend =</span> <span class="dv" style="color: #AD0000;">0</span>, <span class="at" style="color: #657422;">yend =</span> bikeshop_name), </span>
<span id="cb27-5">               <span class="at" style="color: #657422;">color =</span> RColorBrewer<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">brewer.pal</span>(<span class="at" style="color: #657422;">n =</span> <span class="dv" style="color: #AD0000;">9</span>, <span class="at" style="color: #657422;">name =</span> <span class="st" style="color: #20794D;">"Set1"</span>)[<span class="dv" style="color: #AD0000;">1</span>],</span>
<span id="cb27-6">               <span class="at" style="color: #657422;">size =</span> <span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb27-7">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="at" style="color: #657422;">color =</span> RColorBrewer<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">brewer.pal</span>(<span class="at" style="color: #657422;">n =</span> <span class="dv" style="color: #AD0000;">9</span>, <span class="at" style="color: #657422;">name =</span> <span class="st" style="color: #20794D;">"Set1"</span>)[<span class="dv" style="color: #AD0000;">1</span>], </span>
<span id="cb27-8">             <span class="at" style="color: #657422;">size =</span> <span class="dv" style="color: #AD0000;">3</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb27-9">  <span class="fu" style="color: #4758AB;">geom_label</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">label =</span> label_text), </span>
<span id="cb27-10">             <span class="at" style="color: #657422;">hjust =</span> <span class="st" style="color: #20794D;">"left"</span>, </span>
<span id="cb27-11">             <span class="at" style="color: #657422;">size =</span> <span class="dv" style="color: #AD0000;">3</span>,</span>
<span id="cb27-12">             <span class="at" style="color: #657422;">nudge_x =</span> <span class="fl" style="color: #AD0000;">0.8e+06</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb27-13">  <span class="co" style="color: #5E5E5E;"># formatting</span></span>
<span id="cb27-14">  <span class="fu" style="color: #4758AB;">scale_x_continuous</span>(<span class="at" style="color: #657422;">labels =</span> scales<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">dollar_format</span>(<span class="at" style="color: #657422;">scale =</span> <span class="fl" style="color: #AD0000;">1e-06</span>, <span class="at" style="color: #657422;">suffix =</span> <span class="st" style="color: #20794D;">"M"</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb27-15">  <span class="fu" style="color: #4758AB;">labs</span>(<span class="at" style="color: #657422;">title =</span> <span class="fu" style="color: #4758AB;">str_glue</span>(<span class="st" style="color: #20794D;">"Top {n} customers in terms of revenue, with cumulative percentage"</span>),</span>
<span id="cb27-16">       <span class="at" style="color: #657422;">subtitle =</span> <span class="fu" style="color: #4758AB;">str_glue</span>(<span class="st" style="color: #20794D;">"Top {n} customers contribute {top_customers$cum_pct_text[n]} of purchasing power."</span>),</span>
<span id="cb27-17">       <span class="at" style="color: #657422;">x =</span> <span class="st" style="color: #20794D;">"Revenue ($M)"</span>,</span>
<span id="cb27-18">       <span class="at" style="color: #657422;">y =</span> <span class="st" style="color: #20794D;">"Customer"</span>,</span>
<span id="cb27-19">       <span class="at" style="color: #657422;">caption =</span> <span class="fu" style="color: #4758AB;">str_glue</span>(<span class="st" style="color: #20794D;">"Year: {year(min(bike_orderlines$order_date))} - {year(max(bike_orderlines$order_date))}"</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb27-20">  <span class="fu" style="color: #4758AB;">expand_limits</span>(<span class="at" style="color: #657422;">x =</span> <span class="fu" style="color: #4758AB;">max</span>(top_customers<span class="sc" style="color: #5E5E5E;">$</span>revenue) <span class="sc" style="color: #5E5E5E;">+</span> <span class="fl" style="color: #AD0000;">6e+06</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb27-21">  <span class="co" style="color: #5E5E5E;"># theme</span></span>
<span id="cb27-22">  <span class="fu" style="color: #4758AB;">theme_bw</span>() </span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/ustomer-analysis-advanced-plots-with-ggplot2/customer-analysis-advanced-plots-with-ggplot2_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="864"></p>
</div>
</div>
</section>
</section>
<section id="heatmap-customers-purchasing-habits" class="level2">
<h2 class="anchored" data-anchor-id="heatmap-customers-purchasing-habits">Heatmap: Customers’ Purchasing Habits</h2>
<p>Question: Do specific customers have a purchasing preference?</p>
<p>Goal is to visualize heatmap of proportion of sales by Secondary Product Category.</p>
<section id="data-manipulation-1" class="level3">
<h3 class="anchored" data-anchor-id="data-manipulation-1">Data manipulation</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1">pct_sales_by_customer <span class="ot" style="color: #003B4F;">&lt;-</span> bike_orderlines <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb28-2">  <span class="fu" style="color: #4758AB;">select</span>(bikeshop_name, category_1, category_2, quantity) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb28-3">  <span class="fu" style="color: #4758AB;">group_by</span>(bikeshop_name, category_1, category_2) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb28-4">  <span class="fu" style="color: #4758AB;">summarise</span>(<span class="at" style="color: #657422;">total_qty =</span> <span class="fu" style="color: #4758AB;">sum</span>(quantity)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb28-5">  <span class="fu" style="color: #4758AB;">ungroup</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb28-6">  <span class="fu" style="color: #4758AB;">group_by</span>(bikeshop_name) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb28-7">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">pct =</span> total_qty <span class="sc" style="color: #5E5E5E;">/</span> <span class="fu" style="color: #4758AB;">sum</span>(total_qty)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb28-8">  <span class="fu" style="color: #4758AB;">ungroup</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb28-9">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">bikeshop_name =</span> <span class="fu" style="color: #4758AB;">as.factor</span>(bikeshop_name) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">fct_rev</span>()) <span class="sc" style="color: #5E5E5E;">%&gt;%</span>  </span>
<span id="cb28-10">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">bikeshop_name_num =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(bikeshop_name))</span>
<span id="cb28-11">    </span>
<span id="cb28-12">pct_sales_by_customer   </span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 270 × 6
   bikeshop_name      category_1 category_2         total_qty    pct bikeshop_…¹
   &lt;fct&gt;              &lt;chr&gt;      &lt;chr&gt;                  &lt;dbl&gt;  &lt;dbl&gt;       &lt;dbl&gt;
 1 Albuquerque Cycles Mountain   Cross Country Race        48 0.168           30
 2 Albuquerque Cycles Mountain   Fat Bike                   9 0.0315          30
 3 Albuquerque Cycles Mountain   Over Mountain             13 0.0455          30
 4 Albuquerque Cycles Mountain   Sport                     35 0.122           30
 5 Albuquerque Cycles Mountain   Trail                     38 0.133           30
 6 Albuquerque Cycles Road       Cyclocross                 7 0.0245          30
 7 Albuquerque Cycles Road       Elite Road                69 0.241           30
 8 Albuquerque Cycles Road       Endurance Road            54 0.189           30
 9 Albuquerque Cycles Road       Triathalon                13 0.0455          30
10 Ann Arbor Speed    Mountain   Cross Country Race        32 0.0532          29
# … with 260 more rows, and abbreviated variable name ¹​bikeshop_name_num</code></pre>
</div>
</div>
</section>
<section id="data-visualization-1" class="level3">
<h3 class="anchored" data-anchor-id="data-visualization-1">Data visualization</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1">pct_sales_by_customer <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb30-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(category_2, bikeshop_name)) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb30-3">  <span class="co" style="color: #5E5E5E;"># geometries</span></span>
<span id="cb30-4">  <span class="fu" style="color: #4758AB;">geom_tile</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">fill =</span> pct)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb30-5">  <span class="fu" style="color: #4758AB;">geom_text</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">label =</span> scales<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">percent</span>(pct, <span class="at" style="color: #657422;">accuracy =</span> <span class="fl" style="color: #AD0000;">0.1</span>)),</span>
<span id="cb30-6">            <span class="at" style="color: #657422;">size =</span> <span class="dv" style="color: #AD0000;">3</span>,</span>
<span id="cb30-7">            <span class="at" style="color: #657422;">color =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(pct_sales_by_customer<span class="sc" style="color: #5E5E5E;">$</span>pct <span class="sc" style="color: #5E5E5E;">&gt;=</span> <span class="fl" style="color: #AD0000;">0.15</span>, <span class="st" style="color: #20794D;">"white"</span>, <span class="st" style="color: #20794D;">"black"</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb30-8">  <span class="fu" style="color: #4758AB;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;">~</span> category_1, <span class="at" style="color: #657422;">scales =</span> <span class="st" style="color: #20794D;">"free_x"</span>) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb30-9">  <span class="co" style="color: #5E5E5E;"># formatting</span></span>
<span id="cb30-10">  <span class="fu" style="color: #4758AB;">scale_fill_gradient</span>(<span class="at" style="color: #657422;">low =</span> <span class="st" style="color: #20794D;">"white"</span>, <span class="at" style="color: #657422;">high =</span> tidyquant<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">palette_light</span>()[<span class="dv" style="color: #AD0000;">1</span>]) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb30-11">  <span class="fu" style="color: #4758AB;">labs</span>(<span class="at" style="color: #657422;">title =</span> <span class="st" style="color: #20794D;">"Heatmap of Purchasing Habits"</span>, </span>
<span id="cb30-12">       <span class="at" style="color: #657422;">subtitle =</span> <span class="fu" style="color: #4758AB;">str_glue</span>(<span class="st" style="color: #20794D;">"Year: {year(min(bike_orderlines$order_date))} - {year(max(bike_orderlines$order_date))}"</span>),</span>
<span id="cb30-13">       <span class="at" style="color: #657422;">x =</span> <span class="st" style="color: #20794D;">"Bike Type"</span>,</span>
<span id="cb30-14">       <span class="at" style="color: #657422;">y =</span> <span class="st" style="color: #20794D;">"Customer"</span>) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb30-15">  <span class="co" style="color: #5E5E5E;"># theme</span></span>
<span id="cb30-16">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">legend.position =</span> <span class="st" style="color: #20794D;">"none"</span>,</span>
<span id="cb30-17">        <span class="at" style="color: #657422;">axis.text.x =</span> <span class="fu" style="color: #4758AB;">element_text</span>(<span class="at" style="color: #657422;">angle =</span> <span class="dv" style="color: #AD0000;">45</span>, <span class="at" style="color: #657422;">hjust =</span> <span class="dv" style="color: #AD0000;">1</span>),</span>
<span id="cb30-18">        <span class="at" style="color: #657422;">plot.title =</span> <span class="fu" style="color: #4758AB;">element_text</span>(<span class="at" style="color: #657422;">face =</span> <span class="st" style="color: #20794D;">"bold"</span>),</span>
<span id="cb30-19">        <span class="at" style="color: #657422;">strip.background =</span> <span class="fu" style="color: #4758AB;">element_rect</span>(<span class="at" style="color: #657422;">fill =</span> tidyquant<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">palette_light</span>()[<span class="dv" style="color: #AD0000;">1</span>], </span>
<span id="cb30-20">                                        <span class="at" style="color: #657422;">color =</span> <span class="st" style="color: #20794D;">"white"</span>), </span>
<span id="cb30-21">        <span class="at" style="color: #657422;">strip.text =</span> <span class="fu" style="color: #4758AB;">element_text</span>(<span class="at" style="color: #657422;">color =</span> <span class="st" style="color: #20794D;">"white"</span>, <span class="at" style="color: #657422;">size =</span> <span class="dv" style="color: #AD0000;">11</span>), </span>
<span id="cb30-22">        <span class="at" style="color: #657422;">panel.background =</span> <span class="fu" style="color: #4758AB;">element_rect</span>(<span class="at" style="color: #657422;">fill =</span> <span class="st" style="color: #20794D;">"white"</span>))</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/ustomer-analysis-advanced-plots-with-ggplot2/customer-analysis-advanced-plots-with-ggplot2_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="864"></p>
</div>
</div>
<p>Top 3 customers that prefer mountain bikes:</p>
<ul>
<li>Ithaca Mountain Climbers</li>
<li>Pittsburgh Mountain Machines</li>
<li>Tampa 29ers</li>
</ul>
<p>Top 3 customers that prefer road bikes:</p>
<ul>
<li>Ann Arbor Speed</li>
<li>Austin Cruisers</li>
<li>Indianapolis Velocipedes</li>
</ul>
<p><br></p>
<p>That’s it! I hope you like it. For those wondering where I learned to make these plots… in a fantastic course <a href="https://university.business-science.io/p/ds4b-101-r-business-analysis-r">Data Science for Business Part 1</a> by <a href="https://www.linkedin.com/in/mattdancho/">Matt Dancho</a>.</p>


</section>
</section>
</section>

 ]]></description>
  <category>data cleaning</category>
  <category>data manipulation</category>
  <category>data visualization</category>
  <category>SQL</category>
  <category>PostgreSQL</category>
  <category>R</category>
  <guid>https://sandrajurela.com/posts/ustomer-analysis-advanced-plots-with-ggplot2/customer-analysis-advanced-plots-with-ggplot2.html</guid>
  <pubDate>Thu, 19 May 2022 22:00:00 GMT</pubDate>
  <media:content url="https://sandrajurela.com/posts/ustomer-analysis-advanced-plots-with-ggplot2/images/preview.png" medium="image" type="image/png" height="144" width="144"/>
</item>
</channel>
</rss>
