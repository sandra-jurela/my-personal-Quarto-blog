<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Sandra Jurela</title>
<link>https://sandrajurela.com/index.html</link>
<atom:link href="https://sandrajurela.com/index.xml" rel="self" type="application/rss+xml"/>
<description>This is an extraordinary blog built by Sandra Jurela</description>
<image>
<url>https://sandrajurela.com/img/profile.jpg</url>
<title>Sandra Jurela</title>
<link>https://sandrajurela.com/index.html</link>
</image>
<generator>quarto-1.2.313</generator>
<lastBuildDate>Tue, 28 Feb 2023 23:00:00 GMT</lastBuildDate>
<item>
  <title>Shiny App - Mass Shootings in the USA</title>
  <dc:creator>Sandra Jurela</dc:creator>
  <link>https://sandrajurela.com/posts/shiny-mass-shootings/mass-shootings.html</link>
  <description><![CDATA[ 




<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Mass shootings have been a topic of intense discussion in the United States. A public ‚Äúdatabase‚Äù of mass shootings since 1982 has been made available by the <a href="https://www.motherjones.com/politics/2012/12/mass-shootings-mother-jones-full-data/">Mother Jones</a>, a non-profit organization. This ‚Äúdatabase‚Äù is stored in a Google spreadsheet. You can view it <a href="https://docs.google.com/spreadsheets/d/1b9o6uDO18sLxBqPwl_Gh9bnhW-ev_dABH83M5Vb5L8o/edit#gid=0">here</a> and download as a CSV file.</p>
<p>There are many definitions of mass shooting. Here is what <a href="https://www.britannica.com/topic/mass-shooting">Britannica</a> has to say:</p>
<blockquote class="blockquote">
<p><em><strong>Mass shooting</strong>, also called <strong>active shooter incident</strong>, as defined by the U.S. <a href="https://www.britannica.com/topic/Federal-Bureau-of-Investigation">Federal Bureau of Investigation</a> (FBI), an event in which one or more individuals are ‚Äúactively engaged in killing or attempting to kill people in a populated area. Implicit in this definition is the shooter‚Äôs use of a firearm.‚Äù The FBI has not set a minimum number of casualties to qualify an event as a mass shooting, but U.S. statute (the Investigative Assistance for Violent Crimes Act of 2012) defines a ‚Äúmass killing‚Äù as <strong>‚Äú3 or more killings in a single incident‚Äù.</strong></em></p>
</blockquote>
</section>
<section id="data-overview" class="level2">
<h2 class="anchored" data-anchor-id="data-overview">Data overview</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;">library</span>(tidyverse)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;">library</span>(tidygeocoder)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;">library</span>(plotly)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;">theme_set</span>(<span class="fu" style="color: #4758AB;">theme_classic</span>())</span>
<span id="cb1-5"></span>
<span id="cb1-6">mass_shootings <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">read_csv</span>(<span class="st" style="color: #20794D;">"data/mass_shootings_usa_1982-2023.csv"</span>)</span>
<span id="cb1-7"></span>
<span id="cb1-8">mass_shootings <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">glimpse</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 140
Columns: 24
$ case                             &lt;chr&gt; "Michigan State University shooting",‚Ä¶
$ location...2                     &lt;chr&gt; "East Lansing, Michigan", "Half Moon ‚Ä¶
$ date                             &lt;date&gt; 2023-02-13, 2023-01-23, 2023-01-21, ‚Ä¶
$ summary                          &lt;chr&gt; "Anthony D. McRae, 43, opened fire at‚Ä¶
$ fatalities                       &lt;dbl&gt; 3, 7, 11, 6, 5, 3, 5, 3, 7, 3, 3, 4, ‚Ä¶
$ injured                          &lt;chr&gt; "5", "1", "10", "6", "25", "2", "2", ‚Ä¶
$ total_victims                    &lt;chr&gt; "8", "8", "21", "12", "30", "5", "7",‚Ä¶
$ location...8                     &lt;chr&gt; "School", "workplace", "Other", "Work‚Ä¶
$ age_of_shooter                   &lt;chr&gt; "43", "67", "72", "31", "22", "22", "‚Ä¶
$ prior_signs_mental_health_issues &lt;chr&gt; "-", "-", "yes", "-", "yes", "-", "-"‚Ä¶
$ mental_health_details            &lt;chr&gt; "-", "-", "According to the LA Times,‚Ä¶
$ weapons_obtained_legally         &lt;chr&gt; "yes", "-", "-", "-", "-", "yes", "-"‚Ä¶
$ where_obtained                   &lt;chr&gt; "-", "-", "-", "-", "-", "Dance's Spo‚Ä¶
$ weapon_type                      &lt;chr&gt; "semiautomatic handguns", "semiautoma‚Ä¶
$ weapon_details                   &lt;chr&gt; "-", "-", "-", "-", "-", "Glock 45 9m‚Ä¶
$ race                             &lt;chr&gt; "Black", "Asian", "Asian", "Black", "‚Ä¶
$ gender                           &lt;chr&gt; "M", "M", "M", "M", "M", "M", "M", "M‚Ä¶
$ sources                          &lt;chr&gt; "https://www.cnn.com/us/live-news/mic‚Ä¶
$ mental_health_sources            &lt;chr&gt; "-", "-", "https://www.latimes.com/ca‚Ä¶
$ sources_additional_age           &lt;chr&gt; "-", "-", "-", "-", "-", "-", "-", "-‚Ä¶
$ latitude                         &lt;chr&gt; "-", "-", "-", "-", "-", "-", "-", "-‚Ä¶
$ longitude                        &lt;chr&gt; "-", "-", "-", "-", "-", "-", "-", "-‚Ä¶
$ type                             &lt;chr&gt; "Mass", "Spree", "Mass", "Mass", "Mas‚Ä¶
$ year                             &lt;dbl&gt; 2023, 2023, 2023, 2022, 2022, 2022, 2‚Ä¶</code></pre>
</div>
</div>
<p>We have 140 cases, described with 24 variables. At first glance, this dataset clearly needs extensive cleaning.</p>
</section>
<section id="data-cleaning" class="level2">
<h2 class="anchored" data-anchor-id="data-cleaning">Data cleaning</h2>
<section id="step-1.-initial-cleaning" class="level3">
<h3 class="anchored" data-anchor-id="step-1.-initial-cleaning">üßπ Step 1. Initial cleaning</h3>
<p>The first cleaning step includes:</p>
<ul>
<li>selecting columns of interest,</li>
<li>replacing the character value<code>"-"</code> with <code>NA</code> in all columns with character data type,</li>
<li>renaming location columns,</li>
<li>converting character data type to numeric for specific columns.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">mass_shootings_cln <span class="ot" style="color: #003B4F;">&lt;-</span> mass_shootings <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-2">  <span class="fu" style="color: #4758AB;">select</span>(<span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">6</span>, <span class="dv" style="color: #AD0000;">8</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">10</span>, <span class="dv" style="color: #AD0000;">12</span>, <span class="dv" style="color: #AD0000;">16</span>, <span class="dv" style="color: #AD0000;">17</span>, <span class="dv" style="color: #AD0000;">21</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">24</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-3">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="fu" style="color: #4758AB;">across</span>(<span class="fu" style="color: #4758AB;">where</span>(is.character), <span class="sc" style="color: #5E5E5E;">~</span><span class="fu" style="color: #4758AB;">na_if</span>(., <span class="st" style="color: #20794D;">"-"</span>))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-4">  <span class="fu" style="color: #4758AB;">rename</span>(<span class="at" style="color: #657422;">location =</span> location...<span class="dv" style="color: #AD0000;">2</span>, <span class="at" style="color: #657422;">location_2 =</span> location...<span class="dv" style="color: #AD0000;">8</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-5">  <span class="fu" style="color: #4758AB;">mutate_at</span>(<span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"injured"</span>, <span class="st" style="color: #20794D;">"age_of_shooter"</span>, <span class="st" style="color: #20794D;">"latitude"</span>, <span class="st" style="color: #20794D;">"longitude"</span>), as.numeric)</span>
<span id="cb3-6">  </span>
<span id="cb3-7">mass_shootings_cln <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">glimpse</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 140
Columns: 16
$ case                             &lt;chr&gt; "Michigan State University shooting",‚Ä¶
$ location                         &lt;chr&gt; "East Lansing, Michigan", "Half Moon ‚Ä¶
$ date                             &lt;date&gt; 2023-02-13, 2023-01-23, 2023-01-21, ‚Ä¶
$ summary                          &lt;chr&gt; "Anthony D. McRae, 43, opened fire at‚Ä¶
$ fatalities                       &lt;dbl&gt; 3, 7, 11, 6, 5, 3, 5, 3, 7, 3, 3, 4, ‚Ä¶
$ injured                          &lt;dbl&gt; 5, 1, 10, 6, 25, 2, 2, 2, 46, 0, 1, N‚Ä¶
$ location_2                       &lt;chr&gt; "School", "workplace", "Other", "Work‚Ä¶
$ age_of_shooter                   &lt;dbl&gt; 43, 67, 72, 31, 22, 22, 15, 20, 21, 7‚Ä¶
$ prior_signs_mental_health_issues &lt;chr&gt; NA, NA, "yes", NA, "yes", NA, NA, NA,‚Ä¶
$ weapons_obtained_legally         &lt;chr&gt; "yes", NA, NA, NA, NA, "yes", NA, "ye‚Ä¶
$ race                             &lt;chr&gt; "Black", "Asian", "Asian", "Black", "‚Ä¶
$ gender                           &lt;chr&gt; "M", "M", "M", "M", "M", "M", "M", "M‚Ä¶
$ latitude                         &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, N‚Ä¶
$ longitude                        &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, N‚Ä¶
$ type                             &lt;chr&gt; "Mass", "Spree", "Mass", "Mass", "Mas‚Ä¶
$ year                             &lt;dbl&gt; 2023, 2023, 2023, 2022, 2022, 2022, 2‚Ä¶</code></pre>
</div>
</div>
<p>üîé Are there any duplicates? No.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;">sum</span>(<span class="fu" style="color: #4758AB;">duplicated</span>(mass_shootings))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<p>üîé Number of missing values, <code>NA</code>, per column.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">mass_shootings_cln <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;">summarise_all</span>(<span class="sc" style="color: #5E5E5E;">~</span><span class="fu" style="color: #4758AB;">sum</span>(<span class="fu" style="color: #4758AB;">is.na</span>(.))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb7-3">  <span class="co" style="color: #5E5E5E;"># transposing for better visibility</span></span>
<span id="cb7-4">  <span class="fu" style="color: #4758AB;">pivot_longer</span>(<span class="at" style="color: #657422;">cols =</span> <span class="fu" style="color: #4758AB;">everything</span>(), <span class="at" style="color: #657422;">names_to =</span> <span class="st" style="color: #20794D;">"column"</span>, <span class="at" style="color: #657422;">values_to =</span> <span class="st" style="color: #20794D;">"n_missing"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 √ó 2
   column                           n_missing
   &lt;chr&gt;                                &lt;int&gt;
 1 case                                     0
 2 location                                 0
 3 date                                     0
 4 summary                                  0
 5 fatalities                               0
 6 injured                                  1
 7 location_2                               0
 8 age_of_shooter                           2
 9 prior_signs_mental_health_issues        27
10 weapons_obtained_legally                16
11 race                                    12
12 gender                                   0
13 latitude                                14
14 longitude                               14
15 type                                     0
16 year                                     0</code></pre>
</div>
</div>
<p>14 of the most recent cases don‚Äôt have location coordinates at all. We‚Äôll address this in the final cleanup step.</p>
</section>
<section id="step-2.-fixing-unique-values-of-categorical-variables" class="level3">
<h3 class="anchored" data-anchor-id="step-2.-fixing-unique-values-of-categorical-variables">üßπ Step 2. Fixing unique values of categorical variables</h3>
<p>üîé Let‚Äôs take a look at the unique values of the <code>gender</code> column.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">mass_shootings_cln <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb9-2">  <span class="fu" style="color: #4758AB;">count</span>(gender, <span class="at" style="color: #657422;">sort =</span> <span class="cn" style="color: #8f5902;">TRUE</span>) </span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 √ó 2
  gender            n
  &lt;chr&gt;         &lt;int&gt;
1 Male             70
2 M                65
3 Female            2
4 Male &amp; Female     2
5 F                 1</code></pre>
</div>
</div>
<p>Almost all categorical variables need unique values correction.</p>
<p>To make a long story short, I‚Äôll correct them all in one step using <code>case_when</code> function, and we‚Äôll look at them later during the analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">mass_shootings_cln <span class="ot" style="color: #003B4F;">&lt;-</span> mass_shootings_cln <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb11-2">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">gender =</span> <span class="fu" style="color: #4758AB;">case_when</span>(gender <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"F"</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"Female"</span>,</span>
<span id="cb11-3">                            gender <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"M"</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"Male"</span>, </span>
<span id="cb11-4">                            <span class="cn" style="color: #8f5902;">TRUE</span> <span class="sc" style="color: #5E5E5E;">~</span> gender),</span>
<span id="cb11-5">         <span class="at" style="color: #657422;">race =</span> <span class="fu" style="color: #4758AB;">case_when</span>(race <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"white"</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"White"</span>,</span>
<span id="cb11-6">                          race <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"black"</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"Black"</span>,</span>
<span id="cb11-7">                          race <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"unclear"</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"Unclear"</span>,</span>
<span id="cb11-8">                          <span class="cn" style="color: #8f5902;">TRUE</span> <span class="sc" style="color: #5E5E5E;">~</span> race),</span>
<span id="cb11-9">         <span class="at" style="color: #657422;">location_2 =</span> </span>
<span id="cb11-10">           <span class="fu" style="color: #4758AB;">case_when</span>(location_2 <span class="sc" style="color: #5E5E5E;">%in%</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"workplace"</span>, <span class="st" style="color: #20794D;">"</span><span class="sc" style="color: #5E5E5E;">\n</span><span class="st" style="color: #20794D;">Workplace"</span>) <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"Workplace"</span>,</span>
<span id="cb11-11">                                location_2 <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"Other</span><span class="sc" style="color: #5E5E5E;">\n</span><span class="st" style="color: #20794D;">"</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"Other"</span>,</span>
<span id="cb11-12">                                location_2 <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"religious"</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"Religious"</span>,</span>
<span id="cb11-13">                                <span class="cn" style="color: #8f5902;">TRUE</span> <span class="sc" style="color: #5E5E5E;">~</span> location_2),</span>
<span id="cb11-14">         <span class="at" style="color: #657422;">prior_signs_mental_health_issues =</span> </span>
<span id="cb11-15">           <span class="fu" style="color: #4758AB;">case_when</span>(prior_signs_mental_health_issues <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"yes"</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"Yes"</span>,</span>
<span id="cb11-16">                     prior_signs_mental_health_issues <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"TBD"</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"To be determined"</span>,</span>
<span id="cb11-17">                     <span class="cn" style="color: #8f5902;">TRUE</span> <span class="sc" style="color: #5E5E5E;">~</span> prior_signs_mental_health_issues),</span>
<span id="cb11-18">         <span class="at" style="color: #657422;">weapons_obtained_legally =</span> </span>
<span id="cb11-19">           <span class="fu" style="color: #4758AB;">case_when</span>(weapons_obtained_legally <span class="sc" style="color: #5E5E5E;">%in%</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"yes"</span>, <span class="st" style="color: #20794D;">"</span><span class="sc" style="color: #5E5E5E;">\n</span><span class="st" style="color: #20794D;">Yes"</span>) <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"Yes"</span>,</span>
<span id="cb11-20">                     weapons_obtained_legally <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"TBD"</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"To be determined"</span>,</span>
<span id="cb11-21">                     weapons_obtained_legally <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">str_detect</span>(<span class="st" style="color: #20794D;">"Kelley"</span>) <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"Unknown"</span>,</span>
<span id="cb11-22">                     weapons_obtained_legally <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">str_detect</span>(<span class="st" style="color: #20794D;">"some"</span>) <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"Partially"</span>,</span>
<span id="cb11-23">                     <span class="cn" style="color: #8f5902;">TRUE</span> <span class="sc" style="color: #5E5E5E;">~</span> weapons_obtained_legally))</span></code></pre></div>
</div>
</section>
<section id="step-3.-geocoding-locations-with-missing-coordinates" class="level3">
<h3 class="anchored" data-anchor-id="step-3.-geocoding-locations-with-missing-coordinates">üßπ Step 3. Geocoding locations with missing coordinates</h3>
<p>There are 14 cases with missing location coordinates. In this step we‚Äôll convert locations to coordinates with geocoding. and use them later to create a <code>leaflet</code> map for a <code>shiny app</code>.</p>
<p>The <code>tidygeocoder</code> package provides geocoding services. It‚Äôs designed to work easily with the <code>tidyverse.</code> It also provides access to several different geocoding services, including <a href="https://locationiq.com/">LocationIQ</a> which I‚Äôm going to use here. LocationIQ is a freemium service that provides a free tier, which doesn‚Äôt require you to give them your billing details. When you sign up to LocationIQ, they‚Äôll take you to the Manage Your API Access Tokens page, which is where we obtain our API token. Next, you need to provide the <code>tidygeocoder</code> package with your API key.</p>
<p>You can also use the <a href="https://nominatim.org/">Nominatim ("osm")</a> geocoding service (OpenStreetMap) which can be specified with the method argument (<code>method = "osm"</code>). I found LocationIQ to be faster.</p>
<p>The first step is to select only locations with missing coordinates and geocode them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">geocoded_locations <span class="ot" style="color: #003B4F;">&lt;-</span> mass_shootings_cln <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb12-2">  <span class="fu" style="color: #4758AB;">filter</span>(<span class="fu" style="color: #4758AB;">is.na</span>(latitude) <span class="sc" style="color: #5E5E5E;">|</span> <span class="fu" style="color: #4758AB;">is.na</span>(longitude)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb12-3">  <span class="fu" style="color: #4758AB;">select</span>(location) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb12-4">  <span class="fu" style="color: #4758AB;">geocode</span>(location, <span class="at" style="color: #657422;">method =</span> <span class="st" style="color: #20794D;">"iq"</span>)</span>
<span id="cb12-5"></span>
<span id="cb12-6">geocoded_locations <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb12-7">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="fu" style="color: #4758AB;">across</span>(<span class="fu" style="color: #4758AB;">where</span>(is.numeric), <span class="sc" style="color: #5E5E5E;">~</span> <span class="fu" style="color: #4758AB;">num</span>(., <span class="at" style="color: #657422;">digits =</span> <span class="dv" style="color: #AD0000;">6</span>)))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 √ó 3
   location                         lat        long
   &lt;chr&gt;                      &lt;num:.6!&gt;   &lt;num:.6!&gt;
 1 East Lansing, Michigan     42.732031  -84.472168
 2 Half Moon Bay, California  37.463552 -122.428586
 3 Monterey Park, California  34.051522 -118.129807
 4 Chesapeake, Virginia       36.718371  -76.246680
 5 Colorado Springs, Colorado 38.833958 -104.825348
 6 Charlottesville, Virginia  38.029306  -78.476678
 7 Hedingham, North Carolina  35.808108  -78.541245
 8 Greenwood, Indiana         39.613658  -86.106653
 9 Highland Park, Illinois    42.181692  -87.800344
10 Birmingham, Alabama        33.520682  -86.802433
11 Smithsburg, Maryland       39.654819  -77.572768
12 Tulsa, Oklahoma            36.156312  -95.992744
13 Uvalde, Texas              29.300357  -99.773318
14 Buffalo, New York          42.886717  -78.878392</code></pre>
</div>
</div>
<p>The next step is to join mass shootings table with geocoded locations and replace missing latitudes and longitudes with geocoded.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">mass_shootings_cln <span class="ot" style="color: #003B4F;">&lt;-</span> mass_shootings_cln <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb14-2">  <span class="fu" style="color: #4758AB;">left_join</span>(geocoded_locations, <span class="at" style="color: #657422;">by =</span> <span class="st" style="color: #20794D;">"location"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb14-3">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">latitude =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(<span class="fu" style="color: #4758AB;">is.na</span>(latitude), lat, latitude),</span>
<span id="cb14-4">         <span class="at" style="color: #657422;">longitude =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(<span class="fu" style="color: #4758AB;">is.na</span>(longitude), long, longitude))</span></code></pre></div>
</div>
<p>üîé Checking for null values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="fu" style="color: #4758AB;">sum</span>(<span class="fu" style="color: #4758AB;">is.na</span>(mass_shootings_cln<span class="sc" style="color: #5E5E5E;">$</span>latitude))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="fu" style="color: #4758AB;">sum</span>(<span class="fu" style="color: #4758AB;">is.na</span>(mass_shootings_cln<span class="sc" style="color: #5E5E5E;">$</span>longitude))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<p>OK, this looks fine.</p>
</section>
</section>
<section id="exploratory-data-analysis-eda" class="level2">
<h2 class="anchored" data-anchor-id="exploratory-data-analysis-eda">Exploratory data analysis (EDA)</h2>
<section id="writing-a-function" class="level3">
<h3 class="anchored" data-anchor-id="writing-a-function">‚ùï Writing a function</h3>
<p>To count unique values for all categorical variables separately, I‚Äôll write a function, <code>count_unique</code>, to avoid copying and pasting a block of code several times.</p>
<p>This is the case when have the data-variable (column name) in a function argument. We need to embrace the argument by surrounding it in doubled braces, like <code>group_by({{ var }})</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1">count_unique <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="cf" style="color: #003B4F;">function</span>(data, var) {</span>
<span id="cb19-2">  </span>
<span id="cb19-3">  data <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb19-4">    <span class="fu" style="color: #4758AB;">group_by</span>({{ var }}) <span class="sc" style="color: #5E5E5E;">%&gt;%</span>    </span>
<span id="cb19-5">    <span class="fu" style="color: #4758AB;">summarise</span>(<span class="at" style="color: #657422;">count =</span> <span class="fu" style="color: #4758AB;">n</span>(), <span class="at" style="color: #657422;">.groups =</span> <span class="st" style="color: #20794D;">"drop"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb19-6">    <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">percent =</span> scales<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">percent</span>(count<span class="sc" style="color: #5E5E5E;">/</span><span class="fu" style="color: #4758AB;">sum</span>(count), <span class="at" style="color: #657422;">accuracy =</span> <span class="fl" style="color: #AD0000;">0.1</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb19-7">    <span class="fu" style="color: #4758AB;">arrange</span>(<span class="fu" style="color: #4758AB;">desc</span>(count))</span>
<span id="cb19-8"></span>
<span id="cb19-9">}</span></code></pre></div>
</div>
</section>
<section id="breakdown-by-categorical-variables" class="level3">
<h3 class="anchored" data-anchor-id="breakdown-by-categorical-variables">üìÑ Breakdown by categorical variables</h3>
<section id="gender" class="level4">
<h4 class="anchored" data-anchor-id="gender">Gender</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1">mass_shootings_cln <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">count_unique</span>(gender)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 √ó 3
  gender        count percent
  &lt;chr&gt;         &lt;int&gt; &lt;chr&gt;  
1 Male            135 96.4%  
2 Female            3 2.1%   
3 Male &amp; Female     2 1.4%   </code></pre>
</div>
</div>
</section>
<section id="race" class="level4">
<h4 class="anchored" data-anchor-id="race">Race</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1">mass_shootings_cln <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">count_unique</span>(race)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 √ó 3
  race            count percent
  &lt;chr&gt;           &lt;int&gt; &lt;chr&gt;  
1 White              73 52.1%  
2 Black              25 17.9%  
3 &lt;NA&gt;               12 8.6%   
4 Latino             11 7.9%   
5 Asian              10 7.1%   
6 Other               5 3.6%   
7 Native American     3 2.1%   
8 Unclear             1 0.7%   </code></pre>
</div>
</div>
</section>
<section id="specific-location" class="level4">
<h4 class="anchored" data-anchor-id="specific-location">Specific location</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1">mass_shootings_cln <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">count_unique</span>(location_2)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 √ó 3
  location_2 count percent
  &lt;chr&gt;      &lt;int&gt; &lt;chr&gt;  
1 Other         53 37.9%  
2 Workplace     51 36.4%  
3 School        21 15.0%  
4 Religious      8 5.7%   
5 Military       6 4.3%   
6 Airport        1 0.7%   </code></pre>
</div>
</div>
</section>
<section id="prior-signs-of-mental-health-issues" class="level4">
<h4 class="anchored" data-anchor-id="prior-signs-of-mental-health-issues">Prior signs of mental health issues</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1">mass_shootings_cln <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">count_unique</span>(prior_signs_mental_health_issues)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 √ó 3
  prior_signs_mental_health_issues count percent
  &lt;chr&gt;                            &lt;int&gt; &lt;chr&gt;  
1 Yes                                 66 47.1%  
2 &lt;NA&gt;                                27 19.3%  
3 Unclear                             24 17.1%  
4 No                                  17 12.1%  
5 To be determined                     5 3.6%   
6 Unknown                              1 0.7%   </code></pre>
</div>
</div>
</section>
<section id="weapons-obtained-legally" class="level4">
<h4 class="anchored" data-anchor-id="weapons-obtained-legally">Weapons obtained legally</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1">mass_shootings_cln <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">count_unique</span>(weapons_obtained_legally)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 √ó 3
  weapons_obtained_legally count percent
  &lt;chr&gt;                    &lt;int&gt; &lt;chr&gt;  
1 Yes                         93 66.4%  
2 No                          16 11.4%  
3 &lt;NA&gt;                        16 11.4%  
4 To be determined             7 5.0%   
5 Unknown                      7 5.0%   
6 Partially                    1 0.7%   </code></pre>
</div>
</div>
</section>
<section id="type" class="level4">
<h4 class="anchored" data-anchor-id="type">Type</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1">mass_shootings_cln <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">count_unique</span>(type)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 √ó 3
  type  count percent
  &lt;chr&gt; &lt;int&gt; &lt;chr&gt;  
1 Mass    119 85.0%  
2 Spree    21 15.0%  </code></pre>
</div>
</div>
<p>Note: Spree shootings here have three or more victims in a short time in multiple locations.</p>
</section>
</section>
<section id="age-of-shooter-distribution" class="level3">
<h3 class="anchored" data-anchor-id="age-of-shooter-distribution">üìä Age of shooter distribution</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1">p1 <span class="ot" style="color: #003B4F;">&lt;-</span> mass_shootings_cln <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb32-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(age_of_shooter)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb32-3">  <span class="fu" style="color: #4758AB;">geom_histogram</span>(<span class="at" style="color: #657422;">fill =</span> <span class="st" style="color: #20794D;">"indianred"</span>, <span class="at" style="color: #657422;">color =</span> <span class="st" style="color: #20794D;">"white"</span>, <span class="at" style="color: #657422;">binwidth =</span> <span class="dv" style="color: #AD0000;">5</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb32-4">  <span class="fu" style="color: #4758AB;">labs</span>(<span class="at" style="color: #657422;">title =</span> <span class="st" style="color: #20794D;">"Age Distribution"</span>, <span class="at" style="color: #657422;">x =</span> <span class="st" style="color: #20794D;">"age of shooter"</span>)</span>
<span id="cb32-5"></span>
<span id="cb32-6"><span class="fu" style="color: #4758AB;">ggplotly</span>(p1)</span></code></pre></div>
<div class="cell-output-display">
<div id="htmlwidget-f8ee79a417db619f1b5c" style="width:100%;height:464px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-f8ee79a417db619f1b5c">{"x":{"data":[{"orientation":"v","width":[5,5,5,5,5,5,5,5,5,5,5,5,5],"base":[0,0,0,0,0,0,0,0,0,0,0,0,0],"x":[10,15,20,25,30,35,40,45,50,55,60,65,70],"y":[1,7,27,18,16,13,19,20,5,4,2,4,2],"text":["count:  1<br />age_of_shooter: 10","count:  7<br />age_of_shooter: 15","count: 27<br />age_of_shooter: 20","count: 18<br />age_of_shooter: 25","count: 16<br />age_of_shooter: 30","count: 13<br />age_of_shooter: 35","count: 19<br />age_of_shooter: 40","count: 20<br />age_of_shooter: 45","count:  5<br />age_of_shooter: 50","count:  4<br />age_of_shooter: 55","count:  2<br />age_of_shooter: 60","count:  4<br />age_of_shooter: 65","count:  2<br />age_of_shooter: 70"],"type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(205,92,92,1)","line":{"width":1.88976377952756,"color":"rgba(255,255,255,1)"}},"showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":43.7625570776256,"r":7.30593607305936,"b":40.1826484018265,"l":37.2602739726027},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"title":{"text":"Age Distribution","font":{"color":"rgba(0,0,0,1)","family":"","size":17.5342465753425},"x":0,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[4.25,75.75],"tickmode":"array","ticktext":["20","40","60"],"tickvals":[20,40,60],"categoryorder":"array","categoryarray":["20","40","60"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":true,"linecolor":"rgba(0,0,0,1)","linewidth":0.66417600664176,"showgrid":false,"gridcolor":null,"gridwidth":0,"zeroline":false,"anchor":"y","title":{"text":"age of shooter","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-1.35,28.35],"tickmode":"array","ticktext":["0","10","20"],"tickvals":[0,10,20],"categoryorder":"array","categoryarray":["0","10","20"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":true,"linecolor":"rgba(0,0,0,1)","linewidth":0.66417600664176,"showgrid":false,"gridcolor":null,"gridwidth":0,"zeroline":false,"anchor":"x","title":{"text":"count","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"5cf47d3e6a96":{"x":{},"type":"bar"}},"cur_data":"5cf47d3e6a96","visdat":{"5cf47d3e6a96":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p><br></p>
<ul>
<li>The vast majority of shooters were between 20 and 50 years old.</li>
<li>Most shooters were in the 20-25 age group.</li>
</ul>
<p>üîé Who was the youngest shooter?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1">index <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">which.min</span>(mass_shootings_cln<span class="sc" style="color: #5E5E5E;">$</span>age_of_shooter)</span>
<span id="cb33-2"></span>
<span id="cb33-3">mass_shootings_cln[index, ] <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb33-4">  <span class="fu" style="color: #4758AB;">select</span>(case, date, summary, fatalities) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb33-5">  knitr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">kable</span>()</span></code></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 13%">
<col style="width: 4%">
<col style="width: 76%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">case</th>
<th style="text-align: left;">date</th>
<th style="text-align: left;">summary</th>
<th style="text-align: right;">fatalities</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Westside Middle School killings</td>
<td style="text-align: left;">1998-03-24</td>
<td style="text-align: left;">Mitchell Scott Johnson, 13, and Andrew Douglas Golden, 11, two juveniles, ambushed students and teachers as they left the school; they were apprehended by police at the scene.</td>
<td style="text-align: right;">5</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="number-of-cases-per-year" class="level3">
<h3 class="anchored" data-anchor-id="number-of-cases-per-year">üìä Number of cases per year</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1">p2 <span class="ot" style="color: #003B4F;">&lt;-</span> mass_shootings_cln <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb34-2">  <span class="fu" style="color: #4758AB;">group_by</span>(year) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb34-3">  <span class="fu" style="color: #4758AB;">summarise</span>(<span class="at" style="color: #657422;">count =</span> <span class="fu" style="color: #4758AB;">n</span>()) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb34-4">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(year, count)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb34-5">  <span class="fu" style="color: #4758AB;">geom_col</span>(<span class="at" style="color: #657422;">fill =</span> <span class="st" style="color: #20794D;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb34-6">  <span class="fu" style="color: #4758AB;">geom_smooth</span>(<span class="at" style="color: #657422;">method =</span> <span class="st" style="color: #20794D;">"loess"</span>, <span class="at" style="color: #657422;">se =</span> <span class="cn" style="color: #8f5902;">FALSE</span>, <span class="at" style="color: #657422;">color =</span> <span class="st" style="color: #20794D;">"indianred"</span>, <span class="at" style="color: #657422;">size =</span> <span class="fl" style="color: #AD0000;">0.7</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb34-7">  <span class="co" style="color: #5E5E5E;"># geom_vline(xintercept = 2012, color = "black", linetype = "dotted") +</span></span>
<span id="cb34-8">  <span class="fu" style="color: #4758AB;">labs</span>(<span class="at" style="color: #657422;">title =</span> <span class="st" style="color: #20794D;">"Number of Cases per Year"</span>) </span>
<span id="cb34-9"></span>
<span id="cb34-10"><span class="fu" style="color: #4758AB;">ggplotly</span>(p2)</span></code></pre></div>
<div class="cell-output-display">
<div id="htmlwidget-92847b6d3def19056710" style="width:100%;height:464px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-92847b6d3def19056710">{"x":{"data":[{"orientation":"v","width":[0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091,0.900000000000091],"base":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"x":[1982,1984,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023],"y":[1,2,1,1,1,2,1,3,2,4,1,1,1,2,3,5,1,1,1,1,2,3,4,3,4,1,3,7,5,4,7,6,11,12,10,2,6,12,3],"text":["year: 1982<br />count:  1","year: 1984<br />count:  2","year: 1986<br />count:  1","year: 1987<br />count:  1","year: 1988<br />count:  1","year: 1989<br />count:  2","year: 1990<br />count:  1","year: 1991<br />count:  3","year: 1992<br />count:  2","year: 1993<br />count:  4","year: 1994<br />count:  1","year: 1995<br />count:  1","year: 1996<br />count:  1","year: 1997<br />count:  2","year: 1998<br />count:  3","year: 1999<br />count:  5","year: 2000<br />count:  1","year: 2001<br />count:  1","year: 2003<br />count:  1","year: 2004<br />count:  1","year: 2005<br />count:  2","year: 2006<br />count:  3","year: 2007<br />count:  4","year: 2008<br />count:  3","year: 2009<br />count:  4","year: 2010<br />count:  1","year: 2011<br />count:  3","year: 2012<br />count:  7","year: 2013<br />count:  5","year: 2014<br />count:  4","year: 2015<br />count:  7","year: 2016<br />count:  6","year: 2017<br />count: 11","year: 2018<br />count: 12","year: 2019<br />count: 10","year: 2020<br />count:  2","year: 2021<br />count:  6","year: 2022<br />count: 12","year: 2023<br />count:  3"],"type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(70,130,180,1)","line":{"width":1.88976377952756,"color":"transparent"}},"showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1982,1982.51898734177,1983.03797468354,1983.55696202532,1984.07594936709,1984.59493670886,1985.11392405063,1985.63291139241,1986.15189873418,1986.67088607595,1987.18987341772,1987.70886075949,1988.22784810127,1988.74683544304,1989.26582278481,1989.78481012658,1990.30379746835,1990.82278481013,1991.3417721519,1991.86075949367,1992.37974683544,1992.89873417722,1993.41772151899,1993.93670886076,1994.45569620253,1994.9746835443,1995.49367088608,1996.01265822785,1996.53164556962,1997.05063291139,1997.56962025316,1998.08860759494,1998.60759493671,1999.12658227848,1999.64556962025,2000.16455696203,2000.6835443038,2001.20253164557,2001.72151898734,2002.24050632911,2002.75949367089,2003.27848101266,2003.79746835443,2004.3164556962,2004.83544303797,2005.35443037975,2005.87341772152,2006.39240506329,2006.91139240506,2007.43037974684,2007.94936708861,2008.46835443038,2008.98734177215,2009.50632911392,2010.0253164557,2010.54430379747,2011.06329113924,2011.58227848101,2012.10126582278,2012.62025316456,2013.13924050633,2013.6582278481,2014.17721518987,2014.69620253165,2015.21518987342,2015.73417721519,2016.25316455696,2016.77215189873,2017.29113924051,2017.81012658228,2018.32911392405,2018.84810126582,2019.36708860759,2019.88607594937,2020.40506329114,2020.92405063291,2021.44303797468,2021.96202531646,2022.48101265823,2023],"y":[1.08044090392719,1.13335093597507,1.18509588070663,1.23561420903098,1.28484439185727,1.33272490009456,1.37919420465199,1.42419077643866,1.4676530863637,1.50951960533622,1.54972880426534,1.58821915406015,1.62486135857014,1.65919253705476,1.69137937566959,1.72171796152656,1.7505043817376,1.77803472341465,1.80460507366959,1.83051151961437,1.85605014836093,1.88151704702117,1.90464436422924,1.92120686926341,1.9325936501292,1.94035241834277,1.94603088542033,1.95117676287805,1.95733776223213,1.96606159499876,1.97889597269412,1.99702102334734,2.0063781285538,2.00207105441712,1.98816395725596,1.96872099338901,1.94780631913495,1.92948409081246,1.91781846474023,1.91687359723693,1.93071364462126,1.96340276321188,2.01900510932748,2.09777107999261,2.18712303484144,2.28617194017104,2.39550256526758,2.5156996794172,2.64734805190606,2.79103245202031,2.94733764904618,3.11684841226968,3.30014951097704,3.50989828553128,3.75341509994013,4.02122144284466,4.30383025893448,4.59175449289933,4.87550708942857,5.14560099321192,5.392549148939,5.60686450129942,5.78199507834182,5.94733430500481,6.11169416303553,6.27354507488135,6.43135746298955,6.58360174980743,6.72874835778227,6.86526770936134,6.991630226992,7.10630633312142,7.20781986795228,7.29612167102944,7.37238871240413,7.43782788486468,7.49364608119946,7.54105019419675,7.58124711664492,7.61544374133231],"text":["year: 1982.000<br />count: 1.080441","year: 1982.519<br />count: 1.133351","year: 1983.038<br />count: 1.185096","year: 1983.557<br />count: 1.235614","year: 1984.076<br />count: 1.284844","year: 1984.595<br />count: 1.332725","year: 1985.114<br />count: 1.379194","year: 1985.633<br />count: 1.424191","year: 1986.152<br />count: 1.467653","year: 1986.671<br />count: 1.509520","year: 1987.190<br />count: 1.549729","year: 1987.709<br />count: 1.588219","year: 1988.228<br />count: 1.624861","year: 1988.747<br />count: 1.659193","year: 1989.266<br />count: 1.691379","year: 1989.785<br />count: 1.721718","year: 1990.304<br />count: 1.750504","year: 1990.823<br />count: 1.778035","year: 1991.342<br />count: 1.804605","year: 1991.861<br />count: 1.830512","year: 1992.380<br />count: 1.856050","year: 1992.899<br />count: 1.881517","year: 1993.418<br />count: 1.904644","year: 1993.937<br />count: 1.921207","year: 1994.456<br />count: 1.932594","year: 1994.975<br />count: 1.940352","year: 1995.494<br />count: 1.946031","year: 1996.013<br />count: 1.951177","year: 1996.532<br />count: 1.957338","year: 1997.051<br />count: 1.966062","year: 1997.570<br />count: 1.978896","year: 1998.089<br />count: 1.997021","year: 1998.608<br />count: 2.006378","year: 1999.127<br />count: 2.002071","year: 1999.646<br />count: 1.988164","year: 2000.165<br />count: 1.968721","year: 2000.684<br />count: 1.947806","year: 2001.203<br />count: 1.929484","year: 2001.722<br />count: 1.917818","year: 2002.241<br />count: 1.916874","year: 2002.759<br />count: 1.930714","year: 2003.278<br />count: 1.963403","year: 2003.797<br />count: 2.019005","year: 2004.316<br />count: 2.097771","year: 2004.835<br />count: 2.187123","year: 2005.354<br />count: 2.286172","year: 2005.873<br />count: 2.395503","year: 2006.392<br />count: 2.515700","year: 2006.911<br />count: 2.647348","year: 2007.430<br />count: 2.791032","year: 2007.949<br />count: 2.947338","year: 2008.468<br />count: 3.116848","year: 2008.987<br />count: 3.300150","year: 2009.506<br />count: 3.509898","year: 2010.025<br />count: 3.753415","year: 2010.544<br />count: 4.021221","year: 2011.063<br />count: 4.303830","year: 2011.582<br />count: 4.591754","year: 2012.101<br />count: 4.875507","year: 2012.620<br />count: 5.145601","year: 2013.139<br />count: 5.392549","year: 2013.658<br />count: 5.606865","year: 2014.177<br />count: 5.781995","year: 2014.696<br />count: 5.947334","year: 2015.215<br />count: 6.111694","year: 2015.734<br />count: 6.273545","year: 2016.253<br />count: 6.431357","year: 2016.772<br />count: 6.583602","year: 2017.291<br />count: 6.728748","year: 2017.810<br />count: 6.865268","year: 2018.329<br />count: 6.991630","year: 2018.848<br />count: 7.106306","year: 2019.367<br />count: 7.207820","year: 2019.886<br />count: 7.296122","year: 2020.405<br />count: 7.372389","year: 2020.924<br />count: 7.437828","year: 2021.443<br />count: 7.493646","year: 2021.962<br />count: 7.541050","year: 2022.481<br />count: 7.581247","year: 2023.000<br />count: 7.615444"],"type":"scatter","mode":"lines","name":"fitted values","line":{"width":2.64566929133858,"color":"rgba(205,92,92,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":43.7625570776256,"r":7.30593607305936,"b":40.1826484018265,"l":48.9497716894977},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"title":{"text":"Number of Cases per Year","font":{"color":"rgba(0,0,0,1)","family":"","size":17.5342465753425},"x":0,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[1979.455,2025.545],"tickmode":"array","ticktext":["1980","1990","2000","2010","2020"],"tickvals":[1980,1990,2000,2010,2020],"categoryorder":"array","categoryarray":["1980","1990","2000","2010","2020"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":true,"linecolor":"rgba(0,0,0,1)","linewidth":0.66417600664176,"showgrid":false,"gridcolor":null,"gridwidth":0,"zeroline":false,"anchor":"y","title":{"text":"year","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.6,12.6],"tickmode":"array","ticktext":["0.0","2.5","5.0","7.5","10.0","12.5"],"tickvals":[0,2.5,5,7.5,10,12.5],"categoryorder":"array","categoryarray":["0.0","2.5","5.0","7.5","10.0","12.5"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":true,"linecolor":"rgba(0,0,0,1)","linewidth":0.66417600664176,"showgrid":false,"gridcolor":null,"gridwidth":0,"zeroline":false,"anchor":"x","title":{"text":"count","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"5cf46a8242b3":{"x":{},"y":{},"type":"bar"},"5cf430d568fa":{"x":{},"y":{}}},"cur_data":"5cf46a8242b3","visdat":{"5cf46a8242b3":["function (y) ","x"],"5cf430d568fa":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p><br></p>
<ul>
<li>We can see an increase in mass shootings in the last 12 years.</li>
<li>2020 has a smaller number of cases probably due to Covid restrictions.</li>
<li>The data for 2023 is incomplete, but 3 cases in the first two months seems a lot.</li>
</ul>
</section>
<section id="fatalities-injured-relationship" class="level3">
<h3 class="anchored" data-anchor-id="fatalities-injured-relationship">üìä Fatalities-Injured relationship</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1">p3 <span class="ot" style="color: #003B4F;">&lt;-</span> mass_shootings_cln <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb35-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> fatalities, <span class="at" style="color: #657422;">y =</span> injured)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb35-3">  <span class="fu" style="color: #4758AB;">geom_jitter</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb35-4">  <span class="fu" style="color: #4758AB;">scale_y_sqrt</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb35-5">  <span class="fu" style="color: #4758AB;">labs</span>(<span class="at" style="color: #657422;">title =</span> <span class="st" style="color: #20794D;">"Fatalities-Injured Relationship"</span>)</span>
<span id="cb35-6">  </span>
<span id="cb35-7"><span class="fu" style="color: #4758AB;">ggplotly</span>(p3)</span></code></pre></div>
<div class="cell-output-display">
<div id="htmlwidget-1ae1c996f466e3b7cba2" style="width:100%;height:464px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-1ae1c996f466e3b7cba2">{"x":{"data":[{"x":[3.35057915616781,7.02240752410144,10.8268666274846,6.20481262337416,4.89259428177029,3.20051309112459,5.31554066967219,2.7843056531623,6.8945414962247,2.77690134923905,2.73644245807081,3.84326848387718,20.6518733369187,9.9855845099315,3.61445971690118,4.06891558580101,9.01560096051544,8.20999302454293,4.0190711338073,9.64928789064288,7.7164203222841,4.16350449770689,4.7377777243033,3.60889724884182,3.23382440544665,6.98041893616319,9.02849772460759,22.1208544658497,3.07183294482529,11.7982466742396,4.95616856906563,3.28618975579739,4.60764294918627,2.74767641536891,11.6218459812924,10.8627064568922,2.98117916546762,4.81661898083985,3.38084578309208,5.33997049294412,9.83949722722173,3.87985942475498,3.26026065703481,16.8133698577061,4.23037627637386,5.09573769159615,26.2869836330414,3.34884690176696,2.93393925130367,57.8695045527071,3.27168464027345,3.11133412253112,5.22814193814993,3.11112108491361,3.14227233808488,4.64714073054492,5.38495958596468,3.15210005249828,5.36797177754343,49.2752375025302,3.04475980754942,5.98214907459915,13.9815376210958,2.79892809651792,2.77277306467295,8.72390362210572,5.13955882452428,9.04682766888291,3.23326791524887,5.21641029529273,5.7714011227712,2.84522693287581,4.00765644460917,11.9803210457787,7.09489432927221,5.70850543994456,4.64368503820151,4.61949949059635,27.1566965740174,7.16281190831214,6.68652301579714,11.842431643419,5.8071209570393,6.68565217275173,4.63016257733107,8.17744751162827,5.24952547773719,6.31284103058279,8.82068624962121,3.77818944621831,12.876217882894,13.9961123881862,8.14530084431171,6.18714563548565,4.83969890363514,5.91853692680597,8.73423220273107,6.24133085925132,32.1413645584136,5.80102626699954,5.8152067553252,6.89013034310192,7.90286283548921,10.0780458658934,7.24065472800285,5.21467523444444,7.36275257617235,4.64243915304542,6.75272325612605,5.36864667981863,7.05621324032545,8.24684180486947,8.88376656286419,12.9201530946419,3.97851773556322,4.79540801681578,5.33922477532178,4.84301921352744,4.29845258463174,6.01109613720328,5.822238281928,4.65573782138526,4.32546541113406,6.16074202191085,4.01364149544388,8.86720360200852,5.08461559582502,3.62971991710365,4.99975285157561,5.762183849141,24.1099371686578,9.60839874874801,9.09459009934217,5.70462315939367,7.07252560034394,5.6188244946301,15.07682329081,22.3882196370512,5.75063780304045,8.30656092967838],"y":[2.20461787815466,1.03323298578048,3.15302841903776,2.45518878285833,5.0261015952358,1.38135612557436,1.38663871411572,1.43624562755407,6.77983455928783,0.00979055302836706,0.968229099083293,null,4.08815026179852,1.69760431381392,0.0140715361296982,2.61620234850952,-0.0132149015137951,2.61682244154525,1.02004658419741,-0.0102449104314582,0.976920069156517,0.0232647704552938,-0.00429862488776984,1.75795594547475,2.80079851055593,4.9948800698611,5.17664604298838,5.10790611006563,3.46209889058179,1.98437242059458,2.41921929831638,0.969665002631589,0.034384314035317,0.0131014611178684,4.68455730307222,2.41519651252849,1.70261339578372,0.0118950883754263,1.38873976276508,1.38373019108791,3.63829419102598,2.01211902896905,0.00606892423154839,4.11940728420039,1.00144005812746,3.18642631954377,4.44516372407986,0.0102561610183038,1.71284315443343,23.3755469320574,1.44829941361301,-0.0122149516744052,-0.00239282761846197,0.00258128593022128,0.00352258551813214,2.46429163900745,0.0375184837352214,1.71376468378901,3.28324259033787,7.29647807655912,3.73337165101008,1.42902488185038,4.55444796920685,3.00850489965257,-0.023437999477401,2.9947544883878,1.45173710469305,1.02635351714109,1.03463662333539,0.970730835056479,3.60544826813108,3.48429013944471,1.38853773915919,2.86497089318147,0.0274579590130863,1.70336744527129,-0.0272288479693346,1.39711424999837,1.43388851971659,0.979293017463491,1.74236318396156,8.37408089062674,0.968101362821547,1.72695014216025,0.0142966330818812,0.991290783473763,2.64570084817331,3.57026446451485,1.45165766642049,1.02587617643766,5.5928142809106,2.02916833975478,1.74755187281895,1.02765897145204,4.59040923226631,1.42388753025447,2.02400871418971,1.0058226962442,4.8083803844947,1.98926540470038,2.21752350140877,1.39147884924837,-0.0333147713085845,2.22163844197584,2.03879810589619,2.64784339363816,2.86093392532904,2.03553249216564,-0.0120529723345229,1.7521657197225,-0.0198905021161249,2.65620391510172,3.60645861200815,4.9333711242251,4.98467469708997,3.16324338010091,1.01152072786628,1.41021002154046,1.74868218821827,1.03850848142606,0.0338563695549702,4.82217947651177,1.02892546373092,4.39304693145838,2.822976525234,2.42987467894759,0.0187299522663264,3.15863773508577,2.24408689475202,1.02279975119252,4.43701109093253,2.00782233772614,3.46371065697348,5.37657445889128,1.96407656209958,3.73089659369474,2.4595038301581,4.37106093819404,1.03219066341657,1.74155589808798],"text":["fatalities:  3<br />injured:   5","fatalities:  7<br />injured:   1","fatalities: 11<br />injured:  10","fatalities:  6<br />injured:   6","fatalities:  5<br />injured:  25","fatalities:  3<br />injured:   2","fatalities:  5<br />injured:   2","fatalities:  3<br />injured:   2","fatalities:  7<br />injured:  46","fatalities:  3<br />injured:   0","fatalities:  3<br />injured:   1","fatalities:  4<br />injured:  NA","fatalities: 21<br />injured:  17","fatalities: 10<br />injured:   3","fatalities:  4<br />injured:   0","fatalities:  4<br />injured:   7","fatalities:  9<br />injured:   0","fatalities:  8<br />injured:   7","fatalities:  4<br />injured:   1","fatalities: 10<br />injured:   0","fatalities:  8<br />injured:   1","fatalities:  4<br />injured:   0","fatalities:  5<br />injured:   0","fatalities:  4<br />injured:   3","fatalities:  3<br />injured:   8","fatalities:  7<br />injured:  25","fatalities:  9<br />injured:  27","fatalities: 22<br />injured:  26","fatalities:  3<br />injured:  12","fatalities: 12<br />injured:   4","fatalities:  5<br />injured:   6","fatalities:  3<br />injured:   1","fatalities:  5<br />injured:   0","fatalities:  3<br />injured:   0","fatalities: 12<br />injured:  22","fatalities: 11<br />injured:   6","fatalities:  3<br />injured:   3","fatalities:  5<br />injured:   0","fatalities:  3<br />injured:   2","fatalities:  5<br />injured:   2","fatalities: 10<br />injured:  13","fatalities:  4<br />injured:   4","fatalities:  3<br />injured:   0","fatalities: 17<br />injured:  17","fatalities:  4<br />injured:   1","fatalities:  5<br />injured:  10","fatalities: 26<br />injured:  20","fatalities:  3<br />injured:   0","fatalities:  3<br />injured:   3","fatalities: 58<br />injured: 546","fatalities:  3<br />injured:   2","fatalities:  3<br />injured:   0","fatalities:  5<br />injured:   0","fatalities:  3<br />injured:   0","fatalities:  3<br />injured:   0","fatalities:  5<br />injured:   6","fatalities:  5<br />injured:   0","fatalities:  3<br />injured:   3","fatalities:  5<br />injured:  11","fatalities: 49<br />injured:  53","fatalities:  3<br />injured:  14","fatalities:  6<br />injured:   2","fatalities: 14<br />injured:  21","fatalities:  3<br />injured:   9","fatalities:  3<br />injured:   0","fatalities:  9<br />injured:   9","fatalities:  5<br />injured:   2","fatalities:  9<br />injured:   1","fatalities:  3<br />injured:   1","fatalities:  5<br />injured:   1","fatalities:  6<br />injured:  13","fatalities:  3<br />injured:  12","fatalities:  4<br />injured:   2","fatalities: 12<br />injured:   8","fatalities:  7<br />injured:   0","fatalities:  6<br />injured:   3","fatalities:  5<br />injured:   0","fatalities:  5<br />injured:   2","fatalities: 27<br />injured:   2","fatalities:  7<br />injured:   1","fatalities:  7<br />injured:   3","fatalities: 12<br />injured:  70","fatalities:  6<br />injured:   1","fatalities:  7<br />injured:   3","fatalities:  5<br />injured:   0","fatalities:  8<br />injured:   1","fatalities:  5<br />injured:   7","fatalities:  6<br />injured:  13","fatalities:  9<br />injured:   2","fatalities:  4<br />injured:   1","fatalities: 13<br />injured:  31","fatalities: 14<br />injured:   4","fatalities:  8<br />injured:   3","fatalities:  6<br />injured:   1","fatalities:  5<br />injured:  21","fatalities:  6<br />injured:   2","fatalities:  9<br />injured:   4","fatalities:  6<br />injured:   1","fatalities: 32<br />injured:  23","fatalities:  6<br />injured:   4","fatalities:  6<br />injured:   5","fatalities:  7<br />injured:   2","fatalities:  8<br />injured:   0","fatalities: 10<br />injured:   5","fatalities:  7<br />injured:   4","fatalities:  5<br />injured:   7","fatalities:  7<br />injured:   8","fatalities:  5<br />injured:   4","fatalities:  7<br />injured:   0","fatalities:  5<br />injured:   3","fatalities:  7<br />injured:   0","fatalities:  8<br />injured:   7","fatalities:  9<br />injured:  13","fatalities: 13<br />injured:  24","fatalities:  4<br />injured:  25","fatalities:  5<br />injured:  10","fatalities:  5<br />injured:   1","fatalities:  5<br />injured:   2","fatalities:  4<br />injured:   3","fatalities:  6<br />injured:   1","fatalities:  6<br />injured:   0","fatalities:  5<br />injured:  23","fatalities:  4<br />injured:   1","fatalities:  6<br />injured:  19","fatalities:  4<br />injured:   8","fatalities:  9<br />injured:   6","fatalities:  5<br />injured:   0","fatalities:  4<br />injured:  10","fatalities:  5<br />injured:   5","fatalities:  6<br />injured:   1","fatalities: 24<br />injured:  20","fatalities: 10<br />injured:   4","fatalities:  9<br />injured:  12","fatalities:  6<br />injured:  29","fatalities:  7<br />injured:   4","fatalities:  6<br />injured:  14","fatalities: 15<br />injured:   6","fatalities: 22<br />injured:  19","fatalities:  6<br />injured:   1","fatalities:  8<br />injured:   3"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,0,0,1)","opacity":1,"size":5.66929133858268,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(0,0,0,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":43.7625570776256,"r":7.30593607305936,"b":40.1826484018265,"l":43.1050228310502},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"title":{"text":"Fatalities-Injured Relationship","font":{"color":"rgba(0,0,0,1)","family":"","size":17.5342465753425},"x":0,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.020210646660999,60.6261576574389],"tickmode":"array","ticktext":["0","10","20","30","40","50","60"],"tickvals":[0,10,20,30,40,50,60],"categoryorder":"array","categoryarray":["0","10","20","30","40","50","60"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":true,"linecolor":"rgba(0,0,0,1)","linewidth":0.66417600664176,"showgrid":false,"gridcolor":null,"gridwidth":0,"zeroline":false,"anchor":"y","title":{"text":"fatalities","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-1.20375785647688,24.5459900172256],"tickmode":"array","ticktext":["100","200","300","400","500","600"],"tickvals":[10,14.142135623731,17.3205080756888,20,22.3606797749979,24.4948974278318],"categoryorder":"array","categoryarray":["100","200","300","400","500","600"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":true,"linecolor":"rgba(0,0,0,1)","linewidth":0.66417600664176,"showgrid":false,"gridcolor":null,"gridwidth":0,"zeroline":false,"anchor":"x","title":{"text":"injured","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"5cf47de4531":{"x":{},"y":{},"type":"scatter"}},"cur_data":"5cf47de4531","visdat":{"5cf47de4531":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p><br></p>
<p>Please note that the <code>Injured</code> values are square root scaled for better visibility, but you can see the actual values by hovering over the points.</p>
<p><strong>Summary of fatalities</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><span class="fu" style="color: #4758AB;">summary</span>(mass_shootings_cln<span class="sc" style="color: #5E5E5E;">$</span>fatalities)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  3.000   4.000   6.000   7.821   8.250  58.000 </code></pre>
</div>
</div>
<p><strong>Summary of injured people</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><span class="fu" style="color: #4758AB;">summary</span>(mass_shootings_cln<span class="sc" style="color: #5E5E5E;">$</span>injured)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
   0.00    1.00    3.00   11.36   10.00  546.00       1 </code></pre>
</div>
</div>
</section>
</section>
<section id="shiny-app" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="shiny-app">Shiny app</h2>
<p>The app you can see below is embedded in this <code>quarto</code> document since my website is static. It was originally published on <a href="https://www.shinyapps.io/">shinyapps.io</a> and you can also interact with it <a href="https://sandra-jurela.shinyapps.io/shiny-mass-shootings-usa/">here</a>.</p>
<p><strong>A quick note:</strong> With a free account I have 25 active hours (when my applications are not idle). If these 25 active hours are exceeded, my app will not be available again until the following month cycle. Hope you get lucky! üòä</p>
<p>üì¢ By clicking on each circle, you can read a summary of the mass shooting case.</p>
<p><br></p>
<div class="column-page">
<iframe height="800" width="100%" frameborder="no" src="https://sandra-jurela.shinyapps.io/shiny-mass-shootings-usa/">
</iframe>
</div>


</section>

 ]]></description>
  <category>R</category>
  <category>shiny</category>
  <category>EDA</category>
  <category>data cleaning</category>
  <guid>https://sandrajurela.com/posts/shiny-mass-shootings/mass-shootings.html</guid>
  <pubDate>Tue, 28 Feb 2023 23:00:00 GMT</pubDate>
  <media:content url="https://sandrajurela.com/posts/shiny-mass-shootings/images/preview.png" medium="image" type="image/png" height="88" width="144"/>
</item>
<item>
  <title>Cryptocurrency SQL Case Study</title>
  <dc:creator>Sandra Jurela</dc:creator>
  <link>https://sandrajurela.com/posts/cryptocurrency-sql-case-study/cryptocurrency.html</link>
  <description><![CDATA[ 




<section id="foreword" class="level2">
<h2 class="anchored" data-anchor-id="foreword">Foreword</h2>
<p>On November 18, 2022 I attended the SQL masterclass ‚ÄúSQL and PostgreSQL for Data Analytics‚Äù, presented live by Danny Ma on O‚ÄôReilly platform.</p>
<p>This <a href="https://github.com/DataWithDanny/sql-masterclass">Github repository</a> contains all the necessary data, sql scripts, and other materials.</p>
<p>I‚Äôm posting some parts of it here for my own reference, but I strongly recommend that you register for that event that takes place every once in a while. It‚Äôs free and worth it. Danny Ma is an excellent teacher and his explanations are outstanding.</p>
<section id="setting-up-the-programming-environment" class="level3">
<h3 class="anchored" data-anchor-id="setting-up-the-programming-environment">Setting up the programming environment</h3>
<p>For the purposes of this project, I created the local <code>trading</code> Postgres database on my machine and ran the sql script to create and populate the tables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;"># loading packages</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;">library</span>(DBI)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;">library</span>(RPostgres)  </span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;">library</span>(tidyverse)</span></code></pre></div>
</div>
<p>The <code>sql</code> engine uses the <code>DBI</code> package to execute SQL queries, print their results, and optionally assign the results to a data frame. To use the <code>sql</code> engine, we first need to establish a DBI connection to a database (typically via the <code>DBI::dbConnect()</code> function).</p>
</section>
<section id="creating-a-connection-to-the-trading-database" class="level3">
<h3 class="anchored" data-anchor-id="creating-a-connection-to-the-trading-database">Creating a connection to the <code>trading</code> database</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">mycon <span class="ot" style="color: #003B4F;">&lt;-</span> DBI<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">dbConnect</span>(RPostgres<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">Postgres</span>(), </span>
<span id="cb2-2">                        <span class="at" style="color: #657422;">dbname =</span> <span class="st" style="color: #20794D;">"trading"</span>, </span>
<span id="cb2-3">                        <span class="at" style="color: #657422;">host =</span> <span class="st" style="color: #20794D;">"localhost"</span>,  </span>
<span id="cb2-4">                        <span class="at" style="color: #657422;">port =</span> <span class="st" style="color: #20794D;">"5432"</span>,  </span>
<span id="cb2-5">                        <span class="at" style="color: #657422;">user =</span> rstudioapi<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">askForPassword</span>(<span class="st" style="color: #20794D;">"Database username"</span>),</span>
<span id="cb2-6">                        <span class="at" style="color: #657422;">password =</span> rstudioapi<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">askForPassword</span>(<span class="st" style="color: #20794D;">"Database password"</span>))</span></code></pre></div>
</div>
<p>There are several options to <a href="https://solutions.posit.co/connections/db/best-practices/managing-credentials/index.html">secure your credentials</a> in R. Here I use prompting for credentials via <code>rstudioapi</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">mycon</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;PqConnection&gt; trading@localhost:5432</code></pre>
</div>
</div>
</section>
</section>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>In this fictitious case study - Danny‚Äôs data mentors from the Data With Danny team have been busy trading cryptocurrency markets since 2017.</p>
<p>The main purpose for this case study is to analyze the performance of the DWD mentors over time. We will accomplish this by writing SQL queries to utilize all available datasets to answer a series of realistic business questions.</p>
<section id="available-datasets" class="level3">
<h3 class="anchored" data-anchor-id="available-datasets">Available Datasets</h3>
<p>All of our data for this case study exists within the <code>trading</code> schema in the <strong>PostgreSQL database</strong>.</p>
<p>There are 3 data tables available in this schema:</p>
<ul>
<li><code>members</code></li>
<li><code>prices</code></li>
<li><code>transactions</code></li>
</ul>
</section>
<section id="entity-relationship-diagram" class="level3">
<h3 class="anchored" data-anchor-id="entity-relationship-diagram">Entity Relationship Diagram</h3>
<p>I drew the ERD <a href="https://dbdiagram.io/home">here</a>.</p>
<p><img src="https://sandrajurela.com/posts/cryptocurrency-sql-case-study/images/erd_trading.png" class="preview-image img-fluid"></p>
</section>
<section id="data-dictionary-and-overview" class="level3">
<h3 class="anchored" data-anchor-id="data-dictionary-and-overview">Data Dictionary and Overview</h3>
<p>The <strong><code>trading.members</code> table</strong> consists of information about the mentors from the Data With Danny team.</p>
<table class="table">
<caption><code>trading.members</code> table</caption>
<thead>
<tr class="header">
<th>Column name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>member_id</code></td>
<td>unique id for each mentor</td>
</tr>
<tr class="even">
<td><code>first_name</code></td>
<td>first name for each mentor</td>
</tr>
<tr class="odd">
<td><code>region</code></td>
<td>region where each mentor is from</td>
</tr>
</tbody>
</table>
<div class="cell" data-max.print="null">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb5-1"><span class="kw" style="color: #003B4F;">SELECT</span> <span class="op" style="color: #5E5E5E;">*</span> <span class="kw" style="color: #003B4F;">FROM</span> trading.members</span></code></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>14 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">member_id</th>
<th style="text-align: left;">first_name</th>
<th style="text-align: left;">region</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">c4ca42</td>
<td style="text-align: left;">Danny</td>
<td style="text-align: left;">Australia</td>
</tr>
<tr class="even">
<td style="text-align: left;">c81e72</td>
<td style="text-align: left;">Vipul</td>
<td style="text-align: left;">United States</td>
</tr>
<tr class="odd">
<td style="text-align: left;">eccbc8</td>
<td style="text-align: left;">Charlie</td>
<td style="text-align: left;">United States</td>
</tr>
<tr class="even">
<td style="text-align: left;">a87ff6</td>
<td style="text-align: left;">Nandita</td>
<td style="text-align: left;">United States</td>
</tr>
<tr class="odd">
<td style="text-align: left;">e4da3b</td>
<td style="text-align: left;">Rowan</td>
<td style="text-align: left;">United States</td>
</tr>
<tr class="even">
<td style="text-align: left;">167909</td>
<td style="text-align: left;">Ayush</td>
<td style="text-align: left;">United States</td>
</tr>
<tr class="odd">
<td style="text-align: left;">8f14e4</td>
<td style="text-align: left;">Alex</td>
<td style="text-align: left;">United States</td>
</tr>
<tr class="even">
<td style="text-align: left;">c9f0f8</td>
<td style="text-align: left;">Abe</td>
<td style="text-align: left;">United States</td>
</tr>
<tr class="odd">
<td style="text-align: left;">45c48c</td>
<td style="text-align: left;">Ben</td>
<td style="text-align: left;">Australia</td>
</tr>
<tr class="even">
<td style="text-align: left;">d3d944</td>
<td style="text-align: left;">Enoch</td>
<td style="text-align: left;">Africa</td>
</tr>
<tr class="odd">
<td style="text-align: left;">6512bd</td>
<td style="text-align: left;">Vikram</td>
<td style="text-align: left;">India</td>
</tr>
<tr class="even">
<td style="text-align: left;">c20ad4</td>
<td style="text-align: left;">Leah</td>
<td style="text-align: left;">Asia</td>
</tr>
<tr class="odd">
<td style="text-align: left;">c51ce4</td>
<td style="text-align: left;">Pavan</td>
<td style="text-align: left;">Australia</td>
</tr>
<tr class="even">
<td style="text-align: left;">aab323</td>
<td style="text-align: left;">Sonia</td>
<td style="text-align: left;">Australia</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The <strong><code>trading.prices</code> table</strong> consists of daily price and volume information from January 2017 through to August 2021 for the 2 most popular cryptocurrency tickers: Bitcoin and Ethereum.</p>
<table class="table">
<caption><code>trading.prices</code> table</caption>
<thead>
<tr class="header">
<th>Column name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>ticker</code></td>
<td>one of either BTC or ETH</td>
</tr>
<tr class="even">
<td><code>market_date</code></td>
<td>the date for each record</td>
</tr>
<tr class="odd">
<td><code>price</code></td>
<td>closing price at end of day</td>
</tr>
<tr class="even">
<td><code>open</code></td>
<td>the opening price</td>
</tr>
<tr class="odd">
<td><code>high</code></td>
<td>the highest price for that day</td>
</tr>
<tr class="even">
<td><code>low</code></td>
<td>the lowest price for that day</td>
</tr>
<tr class="odd">
<td><code>volume</code></td>
<td>the total volume traded</td>
</tr>
<tr class="even">
<td><code>change</code></td>
<td>% change in daily price</td>
</tr>
</tbody>
</table>
<p>The first 5 rows from this dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb6-1"><span class="kw" style="color: #003B4F;">SELECT</span> <span class="op" style="color: #5E5E5E;">*</span> <span class="kw" style="color: #003B4F;">FROM</span> trading.prices <span class="kw" style="color: #003B4F;">LIMIT</span> <span class="dv" style="color: #AD0000;">5</span></span></code></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>5 records</caption>
<colgroup>
<col style="width: 10%">
<col style="width: 18%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">ticker</th>
<th style="text-align: left;">market_date</th>
<th style="text-align: right;">price</th>
<th style="text-align: right;">open</th>
<th style="text-align: right;">high</th>
<th style="text-align: right;">low</th>
<th style="text-align: left;">volume</th>
<th style="text-align: left;">change</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ETH</td>
<td style="text-align: left;">2021-08-29</td>
<td style="text-align: right;">3177.84</td>
<td style="text-align: right;">3243.96</td>
<td style="text-align: right;">3282.21</td>
<td style="text-align: right;">3162.79</td>
<td style="text-align: left;">582.04K</td>
<td style="text-align: left;">-2.04%</td>
</tr>
<tr class="even">
<td style="text-align: left;">ETH</td>
<td style="text-align: left;">2021-08-28</td>
<td style="text-align: right;">3243.90</td>
<td style="text-align: right;">3273.78</td>
<td style="text-align: right;">3284.58</td>
<td style="text-align: right;">3212.24</td>
<td style="text-align: left;">466.21K</td>
<td style="text-align: left;">-0.91%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ETH</td>
<td style="text-align: left;">2021-08-27</td>
<td style="text-align: right;">3273.58</td>
<td style="text-align: right;">3093.78</td>
<td style="text-align: right;">3279.93</td>
<td style="text-align: right;">3063.37</td>
<td style="text-align: left;">839.54K</td>
<td style="text-align: left;">5.82%</td>
</tr>
<tr class="even">
<td style="text-align: left;">ETH</td>
<td style="text-align: left;">2021-08-26</td>
<td style="text-align: right;">3093.54</td>
<td style="text-align: right;">3228.03</td>
<td style="text-align: right;">3249.62</td>
<td style="text-align: right;">3057.48</td>
<td style="text-align: left;">118.44K</td>
<td style="text-align: left;">-4.17%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ETH</td>
<td style="text-align: left;">2021-08-25</td>
<td style="text-align: right;">3228.15</td>
<td style="text-align: right;">3172.12</td>
<td style="text-align: right;">3247.43</td>
<td style="text-align: right;">3080.70</td>
<td style="text-align: left;">923.13K</td>
<td style="text-align: left;">1.73%</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The <strong><code>trading.transactions</code> table</strong> consists of buy and sell transactions data for each trade made by the DWD mentors.</p>
<table class="table">
<caption><code>trading.transactions</code> table</caption>
<thead>
<tr class="header">
<th>Column name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>txn_id</code></td>
<td>unique ID for each transaction</td>
</tr>
<tr class="even">
<td><code>member_id</code></td>
<td>member identifier for each trade</td>
</tr>
<tr class="odd">
<td><code>ticker</code></td>
<td>the ticker for each trade</td>
</tr>
<tr class="even">
<td><code>txn_date</code></td>
<td>the date for each transaction</td>
</tr>
<tr class="odd">
<td><code>txn_type</code></td>
<td>either BUY or SELL</td>
</tr>
<tr class="even">
<td><code>quantity</code></td>
<td>the total quantity for each trade</td>
</tr>
<tr class="odd">
<td><code>percentage_fee</code></td>
<td>% of total amount charged as fees</td>
</tr>
<tr class="even">
<td><code>txn_time</code></td>
<td>the timestamp for each trade</td>
</tr>
</tbody>
</table>
<p>The first 5 frows from this transactions table.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb7-1"><span class="kw" style="color: #003B4F;">SELECT</span> <span class="op" style="color: #5E5E5E;">*</span> <span class="kw" style="color: #003B4F;">FROM</span> trading.transactions <span class="kw" style="color: #003B4F;">LIMIT</span> <span class="dv" style="color: #AD0000;">5</span></span></code></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>5 records</caption>
<colgroup>
<col style="width: 8%">
<col style="width: 12%">
<col style="width: 8%">
<col style="width: 13%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 18%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">txn_id</th>
<th style="text-align: left;">member_id</th>
<th style="text-align: left;">ticker</th>
<th style="text-align: left;">txn_date</th>
<th style="text-align: left;">txn_type</th>
<th style="text-align: right;">quantity</th>
<th style="text-align: right;">percentage_fee</th>
<th style="text-align: left;">txn_time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">c81e72</td>
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2017-01-01</td>
<td style="text-align: left;">BUY</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">0.3</td>
<td style="text-align: left;">2017-01-01</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: left;">eccbc8</td>
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2017-01-01</td>
<td style="text-align: left;">BUY</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">0.3</td>
<td style="text-align: left;">2017-01-01</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: left;">a87ff6</td>
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2017-01-01</td>
<td style="text-align: left;">BUY</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: left;">2017-01-01</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: left;">e4da3b</td>
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2017-01-01</td>
<td style="text-align: left;">BUY</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">0.3</td>
<td style="text-align: left;">2017-01-01</td>
</tr>
<tr class="odd">
<td style="text-align: left;">5</td>
<td style="text-align: left;">167909</td>
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2017-01-01</td>
<td style="text-align: left;">BUY</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">0.3</td>
<td style="text-align: left;">2017-01-01</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="part-1-basic-data-analysis-techniques" class="level2">
<h2 class="anchored" data-anchor-id="part-1-basic-data-analysis-techniques">PART 1Ô∏è‚É£: Basic Data Analysis Techniques</h2>
<section id="question-1.1" class="level3">
<h3 class="anchored" data-anchor-id="question-1.1">Question 1.1</h3>
<p>Show only the top 5 rows from the <code>trading.members</code> table.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb8-1"><span class="kw" style="color: #003B4F;">SELECT</span> <span class="op" style="color: #5E5E5E;">*</span> </span>
<span id="cb8-2"><span class="kw" style="color: #003B4F;">FROM</span> trading.members</span>
<span id="cb8-3"><span class="kw" style="color: #003B4F;">LIMIT</span> <span class="dv" style="color: #AD0000;">5</span></span></code></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>5 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">member_id</th>
<th style="text-align: left;">first_name</th>
<th style="text-align: left;">region</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">c4ca42</td>
<td style="text-align: left;">Danny</td>
<td style="text-align: left;">Australia</td>
</tr>
<tr class="even">
<td style="text-align: left;">c81e72</td>
<td style="text-align: left;">Vipul</td>
<td style="text-align: left;">United States</td>
</tr>
<tr class="odd">
<td style="text-align: left;">eccbc8</td>
<td style="text-align: left;">Charlie</td>
<td style="text-align: left;">United States</td>
</tr>
<tr class="even">
<td style="text-align: left;">a87ff6</td>
<td style="text-align: left;">Nandita</td>
<td style="text-align: left;">United States</td>
</tr>
<tr class="odd">
<td style="text-align: left;">e4da3b</td>
<td style="text-align: left;">Rowan</td>
<td style="text-align: left;">United States</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="question-1.2" class="level3">
<h3 class="anchored" data-anchor-id="question-1.2">Question 1.2</h3>
<p>Sort all the rows in the <code>trading.members</code> table by <code>first_name</code> in alphabetical order and show the top 3 rows with all columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb9-1"><span class="kw" style="color: #003B4F;">SELECT</span> <span class="op" style="color: #5E5E5E;">*</span> </span>
<span id="cb9-2"><span class="kw" style="color: #003B4F;">FROM</span> trading.members</span>
<span id="cb9-3"><span class="kw" style="color: #003B4F;">ORDER</span> <span class="kw" style="color: #003B4F;">BY</span> first_name</span>
<span id="cb9-4"><span class="kw" style="color: #003B4F;">LIMIT</span> <span class="dv" style="color: #AD0000;">3</span></span></code></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>3 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">member_id</th>
<th style="text-align: left;">first_name</th>
<th style="text-align: left;">region</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">c9f0f8</td>
<td style="text-align: left;">Abe</td>
<td style="text-align: left;">United States</td>
</tr>
<tr class="even">
<td style="text-align: left;">8f14e4</td>
<td style="text-align: left;">Alex</td>
<td style="text-align: left;">United States</td>
</tr>
<tr class="odd">
<td style="text-align: left;">167909</td>
<td style="text-align: left;">Ayush</td>
<td style="text-align: left;">United States</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="question-1.3" class="level3">
<h3 class="anchored" data-anchor-id="question-1.3">Question 1.3</h3>
<p>Count the number of records from the <code>trading.members</code> table which have United States as the <code>region</code> value.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb10-1"><span class="kw" style="color: #003B4F;">SELECT</span> </span>
<span id="cb10-2">  <span class="fu" style="color: #4758AB;">COUNT</span>(<span class="op" style="color: #5E5E5E;">*</span>) <span class="kw" style="color: #003B4F;">AS</span> record_count</span>
<span id="cb10-3"><span class="kw" style="color: #003B4F;">FROM</span> trading.members</span>
<span id="cb10-4"><span class="kw" style="color: #003B4F;">WHERE</span> region <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'United States'</span></span></code></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>1 records</caption>
<thead>
<tr class="header">
<th style="text-align: right;">record_count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">7</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="question-1.4" class="level3">
<h3 class="anchored" data-anchor-id="question-1.4">Question 1.4</h3>
<p>Select only the <code>first_name</code> and <code>region</code> columns for mentors who are not from Australia.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb11-1"><span class="kw" style="color: #003B4F;">SELECT</span> </span>
<span id="cb11-2">  first_name, </span>
<span id="cb11-3">  region</span>
<span id="cb11-4"><span class="kw" style="color: #003B4F;">FROM</span> trading.members</span>
<span id="cb11-5"><span class="kw" style="color: #003B4F;">WHERE</span> region <span class="op" style="color: #5E5E5E;">!=</span> <span class="st" style="color: #20794D;">'Australia'</span></span></code></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th style="text-align: left;">first_name</th>
<th style="text-align: left;">region</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Vipul</td>
<td style="text-align: left;">United States</td>
</tr>
<tr class="even">
<td style="text-align: left;">Charlie</td>
<td style="text-align: left;">United States</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Nandita</td>
<td style="text-align: left;">United States</td>
</tr>
<tr class="even">
<td style="text-align: left;">Rowan</td>
<td style="text-align: left;">United States</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Ayush</td>
<td style="text-align: left;">United States</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alex</td>
<td style="text-align: left;">United States</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Abe</td>
<td style="text-align: left;">United States</td>
</tr>
<tr class="even">
<td style="text-align: left;">Enoch</td>
<td style="text-align: left;">Africa</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Vikram</td>
<td style="text-align: left;">India</td>
</tr>
<tr class="even">
<td style="text-align: left;">Leah</td>
<td style="text-align: left;">Asia</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="question-1.5" class="level3">
<h3 class="anchored" data-anchor-id="question-1.5">Question 1.5</h3>
<p>Return only the unique <code>region</code> values from the <code>trading.members</code> table and sort the output by reverse alphabetical order.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb12-1"><span class="kw" style="color: #003B4F;">SELECT</span> <span class="kw" style="color: #003B4F;">DISTINCT</span> region</span>
<span id="cb12-2"><span class="kw" style="color: #003B4F;">FROM</span> trading.members</span>
<span id="cb12-3"><span class="kw" style="color: #003B4F;">ORDER</span> <span class="kw" style="color: #003B4F;">BY</span> region <span class="kw" style="color: #003B4F;">DESC</span></span></code></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>5 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">region</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">United States</td>
</tr>
<tr class="even">
<td style="text-align: left;">India</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Australia</td>
</tr>
<tr class="even">
<td style="text-align: left;">Asia</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Africa</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="part-2-aggregate-functions-for-data-analysis" class="level2">
<h2 class="anchored" data-anchor-id="part-2-aggregate-functions-for-data-analysis">PART 2Ô∏è‚É£: Aggregate Functions for Data Analysis</h2>
<section id="question-2.1" class="level3">
<h3 class="anchored" data-anchor-id="question-2.1">Question 2.1</h3>
<p>How many records are there per <code>ticker</code> value in the <code>trading.prices</code> table?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb13-1"><span class="kw" style="color: #003B4F;">SELECT</span></span>
<span id="cb13-2">  ticker,</span>
<span id="cb13-3">  <span class="fu" style="color: #4758AB;">COUNT</span>(<span class="op" style="color: #5E5E5E;">*</span>) <span class="kw" style="color: #003B4F;">AS</span> record_count</span>
<span id="cb13-4"><span class="kw" style="color: #003B4F;">FROM</span> trading.prices</span>
<span id="cb13-5"><span class="kw" style="color: #003B4F;">GROUP</span> <span class="kw" style="color: #003B4F;">BY</span> ticker</span></code></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>2 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">ticker</th>
<th style="text-align: right;">record_count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">BTC</td>
<td style="text-align: right;">1702</td>
</tr>
<tr class="even">
<td style="text-align: left;">ETH</td>
<td style="text-align: right;">1702</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="question-2.2" class="level3">
<h3 class="anchored" data-anchor-id="question-2.2">Question 2.2</h3>
<p>What is the maximum, minimum values for the <code>price</code> column for both Bitcoin and Ethereum in 2020?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb14-1"><span class="kw" style="color: #003B4F;">SELECT</span> </span>
<span id="cb14-2">  ticker,</span>
<span id="cb14-3">  <span class="fu" style="color: #4758AB;">MIN</span>(price) <span class="kw" style="color: #003B4F;">AS</span> min_price,</span>
<span id="cb14-4">  <span class="fu" style="color: #4758AB;">MAX</span>(price) <span class="kw" style="color: #003B4F;">AS</span> max_price</span>
<span id="cb14-5"><span class="kw" style="color: #003B4F;">FROM</span> trading.prices</span>
<span id="cb14-6"><span class="kw" style="color: #003B4F;">WHERE</span> market_date <span class="kw" style="color: #003B4F;">BETWEEN</span> <span class="st" style="color: #20794D;">'2020-01-01'</span> <span class="kw" style="color: #003B4F;">AND</span> <span class="st" style="color: #20794D;">'2020-12-31'</span></span>
<span id="cb14-7"><span class="kw" style="color: #003B4F;">GROUP</span> <span class="kw" style="color: #003B4F;">BY</span> ticker</span></code></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>2 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">ticker</th>
<th style="text-align: right;">min_price</th>
<th style="text-align: right;">max_price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">BTC</td>
<td style="text-align: right;">4826.0</td>
<td style="text-align: right;">28949.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">ETH</td>
<td style="text-align: right;">107.9</td>
<td style="text-align: right;">751.8</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="question-2.3" class="level3">
<h3 class="anchored" data-anchor-id="question-2.3">Question 2.3</h3>
<p>What is the annual minimum, maximum and average price for each ticker?</p>
<ul>
<li>Include a calendar_year column with the year from 2017 through to 2021</li>
<li>Calculate a <code>spread</code> column which calculates the difference between the min and max prices</li>
<li>Round the average price output to 2 decimal places</li>
<li>Sort the output in chronological order with Bitcoin records before Ethereum within each year</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb15-1"><span class="kw" style="color: #003B4F;">SELECT</span></span>
<span id="cb15-2">  <span class="fu" style="color: #4758AB;">EXTRACT</span>(<span class="dt" style="color: #AD0000;">YEAR</span> <span class="kw" style="color: #003B4F;">FROM</span> market_date) <span class="kw" style="color: #003B4F;">AS</span> calendar_year,</span>
<span id="cb15-3">  ticker,</span>
<span id="cb15-4">  <span class="fu" style="color: #4758AB;">MIN</span>(price) <span class="kw" style="color: #003B4F;">AS</span> min_price,</span>
<span id="cb15-5">  <span class="fu" style="color: #4758AB;">MAX</span>(price) <span class="kw" style="color: #003B4F;">AS</span> max_price,</span>
<span id="cb15-6">  <span class="fu" style="color: #4758AB;">ROUND</span>(<span class="fu" style="color: #4758AB;">AVG</span>(price):<span class="ch" style="color: #20794D;">:NUMERIC</span>, <span class="dv" style="color: #AD0000;">2</span>) <span class="kw" style="color: #003B4F;">AS</span> avg_price,</span>
<span id="cb15-7">  <span class="fu" style="color: #4758AB;">MAX</span>(price) <span class="op" style="color: #5E5E5E;">-</span> <span class="fu" style="color: #4758AB;">MIN</span>(price) <span class="kw" style="color: #003B4F;">AS</span> spread</span>
<span id="cb15-8"><span class="kw" style="color: #003B4F;">FROM</span> trading.prices</span>
<span id="cb15-9"><span class="kw" style="color: #003B4F;">GROUP</span> <span class="kw" style="color: #003B4F;">BY</span> calendar_year, ticker</span>
<span id="cb15-10"><span class="kw" style="color: #003B4F;">ORDER</span> <span class="kw" style="color: #003B4F;">BY</span> calendar_year, ticker</span></code></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th style="text-align: right;">calendar_year</th>
<th style="text-align: left;">ticker</th>
<th style="text-align: right;">min_price</th>
<th style="text-align: right;">max_price</th>
<th style="text-align: right;">avg_price</th>
<th style="text-align: right;">spread</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2017</td>
<td style="text-align: left;">BTC</td>
<td style="text-align: right;">785.40</td>
<td style="text-align: right;">19345.50</td>
<td style="text-align: right;">3981.07</td>
<td style="text-align: right;">18560.10</td>
</tr>
<tr class="even">
<td style="text-align: right;">2017</td>
<td style="text-align: left;">ETH</td>
<td style="text-align: right;">8.20</td>
<td style="text-align: right;">799.98</td>
<td style="text-align: right;">220.34</td>
<td style="text-align: right;">791.78</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2018</td>
<td style="text-align: left;">BTC</td>
<td style="text-align: right;">3228.70</td>
<td style="text-align: right;">17172.30</td>
<td style="text-align: right;">7552.16</td>
<td style="text-align: right;">13943.60</td>
</tr>
<tr class="even">
<td style="text-align: right;">2018</td>
<td style="text-align: left;">ETH</td>
<td style="text-align: right;">83.81</td>
<td style="text-align: right;">1380.00</td>
<td style="text-align: right;">481.33</td>
<td style="text-align: right;">1296.19</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2019</td>
<td style="text-align: left;">BTC</td>
<td style="text-align: right;">3397.70</td>
<td style="text-align: right;">13063.80</td>
<td style="text-align: right;">7371.82</td>
<td style="text-align: right;">9666.10</td>
</tr>
<tr class="even">
<td style="text-align: right;">2019</td>
<td style="text-align: left;">ETH</td>
<td style="text-align: right;">104.55</td>
<td style="text-align: right;">338.54</td>
<td style="text-align: right;">180.99</td>
<td style="text-align: right;">233.99</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2020</td>
<td style="text-align: left;">BTC</td>
<td style="text-align: right;">4826.00</td>
<td style="text-align: right;">28949.40</td>
<td style="text-align: right;">11111.63</td>
<td style="text-align: right;">24123.40</td>
</tr>
<tr class="even">
<td style="text-align: right;">2020</td>
<td style="text-align: left;">ETH</td>
<td style="text-align: right;">107.90</td>
<td style="text-align: right;">751.80</td>
<td style="text-align: right;">307.30</td>
<td style="text-align: right;">643.90</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2021</td>
<td style="text-align: left;">BTC</td>
<td style="text-align: right;">29359.90</td>
<td style="text-align: right;">63540.90</td>
<td style="text-align: right;">44353.55</td>
<td style="text-align: right;">34181.00</td>
</tr>
<tr class="even">
<td style="text-align: right;">2021</td>
<td style="text-align: left;">ETH</td>
<td style="text-align: right;">729.12</td>
<td style="text-align: right;">4167.78</td>
<td style="text-align: right;">2199.12</td>
<td style="text-align: right;">3438.66</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="question-2.4" class="level3">
<h3 class="anchored" data-anchor-id="question-2.4">Question 2.4</h3>
<p>What is the monthly average of the <code>price</code> column for each ticker from January 2020 and after?</p>
<ul>
<li>Create a <code>month_start</code> column with the first day of each month</li>
<li>Sort the output by ticker in alphabetical order and months in chronological order</li>
<li>Round the <code>average_price</code> column to 2 decimal places</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb16-1"><span class="kw" style="color: #003B4F;">SELECT</span></span>
<span id="cb16-2">  ticker,</span>
<span id="cb16-3">  DATE_TRUNC(<span class="st" style="color: #20794D;">'MON'</span>, market_date):<span class="ch" style="color: #20794D;">:DATE</span> <span class="kw" style="color: #003B4F;">AS</span> month_start,</span>
<span id="cb16-4">  <span class="fu" style="color: #4758AB;">ROUND</span>(<span class="fu" style="color: #4758AB;">AVG</span>(price):<span class="ch" style="color: #20794D;">:NUMERIC</span>, <span class="dv" style="color: #AD0000;">2</span>) <span class="kw" style="color: #003B4F;">AS</span> average_price</span>
<span id="cb16-5"><span class="kw" style="color: #003B4F;">FROM</span> trading.prices</span>
<span id="cb16-6"><span class="kw" style="color: #003B4F;">WHERE</span> market_date <span class="op" style="color: #5E5E5E;">&gt;=</span> <span class="st" style="color: #20794D;">'2020-01-01'</span></span>
<span id="cb16-7"><span class="kw" style="color: #003B4F;">GROUP</span> <span class="kw" style="color: #003B4F;">BY</span> ticker, month_start</span>
<span id="cb16-8"><span class="kw" style="color: #003B4F;">ORDER</span> <span class="kw" style="color: #003B4F;">BY</span> ticker, month_start</span></code></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th style="text-align: left;">ticker</th>
<th style="text-align: left;">month_start</th>
<th style="text-align: right;">average_price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2020-01-01</td>
<td style="text-align: right;">8378.80</td>
</tr>
<tr class="even">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2020-02-01</td>
<td style="text-align: right;">9636.56</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2020-03-01</td>
<td style="text-align: right;">6863.11</td>
</tr>
<tr class="even">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2020-04-01</td>
<td style="text-align: right;">7211.03</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2020-05-01</td>
<td style="text-align: right;">9253.55</td>
</tr>
<tr class="even">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2020-06-01</td>
<td style="text-align: right;">9481.85</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2020-07-01</td>
<td style="text-align: right;">9592.10</td>
</tr>
<tr class="even">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2020-08-01</td>
<td style="text-align: right;">11638.41</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2020-09-01</td>
<td style="text-align: right;">10643.33</td>
</tr>
<tr class="even">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2020-10-01</td>
<td style="text-align: right;">11888.36</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="part-3-case-when-statements" class="level2">
<h2 class="anchored" data-anchor-id="part-3-case-when-statements">PART 3Ô∏è‚É£: Case When Statements</h2>
<section id="question-3.1" class="level3">
<h3 class="anchored" data-anchor-id="question-3.1">Question 3.1</h3>
<p>Convert the <code>volume</code> column in the <code>trading.prices</code> table with an adjusted integer value to take into the unit values</p>
<ul>
<li>Return only the <code>market_date</code>, <code>price</code>, <code>volume</code> and <code>adjusted_volume</code> columns for the first 10 days of August 2021 for Ethereum only</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb17-1"><span class="kw" style="color: #003B4F;">SELECT</span></span>
<span id="cb17-2">  market_date,</span>
<span id="cb17-3">  price,</span>
<span id="cb17-4">  volume,    </span>
<span id="cb17-5">  <span class="cf" style="color: #003B4F;">CASE</span></span>
<span id="cb17-6">    <span class="cf" style="color: #003B4F;">WHEN</span> <span class="kw" style="color: #003B4F;">RIGHT</span>(volume, <span class="dv" style="color: #AD0000;">1</span>) <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'K'</span> <span class="cf" style="color: #003B4F;">THEN</span> <span class="kw" style="color: #003B4F;">LEFT</span>(volume, <span class="fu" style="color: #4758AB;">LENGTH</span>(volume) <span class="op" style="color: #5E5E5E;">-</span> <span class="dv" style="color: #AD0000;">1</span>):<span class="ch" style="color: #20794D;">:NUMERIC</span> <span class="op" style="color: #5E5E5E;">*</span> <span class="dv" style="color: #AD0000;">1000</span> </span>
<span id="cb17-7">    <span class="cf" style="color: #003B4F;">WHEN</span> <span class="kw" style="color: #003B4F;">RIGHT</span>(volume, <span class="dv" style="color: #AD0000;">1</span>) <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'M'</span> <span class="cf" style="color: #003B4F;">THEN</span> <span class="kw" style="color: #003B4F;">LEFT</span>(volume, <span class="fu" style="color: #4758AB;">LENGTH</span>(volume) <span class="op" style="color: #5E5E5E;">-</span> <span class="dv" style="color: #AD0000;">1</span>):<span class="ch" style="color: #20794D;">:NUMERIC</span> <span class="op" style="color: #5E5E5E;">*</span> <span class="dv" style="color: #AD0000;">1000000</span> </span>
<span id="cb17-8">    <span class="cf" style="color: #003B4F;">WHEN</span> volume <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'-'</span> <span class="cf" style="color: #003B4F;">THEN</span> <span class="dv" style="color: #AD0000;">0</span></span>
<span id="cb17-9">    <span class="cf" style="color: #003B4F;">END</span> <span class="kw" style="color: #003B4F;">AS</span> adjusted_volume</span>
<span id="cb17-10"><span class="kw" style="color: #003B4F;">FROM</span> trading.prices</span>
<span id="cb17-11"><span class="kw" style="color: #003B4F;">WHERE</span> ticker <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'ETH'</span></span>
<span id="cb17-12">  <span class="kw" style="color: #003B4F;">AND</span> market_date <span class="kw" style="color: #003B4F;">BETWEEN</span> <span class="st" style="color: #20794D;">'2021-08-01'</span> <span class="kw" style="color: #003B4F;">AND</span> <span class="st" style="color: #20794D;">'2021-08-10'</span></span>
<span id="cb17-13"><span class="kw" style="color: #003B4F;">ORDER</span> <span class="kw" style="color: #003B4F;">BY</span> market_date</span></code></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th style="text-align: left;">market_date</th>
<th style="text-align: right;">price</th>
<th style="text-align: left;">volume</th>
<th style="text-align: right;">adjusted_volume</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2021-08-01</td>
<td style="text-align: right;">2556.23</td>
<td style="text-align: left;">1.20M</td>
<td style="text-align: right;">1200000</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-08-02</td>
<td style="text-align: right;">2608.04</td>
<td style="text-align: left;">970.67K</td>
<td style="text-align: right;">970670</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-08-03</td>
<td style="text-align: right;">2506.65</td>
<td style="text-align: left;">158.45K</td>
<td style="text-align: right;">158450</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-08-04</td>
<td style="text-align: right;">2725.29</td>
<td style="text-align: left;">1.23M</td>
<td style="text-align: right;">1230000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-08-05</td>
<td style="text-align: right;">2827.21</td>
<td style="text-align: left;">1.65M</td>
<td style="text-align: right;">1650000</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-08-06</td>
<td style="text-align: right;">2889.43</td>
<td style="text-align: left;">1.06M</td>
<td style="text-align: right;">1060000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-08-07</td>
<td style="text-align: right;">3158.00</td>
<td style="text-align: left;">64.84K</td>
<td style="text-align: right;">64840</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-08-08</td>
<td style="text-align: right;">3012.07</td>
<td style="text-align: left;">1.25M</td>
<td style="text-align: right;">1250000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-08-09</td>
<td style="text-align: right;">3162.93</td>
<td style="text-align: left;">1.44M</td>
<td style="text-align: right;">1440000</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-08-10</td>
<td style="text-align: right;">3140.71</td>
<td style="text-align: left;">1.12M</td>
<td style="text-align: right;">1120000</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="question-3.2" class="level3">
<h3 class="anchored" data-anchor-id="question-3.2">Question 3.2</h3>
<p>How many ‚Äúbreakout‚Äù days were there in 2020 where the <code>price</code> column is greater than the <code>open</code> column for each <code>ticker</code>? In the same query also calculate the number of ‚Äúnon breakout‚Äù days where the <code>price</code> column was lower than or equal to the <code>open</code> column.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb18-1"><span class="kw" style="color: #003B4F;">SELECT</span></span>
<span id="cb18-2">  ticker,</span>
<span id="cb18-3">  <span class="fu" style="color: #4758AB;">SUM</span>(<span class="cf" style="color: #003B4F;">CASE</span> <span class="cf" style="color: #003B4F;">WHEN</span> price <span class="op" style="color: #5E5E5E;">&gt;</span> <span class="kw" style="color: #003B4F;">open</span> <span class="cf" style="color: #003B4F;">THEN</span> <span class="dv" style="color: #AD0000;">1</span> <span class="cf" style="color: #003B4F;">ELSE</span> <span class="dv" style="color: #AD0000;">0</span> <span class="cf" style="color: #003B4F;">END</span>) <span class="kw" style="color: #003B4F;">AS</span> breakout_days,</span>
<span id="cb18-4">  <span class="fu" style="color: #4758AB;">SUM</span>(<span class="cf" style="color: #003B4F;">CASE</span> <span class="cf" style="color: #003B4F;">WHEN</span> price <span class="op" style="color: #5E5E5E;">&lt;=</span> <span class="kw" style="color: #003B4F;">open</span> <span class="cf" style="color: #003B4F;">THEN</span> <span class="dv" style="color: #AD0000;">1</span> <span class="cf" style="color: #003B4F;">ELSE</span> <span class="dv" style="color: #AD0000;">0</span> <span class="cf" style="color: #003B4F;">END</span>) <span class="kw" style="color: #003B4F;">AS</span> non_breakout_days</span>
<span id="cb18-5"><span class="kw" style="color: #003B4F;">FROM</span> trading.prices</span>
<span id="cb18-6"><span class="kw" style="color: #003B4F;">WHERE</span> market_date <span class="kw" style="color: #003B4F;">BETWEEN</span> <span class="st" style="color: #20794D;">'2020-01-01'</span> <span class="kw" style="color: #003B4F;">AND</span> <span class="st" style="color: #20794D;">'2020-12-31'</span></span>
<span id="cb18-7"><span class="kw" style="color: #003B4F;">GROUP</span> <span class="kw" style="color: #003B4F;">BY</span> ticker</span></code></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>2 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">ticker</th>
<th style="text-align: right;">breakout_days</th>
<th style="text-align: right;">non_breakout_days</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">BTC</td>
<td style="text-align: right;">207</td>
<td style="text-align: right;">159</td>
</tr>
<tr class="even">
<td style="text-align: left;">ETH</td>
<td style="text-align: right;">200</td>
<td style="text-align: right;">166</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="question-3.3" class="level3">
<h3 class="anchored" data-anchor-id="question-3.3">Question 3.3</h3>
<p>What was the final quantity Bitcoin and Ethereum held by all Data With Danny mentors based off the <code>trading.transactions</code> table?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb19-1"><span class="kw" style="color: #003B4F;">SELECT</span> </span>
<span id="cb19-2">  ticker,</span>
<span id="cb19-3">  <span class="fu" style="color: #4758AB;">SUM</span>(<span class="cf" style="color: #003B4F;">CASE</span> <span class="cf" style="color: #003B4F;">WHEN</span> txn_type <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'SELL'</span> <span class="cf" style="color: #003B4F;">THEN</span> <span class="op" style="color: #5E5E5E;">-</span>quantity <span class="cf" style="color: #003B4F;">ELSE</span> quantity <span class="cf" style="color: #003B4F;">END</span>) <span class="kw" style="color: #003B4F;">AS</span> final_btc_holding</span>
<span id="cb19-4"><span class="kw" style="color: #003B4F;">FROM</span> trading.transactions</span>
<span id="cb19-5"><span class="kw" style="color: #003B4F;">GROUP</span> <span class="kw" style="color: #003B4F;">BY</span> ticker</span></code></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>2 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">ticker</th>
<th style="text-align: right;">final_btc_holding</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">BTC</td>
<td style="text-align: right;">42848.67</td>
</tr>
<tr class="even">
<td style="text-align: left;">ETH</td>
<td style="text-align: right;">32801.04</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Divided by quantity bought and quantity sold.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb20-1"><span class="kw" style="color: #003B4F;">SELECT</span> </span>
<span id="cb20-2">  ticker,</span>
<span id="cb20-3">  <span class="fu" style="color: #4758AB;">SUM</span>(<span class="cf" style="color: #003B4F;">CASE</span> <span class="cf" style="color: #003B4F;">WHEN</span> txn_type <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'BUY'</span> <span class="cf" style="color: #003B4F;">THEN</span> quantity <span class="cf" style="color: #003B4F;">ELSE</span> <span class="dv" style="color: #AD0000;">0</span> <span class="cf" style="color: #003B4F;">END</span>) <span class="kw" style="color: #003B4F;">AS</span> qty_bought,</span>
<span id="cb20-4">  <span class="fu" style="color: #4758AB;">SUM</span>(<span class="cf" style="color: #003B4F;">CASE</span> <span class="cf" style="color: #003B4F;">WHEN</span> txn_type <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'SELL'</span> <span class="cf" style="color: #003B4F;">THEN</span> quantity <span class="cf" style="color: #003B4F;">ELSE</span> <span class="dv" style="color: #AD0000;">0</span> <span class="cf" style="color: #003B4F;">END</span>) <span class="kw" style="color: #003B4F;">AS</span> qty_sold</span>
<span id="cb20-5"><span class="kw" style="color: #003B4F;">FROM</span> trading.transactions</span>
<span id="cb20-6"><span class="kw" style="color: #003B4F;">GROUP</span> <span class="kw" style="color: #003B4F;">BY</span> ticker</span></code></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>2 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">ticker</th>
<th style="text-align: right;">qty_bought</th>
<th style="text-align: right;">qty_sold</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">BTC</td>
<td style="text-align: right;">53250.15</td>
<td style="text-align: right;">10401.485</td>
</tr>
<tr class="even">
<td style="text-align: left;">ETH</td>
<td style="text-align: right;">42599.20</td>
<td style="text-align: right;">9798.154</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="part-4-window-functions" class="level2">
<h2 class="anchored" data-anchor-id="part-4-window-functions">PART 4Ô∏è‚É£: Window Functions</h2>
<section id="question-4.1" class="level3">
<h3 class="anchored" data-anchor-id="question-4.1">Question 4.1</h3>
<p>What are the <code>market_date</code>, <code>price</code> and <code>volume</code> and <code>price_rank</code> values for the days with the top 5 highest <code>price</code> values for each tickers in the <code>trading.prices</code> table?</p>
<ul>
<li>The <code>price_rank</code> column is the ranking for price values for each ticker with rank = 1 for the highest value.</li>
<li>Return the output for Bitcoin, followed by Ethereum in price rank order.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb21-1"><span class="kw" style="color: #003B4F;">WITH</span> cte_rank <span class="kw" style="color: #003B4F;">AS</span> (</span>
<span id="cb21-2">  <span class="kw" style="color: #003B4F;">SELECT</span></span>
<span id="cb21-3">    ticker,</span>
<span id="cb21-4">    market_date,</span>
<span id="cb21-5">    price, </span>
<span id="cb21-6">    volume,</span>
<span id="cb21-7">    <span class="fu" style="color: #4758AB;">RANK</span>() <span class="kw" style="color: #003B4F;">OVER</span> (<span class="kw" style="color: #003B4F;">PARTITION</span> <span class="kw" style="color: #003B4F;">BY</span> ticker <span class="kw" style="color: #003B4F;">ORDER</span> <span class="kw" style="color: #003B4F;">BY</span> price <span class="kw" style="color: #003B4F;">DESC</span>) <span class="kw" style="color: #003B4F;">AS</span> price_rank</span>
<span id="cb21-8">  <span class="kw" style="color: #003B4F;">FROM</span> trading.prices</span>
<span id="cb21-9">)</span>
<span id="cb21-10"></span>
<span id="cb21-11"><span class="kw" style="color: #003B4F;">SELECT</span> <span class="op" style="color: #5E5E5E;">*</span></span>
<span id="cb21-12"><span class="kw" style="color: #003B4F;">FROM</span> cte_rank</span>
<span id="cb21-13"><span class="kw" style="color: #003B4F;">WHERE</span> price_rank <span class="op" style="color: #5E5E5E;">&lt;=</span> <span class="dv" style="color: #AD0000;">5</span></span>
<span id="cb21-14"><span class="kw" style="color: #003B4F;">ORDER</span> <span class="kw" style="color: #003B4F;">BY</span> ticker, price_rank</span></code></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th style="text-align: left;">ticker</th>
<th style="text-align: left;">market_date</th>
<th style="text-align: right;">price</th>
<th style="text-align: left;">volume</th>
<th style="text-align: right;">price_rank</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2021-04-13</td>
<td style="text-align: right;">63540.90</td>
<td style="text-align: left;">126.56K</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2021-04-15</td>
<td style="text-align: right;">63216.00</td>
<td style="text-align: left;">76.97K</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2021-04-14</td>
<td style="text-align: right;">62980.40</td>
<td style="text-align: left;">130.43K</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2021-04-16</td>
<td style="text-align: right;">61379.70</td>
<td style="text-align: left;">136.85K</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2021-03-13</td>
<td style="text-align: right;">61195.30</td>
<td style="text-align: left;">134.64K</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="even">
<td style="text-align: left;">ETH</td>
<td style="text-align: left;">2021-05-11</td>
<td style="text-align: right;">4167.78</td>
<td style="text-align: left;">1.27M</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ETH</td>
<td style="text-align: left;">2021-05-14</td>
<td style="text-align: right;">4075.38</td>
<td style="text-align: left;">2.06M</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">ETH</td>
<td style="text-align: left;">2021-05-10</td>
<td style="text-align: right;">3947.90</td>
<td style="text-align: left;">2.70M</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ETH</td>
<td style="text-align: left;">2021-05-09</td>
<td style="text-align: right;">3922.23</td>
<td style="text-align: left;">1.94M</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">ETH</td>
<td style="text-align: left;">2021-05-08</td>
<td style="text-align: right;">3905.55</td>
<td style="text-align: left;">1.34M</td>
<td style="text-align: right;">5</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="question-4.1---fa-brands-r-project-solution" class="level4">
<h4 class="anchored" data-anchor-id="question-4.1---fa-brands-r-project-solution">Question 4.1 - <i class="fa-brands fa-r-project" aria-label="r-project"></i> solution</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1">members <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">read_csv</span>(<span class="st" style="color: #20794D;">"data/members_tbl.csv"</span>)</span>
<span id="cb22-2">prices <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">read_csv</span>(<span class="st" style="color: #20794D;">"data/prices_tbl.csv"</span>)</span>
<span id="cb22-3">transactions <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">read_csv</span>(<span class="st" style="color: #20794D;">"data/transactions_tbl.csv"</span>)</span>
<span id="cb22-4"></span>
<span id="cb22-5">prices <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">head</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 √ó 8
  ticker market_date price  open  high   low volume  change
  &lt;chr&gt;  &lt;date&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt; 
1 ETH    2021-08-29  3178. 3244. 3282. 3163. 582.04K -2.04%
2 ETH    2021-08-28  3244. 3274. 3285. 3212. 466.21K -0.91%
3 ETH    2021-08-27  3274. 3094. 3280. 3063. 839.54K 5.82% 
4 ETH    2021-08-26  3094. 3228. 3250. 3057. 118.44K -4.17%
5 ETH    2021-08-25  3228. 3172. 3247. 3081. 923.13K 1.73% 
6 ETH    2021-08-24  3173. 3323. 3358. 3151. 988.82K -4.41%</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><span class="co" style="color: #5E5E5E;"># R solution</span></span>
<span id="cb24-2">prices <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb24-3">  <span class="fu" style="color: #4758AB;">select</span>(ticker, market_date, price, volume) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb24-4">  <span class="fu" style="color: #4758AB;">group_by</span>(ticker) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb24-5">  <span class="fu" style="color: #4758AB;">arrange</span>(ticker, <span class="fu" style="color: #4758AB;">desc</span>(price)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb24-6">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">price_rank =</span> <span class="fu" style="color: #4758AB;">row_number</span>()) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb24-7">  <span class="fu" style="color: #4758AB;">filter</span>(price_rank <span class="sc" style="color: #5E5E5E;">&lt;=</span><span class="dv" style="color: #AD0000;">5</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 √ó 5
# Groups:   ticker [2]
   ticker market_date  price volume  price_rank
   &lt;chr&gt;  &lt;date&gt;       &lt;dbl&gt; &lt;chr&gt;        &lt;int&gt;
 1 BTC    2021-04-13  63541. 126.56K          1
 2 BTC    2021-04-15  63216  76.97K           2
 3 BTC    2021-04-14  62980. 130.43K          3
 4 BTC    2021-04-16  61380. 136.85K          4
 5 BTC    2021-03-13  61195. 134.64K          5
 6 ETH    2021-05-11   4168. 1.27M            1
 7 ETH    2021-05-14   4075. 2.06M            2
 8 ETH    2021-05-10   3948. 2.70M            3
 9 ETH    2021-05-09   3922. 1.94M            4
10 ETH    2021-05-08   3906. 1.34M            5</code></pre>
</div>
</div>
</section>
</section>
<section id="question-4.2" class="level3">
<h3 class="anchored" data-anchor-id="question-4.2">Question 4.2</h3>
<p>Calculate a 7 day rolling average for the <code>price</code> and <code>volume</code> columns in the <code>trading.prices</code> table for each ticker.</p>
<ul>
<li>Return only the first 10 days of August 2021</li>
</ul>
<div class="cell" data-max.print="null">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb26-1"><span class="co" style="color: #5E5E5E;">-- Step 1 - Adjusted prices CTE</span></span>
<span id="cb26-2"><span class="kw" style="color: #003B4F;">WITH</span> cte_adjusted_prices <span class="kw" style="color: #003B4F;">AS</span> (</span>
<span id="cb26-3">  <span class="kw" style="color: #003B4F;">SELECT</span></span>
<span id="cb26-4">    ticker,</span>
<span id="cb26-5">    market_date,</span>
<span id="cb26-6">    price,</span>
<span id="cb26-7">    <span class="cf" style="color: #003B4F;">CASE</span></span>
<span id="cb26-8">      <span class="cf" style="color: #003B4F;">WHEN</span> <span class="kw" style="color: #003B4F;">RIGHT</span>(volume, <span class="dv" style="color: #AD0000;">1</span>) <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'K'</span> <span class="cf" style="color: #003B4F;">THEN</span> <span class="kw" style="color: #003B4F;">LEFT</span>(volume, <span class="fu" style="color: #4758AB;">LENGTH</span>(volume)<span class="op" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span>):<span class="ch" style="color: #20794D;">:NUMERIC</span> <span class="op" style="color: #5E5E5E;">*</span> <span class="dv" style="color: #AD0000;">1000</span></span>
<span id="cb26-9">      <span class="cf" style="color: #003B4F;">WHEN</span> <span class="kw" style="color: #003B4F;">RIGHT</span>(volume, <span class="dv" style="color: #AD0000;">1</span>) <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'M'</span> <span class="cf" style="color: #003B4F;">THEN</span> <span class="kw" style="color: #003B4F;">LEFT</span>(volume, <span class="fu" style="color: #4758AB;">LENGTH</span>(volume)<span class="op" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span>):<span class="ch" style="color: #20794D;">:NUMERIC</span> <span class="op" style="color: #5E5E5E;">*</span> <span class="dv" style="color: #AD0000;">1000000</span></span>
<span id="cb26-10">      <span class="cf" style="color: #003B4F;">WHEN</span> volume <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'-'</span> <span class="cf" style="color: #003B4F;">THEN</span> <span class="dv" style="color: #AD0000;">0</span></span>
<span id="cb26-11">    <span class="cf" style="color: #003B4F;">END</span> <span class="kw" style="color: #003B4F;">AS</span> volume</span>
<span id="cb26-12">  <span class="kw" style="color: #003B4F;">FROM</span> trading.prices</span>
<span id="cb26-13">),</span>
<span id="cb26-14"></span>
<span id="cb26-15"><span class="co" style="color: #5E5E5E;">-- Step 2 - Moving Averages CTE</span></span>
<span id="cb26-16">cte_moving_averages <span class="kw" style="color: #003B4F;">AS</span> (</span>
<span id="cb26-17">  <span class="kw" style="color: #003B4F;">SELECT</span></span>
<span id="cb26-18">    ticker,</span>
<span id="cb26-19">    market_date,</span>
<span id="cb26-20">    price,</span>
<span id="cb26-21">    <span class="fu" style="color: #4758AB;">AVG</span>(price) <span class="kw" style="color: #003B4F;">OVER</span> (</span>
<span id="cb26-22">      <span class="kw" style="color: #003B4F;">PARTITION</span> <span class="kw" style="color: #003B4F;">BY</span> ticker</span>
<span id="cb26-23">      <span class="kw" style="color: #003B4F;">ORDER</span> <span class="kw" style="color: #003B4F;">BY</span> market_date</span>
<span id="cb26-24">      <span class="kw" style="color: #003B4F;">RANGE</span> <span class="kw" style="color: #003B4F;">BETWEEN</span> <span class="st" style="color: #20794D;">'6 DAYS'</span> <span class="kw" style="color: #003B4F;">PRECEDING</span> <span class="kw" style="color: #003B4F;">AND</span> <span class="kw" style="color: #003B4F;">CURRENT</span> <span class="kw" style="color: #003B4F;">ROW</span>  </span>
<span id="cb26-25">    ) <span class="kw" style="color: #003B4F;">AS</span> moving_avg_price,</span>
<span id="cb26-26">    volume,</span>
<span id="cb26-27">    <span class="fu" style="color: #4758AB;">AVG</span>(volume) <span class="kw" style="color: #003B4F;">OVER</span> (</span>
<span id="cb26-28">      <span class="kw" style="color: #003B4F;">PARTITION</span> <span class="kw" style="color: #003B4F;">BY</span> ticker</span>
<span id="cb26-29">      <span class="kw" style="color: #003B4F;">ORDER</span> <span class="kw" style="color: #003B4F;">BY</span> market_date</span>
<span id="cb26-30">      <span class="kw" style="color: #003B4F;">RANGE</span> <span class="kw" style="color: #003B4F;">BETWEEN</span> <span class="st" style="color: #20794D;">'6 DAYS'</span> <span class="kw" style="color: #003B4F;">PRECEDING</span> <span class="kw" style="color: #003B4F;">AND</span> <span class="kw" style="color: #003B4F;">CURRENT</span> <span class="kw" style="color: #003B4F;">ROW</span>  </span>
<span id="cb26-31">    ) <span class="kw" style="color: #003B4F;">AS</span> moving_avg_volume</span>
<span id="cb26-32">  <span class="kw" style="color: #003B4F;">FROM</span> cte_adjusted_prices</span>
<span id="cb26-33">)</span>
<span id="cb26-34"></span>
<span id="cb26-35"><span class="co" style="color: #5E5E5E;">-- final output</span></span>
<span id="cb26-36"><span class="kw" style="color: #003B4F;">SELECT</span> <span class="op" style="color: #5E5E5E;">*</span> <span class="kw" style="color: #003B4F;">FROM</span> cte_moving_averages</span>
<span id="cb26-37"><span class="kw" style="color: #003B4F;">WHERE</span> market_date <span class="kw" style="color: #003B4F;">BETWEEN</span> <span class="st" style="color: #20794D;">'2021-08-01'</span> <span class="kw" style="color: #003B4F;">AND</span> <span class="st" style="color: #20794D;">'2021-08-10'</span></span>
<span id="cb26-38"><span class="kw" style="color: #003B4F;">ORDER</span> <span class="kw" style="color: #003B4F;">BY</span> ticker, market_date;</span></code></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>20 records</caption>
<colgroup>
<col style="width: 9%">
<col style="width: 16%">
<col style="width: 12%">
<col style="width: 23%">
<col style="width: 11%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">ticker</th>
<th style="text-align: left;">market_date</th>
<th style="text-align: right;">price</th>
<th style="text-align: right;">moving_avg_price</th>
<th style="text-align: right;">volume</th>
<th style="text-align: right;">moving_avg_volume</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2021-08-01</td>
<td style="text-align: right;">39878.30</td>
<td style="text-align: right;">40052.657</td>
<td style="text-align: right;">80330</td>
<td style="text-align: right;">103645.71</td>
</tr>
<tr class="even">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2021-08-02</td>
<td style="text-align: right;">39168.40</td>
<td style="text-align: right;">40322.914</td>
<td style="text-align: right;">74810</td>
<td style="text-align: right;">88957.14</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2021-08-03</td>
<td style="text-align: right;">38130.30</td>
<td style="text-align: right;">40134.100</td>
<td style="text-align: right;">260</td>
<td style="text-align: right;">74674.29</td>
</tr>
<tr class="even">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2021-08-04</td>
<td style="text-align: right;">39736.90</td>
<td style="text-align: right;">40096.057</td>
<td style="text-align: right;">79220</td>
<td style="text-align: right;">64717.14</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2021-08-05</td>
<td style="text-align: right;">40867.20</td>
<td style="text-align: right;">40219.743</td>
<td style="text-align: right;">130600</td>
<td style="text-align: right;">72617.14</td>
</tr>
<tr class="even">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2021-08-06</td>
<td style="text-align: right;">42795.40</td>
<td style="text-align: right;">40304.314</td>
<td style="text-align: right;">111930</td>
<td style="text-align: right;">74542.86</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2021-08-07</td>
<td style="text-align: right;">44614.20</td>
<td style="text-align: right;">40741.529</td>
<td style="text-align: right;">112840</td>
<td style="text-align: right;">84284.29</td>
</tr>
<tr class="even">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2021-08-08</td>
<td style="text-align: right;">43792.80</td>
<td style="text-align: right;">41300.743</td>
<td style="text-align: right;">105250</td>
<td style="text-align: right;">87844.29</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2021-08-09</td>
<td style="text-align: right;">46284.30</td>
<td style="text-align: right;">42317.300</td>
<td style="text-align: right;">117080</td>
<td style="text-align: right;">93882.86</td>
</tr>
<tr class="even">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2021-08-10</td>
<td style="text-align: right;">45593.80</td>
<td style="text-align: right;">43383.514</td>
<td style="text-align: right;">80550</td>
<td style="text-align: right;">105352.86</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ETH</td>
<td style="text-align: left;">2021-08-01</td>
<td style="text-align: right;">2556.23</td>
<td style="text-align: right;">2394.166</td>
<td style="text-align: right;">1200000</td>
<td style="text-align: right;">1069824.29</td>
</tr>
<tr class="even">
<td style="text-align: left;">ETH</td>
<td style="text-align: left;">2021-08-02</td>
<td style="text-align: right;">2608.04</td>
<td style="text-align: right;">2448.239</td>
<td style="text-align: right;">970670</td>
<td style="text-align: right;">938491.43</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ETH</td>
<td style="text-align: left;">2021-08-03</td>
<td style="text-align: right;">2506.65</td>
<td style="text-align: right;">2477.729</td>
<td style="text-align: right;">158450</td>
<td style="text-align: right;">782555.71</td>
</tr>
<tr class="even">
<td style="text-align: left;">ETH</td>
<td style="text-align: left;">2021-08-04</td>
<td style="text-align: right;">2725.29</td>
<td style="text-align: right;">2538.611</td>
<td style="text-align: right;">1230000</td>
<td style="text-align: right;">819850.00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ETH</td>
<td style="text-align: left;">2021-08-05</td>
<td style="text-align: right;">2827.21</td>
<td style="text-align: right;">2602.366</td>
<td style="text-align: right;">1650000</td>
<td style="text-align: right;">963742.86</td>
</tr>
<tr class="even">
<td style="text-align: left;">ETH</td>
<td style="text-align: left;">2021-08-06</td>
<td style="text-align: right;">2889.43</td>
<td style="text-align: right;">2663.577</td>
<td style="text-align: right;">1060000</td>
<td style="text-align: right;">968028.57</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ETH</td>
<td style="text-align: left;">2021-08-07</td>
<td style="text-align: right;">3158.00</td>
<td style="text-align: right;">2752.979</td>
<td style="text-align: right;">64840</td>
<td style="text-align: right;">904851.43</td>
</tr>
<tr class="even">
<td style="text-align: left;">ETH</td>
<td style="text-align: left;">2021-08-08</td>
<td style="text-align: right;">3012.07</td>
<td style="text-align: right;">2818.099</td>
<td style="text-align: right;">1250000</td>
<td style="text-align: right;">911994.29</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ETH</td>
<td style="text-align: left;">2021-08-09</td>
<td style="text-align: right;">3162.93</td>
<td style="text-align: right;">2897.369</td>
<td style="text-align: right;">1440000</td>
<td style="text-align: right;">979041.43</td>
</tr>
<tr class="even">
<td style="text-align: left;">ETH</td>
<td style="text-align: left;">2021-08-10</td>
<td style="text-align: right;">3140.71</td>
<td style="text-align: right;">2987.949</td>
<td style="text-align: right;">1120000</td>
<td style="text-align: right;">1116405.71</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="question-4.2---fa-brands-r-project-solution" class="level4">
<h4 class="anchored" data-anchor-id="question-4.2---fa-brands-r-project-solution">Question 4.2 - <i class="fa-brands fa-r-project" aria-label="r-project"></i> solution</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1">prices <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb27-2">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">volume =</span> <span class="fu" style="color: #4758AB;">case_when</span>(</span>
<span id="cb27-3">    <span class="fu" style="color: #4758AB;">str_sub</span>(volume, <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"K"</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">str_sub</span>(volume, <span class="dv" style="color: #AD0000;">1</span>, <span class="fu" style="color: #4758AB;">str_length</span>(volume) <span class="sc" style="color: #5E5E5E;">-</span> <span class="dv" style="color: #AD0000;">1</span>)) <span class="sc" style="color: #5E5E5E;">*</span> <span class="dv" style="color: #AD0000;">10</span><span class="sc" style="color: #5E5E5E;">^</span><span class="dv" style="color: #AD0000;">3</span>,</span>
<span id="cb27-4">    <span class="fu" style="color: #4758AB;">str_sub</span>(volume, <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"M"</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">str_sub</span>(volume, <span class="dv" style="color: #AD0000;">1</span>, <span class="fu" style="color: #4758AB;">str_length</span>(volume) <span class="sc" style="color: #5E5E5E;">-</span> <span class="dv" style="color: #AD0000;">1</span>)) <span class="sc" style="color: #5E5E5E;">*</span> <span class="dv" style="color: #AD0000;">10</span><span class="sc" style="color: #5E5E5E;">^</span><span class="dv" style="color: #AD0000;">6</span>,</span>
<span id="cb27-5">    <span class="fu" style="color: #4758AB;">str_sub</span>(volume, <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"-"</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">str_sub</span>(volume, <span class="dv" style="color: #AD0000;">1</span>, <span class="fu" style="color: #4758AB;">str_length</span>(volume) <span class="sc" style="color: #5E5E5E;">-</span> <span class="dv" style="color: #AD0000;">1</span>)) <span class="sc" style="color: #5E5E5E;">*</span> <span class="dv" style="color: #AD0000;">0</span>)</span>
<span id="cb27-6">  ) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb27-7">  <span class="fu" style="color: #4758AB;">group_by</span>(ticker) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb27-8">  <span class="fu" style="color: #4758AB;">arrange</span>(ticker, market_date) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb27-9">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">moving_avg_price =</span> zoo<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">rollmean</span>(price, <span class="at" style="color: #657422;">k =</span> <span class="dv" style="color: #AD0000;">7</span>, <span class="at" style="color: #657422;">align =</span> <span class="st" style="color: #20794D;">"right"</span>, <span class="at" style="color: #657422;">fill =</span> <span class="cn" style="color: #8f5902;">NA</span>),</span>
<span id="cb27-10">         <span class="at" style="color: #657422;">moving_avg_volume =</span> zoo<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">rollmean</span>(volume, <span class="at" style="color: #657422;">k =</span> <span class="dv" style="color: #AD0000;">7</span>, <span class="at" style="color: #657422;">align =</span> <span class="st" style="color: #20794D;">"right"</span>, <span class="at" style="color: #657422;">fill =</span> <span class="cn" style="color: #8f5902;">NA</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb27-11">  <span class="fu" style="color: #4758AB;">select</span>(ticker, market_date, price, moving_avg_price, volume, moving_avg_volume) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb27-12">  <span class="fu" style="color: #4758AB;">filter</span>(market_date <span class="sc" style="color: #5E5E5E;">&gt;=</span> <span class="st" style="color: #20794D;">"2021-08-01"</span>, market_date <span class="sc" style="color: #5E5E5E;">&lt;=</span> <span class="st" style="color: #20794D;">"2021-08-10"</span>) </span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 √ó 6
# Groups:   ticker [2]
   ticker market_date  price moving_avg_price  volume moving_avg_volume
   &lt;chr&gt;  &lt;date&gt;       &lt;dbl&gt;            &lt;dbl&gt;   &lt;dbl&gt;             &lt;dbl&gt;
 1 BTC    2021-08-01  39878.           40053.   80330           103646.
 2 BTC    2021-08-02  39168.           40323.   74810            88957.
 3 BTC    2021-08-03  38130.           40134.     260            74674.
 4 BTC    2021-08-04  39737.           40096.   79220            64717.
 5 BTC    2021-08-05  40867.           40220.  130600            72617.
 6 BTC    2021-08-06  42795.           40304.  111930            74543.
 7 BTC    2021-08-07  44614.           40742.  112840            84284.
 8 BTC    2021-08-08  43793.           41301.  105250            87844.
 9 BTC    2021-08-09  46284.           42317.  117080            93883.
10 BTC    2021-08-10  45594.           43384.   80550           105353.
11 ETH    2021-08-01   2556.            2394. 1200000          1069824.
12 ETH    2021-08-02   2608.            2448.  970670           938491.
13 ETH    2021-08-03   2507.            2478.  158450           782556.
14 ETH    2021-08-04   2725.            2539. 1230000           819850 
15 ETH    2021-08-05   2827.            2602. 1650000           963743.
16 ETH    2021-08-06   2889.            2664. 1060000           968029.
17 ETH    2021-08-07   3158             2753.   64840           904851.
18 ETH    2021-08-08   3012.            2818. 1250000           911994.
19 ETH    2021-08-09   3163.            2897. 1440000           979041.
20 ETH    2021-08-10   3141.            2988. 1120000          1116406.</code></pre>
</div>
</div>
</section>
</section>
<section id="question-4.3" class="level3">
<h3 class="anchored" data-anchor-id="question-4.3">Question 4.3</h3>
<p>Calculate the monthly cumulative volume traded for each ticker in 2020</p>
<ul>
<li>Sort the output by ticker in chronological order with the <code>month_start</code> as the first day of each month</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb29-1"><span class="kw" style="color: #003B4F;">WITH</span> cte_monthly_volume <span class="kw" style="color: #003B4F;">AS</span> (</span>
<span id="cb29-2">  <span class="kw" style="color: #003B4F;">SELECT</span></span>
<span id="cb29-3">    ticker,</span>
<span id="cb29-4">    DATE_TRUNC(<span class="st" style="color: #20794D;">'MON'</span>, market_date):<span class="ch" style="color: #20794D;">:DATE</span> <span class="kw" style="color: #003B4F;">AS</span> month_start,</span>
<span id="cb29-5">    <span class="fu" style="color: #4758AB;">SUM</span>(</span>
<span id="cb29-6">      <span class="cf" style="color: #003B4F;">CASE</span></span>
<span id="cb29-7">      <span class="cf" style="color: #003B4F;">WHEN</span> <span class="kw" style="color: #003B4F;">RIGHT</span>(volume, <span class="dv" style="color: #AD0000;">1</span>) <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'K'</span> <span class="cf" style="color: #003B4F;">THEN</span> <span class="kw" style="color: #003B4F;">LEFT</span>(volume, <span class="fu" style="color: #4758AB;">LENGTH</span>(volume)<span class="op" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span>):<span class="ch" style="color: #20794D;">:NUMERIC</span> <span class="op" style="color: #5E5E5E;">*</span> <span class="dv" style="color: #AD0000;">1000</span></span>
<span id="cb29-8">      <span class="cf" style="color: #003B4F;">WHEN</span> <span class="kw" style="color: #003B4F;">RIGHT</span>(volume, <span class="dv" style="color: #AD0000;">1</span>) <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'M'</span> <span class="cf" style="color: #003B4F;">THEN</span> <span class="kw" style="color: #003B4F;">LEFT</span>(volume, <span class="fu" style="color: #4758AB;">LENGTH</span>(volume)<span class="op" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span>):<span class="ch" style="color: #20794D;">:NUMERIC</span> <span class="op" style="color: #5E5E5E;">*</span> <span class="dv" style="color: #AD0000;">1000000</span></span>
<span id="cb29-9">      <span class="cf" style="color: #003B4F;">WHEN</span> volume <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'-'</span> <span class="cf" style="color: #003B4F;">THEN</span> <span class="dv" style="color: #AD0000;">0</span></span>
<span id="cb29-10">    <span class="cf" style="color: #003B4F;">END</span></span>
<span id="cb29-11">  ) <span class="kw" style="color: #003B4F;">AS</span> monthly_volume</span>
<span id="cb29-12">  <span class="kw" style="color: #003B4F;">FROM</span> trading.prices</span>
<span id="cb29-13">  <span class="kw" style="color: #003B4F;">WHERE</span> market_date <span class="kw" style="color: #003B4F;">BETWEEN</span> <span class="st" style="color: #20794D;">'2020-01-01'</span> <span class="kw" style="color: #003B4F;">AND</span> <span class="st" style="color: #20794D;">'2020-12-31'</span></span>
<span id="cb29-14">  <span class="kw" style="color: #003B4F;">GROUP</span> <span class="kw" style="color: #003B4F;">BY</span> ticker, month_start</span>
<span id="cb29-15">)</span>
<span id="cb29-16"></span>
<span id="cb29-17"><span class="kw" style="color: #003B4F;">SELECT</span></span>
<span id="cb29-18">  ticker,</span>
<span id="cb29-19">  month_start,</span>
<span id="cb29-20">  <span class="fu" style="color: #4758AB;">SUM</span>(monthly_volume) <span class="kw" style="color: #003B4F;">OVER</span> (</span>
<span id="cb29-21">    <span class="kw" style="color: #003B4F;">PARTITION</span> <span class="kw" style="color: #003B4F;">BY</span> ticker</span>
<span id="cb29-22">    <span class="kw" style="color: #003B4F;">ORDER</span> <span class="kw" style="color: #003B4F;">BY</span> month_start</span>
<span id="cb29-23">    <span class="kw" style="color: #003B4F;">ROWS</span> <span class="kw" style="color: #003B4F;">BETWEEN</span> <span class="kw" style="color: #003B4F;">UNBOUNDED</span> <span class="kw" style="color: #003B4F;">PRECEDING</span> <span class="kw" style="color: #003B4F;">AND</span> <span class="kw" style="color: #003B4F;">CURRENT</span> <span class="kw" style="color: #003B4F;">ROW</span></span>
<span id="cb29-24">  ) <span class="kw" style="color: #003B4F;">AS</span> cumulative_monthly_volume</span>
<span id="cb29-25"><span class="kw" style="color: #003B4F;">FROM</span> cte_monthly_volume</span>
<span id="cb29-26"><span class="kw" style="color: #003B4F;">ORDER</span> <span class="kw" style="color: #003B4F;">BY</span> ticker, month_start</span></code></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th style="text-align: left;">ticker</th>
<th style="text-align: left;">month_start</th>
<th style="text-align: right;">cumulative_monthly_volume</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2020-01-01</td>
<td style="text-align: right;">23451920</td>
</tr>
<tr class="even">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2020-02-01</td>
<td style="text-align: right;">46839130</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2020-03-01</td>
<td style="text-align: right;">94680450</td>
</tr>
<tr class="even">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2020-04-01</td>
<td style="text-align: right;">134302740</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2020-05-01</td>
<td style="text-align: right;">172687010</td>
</tr>
<tr class="even">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2020-06-01</td>
<td style="text-align: right;">188026610</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2020-07-01</td>
<td style="text-align: right;">201272600</td>
</tr>
<tr class="even">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2020-08-01</td>
<td style="text-align: right;">216762630</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2020-09-01</td>
<td style="text-align: right;">300641440</td>
</tr>
<tr class="even">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2020-10-01</td>
<td style="text-align: right;">303060020</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="question-4.3---fa-brands-r-project-solution" class="level4">
<h4 class="anchored" data-anchor-id="question-4.3---fa-brands-r-project-solution">Question 4.3 - <i class="fa-brands fa-r-project" aria-label="r-project"></i> solution</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1">prices <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb30-2">  <span class="fu" style="color: #4758AB;">select</span>(ticker, market_date, volume) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb30-3">  <span class="fu" style="color: #4758AB;">filter</span>(market_date <span class="sc" style="color: #5E5E5E;">&gt;=</span> <span class="st" style="color: #20794D;">"2020-01-01"</span>, market_date <span class="sc" style="color: #5E5E5E;">&lt;=</span> <span class="st" style="color: #20794D;">"2020-12-31"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb30-4">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">month_start =</span> lubridate<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">floor_date</span>(market_date, <span class="at" style="color: #657422;">unit =</span> <span class="st" style="color: #20794D;">"month"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb30-5">  <span class="fu" style="color: #4758AB;">group_by</span>(ticker, month_start) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb30-6">  <span class="fu" style="color: #4758AB;">summarise</span>(<span class="at" style="color: #657422;">monthly_volume =</span> <span class="fu" style="color: #4758AB;">sum</span>(</span>
<span id="cb30-7">    <span class="fu" style="color: #4758AB;">case_when</span>(</span>
<span id="cb30-8">      <span class="fu" style="color: #4758AB;">str_sub</span>(volume, <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"K"</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">str_sub</span>(volume, <span class="dv" style="color: #AD0000;">1</span>, <span class="fu" style="color: #4758AB;">str_length</span>(volume) <span class="sc" style="color: #5E5E5E;">-</span> <span class="dv" style="color: #AD0000;">1</span>)) <span class="sc" style="color: #5E5E5E;">*</span> <span class="dv" style="color: #AD0000;">10</span><span class="sc" style="color: #5E5E5E;">^</span><span class="dv" style="color: #AD0000;">3</span>,</span>
<span id="cb30-9">      <span class="fu" style="color: #4758AB;">str_sub</span>(volume, <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"M"</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">str_sub</span>(volume, <span class="dv" style="color: #AD0000;">1</span>, <span class="fu" style="color: #4758AB;">str_length</span>(volume) <span class="sc" style="color: #5E5E5E;">-</span> <span class="dv" style="color: #AD0000;">1</span>)) <span class="sc" style="color: #5E5E5E;">*</span> <span class="dv" style="color: #AD0000;">10</span><span class="sc" style="color: #5E5E5E;">^</span><span class="dv" style="color: #AD0000;">6</span>,</span>
<span id="cb30-10">      <span class="fu" style="color: #4758AB;">str_sub</span>(volume, <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"-"</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">str_sub</span>(volume, <span class="dv" style="color: #AD0000;">1</span>, <span class="fu" style="color: #4758AB;">str_length</span>(volume) <span class="sc" style="color: #5E5E5E;">-</span> <span class="dv" style="color: #AD0000;">1</span>)) <span class="sc" style="color: #5E5E5E;">*</span> <span class="dv" style="color: #AD0000;">0</span>)</span>
<span id="cb30-11">    )</span>
<span id="cb30-12">  ) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb30-13">  <span class="fu" style="color: #4758AB;">ungroup</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb30-14">  <span class="fu" style="color: #4758AB;">group_by</span>(ticker) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb30-15">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">cumulative_monthly_volume =</span> <span class="fu" style="color: #4758AB;">cumsum</span>(monthly_volume)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb30-16">  <span class="fu" style="color: #4758AB;">ungroup</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 √ó 4
   ticker month_start monthly_volume cumulative_monthly_volume
   &lt;chr&gt;  &lt;date&gt;               &lt;dbl&gt;                     &lt;dbl&gt;
 1 BTC    2020-01-01        23451920                  23451920
 2 BTC    2020-02-01        23387210                  46839130
 3 BTC    2020-03-01        47841320                  94680450
 4 BTC    2020-04-01        39622290                 134302740
 5 BTC    2020-05-01        38384270                 172687010
 6 BTC    2020-06-01        15339600                 188026610
 7 BTC    2020-07-01        13245990                 201272600
 8 BTC    2020-08-01        15490030                 216762630
 9 BTC    2020-09-01        83878810                 300641440
10 BTC    2020-10-01         2418580                 303060020
# ‚Ä¶ with 14 more rows</code></pre>
</div>
</div>
</section>
</section>
<section id="question-4.4" class="level3">
<h3 class="anchored" data-anchor-id="question-4.4">Question 4.4</h3>
<p>Calculate the daily percentage change in volume for each ticker in the <code>trading.prices</code> table</p>
<ul>
<li>Percentage change can be calculated as (current - previous) / previous</li>
<li>Multiply the percentage by 100 and round the value to 2 decimal places</li>
<li>Return data for the first 10 days of August 2021</li>
</ul>
<div class="cell" data-max.print="null">
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb32-1"><span class="kw" style="color: #003B4F;">WITH</span> cte_adjusted_prices <span class="kw" style="color: #003B4F;">AS</span> (</span>
<span id="cb32-2">  <span class="kw" style="color: #003B4F;">SELECT</span></span>
<span id="cb32-3">    ticker,</span>
<span id="cb32-4">    market_date,</span>
<span id="cb32-5">    <span class="cf" style="color: #003B4F;">CASE</span></span>
<span id="cb32-6">      <span class="cf" style="color: #003B4F;">WHEN</span> <span class="kw" style="color: #003B4F;">RIGHT</span>(volume, <span class="dv" style="color: #AD0000;">1</span>) <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'K'</span> <span class="cf" style="color: #003B4F;">THEN</span> <span class="kw" style="color: #003B4F;">LEFT</span>(volume, <span class="fu" style="color: #4758AB;">LENGTH</span>(volume)<span class="op" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span>):<span class="ch" style="color: #20794D;">:NUMERIC</span> <span class="op" style="color: #5E5E5E;">*</span> <span class="dv" style="color: #AD0000;">1000</span></span>
<span id="cb32-7">      <span class="cf" style="color: #003B4F;">WHEN</span> <span class="kw" style="color: #003B4F;">RIGHT</span>(volume, <span class="dv" style="color: #AD0000;">1</span>) <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'M'</span> <span class="cf" style="color: #003B4F;">THEN</span> <span class="kw" style="color: #003B4F;">LEFT</span>(volume, <span class="fu" style="color: #4758AB;">LENGTH</span>(volume)<span class="op" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span>):<span class="ch" style="color: #20794D;">:NUMERIC</span> <span class="op" style="color: #5E5E5E;">*</span> <span class="dv" style="color: #AD0000;">1000000</span></span>
<span id="cb32-8">      <span class="cf" style="color: #003B4F;">WHEN</span> volume <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'-'</span> <span class="cf" style="color: #003B4F;">THEN</span> <span class="dv" style="color: #AD0000;">0</span></span>
<span id="cb32-9">    <span class="cf" style="color: #003B4F;">END</span> <span class="kw" style="color: #003B4F;">AS</span> volume</span>
<span id="cb32-10">  <span class="kw" style="color: #003B4F;">FROM</span> trading.prices</span>
<span id="cb32-11">),</span>
<span id="cb32-12"></span>
<span id="cb32-13">cte_previous_volume <span class="kw" style="color: #003B4F;">AS</span> (</span>
<span id="cb32-14">  <span class="kw" style="color: #003B4F;">SELECT</span></span>
<span id="cb32-15">    ticker,</span>
<span id="cb32-16">    market_date,</span>
<span id="cb32-17">    volume,</span>
<span id="cb32-18">    <span class="fu" style="color: #4758AB;">LAG</span>(volume) <span class="kw" style="color: #003B4F;">OVER</span> (<span class="kw" style="color: #003B4F;">PARTITION</span> <span class="kw" style="color: #003B4F;">BY</span> ticker <span class="kw" style="color: #003B4F;">ORDER</span> <span class="kw" style="color: #003B4F;">BY</span> market_date) <span class="kw" style="color: #003B4F;">AS</span> previous_volume</span>
<span id="cb32-19">  <span class="kw" style="color: #003B4F;">FROM</span> cte_adjusted_prices</span>
<span id="cb32-20">  <span class="kw" style="color: #003B4F;">WHERE</span> volume <span class="op" style="color: #5E5E5E;">!=</span> <span class="dv" style="color: #AD0000;">0</span></span>
<span id="cb32-21">)</span>
<span id="cb32-22">  </span>
<span id="cb32-23"><span class="kw" style="color: #003B4F;">SELECT</span></span>
<span id="cb32-24">  ticker,</span>
<span id="cb32-25">  market_date,</span>
<span id="cb32-26">  volume,</span>
<span id="cb32-27">  previous_volume,</span>
<span id="cb32-28">  <span class="fu" style="color: #4758AB;">ROUND</span>(<span class="dv" style="color: #AD0000;">100</span> <span class="op" style="color: #5E5E5E;">*</span> (volume <span class="op" style="color: #5E5E5E;">-</span> previous_volume) <span class="op" style="color: #5E5E5E;">/</span> previous_volume, <span class="dv" style="color: #AD0000;">2</span>) <span class="kw" style="color: #003B4F;">AS</span> daily_change</span>
<span id="cb32-29"><span class="kw" style="color: #003B4F;">FROM</span> cte_previous_volume</span>
<span id="cb32-30"><span class="kw" style="color: #003B4F;">WHERE</span> market_date <span class="kw" style="color: #003B4F;">BETWEEN</span> <span class="st" style="color: #20794D;">'2021-08-01'</span> <span class="kw" style="color: #003B4F;">AND</span> <span class="st" style="color: #20794D;">'2021-08-10'</span></span>
<span id="cb32-31"><span class="kw" style="color: #003B4F;">ORDER</span> <span class="kw" style="color: #003B4F;">BY</span> ticker, market_date</span></code></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>20 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">ticker</th>
<th style="text-align: left;">market_date</th>
<th style="text-align: right;">volume</th>
<th style="text-align: right;">previous_volume</th>
<th style="text-align: right;">daily_change</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2021-08-01</td>
<td style="text-align: right;">80330</td>
<td style="text-align: right;">44650</td>
<td style="text-align: right;">79.91</td>
</tr>
<tr class="even">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2021-08-02</td>
<td style="text-align: right;">74810</td>
<td style="text-align: right;">80330</td>
<td style="text-align: right;">-6.87</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2021-08-03</td>
<td style="text-align: right;">260</td>
<td style="text-align: right;">74810</td>
<td style="text-align: right;">-99.65</td>
</tr>
<tr class="even">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2021-08-04</td>
<td style="text-align: right;">79220</td>
<td style="text-align: right;">260</td>
<td style="text-align: right;">30369.23</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2021-08-05</td>
<td style="text-align: right;">130600</td>
<td style="text-align: right;">79220</td>
<td style="text-align: right;">64.86</td>
</tr>
<tr class="even">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2021-08-06</td>
<td style="text-align: right;">111930</td>
<td style="text-align: right;">130600</td>
<td style="text-align: right;">-14.30</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2021-08-07</td>
<td style="text-align: right;">112840</td>
<td style="text-align: right;">111930</td>
<td style="text-align: right;">0.81</td>
</tr>
<tr class="even">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2021-08-08</td>
<td style="text-align: right;">105250</td>
<td style="text-align: right;">112840</td>
<td style="text-align: right;">-6.73</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2021-08-09</td>
<td style="text-align: right;">117080</td>
<td style="text-align: right;">105250</td>
<td style="text-align: right;">11.24</td>
</tr>
<tr class="even">
<td style="text-align: left;">BTC</td>
<td style="text-align: left;">2021-08-10</td>
<td style="text-align: right;">80550</td>
<td style="text-align: right;">117080</td>
<td style="text-align: right;">-31.20</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ETH</td>
<td style="text-align: left;">2021-08-01</td>
<td style="text-align: right;">1200000</td>
<td style="text-align: right;">507080</td>
<td style="text-align: right;">136.65</td>
</tr>
<tr class="even">
<td style="text-align: left;">ETH</td>
<td style="text-align: left;">2021-08-02</td>
<td style="text-align: right;">970670</td>
<td style="text-align: right;">1200000</td>
<td style="text-align: right;">-19.11</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ETH</td>
<td style="text-align: left;">2021-08-03</td>
<td style="text-align: right;">158450</td>
<td style="text-align: right;">970670</td>
<td style="text-align: right;">-83.68</td>
</tr>
<tr class="even">
<td style="text-align: left;">ETH</td>
<td style="text-align: left;">2021-08-04</td>
<td style="text-align: right;">1230000</td>
<td style="text-align: right;">158450</td>
<td style="text-align: right;">676.27</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ETH</td>
<td style="text-align: left;">2021-08-05</td>
<td style="text-align: right;">1650000</td>
<td style="text-align: right;">1230000</td>
<td style="text-align: right;">34.15</td>
</tr>
<tr class="even">
<td style="text-align: left;">ETH</td>
<td style="text-align: left;">2021-08-06</td>
<td style="text-align: right;">1060000</td>
<td style="text-align: right;">1650000</td>
<td style="text-align: right;">-35.76</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ETH</td>
<td style="text-align: left;">2021-08-07</td>
<td style="text-align: right;">64840</td>
<td style="text-align: right;">1060000</td>
<td style="text-align: right;">-93.88</td>
</tr>
<tr class="even">
<td style="text-align: left;">ETH</td>
<td style="text-align: left;">2021-08-08</td>
<td style="text-align: right;">1250000</td>
<td style="text-align: right;">64840</td>
<td style="text-align: right;">1827.82</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ETH</td>
<td style="text-align: left;">2021-08-09</td>
<td style="text-align: right;">1440000</td>
<td style="text-align: right;">1250000</td>
<td style="text-align: right;">15.20</td>
</tr>
<tr class="even">
<td style="text-align: left;">ETH</td>
<td style="text-align: left;">2021-08-10</td>
<td style="text-align: right;">1120000</td>
<td style="text-align: right;">1440000</td>
<td style="text-align: right;">-22.22</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="question-4.4---fa-brands-r-project-solution" class="level4">
<h4 class="anchored" data-anchor-id="question-4.4---fa-brands-r-project-solution">Question 4.4 - <i class="fa-brands fa-r-project" aria-label="r-project"></i> solution</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1">prices <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb33-2">  <span class="fu" style="color: #4758AB;">select</span>(ticker, market_date, volume) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb33-3">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">volume =</span> <span class="fu" style="color: #4758AB;">case_when</span>(</span>
<span id="cb33-4">    <span class="fu" style="color: #4758AB;">str_sub</span>(volume, <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"K"</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">str_sub</span>(volume, <span class="dv" style="color: #AD0000;">1</span>, <span class="fu" style="color: #4758AB;">str_length</span>(volume) <span class="sc" style="color: #5E5E5E;">-</span> <span class="dv" style="color: #AD0000;">1</span>)) <span class="sc" style="color: #5E5E5E;">*</span> <span class="dv" style="color: #AD0000;">10</span><span class="sc" style="color: #5E5E5E;">^</span><span class="dv" style="color: #AD0000;">3</span>,</span>
<span id="cb33-5">    <span class="fu" style="color: #4758AB;">str_sub</span>(volume, <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"M"</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">str_sub</span>(volume, <span class="dv" style="color: #AD0000;">1</span>, <span class="fu" style="color: #4758AB;">str_length</span>(volume) <span class="sc" style="color: #5E5E5E;">-</span> <span class="dv" style="color: #AD0000;">1</span>)) <span class="sc" style="color: #5E5E5E;">*</span> <span class="dv" style="color: #AD0000;">10</span><span class="sc" style="color: #5E5E5E;">^</span><span class="dv" style="color: #AD0000;">6</span>,</span>
<span id="cb33-6">    <span class="fu" style="color: #4758AB;">str_sub</span>(volume, <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"-"</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">str_sub</span>(volume, <span class="dv" style="color: #AD0000;">1</span>, <span class="fu" style="color: #4758AB;">str_length</span>(volume) <span class="sc" style="color: #5E5E5E;">-</span> <span class="dv" style="color: #AD0000;">1</span>)) <span class="sc" style="color: #5E5E5E;">*</span> <span class="dv" style="color: #AD0000;">0</span>)</span>
<span id="cb33-7">  ) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb33-8">  <span class="fu" style="color: #4758AB;">arrange</span>(ticker, market_date) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb33-9">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">volume_prev_day =</span> <span class="fu" style="color: #4758AB;">lag</span>(volume)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb33-10">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">daily_change_perc =</span> <span class="fu" style="color: #4758AB;">round</span>(<span class="dv" style="color: #AD0000;">100</span><span class="sc" style="color: #5E5E5E;">*</span>(volume <span class="sc" style="color: #5E5E5E;">-</span> volume_prev_day)<span class="sc" style="color: #5E5E5E;">/</span>volume_prev_day, <span class="dv" style="color: #AD0000;">2</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb33-11">  <span class="fu" style="color: #4758AB;">filter</span>(market_date <span class="sc" style="color: #5E5E5E;">&gt;=</span> <span class="st" style="color: #20794D;">"2021-08-01"</span>, market_date <span class="sc" style="color: #5E5E5E;">&lt;=</span> <span class="st" style="color: #20794D;">"2021-08-10"</span>) </span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 √ó 5
   ticker market_date  volume volume_prev_day daily_change_perc
   &lt;chr&gt;  &lt;date&gt;        &lt;dbl&gt;           &lt;dbl&gt;             &lt;dbl&gt;
 1 BTC    2021-08-01    80330           44650             79.9 
 2 BTC    2021-08-02    74810           80330             -6.87
 3 BTC    2021-08-03      260           74810            -99.6 
 4 BTC    2021-08-04    79220             260          30369.  
 5 BTC    2021-08-05   130600           79220             64.9 
 6 BTC    2021-08-06   111930          130600            -14.3 
 7 BTC    2021-08-07   112840          111930              0.81
 8 BTC    2021-08-08   105250          112840             -6.73
 9 BTC    2021-08-09   117080          105250             11.2 
10 BTC    2021-08-10    80550          117080            -31.2 
11 ETH    2021-08-01  1200000          507080            137.  
12 ETH    2021-08-02   970670         1200000            -19.1 
13 ETH    2021-08-03   158450          970670            -83.7 
14 ETH    2021-08-04  1230000          158450            676.  
15 ETH    2021-08-05  1650000         1230000             34.2 
16 ETH    2021-08-06  1060000         1650000            -35.8 
17 ETH    2021-08-07    64840         1060000            -93.9 
18 ETH    2021-08-08  1250000           64840           1828.  
19 ETH    2021-08-09  1440000         1250000             15.2 
20 ETH    2021-08-10  1120000         1440000            -22.2 </code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="part-5-table-joins" class="level2">
<h2 class="anchored" data-anchor-id="part-5-table-joins">PART 5Ô∏è‚É£: Table Joins</h2>
<section id="question-5.1---inner-joins" class="level3">
<h3 class="anchored" data-anchor-id="question-5.1---inner-joins">Question 5.1 - Inner Joins</h3>
<p>Which top 3 mentors have the most Bitcoin quantity? Return the f<code>irst_name</code> of the mentors and sort the output from highest to lowest <code>total_quantity</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb35-1"><span class="kw" style="color: #003B4F;">SELECT</span></span>
<span id="cb35-2">  m.first_name,</span>
<span id="cb35-3">  <span class="fu" style="color: #4758AB;">SUM</span>(</span>
<span id="cb35-4">    <span class="cf" style="color: #003B4F;">CASE</span></span>
<span id="cb35-5">      <span class="cf" style="color: #003B4F;">WHEN</span> t.txn_type <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'BUY'</span> <span class="cf" style="color: #003B4F;">THEN</span> t.quantity </span>
<span id="cb35-6">      <span class="cf" style="color: #003B4F;">WHEN</span> t.txn_type <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'SELL'</span> <span class="cf" style="color: #003B4F;">THEN</span> <span class="op" style="color: #5E5E5E;">-</span>t.quantity </span>
<span id="cb35-7">      <span class="cf" style="color: #003B4F;">END</span></span>
<span id="cb35-8">  ) <span class="kw" style="color: #003B4F;">AS</span> total_quantity</span>
<span id="cb35-9"><span class="kw" style="color: #003B4F;">FROM</span> trading.transactions t</span>
<span id="cb35-10"><span class="kw" style="color: #003B4F;">INNER</span> <span class="kw" style="color: #003B4F;">JOIN</span> trading.members m</span>
<span id="cb35-11">  <span class="kw" style="color: #003B4F;">ON</span> t.member_id <span class="op" style="color: #5E5E5E;">=</span> m.member_id</span>
<span id="cb35-12"><span class="kw" style="color: #003B4F;">WHERE</span> ticker <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'BTC'</span> </span>
<span id="cb35-13"><span class="kw" style="color: #003B4F;">GROUP</span> <span class="kw" style="color: #003B4F;">By</span> m.first_name</span>
<span id="cb35-14"><span class="kw" style="color: #003B4F;">ORDER</span> <span class="kw" style="color: #003B4F;">BY</span> total_quantity <span class="kw" style="color: #003B4F;">DESC</span></span>
<span id="cb35-15"><span class="kw" style="color: #003B4F;">LIMIT</span> <span class="dv" style="color: #AD0000;">3</span></span></code></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>3 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">first_name</th>
<th style="text-align: right;">total_quantity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Nandita</td>
<td style="text-align: right;">4160.220</td>
</tr>
<tr class="even">
<td style="text-align: left;">Leah</td>
<td style="text-align: right;">4046.091</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Ayush</td>
<td style="text-align: right;">3945.198</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="question-5.2---left-joins" class="level3">
<h3 class="anchored" data-anchor-id="question-5.2---left-joins">Question 5.2 - Left Joins</h3>
<p>Show the <code>market_date</code> values which have less than 5 transactions? Sort the output in reverse chronological order.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb36-1"><span class="kw" style="color: #003B4F;">SELECT</span> </span>
<span id="cb36-2">  p.market_date,</span>
<span id="cb36-3">  <span class="fu" style="color: #4758AB;">COUNT</span>(t.txn_id) <span class="kw" style="color: #003B4F;">AS</span> transaction_count</span>
<span id="cb36-4"><span class="kw" style="color: #003B4F;">FROM</span> trading.prices p</span>
<span id="cb36-5"><span class="kw" style="color: #003B4F;">LEFT</span> <span class="kw" style="color: #003B4F;">JOIN</span> trading.transactions t</span>
<span id="cb36-6">  <span class="kw" style="color: #003B4F;">ON</span> p.market_date <span class="op" style="color: #5E5E5E;">=</span> t.txn_date</span>
<span id="cb36-7">  <span class="kw" style="color: #003B4F;">AND</span> p.ticker <span class="op" style="color: #5E5E5E;">=</span> t.ticker</span>
<span id="cb36-8"><span class="kw" style="color: #003B4F;">GROUP</span> <span class="kw" style="color: #003B4F;">BY</span> p.market_date</span>
<span id="cb36-9"><span class="kw" style="color: #003B4F;">HAVING</span> <span class="fu" style="color: #4758AB;">COUNT</span>(t.txn_id) <span class="op" style="color: #5E5E5E;">&lt;</span> <span class="dv" style="color: #AD0000;">5</span></span>
<span id="cb36-10"><span class="kw" style="color: #003B4F;">ORDER</span> <span class="kw" style="color: #003B4F;">BY</span> p.market_date <span class="kw" style="color: #003B4F;">DESC</span></span></code></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>8 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">market_date</th>
<th style="text-align: right;">transaction_count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2021-08-29</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-08-28</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-07-17</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-06</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2020-01-17</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">2019-07-15</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2019-06-14</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">2018-10-20</td>
<td style="text-align: right;">4</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="question-5.3---multiple-table-joins" class="level3">
<h3 class="anchored" data-anchor-id="question-5.3---multiple-table-joins">Question 5.3 - Multiple Table Joins</h3>
<p><strong>Part 1:</strong> Calculate the Dollar Cost Average</p>
<p>What is the dollar cost average (<code>btc_dca</code>) for all Bitcoin purchases by region for each calendar year?</p>
<ul>
<li>Create a column called <code>year_start</code> and use the start of the calendar year</li>
<li>The dollar cost average calculation is <code>btc_dca</code> = SUM(<code>quantit</code>y x <code>price</code>) / SUM(<code>quantity</code>)</li>
</ul>
<p><strong>Part 2:</strong> Yearly Dollar Cost Average Ranking</p>
<p>Use this <code>btc_dca</code> value to generate a <code>dca_ranking</code> column for each year</p>
<ul>
<li>The region with the lowest <code>btc_dca</code> each year has a rank of 1</li>
</ul>
<p><strong>Part 3:</strong> Dollar Cost Average Yearly Percentage Change</p>
<p>Calculate the yearly percentage change in DCA for each region to 2 decimal places</p>
<ul>
<li>This calculation is (current - previous) / previous</li>
</ul>
<p>Finally order the output by <code>region</code> and <code>year_start</code> columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb37-1"><span class="kw" style="color: #003B4F;">WITH</span> cte_dollar_cost_average <span class="kw" style="color: #003B4F;">AS</span> (</span>
<span id="cb37-2">  <span class="kw" style="color: #003B4F;">SELECT</span></span>
<span id="cb37-3">    DATE_TRUNC(<span class="st" style="color: #20794D;">'YEAR'</span>, transactions.txn_date):<span class="ch" style="color: #20794D;">:DATE</span> <span class="kw" style="color: #003B4F;">AS</span> year_start,</span>
<span id="cb37-4">    members.region,</span>
<span id="cb37-5">    <span class="fu" style="color: #4758AB;">SUM</span>(transactions.quantity <span class="op" style="color: #5E5E5E;">*</span> prices.price) <span class="op" style="color: #5E5E5E;">/</span> <span class="fu" style="color: #4758AB;">SUM</span>(transactions.quantity) <span class="kw" style="color: #003B4F;">AS</span> btc_dca</span>
<span id="cb37-6">  <span class="kw" style="color: #003B4F;">FROM</span> trading.transactions</span>
<span id="cb37-7">  <span class="kw" style="color: #003B4F;">INNER</span> <span class="kw" style="color: #003B4F;">JOIN</span> trading.prices</span>
<span id="cb37-8">    <span class="kw" style="color: #003B4F;">ON</span> transactions.ticker <span class="op" style="color: #5E5E5E;">=</span> prices.ticker</span>
<span id="cb37-9">    <span class="kw" style="color: #003B4F;">AND</span> transactions.txn_date <span class="op" style="color: #5E5E5E;">=</span> prices.market_date</span>
<span id="cb37-10">  <span class="kw" style="color: #003B4F;">INNER</span> <span class="kw" style="color: #003B4F;">JOIN</span> trading.members</span>
<span id="cb37-11">    <span class="kw" style="color: #003B4F;">ON</span> transactions.member_id <span class="op" style="color: #5E5E5E;">=</span> members.member_id</span>
<span id="cb37-12">  <span class="kw" style="color: #003B4F;">WHERE</span> transactions.ticker <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'BTC'</span></span>
<span id="cb37-13">    <span class="kw" style="color: #003B4F;">AND</span> transactions.txn_type <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'BUY'</span></span>
<span id="cb37-14">  <span class="kw" style="color: #003B4F;">GROUP</span> <span class="kw" style="color: #003B4F;">BY</span> year_start, members.region</span>
<span id="cb37-15">),</span>
<span id="cb37-16">  </span>
<span id="cb37-17">cte_window_functions <span class="kw" style="color: #003B4F;">AS</span> (</span>
<span id="cb37-18">  <span class="kw" style="color: #003B4F;">SELECT</span></span>
<span id="cb37-19">    year_start,</span>
<span id="cb37-20">    region,</span>
<span id="cb37-21">    btc_dca,</span>
<span id="cb37-22">    <span class="fu" style="color: #4758AB;">RANK</span>() <span class="kw" style="color: #003B4F;">OVER</span> (<span class="kw" style="color: #003B4F;">PARTITION</span> <span class="kw" style="color: #003B4F;">BY</span> year_start <span class="kw" style="color: #003B4F;">ORDER</span> <span class="kw" style="color: #003B4F;">BY</span> btc_dca) <span class="kw" style="color: #003B4F;">AS</span> dca_ranking,</span>
<span id="cb37-23">    <span class="fu" style="color: #4758AB;">LAG</span>(btc_dca) <span class="kw" style="color: #003B4F;">OVER</span> (<span class="kw" style="color: #003B4F;">PARTITION</span> <span class="kw" style="color: #003B4F;">BY</span> region <span class="kw" style="color: #003B4F;">ORDER</span> <span class="kw" style="color: #003B4F;">BY</span> year_start) <span class="kw" style="color: #003B4F;">AS</span> previous_btc_dca</span>
<span id="cb37-24">  <span class="kw" style="color: #003B4F;">FROM</span> cte_dollar_cost_average</span>
<span id="cb37-25">)</span>
<span id="cb37-26">  </span>
<span id="cb37-27"><span class="kw" style="color: #003B4F;">SELECT</span></span>
<span id="cb37-28">  year_start,</span>
<span id="cb37-29">  region,</span>
<span id="cb37-30">  btc_dca,</span>
<span id="cb37-31">  dca_ranking,</span>
<span id="cb37-32">  <span class="fu" style="color: #4758AB;">ROUND</span>(</span>
<span id="cb37-33">    (<span class="dv" style="color: #AD0000;">100</span> <span class="op" style="color: #5E5E5E;">*</span> (btc_dca <span class="op" style="color: #5E5E5E;">-</span> previous_btc_dca) <span class="op" style="color: #5E5E5E;">/</span> previous_btc_dca):<span class="ch" style="color: #20794D;">:NUMERIC</span>,</span>
<span id="cb37-34">    <span class="dv" style="color: #AD0000;">2</span></span>
<span id="cb37-35">  ) <span class="kw" style="color: #003B4F;">AS</span> dca_percentage_change</span>
<span id="cb37-36"><span class="kw" style="color: #003B4F;">FROM</span> cte_window_functions</span>
<span id="cb37-37"><span class="kw" style="color: #003B4F;">ORDER</span> <span class="kw" style="color: #003B4F;">BY</span> region, year_start</span></code></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th style="text-align: left;">year_start</th>
<th style="text-align: left;">region</th>
<th style="text-align: right;">btc_dca</th>
<th style="text-align: right;">dca_ranking</th>
<th style="text-align: right;">dca_percentage_change</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2017-01-01</td>
<td style="text-align: left;">Africa</td>
<td style="text-align: right;">3987.626</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">2018-01-01</td>
<td style="text-align: left;">Africa</td>
<td style="text-align: right;">7690.713</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">92.86</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2019-01-01</td>
<td style="text-align: left;">Africa</td>
<td style="text-align: right;">7368.820</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">-4.19</td>
</tr>
<tr class="even">
<td style="text-align: left;">2020-01-01</td>
<td style="text-align: left;">Africa</td>
<td style="text-align: right;">11114.125</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">50.83</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-01</td>
<td style="text-align: left;">Africa</td>
<td style="text-align: right;">44247.215</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">298.12</td>
</tr>
<tr class="even">
<td style="text-align: left;">2017-01-01</td>
<td style="text-align: left;">Asia</td>
<td style="text-align: right;">4002.939</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2018-01-01</td>
<td style="text-align: left;">Asia</td>
<td style="text-align: right;">7829.999</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">95.61</td>
</tr>
<tr class="even">
<td style="text-align: left;">2019-01-01</td>
<td style="text-align: left;">Asia</td>
<td style="text-align: right;">7267.679</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-7.18</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2020-01-01</td>
<td style="text-align: left;">Asia</td>
<td style="text-align: right;">10759.621</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">48.05</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-01</td>
<td style="text-align: left;">Asia</td>
<td style="text-align: right;">44570.901</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">314.24</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<p>Thanks for reading!</p>


</section>
</section>

 ]]></description>
  <category>SQL</category>
  <category>PostgreSQL</category>
  <category>EDA</category>
  <guid>https://sandrajurela.com/posts/cryptocurrency-sql-case-study/cryptocurrency.html</guid>
  <pubDate>Thu, 24 Nov 2022 23:00:00 GMT</pubDate>
  <media:content url="https://sandrajurela.com/posts/cryptocurrency-sql-case-study/images/erd_trading.png" medium="image" type="image/png" height="104" width="144"/>
</item>
<item>
  <title>Scraping 200 Best Movies of 2010s from Rotten Tomatoes</title>
  <dc:creator>Sandra Jurela</dc:creator>
  <link>https://sandrajurela.com/posts/web-scraping-rotten-tomatoes/rotten-tomatoes.html</link>
  <description><![CDATA[ 




<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>The goal of this project is to scrape data on the 200 best movies of the last decade from the <a href="https://editorial.rottentomatoes.com/guide/the-200-best-movies-of-the-2010s/">Rotten Tomatoes</a> website with the R <code>rvest</code> package, and finally create a dashboard in <a href="https://www.tableau.com/">Tableau</a>. The idea is to show all the movies in one place. Hovering over the movie should reveal relevant data in the tooltip for quick overview. Clicking on the movie should open the movie‚Äôs website for more information.</p>
<p>I‚Äôve learned so much while working on this project (like web scraping, writing functions, iteration, ‚Ä¶). The <code>purrr</code> package for functional programming is super-cool. It allows iteration with just one line of code (a very handy replacement for <code>for loops</code>).</p>
<p>I hope you‚Äôll enjoy the process as much as I did. At times it was quite challenging, but that‚Äôs how we learn!</p>
<section id="setting-up-the-programming-environment" class="level3">
<h3 class="anchored" data-anchor-id="setting-up-the-programming-environment">Setting up the programming environment</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;"># loading packages</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;">library</span>(tidyverse)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;">library</span>(rvest)</span></code></pre></div>
</div>
<p>Are we allowed to scrape data from the Rotten Tomatoes website?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">robotstxt<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">paths_allowed</span>(<span class="st" style="color: #20794D;">"https://www.rottentomatoes.com/"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</section>
</section>
<section id="plan" class="level2">
<h2 class="anchored" data-anchor-id="plan">Plan</h2>
<p>The data will be scraped from <a href="https://editorial.rottentomatoes.com/guide/the-200-best-movies-of-the-2010s/">this page</a>. Since it doesn‚Äôt contain all the data I am interested in, I have to visit every movie‚Äôs web page on the list and scrape data from there. Here is the plan:</p>
<ol type="1">
<li><p>Scrape data from the main page: the <code>url</code>s of movies, and the <code>url</code>s of images.</p></li>
<li><p>Scrape <code>title</code>, <code>year_genre_runtime</code>, <code>critics_score</code>, <code>audiaece_score</code>, and <code>synopsis</code> from the first movie to develop the code.</p></li>
<li><p>Write a function that scrapes data based on movie‚Äôs URL.</p></li>
<li><p>Iteration - use this function to scrape data from each individual movie and create a data frame with the columns <code>title</code>, <code>year_genre_runtime</code>, <code>critics_score</code>, <code>audiaece_score</code>, <code>synopsis</code>, and <code>url</code>.</p></li>
<li><p>Download images</p></li>
<li><p>Prepare data for Tableau</p></li>
<li><p>Create a dashboard in Tableau</p></li>
</ol>
</section>
<section id="scraping-data-from-the-main-page" class="level2">
<h2 class="anchored" data-anchor-id="scraping-data-from-the-main-page">1. Scraping data from the main page</h2>
<p>Reading the main page with <code>read_html()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">main_url <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="st" style="color: #20794D;">"https://editorial.rottentomatoes.com/guide/the-200-best-movies-of-the-2010s/"</span></span>
<span id="cb4-2">main_page <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">read_html</span>(main_url)</span></code></pre></div>
</div>
<p><br></p>
<div class="cell" data-layout-align="left">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="https://sandrajurela.com/posts/web-scraping-rotten-tomatoes/images/img1.jpg" class="img-fluid figure-img" width="710"></p>
<p></p><figcaption class="figure-caption">Figure 1: The main page</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>I make use of the <strong>SelectorGadget</strong> to identify the tags for the relevant nodes. Here is the <a href="https://chrome.google.com/webstore/detail/selectorgadget/mhjhnkcfbdhnjickkkdbjoemdmbfginb">link</a> for Chrome (recommended).</p>
<section id="extracting-urls-of-movies" class="level4">
<h4 class="anchored" data-anchor-id="extracting-urls-of-movies">Extracting <code>url</code>s of movies</h4>
<p>The same nodes that contain the text for the titles also contain information on the links to individual movie pages for each title. We can extract this information using the <code>html_attr()</code> function, which extracts attributes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">movie_urls <span class="ot" style="color: #003B4F;">&lt;-</span> main_page <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb5-2">  <span class="fu" style="color: #4758AB;">html_nodes</span>(<span class="st" style="color: #20794D;">".article_movie_title a"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;">html_attr</span>(<span class="st" style="color: #20794D;">"href"</span>)</span>
<span id="cb5-4"></span>
<span id="cb5-5">movie_urls <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">head</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "https://www.rottentomatoes.com/m/12_years_a_slave"    
[2] "https://www.rottentomatoes.com/m/20_feet_from_stardom"
[3] "https://www.rottentomatoes.com/m/45_years"            
[4] "https://www.rottentomatoes.com/m/all_is_lost_2013"    
[5] "https://www.rottentomatoes.com/m/amazing_grace_2018"  
[6] "https://www.rottentomatoes.com/m/american_hustle"     </code></pre>
</div>
</div>
</section>
<section id="extracting-urls-of-images" class="level4">
<h4 class="anchored" data-anchor-id="extracting-urls-of-images">Extracting <code>url</code>s of images</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">image_urls <span class="ot" style="color: #003B4F;">&lt;-</span> main_page <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;">html_nodes</span>(<span class="st" style="color: #20794D;">".article_poster"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb7-3">  <span class="fu" style="color: #4758AB;">html_attr</span>(<span class="st" style="color: #20794D;">"src"</span>)</span></code></pre></div>
</div>
<p>Let‚Äôs check the image for the 6th title.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">knitr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">include_graphics</span>(image_urls[<span class="dv" style="color: #AD0000;">6</span>])</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/web-scraping-rotten-tomatoes/https:/resizing.flixster.com/5RRz_ps7sPP4cWIxG3nYebujtg4=/fit-in/180x240/v2/https:/flxt.tmsimg.com/assets/p10016553_p_v10_al.jpg" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="scraping-data-for-the-first-movie-on-the-list" class="level2">
<h2 class="anchored" data-anchor-id="scraping-data-for-the-first-movie-on-the-list">2. Scraping data for the first movie on the list</h2>
<p>Now I‚Äôm going to scrape data for the movie <em>12 Years a Slave</em> in order to develop the code.</p>
<p>Reading page for the first movie.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">url <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="st" style="color: #20794D;">"https://www.rottentomatoes.com/m/12_years_a_slave"</span></span>
<span id="cb9-2">movie_page <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">read_html</span>(url)</span></code></pre></div>
</div>
<p><br></p>
<div class="cell" data-layout-align="left">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="https://sandrajurela.com/posts/web-scraping-rotten-tomatoes/images/img2.jpg" class="img-fluid figure-img" width="828"></p>
<p></p><figcaption class="figure-caption">Figure 2: Title, year, genre, runtime, critics and audience score</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Scroll down the page and you‚Äôll find the movie synopsis.</p>
<div class="cell" data-layout-align="left">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="https://sandrajurela.com/posts/web-scraping-rotten-tomatoes/images/img3.jpg" class="img-fluid figure-img" width="837"></p>
<p></p><figcaption class="figure-caption">Figure 3: Synopsis</figcaption><p></p>
</figure>
</div>
</div>
</div>
<section id="extracting-title" class="level4">
<h4 class="anchored" data-anchor-id="extracting-title">Extracting <code>title</code></h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">title <span class="ot" style="color: #003B4F;">&lt;-</span> movie_page <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb10-2">  <span class="fu" style="color: #4758AB;">html_node</span>(<span class="st" style="color: #20794D;">".scoreboard__title"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb10-3">  <span class="fu" style="color: #4758AB;">html_text</span>()</span>
<span id="cb10-4"></span>
<span id="cb10-5">title</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "12 Years a Slave"</code></pre>
</div>
</div>
</section>
<section id="extracting-year-genre-and-runtime" class="level4">
<h4 class="anchored" data-anchor-id="extracting-year-genre-and-runtime">Extracting <code>year</code>, <code>genre</code>, and <code>runtime</code></h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">year_genre_runtime <span class="ot" style="color: #003B4F;">&lt;-</span> movie_page <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb12-2">  <span class="fu" style="color: #4758AB;">html_node</span>(<span class="st" style="color: #20794D;">".scoreboard__info"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb12-3">  <span class="fu" style="color: #4758AB;">html_text</span>()</span>
<span id="cb12-4"></span>
<span id="cb12-5">year_genre_runtime</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2013, History/Drama, 2h 14m"</code></pre>
</div>
</div>
</section>
<section id="extracting-critics-score" class="level4">
<h4 class="anchored" data-anchor-id="extracting-critics-score">Extracting <code>critics score</code></h4>
<p>The next two are tricky. I had to look at the page source and find them manually.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">critics_score <span class="ot" style="color: #003B4F;">&lt;-</span> movie_page <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb14-2">  <span class="fu" style="color: #4758AB;">html_element</span>(<span class="st" style="color: #20794D;">"score-board"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb14-3">  <span class="fu" style="color: #4758AB;">html_attr</span>(<span class="st" style="color: #20794D;">"tomatometerscore"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb14-4">  <span class="fu" style="color: #4758AB;">str_c</span>(.,<span class="st" style="color: #20794D;">"%"</span>)</span>
<span id="cb14-5"></span>
<span id="cb14-6">critics_score</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "95%"</code></pre>
</div>
</div>
</section>
<section id="extracting-audience-score" class="level4">
<h4 class="anchored" data-anchor-id="extracting-audience-score">Extracting <code>audience score</code></h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">audience_score <span class="ot" style="color: #003B4F;">&lt;-</span> movie_page <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb16-2">  <span class="fu" style="color: #4758AB;">html_element</span>(<span class="st" style="color: #20794D;">"score-board"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb16-3">  <span class="fu" style="color: #4758AB;">html_attr</span>(<span class="st" style="color: #20794D;">"audiencescore"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb16-4">  <span class="fu" style="color: #4758AB;">str_c</span>(.,<span class="st" style="color: #20794D;">"%"</span>)</span>
<span id="cb16-5"></span>
<span id="cb16-6">audience_score</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "90%"</code></pre>
</div>
</div>
</section>
<section id="extracting-movie-synopsis" class="level4">
<h4 class="anchored" data-anchor-id="extracting-movie-synopsis">Extracting movie <code>synopsis</code></h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">synopsis <span class="ot" style="color: #003B4F;">&lt;-</span> movie_page <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb18-2">  <span class="fu" style="color: #4758AB;">html_node</span>(<span class="st" style="color: #20794D;">"#movieSynopsis"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb18-3">  <span class="fu" style="color: #4758AB;">html_text2</span>()</span>
<span id="cb18-4"></span>
<span id="cb18-5">synopsis</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "In the years before the Civil War, Solomon Northup (Chiwetel Ejiofor), a free black man from upstate New York, is kidnapped and sold into slavery in the South. Subjected to the cruelty of one malevolent owner (Michael Fassbender), he also finds unexpected kindness from another, as he struggles continually to survive and maintain some of his dignity. Then in the 12th year of the disheartening ordeal, a chance meeting with an abolitionist from Canada changes Solomon's life forever."</code></pre>
</div>
</div>
</section>
<section id="makinging-a-data-frame-of-extracted-elements" class="level3">
<h3 class="anchored" data-anchor-id="makinging-a-data-frame-of-extracted-elements">Makinging a data frame of extracted elements</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1">movie  <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">tibble</span>(<span class="at" style="color: #657422;">title =</span> title, </span>
<span id="cb20-2">                 <span class="at" style="color: #657422;">year_genre_runtime =</span> year_genre_runtime,</span>
<span id="cb20-3">                 <span class="at" style="color: #657422;">critics_score =</span> critics_score,</span>
<span id="cb20-4">                 <span class="at" style="color: #657422;">audience_score =</span> audience_score,</span>
<span id="cb20-5">                 <span class="at" style="color: #657422;">synopsis =</span> synopsis,  </span>
<span id="cb20-6">                 <span class="at" style="color: #657422;">url =</span> url)</span>
<span id="cb20-7"></span>
<span id="cb20-8">movie <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">glimpse</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1
Columns: 6
$ title              &lt;chr&gt; "12 Years a Slave"
$ year_genre_runtime &lt;chr&gt; "2013, History/Drama, 2h 14m"
$ critics_score      &lt;chr&gt; "95%"
$ audience_score     &lt;chr&gt; "90%"
$ synopsis           &lt;chr&gt; "In the years before the Civil War, Solomon Northup‚Ä¶
$ url                &lt;chr&gt; "https://www.rottentomatoes.com/m/12_years_a_slave"</code></pre>
</div>
</div>
</section>
</section>
<section id="writing-a-function" class="level2">
<h2 class="anchored" data-anchor-id="writing-a-function">3. Writing a function</h2>
<p>Instead of manually scraping individual movies, I‚Äôll write a function to do the same.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1">scrape_movie <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="cf" style="color: #003B4F;">function</span>(x, ...){</span>
<span id="cb22-2">  </span>
<span id="cb22-3">  movie_page <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">read_html</span>(x)</span>
<span id="cb22-4">  </span>
<span id="cb22-5">  title <span class="ot" style="color: #003B4F;">&lt;-</span> movie_page <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb22-6">    <span class="fu" style="color: #4758AB;">html_node</span>(<span class="st" style="color: #20794D;">".scoreboard__title"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb22-7">    <span class="fu" style="color: #4758AB;">html_text</span>()</span>
<span id="cb22-8">  </span>
<span id="cb22-9">  year_genre_runtime <span class="ot" style="color: #003B4F;">&lt;-</span> movie_page <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb22-10">    <span class="fu" style="color: #4758AB;">html_node</span>(<span class="st" style="color: #20794D;">".scoreboard__info"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb22-11">    <span class="fu" style="color: #4758AB;">html_text</span>()</span>
<span id="cb22-12">  </span>
<span id="cb22-13">  critics_score <span class="ot" style="color: #003B4F;">&lt;-</span> movie_page <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb22-14">    <span class="fu" style="color: #4758AB;">html_element</span>(<span class="st" style="color: #20794D;">"score-board"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb22-15">    <span class="fu" style="color: #4758AB;">html_attr</span>(<span class="st" style="color: #20794D;">"tomatometerscore"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb22-16">    <span class="fu" style="color: #4758AB;">str_c</span>(.,<span class="st" style="color: #20794D;">"%"</span>)</span>
<span id="cb22-17">  </span>
<span id="cb22-18">  audience_score <span class="ot" style="color: #003B4F;">&lt;-</span> movie_page <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb22-19">    <span class="fu" style="color: #4758AB;">html_element</span>(<span class="st" style="color: #20794D;">"score-board"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb22-20">    <span class="fu" style="color: #4758AB;">html_attr</span>(<span class="st" style="color: #20794D;">"audiencescore"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb22-21">    <span class="fu" style="color: #4758AB;">str_c</span>(.,<span class="st" style="color: #20794D;">"%"</span>)</span>
<span id="cb22-22">  </span>
<span id="cb22-23">  synopsis <span class="ot" style="color: #003B4F;">&lt;-</span> movie_page <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb22-24">    <span class="fu" style="color: #4758AB;">html_node</span>(<span class="st" style="color: #20794D;">"#movieSynopsis"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb22-25">    <span class="fu" style="color: #4758AB;">html_text2</span>()</span>
<span id="cb22-26">  </span>
<span id="cb22-27">  movie_df <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">tibble</span>(<span class="at" style="color: #657422;">title =</span> title, </span>
<span id="cb22-28">                     <span class="at" style="color: #657422;">year_genre_runtime =</span> year_genre_runtime,</span>
<span id="cb22-29">                     <span class="at" style="color: #657422;">critics_score =</span> critics_score,</span>
<span id="cb22-30">                     <span class="at" style="color: #657422;">audience_score =</span> audience_score,</span>
<span id="cb22-31">                     <span class="at" style="color: #657422;">synopsis =</span> synopsis,</span>
<span id="cb22-32">                     <span class="at" style="color: #657422;">url =</span> x)</span>
<span id="cb22-33">  </span>
<span id="cb22-34">  <span class="fu" style="color: #4758AB;">return</span>(movie_df)</span>
<span id="cb22-35">  </span>
<span id="cb22-36">}</span></code></pre></div>
</div>
<section id="function-in-action" class="level4">
<h4 class="anchored" data-anchor-id="function-in-action">Function in action</h4>
<p>Now that we have the <code>scrape_movie()</code> function, let‚Äôs scrape data for the movie ‚ÄúAmerican Hustle‚Äù.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><span class="fu" style="color: #4758AB;">scrape_movie</span>(movie_urls[<span class="dv" style="color: #AD0000;">6</span>]) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">glimpse</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1
Columns: 6
$ title              &lt;chr&gt; "American Hustle"
$ year_genre_runtime &lt;chr&gt; "2013, Crime/Drama, 2h 18m"
$ critics_score      &lt;chr&gt; "92%"
$ audience_score     &lt;chr&gt; "74%"
$ synopsis           &lt;chr&gt; "Irving Rosenfeld (Christian Bale) dabbles in forge‚Ä¶
$ url                &lt;chr&gt; "https://www.rottentomatoes.com/m/american_hustle"</code></pre>
</div>
</div>
<p>Or ‚ÄúEx Machina‚Äù (an interesting SF movie).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"> <span class="fu" style="color: #4758AB;">scrape_movie</span>(movie_urls[<span class="dv" style="color: #AD0000;">53</span>]) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">glimpse</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1
Columns: 6
$ title              &lt;chr&gt; "Ex Machina"
$ year_genre_runtime &lt;chr&gt; "2014, Sci-fi/Mystery &amp; thriller, 1h 47m"
$ critics_score      &lt;chr&gt; "92%"
$ audience_score     &lt;chr&gt; "86%"
$ synopsis           &lt;chr&gt; "Caleb Smith (Domhnall Gleeson) a programmer at a h‚Ä¶
$ url                &lt;chr&gt; "https://www.rottentomatoes.com/m/ex_machina"</code></pre>
</div>
</div>
</section>
</section>
<section id="iteration" class="level2">
<h2 class="anchored" data-anchor-id="iteration">4. Iteration</h2>
<p>To make my workflow a little more efficient, I make use of the <code>map_dfr()</code> function from the <code>purrr</code> package to iterate over all movie pages. <code>map_dfr()</code> will apply the <code>scrape_movie()</code>function to each element in the vector of links, and return a data frame created by row-binding. It‚Äôs as simple as that.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1">movies <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">map_dfr</span>(movie_urls, scrape_movie)</span>
<span id="cb27-2"></span>
<span id="cb27-3">movies </span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 200 √ó 6
   title                year_genre_runtime         criti‚Ä¶¬π audie‚Ä¶¬≤ synop‚Ä¶¬≥ url  
   &lt;chr&gt;                &lt;chr&gt;                      &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;
 1 12 Years a Slave     2013, History/Drama, 2h 1‚Ä¶ 95%     90%     In the‚Ä¶ http‚Ä¶
 2 20 Feet From Stardom 2013, Documentary, 1h 30m  99%     82%     Filmma‚Ä¶ http‚Ä¶
 3 45 Years             2015, Drama, 1h 33m        97%     67%     As the‚Ä¶ http‚Ä¶
 4 All Is Lost          2013, Adventure/Mystery &amp;‚Ä¶ 94%     64%     During‚Ä¶ http‚Ä¶
 5 Amazing Grace        2018, Documentary/Music, ‚Ä¶ 99%     80%     Singer‚Ä¶ http‚Ä¶
 6 American Hustle      2013, Crime/Drama, 2h 18m  92%     74%     Irving‚Ä¶ http‚Ä¶
 7 Amy                  2015, Documentary/Biograp‚Ä¶ 95%     87%     Archiv‚Ä¶ http‚Ä¶
 8 Anomalisa            2015, Comedy/Drama, 1h 30m 91%     71%     An ins‚Ä¶ http‚Ä¶
 9 Ant-Man and The Wasp 2018, Action/Adventure, 1‚Ä¶ 87%     80%     Scott ‚Ä¶ http‚Ä¶
10 Apollo 11            2019, Documentary/History‚Ä¶ 99%     90%     Never-‚Ä¶ http‚Ä¶
# ‚Ä¶ with 190 more rows, and abbreviated variable names ¬π‚Äãcritics_score,
#   ¬≤‚Äãaudience_score, ¬≥‚Äãsynopsis</code></pre>
</div>
</div>
</section>
<section id="downloading-images" class="level2">
<h2 class="anchored" data-anchor-id="downloading-images">5. Downloading images</h2>
<p>I‚Äôve already extracted urls of images in the first step and saved them to <code>image_urls</code>. Now I‚Äôm going to create a directory and directory paths for the images.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1">fs<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">dir_create</span>(<span class="st" style="color: #20794D;">"images/top_200_images/"</span>)</span>
<span id="cb29-2"></span>
<span id="cb29-3">paths <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="fu" style="color: #4758AB;">str_c</span>(<span class="st" style="color: #20794D;">"images/top_200_images/"</span>, <span class="fu" style="color: #4758AB;">sprintf</span>(<span class="st" style="color: #20794D;">"%0.3d"</span>, <span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">200</span>), <span class="st" style="color: #20794D;">".jpg"</span>))</span>
<span id="cb29-4"></span>
<span id="cb29-5">paths <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">head</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "images/top_200_images/001.jpg" "images/top_200_images/002.jpg"
[3] "images/top_200_images/003.jpg" "images/top_200_images/004.jpg"
[5] "images/top_200_images/005.jpg" "images/top_200_images/006.jpg"</code></pre>
</div>
</div>
<p>Since Tableau sorts images alphabetically (1, 11, 111, 2, 22, ‚Ä¶) by default, these leading zeros will help Tableau to correctly match the images with the data so I don‚Äôt have to do it manually.</p>
<section id="downloading-images-1" class="level4">
<h4 class="anchored" data-anchor-id="downloading-images-1">Downloading images</h4>
<p>This time I‚Äôll use <code>map2()</code> function from the <code>purrr</code> package, It will apply the <code>download.file()</code> function to pairs of elements from two vectors, <code>image_urls</code> and <code>paths</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><span class="fu" style="color: #4758AB;">map2</span>(image_urls, paths, <span class="cf" style="color: #003B4F;">function</span>(.x, .y) <span class="fu" style="color: #4758AB;">download.file</span>(.x, .y, <span class="at" style="color: #657422;">mode=</span><span class="st" style="color: #20794D;">"wb"</span>)) </span></code></pre></div>
</div>
<p>Are the images properly saved? Let‚Äôs read in the image for the first movie.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1">knitr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">include_graphics</span>(<span class="st" style="color: #20794D;">"images/top_200_images/001.jpg"</span>)</span></code></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/web-scraping-rotten-tomatoes/https:/resizing.flixster.com/omz-ZW3ToC8rY90ysUItce6Y1T0=/fit-in/180x240/v2/https:/flxt.tmsimg.com/assets/p10029562_p_v8_ac.jpg" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="data-wrangling" class="level2">
<h2 class="anchored" data-anchor-id="data-wrangling">6. Data wrangling</h2>
<p>Preparing the final dataset for Tableau.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1">movies <span class="ot" style="color: #003B4F;">&lt;-</span> movies <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb33-2">  </span>
<span id="cb33-3">  <span class="co" style="color: #5E5E5E;"># separate year_genre_runtime column into year, genre, and runtime</span></span>
<span id="cb33-4">  <span class="fu" style="color: #4758AB;">separate</span>(year_genre_runtime, <span class="at" style="color: #657422;">sep =</span> <span class="st" style="color: #20794D;">", "</span>, <span class="at" style="color: #657422;">into =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"year"</span>, <span class="st" style="color: #20794D;">"genre"</span>, <span class="st" style="color: #20794D;">"runtime"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb33-5">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">year =</span> <span class="fu" style="color: #4758AB;">as.factor</span>(year)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb33-6">  </span>
<span id="cb33-7">  <span class="co" style="color: #5E5E5E;"># separate genre column into primary and secondary genre</span></span>
<span id="cb33-8">  <span class="fu" style="color: #4758AB;">separate</span>(genre, <span class="at" style="color: #657422;">sep =</span> <span class="st" style="color: #20794D;">"/"</span>, <span class="at" style="color: #657422;">into =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"genre_1"</span>, <span class="st" style="color: #20794D;">"genre_2"</span>), <span class="at" style="color: #657422;">remove =</span> <span class="cn" style="color: #8f5902;">FALSE</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb33-9">  </span>
<span id="cb33-10">  <span class="co" style="color: #5E5E5E;"># create id column with leading zeroes so Tableau can automatically match the images</span></span>
<span id="cb33-11">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">id =</span> <span class="fu" style="color: #4758AB;">sprintf</span>(<span class="st" style="color: #20794D;">"%0.3d"</span>, <span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">200</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb33-12">  <span class="fu" style="color: #4758AB;">select</span>(id, <span class="fu" style="color: #4758AB;">everything</span>())</span>
<span id="cb33-13"></span>
<span id="cb33-14">movies <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">head</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 √ó 11
  id    title  year  genre genre_1 genre_2 runtime criti‚Ä¶¬π audie‚Ä¶¬≤ synop‚Ä¶¬≥ url  
  &lt;chr&gt; &lt;chr&gt;  &lt;fct&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;
1 001   12 Ye‚Ä¶ 2013  Hist‚Ä¶ History Drama   2h 14m  95%     90%     In the‚Ä¶ http‚Ä¶
2 002   20 Fe‚Ä¶ 2013  Docu‚Ä¶ Docume‚Ä¶ &lt;NA&gt;    1h 30m  99%     82%     Filmma‚Ä¶ http‚Ä¶
3 003   45 Ye‚Ä¶ 2015  Drama Drama   &lt;NA&gt;    1h 33m  97%     67%     As the‚Ä¶ http‚Ä¶
4 004   All I‚Ä¶ 2013  Adve‚Ä¶ Advent‚Ä¶ Myster‚Ä¶ 1h 45m  94%     64%     During‚Ä¶ http‚Ä¶
5 005   Amazi‚Ä¶ 2018  Docu‚Ä¶ Docume‚Ä¶ Music   1h 27m  99%     80%     Singer‚Ä¶ http‚Ä¶
6 006   Ameri‚Ä¶ 2013  Crim‚Ä¶ Crime   Drama   2h 18m  92%     74%     Irving‚Ä¶ http‚Ä¶
# ‚Ä¶ with abbreviated variable names ¬π‚Äãcritics_score, ¬≤‚Äãaudience_score, ¬≥‚Äãsynopsis</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><span class="co" style="color: #5E5E5E;"># number of unique values in genre column</span></span>
<span id="cb35-2">movies<span class="sc" style="color: #5E5E5E;">$</span>genre <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">unique</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">length</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 59</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><span class="co" style="color: #5E5E5E;"># unique values in genre_1</span></span>
<span id="cb37-2">movies<span class="sc" style="color: #5E5E5E;">$</span>genre_1 <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">unique</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "History"            "Documentary"        "Drama"             
 [4] "Adventure"          "Crime"              "Comedy"            
 [7] "Action"             "Sci-fi"             "Romance"           
[10] "Horror"             "Biography"          "Mystery &amp; thriller"
[13] "Kids &amp; family"      "War"                "Fantasy"           
[16] "Musical"            "Western"           </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><span class="co" style="color: #5E5E5E;"># unique values in genre_2</span></span>
<span id="cb39-2">movies<span class="sc" style="color: #5E5E5E;">$</span>genre_2 <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">unique</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Drama"              NA                   "Mystery &amp; thriller"
 [4] "Music"              "Biography"          "Adventure"         
 [7] "History"            "Romance"            "Comedy"            
[10] "Lgbtq+"             "Action"             "War"               
[13] "Fantasy"            "Sci-fi"             "Crime"             
[16] "Musical"            "Western"            "Anime"             
[19] "Horror"            </code></pre>
</div>
</div>
<p>Finding values in <code>genre_2</code>, that are not in <code>genre_1</code>. This will help when creating a list parameter for filtering by primary or secondary genre.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><span class="fu" style="color: #4758AB;">setdiff</span>(movies<span class="sc" style="color: #5E5E5E;">$</span>genre_2, movies<span class="sc" style="color: #5E5E5E;">$</span>genre_1)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA       "Music"  "Lgbtq+" "Anime" </code></pre>
</div>
</div>
<section id="dt-table" class="level3">
<h3 class="anchored" data-anchor-id="dt-table">DT table</h3>
<p>If you prefer to search a table for data, then this one is for you!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1">movies <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb43-2">  <span class="fu" style="color: #4758AB;">select</span>(<span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">9</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb43-3">  DT<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">datatable</span>(<span class="at" style="color: #657422;">rownames =</span> <span class="cn" style="color: #8f5902;">FALSE</span>)</span></code></pre></div>
<div class="cell-output-display">

<div id="htmlwidget-0c39fcac22bd076d4804" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-0c39fcac22bd076d4804">{"x":{"filter":"none","vertical":false,"data":[["001","002","003","004","005","006","007","008","009","010","011","012","013","014","015","016","017","018","019","020","021","022","023","024","025","026","027","028","029","030","031","032","033","034","035","036","037","038","039","040","041","042","043","044","045","046","047","048","049","050","051","052","053","054","055","056","057","058","059","060","061","062","063","064","065","066","067","068","069","070","071","072","073","074","075","076","077","078","079","080","081","082","083","084","085","086","087","088","089","090","091","092","093","094","095","096","097","098","099","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200"],["12 Years a Slave","20 Feet From Stardom","45 Years","All Is Lost","Amazing Grace","American Hustle","Amy","Anomalisa","Ant-Man and The Wasp","Apollo 11","Argo","Arrival","Ash Is Purest White","The Artist","Avengers: Endgame","Avengers: Infinity War","The Babadook","Baby Driver","A Beautiful Day in the Neighborhood","Before Midnight","The Big Sick","Birdman or (The Unexpected Virtue of Ignorance)","Birds of Passage","Black Panther","Blackfish","BlacKkKlansman","Blade Runner 2049","Booksmart","Boyhood","BPM (Beats Per Minute)","Bridge of Spies","Brooklyn","Bumblebee","Burning","Call Me by Your Name","Cameraperson","Can You Ever Forgive Me?","Captain America: Civil War","Captain Phillips","Carol","Coco","Crazy Rich Asians","Creed","Dallas Buyers Club","Dawn of the Planet of the Apes","The Death of Stalin","The Disaster Artist","Doctor Strange","Dolemite Is My Name","Don't Think Twice","Dunkirk","Eighth Grade","Ex Machina","Eye in the Sky","Faces Places","A Fantastic Woman","The Farewell","The Favourite","Fighting With My Family","Finding Dory","First Man","First Reformed","The Florida Project","Ford v Ferrari","Free Solo","Get Out","A Ghost Story","Gloria","The Grand Budapest Hotel","Gravity","Guardians of the Galaxy","The Guilty","The Handmaiden","Harry Potter and the Deathly Hallows: Part 2","The Hate U Give","Hell or High Water","Her","Hereditary","Hidden Figures","Honeyland","How to Train Your Dragon","Hunt for the Wilderpeople","Hustlers","I Am Not Your Negro","I, Tonya","If Beale Street Could Talk","Incredibles 2","Inside Llewyn Davis","Inside Out","The Irishman","Isle of Dogs","It Follows","John Wick: Chapter 3 -- Parabellum","The Jungle Book","Kedi","The King's Speech","Knives Out","Kubo and the Two Strings","La La Land","Lady Bird","Leave No Trace","The LEGO Movie","Leviathan","Life Itself","The Lighthouse","Edge of Tomorrow","Logan","Logan Lucky","Looper","Love &amp; Friendship","Lucky","Mad Max: Fury Road","Maiden","Manchester by the Sea","Marriage Story","The Martian","Marvel's the Avengers","McQueen","Minding the Gap","Mission: Impossible -- Fallout","Mission: Impossible Rogue Nation","Moana","Moonlight","Mr. Turner","Mud","Mudbound","Mustang","My Life as a Zucchini","The Nice Guys","Nightcrawler","The Old Man &amp; the Gun","Once Upon a Time... In Hollywood","Paddington","Paddington 2","Pain and Glory","Parasite","Paterson","The Peanut Butter Falcon","Phantom Thread","Phoenix","Portrait of a Lady on Fire","The Post","A Quiet Place","Rocketman","Roma","Room","The Rider","The Salesman","Searching","Selma","A Separation","The Shape of Water","Shaun the Sheep Movie","Shazam!","Shoplifters","Short Term 12","Sicario","Sing Street","Skyfall","Snowpiercer","The Social Network","Son of Saul","Sorry to Bother You","Spider-Man: Far From Home","Spider-Man: Homecoming","Spider-Man: Into the Spider-Verse","Spotlight","Spy","Stan &amp; Ollie","A Star Is Born","Star Wars: The Force Awakens","Star Wars: The Last Jedi","Starred Up","Summer 1993","The Tale of the Princess Kaguya","They Shall Not Grow Old","Things to Come","Thor: Ragnarok","Three Billboards Outside Ebbing, Missouri","Three Identical Strangers","Tower","Toy Story 3","Toy Story 4","True Grit","Two Days One Night","Us","Wadjda","War for the Planet of the Apes","Weiner","What We Do in the Shadows","Whiplash","Widows","The Witch","Wildlife","Won't You Be My Neighbor?","Wonder Woman","X-Men: Days of Future Past","Your Name","Zero Dark Thirty","Zootopia"],["2013","2013","2015","2013","2018","2013","2015","2015","2018","2019","2012","2016","2018","2011","2019","2018","2014","2017","2019","2013","2017","2014","2018","2018","2013","2018","2017","2019","2014","2017","2015","2015","2018","2018","2017","2016","2018","2016","2013","2015","2017","2018","2015","2013","2014","2017","2017","2016","2019","2016","2017","2018","2014","2015","2017","2017","2019","2018","2019","2016","2018","2017","2017","2019","2018","2017","2017","2013","2014","2013","2014","2018","2016","2011","2018","2016","2013","2018","2016","2019","2010","2016","2019","2016","2017","2018","2018","2013","2015","2019","2018","2014","2019","2016","2016","2010","2019","2016","2016","2017","2018","2014","2014","2014","2019","2014","2017","2017","2012","2016","2017","2015","2018","2016","2019","2015","2012","2018","2018","2018","2015","2016","2016","2014","2013","2017","2015","2016","2016","2014","2018","2019","2014","2017","2019","2019","2016","2019","2017","2014","2019","2017","2018","2019","2018","2015","2017","2016","2018","2014","2011","2017","2015","2019","2018","2013","2015","2016","2012","2013","2010","2015","2018","2019","2017","2018","2015","2015","2018","2018","2015","2017","2013","2017","2013","2018","2016","2017","2017","2018","2016","2010","2019","2010","2014","2019","2012","2017","2016","2014","2014","2018","2015","2018","2018","2017","2014","2016","2012","2016"],["History/Drama","Documentary","Drama","Adventure/Mystery &amp; thriller","Documentary/Music","Crime/Drama","Documentary/Biography","Comedy/Drama","Action/Adventure","Documentary/History","History/Drama","Sci-fi/Mystery &amp; thriller","Drama/Romance","Romance/Comedy","Action/Adventure","Action/Adventure","Horror/Mystery &amp; thriller","Action/Mystery &amp; thriller","Biography/Drama","Romance/Drama","Romance/Comedy","Comedy/Drama","Crime/Drama","Action/Adventure","Documentary","Comedy/Drama","Sci-fi/Mystery &amp; thriller","Comedy/Lgbtq+","Drama","Drama/Lgbtq+","History/Drama","Romance/History","Action/Adventure","Mystery &amp; thriller/Drama","Romance/Drama","Documentary","Biography/Comedy","Action/Adventure","Drama/Action","Romance/Drama","Kids &amp; family/Comedy","Romance/Comedy","Drama","Drama/Lgbtq+","Sci-fi/Action","Comedy","Comedy/Drama","Action/Adventure","Biography/Comedy","Comedy/Drama","War/History","Comedy/Drama","Sci-fi/Mystery &amp; thriller","Mystery &amp; thriller/War","Documentary","Drama/Lgbtq+","Comedy/Drama","Comedy/Drama","Comedy/Drama","Kids &amp; family/Comedy","Biography/History","Mystery &amp; thriller/Drama","Drama","History/Drama","Documentary","Horror/Mystery &amp; thriller","Drama/Fantasy","Drama/Romance","Comedy/Drama","Drama/Sci-fi","Sci-fi/Adventure","Mystery &amp; thriller/Crime","Mystery &amp; thriller/Drama","Fantasy/Adventure","Crime/Drama","Crime/Drama","Comedy/Drama","Horror/Mystery &amp; thriller","History/Drama","Documentary","Kids &amp; family/Fantasy","Comedy/Adventure","Comedy/Drama","Documentary","Biography/Comedy","Crime/Drama","Kids &amp; family/Comedy","Drama/Comedy","Kids &amp; family/Comedy","Crime/Drama","Comedy/Adventure","Horror/Mystery &amp; thriller","Action/Mystery &amp; thriller","Kids &amp; family/Adventure","Documentary","History/Drama","Mystery &amp; thriller/Comedy","Kids &amp; family/Fantasy","Musical/Romance","Comedy/Drama","Drama","Kids &amp; family/Comedy","Drama","Documentary","Mystery &amp; thriller/Drama","Sci-fi/Action","Action/Adventure","Comedy/Crime","Sci-fi/Action","Comedy","Comedy/Drama","Action/Adventure","Documentary","Drama","Drama","Sci-fi/Adventure","Action/Adventure","Documentary","Documentary","Action/Adventure","Action/Adventure","Kids &amp; family/Musical","Drama/Lgbtq+","Biography/History","Drama/Adventure","History/Drama","Drama","Comedy/Drama","Action/Comedy","Mystery &amp; thriller/Crime","Comedy/Drama","Comedy/Drama","Kids &amp; family/Comedy","Kids &amp; family/Comedy","Drama","Comedy/Mystery &amp; thriller","Drama","Comedy/Drama","Drama/Romance","History/Drama","Romance/History","History/Drama","Horror/Mystery &amp; thriller","Musical/Biography","Drama","Drama","Drama/Western","Drama","Mystery &amp; thriller","History/Drama","Drama","Fantasy/Romance","Kids &amp; family/Comedy","Action/Adventure","Crime/Drama","Drama","Mystery &amp; thriller/Crime","Comedy/Drama","Action/Adventure","Sci-fi/Action","Drama/Biography","History/Drama","Comedy/Fantasy","Action/Adventure","Action/Adventure","Kids &amp; family/Action","Drama","Comedy/Action","Biography/Comedy","Romance/Drama","Sci-fi/Adventure","Sci-fi/Adventure","Crime/Drama","Drama","Fantasy/Anime","Documentary/History","Drama","Action/Adventure","Crime/Drama","Documentary/Biography","Documentary","Kids &amp; family/Comedy","Kids &amp; family/Comedy","Western/Drama","Drama","Horror/Mystery &amp; thriller","Drama","Sci-fi/Action","Documentary","Comedy/Horror","Drama/Music","Mystery &amp; thriller/Crime","Horror/History","Drama","Documentary","Action/Adventure","Action/Adventure","Fantasy/Romance","Drama/Mystery &amp; thriller","Kids &amp; family/Comedy"],["History","Documentary","Drama","Adventure","Documentary","Crime","Documentary","Comedy","Action","Documentary","History","Sci-fi","Drama","Romance","Action","Action","Horror","Action","Biography","Romance","Romance","Comedy","Crime","Action","Documentary","Comedy","Sci-fi","Comedy","Drama","Drama","History","Romance","Action","Mystery &amp; thriller","Romance","Documentary","Biography","Action","Drama","Romance","Kids &amp; family","Romance","Drama","Drama","Sci-fi","Comedy","Comedy","Action","Biography","Comedy","War","Comedy","Sci-fi","Mystery &amp; thriller","Documentary","Drama","Comedy","Comedy","Comedy","Kids &amp; family","Biography","Mystery &amp; thriller","Drama","History","Documentary","Horror","Drama","Drama","Comedy","Drama","Sci-fi","Mystery &amp; thriller","Mystery &amp; thriller","Fantasy","Crime","Crime","Comedy","Horror","History","Documentary","Kids &amp; family","Comedy","Comedy","Documentary","Biography","Crime","Kids &amp; family","Drama","Kids &amp; family","Crime","Comedy","Horror","Action","Kids &amp; family","Documentary","History","Mystery &amp; thriller","Kids &amp; family","Musical","Comedy","Drama","Kids &amp; family","Drama","Documentary","Mystery &amp; thriller","Sci-fi","Action","Comedy","Sci-fi","Comedy","Comedy","Action","Documentary","Drama","Drama","Sci-fi","Action","Documentary","Documentary","Action","Action","Kids &amp; family","Drama","Biography","Drama","History","Drama","Comedy","Action","Mystery &amp; thriller","Comedy","Comedy","Kids &amp; family","Kids &amp; family","Drama","Comedy","Drama","Comedy","Drama","History","Romance","History","Horror","Musical","Drama","Drama","Drama","Drama","Mystery &amp; thriller","History","Drama","Fantasy","Kids &amp; family","Action","Crime","Drama","Mystery &amp; thriller","Comedy","Action","Sci-fi","Drama","History","Comedy","Action","Action","Kids &amp; family","Drama","Comedy","Biography","Romance","Sci-fi","Sci-fi","Crime","Drama","Fantasy","Documentary","Drama","Action","Crime","Documentary","Documentary","Kids &amp; family","Kids &amp; family","Western","Drama","Horror","Drama","Sci-fi","Documentary","Comedy","Drama","Mystery &amp; thriller","Horror","Drama","Documentary","Action","Action","Fantasy","Drama","Kids &amp; family"],["Drama",null,null,"Mystery &amp; thriller","Music","Drama","Biography","Drama","Adventure","History","Drama","Mystery &amp; thriller","Romance","Comedy","Adventure","Adventure","Mystery &amp; thriller","Mystery &amp; thriller","Drama","Drama","Comedy","Drama","Drama","Adventure",null,"Drama","Mystery &amp; thriller","Lgbtq+",null,"Lgbtq+","Drama","History","Adventure","Drama","Drama",null,"Comedy","Adventure","Action","Drama","Comedy","Comedy",null,"Lgbtq+","Action",null,"Drama","Adventure","Comedy","Drama","History","Drama","Mystery &amp; thriller","War",null,"Lgbtq+","Drama","Drama","Drama","Comedy","History","Drama",null,"Drama",null,"Mystery &amp; thriller","Fantasy","Romance","Drama","Sci-fi","Adventure","Crime","Drama","Adventure","Drama","Drama","Drama","Mystery &amp; thriller","Drama",null,"Fantasy","Adventure","Drama",null,"Comedy","Drama","Comedy","Comedy","Comedy","Drama","Adventure","Mystery &amp; thriller","Mystery &amp; thriller","Adventure",null,"Drama","Comedy","Fantasy","Romance","Drama",null,"Comedy",null,null,"Drama","Action","Adventure","Crime","Action",null,"Drama","Adventure",null,null,null,"Adventure","Adventure",null,null,"Adventure","Adventure","Musical","Lgbtq+","History","Adventure","Drama",null,"Drama","Comedy","Crime","Drama","Drama","Comedy","Comedy",null,"Mystery &amp; thriller",null,"Drama","Romance","Drama","History","Drama","Mystery &amp; thriller","Biography",null,null,"Western",null,null,"Drama",null,"Romance","Comedy","Adventure","Drama",null,"Crime","Drama","Adventure","Action","Biography","Drama","Fantasy","Adventure","Adventure","Action",null,"Action","Comedy","Drama","Adventure","Adventure","Drama",null,"Anime","History",null,"Adventure","Drama","Biography",null,"Comedy","Comedy","Drama",null,"Mystery &amp; thriller",null,"Action",null,"Horror","Music","Crime","History",null,null,"Adventure","Adventure","Romance","Mystery &amp; thriller","Comedy"],["2h 14m","1h 30m","1h 33m","1h 45m","1h 27m","2h 18m","2h 8m","1h 30m","1h 58m","1h 33m","2h 0m","1h 56m","2h 21m","1h 40m","3h 1m","2h 29m","1h 33m","1h 53m","1h 47m","1h 49m","2h 0m","1h 59m","2h 5m","2h 14m","1h 23m","2h 14m","2h 44m","1h 42m","2h 45m","2h 23m","2h 21m","1h 52m","1h 54m","2h 28m","2h 12m","1h 42m","1h 46m","2h 26m","2h 13m","1h 58m","1h 49m","2h 0m","2h 13m","1h 57m","2h 10m","1h 47m","1h 43m","1h 55m","1h 58m","1h 28m","1h 47m","1h 33m","1h 47m","1h 42m","1h 29m","1h 43m","1h 40m","2h 0m","1h 47m","1h 43m","2h 21m","1h 53m","1h 55m","2h 32m","1h 40m","1h 44m","1h 30m","1h 49m","1h 39m","1h 31m","2h 1m","1h 25m","2h 24m","2h 11m","2h 13m","1h 37m","1h 59m","2h 7m","2h 7m","1h 25m","1h 38m","1h 41m","1h 50m","1h 35m","2h 1m","1h 59m","1h 58m","1h 44m","1h 35m","3h 29m","1h 41m","1h 41m","2h 11m","1h 45m","1h 20m","1h 58m","2h 10m","1h 42m","2h 8m","1h 34m","1h 48m","1h 35m","2h 22m","2h 0m","1h 50m","1h 53m","2h 17m","1h 59m","1h 59m","1h 33m","1h 28m","2h 0m","1h 33m","2h 17m","2h 16m","2h 22m","2h 23m","1h 51m","1h 33m","2h 27m","2h 11m","1h 53m","1h 51m","2h 29m","2h 10m","2h 14m","1h 37m","1h 6m","1h 56m","1h 57m","1h 33m","2h 39m","1h 35m","1h 43m","1h 53m","2h 12m","1h 58m","1h 36m","2h 10m","1h 38m","2h 1m","1h 55m","1h 30m","2h 1m","2h 15m","1h 58m","1h 44m","2h 5m","1h 42m","2h 8m","2h 3m","2h 3m","1h 25m","2h 12m","2h 1m","1h 36m","2h 1m","1h 46m","2h 23m","2h 5m","2h 0m","1h 47m","1h 45m","2h 9m","2h 13m","1h 57m","2h 8m","1h 55m","1h 37m","2h 15m","2h 16m","2h 32m","1h 40m","1h 38m","2h 17m","1h 39m","1h 41m","2h 10m","1h 55m","1h 36m","1h 38m","1h 42m","1h 40m","1h 50m","1h 35m","1h 56m","1h 38m","2h 22m","1h 36m","1h 26m","1h 46m","2h 8m","1h 32m","1h 44m","1h 34m","2h 21m","2h 11m","1h 46m","2h 37m","1h 48m"],["95%","99%","97%","94%","99%","92%","95%","91%","87%","99%","96%","95%","99%","95%","94%","85%","98%","92%","95%","98%","98%","91%","96%","96%","98%","96%","88%","96%","97%","99%","91%","97%","91%","95%","94%","99%","98%","90%","93%","94%","97%","91%","95%","92%","91%","94%","91%","89%","97%","98%","92%","99%","92%","95%","99%","94%","97%","93%","93%","94%","87%","94%","96%","92%","98%","98%","91%","100%","92%","96%","92%","98%","96%","96%","97%","97%","94%","90%","93%","100%","99%","97%","87%","99%","90%","95%","93%","92%","98%","95%","90%","95%","89%","94%","98%","94%","97%","97%","91%","99%","100%","96%","97%","98%","90%","91%","94%","92%","93%","96%","97%","97%","98%","96%","95%","91%","91%","99%","100%","97%","94%","95%","98%","97%","97%","97%","97%","99%","91%","95%","93%","85%","97%","99%","96%","99%","96%","95%","91%","98%","97%","88%","96%","89%","96%","93%","97%","96%","92%","99%","99%","92%","99%","90%","99%","98%","92%","95%","92%","94%","96%","96%","93%","90%","92%","97%","97%","95%","92%","90%","93%","91%","99%","100%","100%","99%","99%","93%","90%","96%","99%","98%","97%","95%","97%","93%","99%","94%","96%","96%","94%","91%","90%","94%","97%","93%","90%","98%","91%","98%"],["90%","82%","67%","64%","80%","74%","87%","71%","80%","90%","90%","82%","69%","87%","90%","92%","72%","86%","92%","82%","88%","78%","85%","79%","90%","83%","82%","77%","81%","84%","87%","87%","74%","80%","86%","69%","81%","89%","89%","74%","94%","76%","89%","91%","88%","78%","85%","86%","91%","69%","81%","82%","86%","82%","89%","77%","87%","70%","86%","84%","67%","69%","80%","98%","93%","86%","66%","65%","86%","79%","92%","87%","91%","89%","82%","88%","82%","69%","93%","86%","91%","91%","65%","83%","88%","71%","84%","74%","89%","86%","87%","66%","86%","86%","85%","92%","92%","86%","81%","79%","80%","87%","80%","88%","72%","90%","90%","76%","82%","60%","81%","86%","97%","78%","85%","91%","91%","79%","91%","88%","87%","89%","79%","56%","80%","85%","88%","89%","79%","86%","62%","70%","80%","88%","91%","90%","72%","96%","71%","78%","92%","73%","83%","88%","72%","93%","82%","84%","87%","86%","92%","72%","81%","82%","91%","92%","85%","92%","86%","73%","87%","80%","70%","95%","87%","93%","93%","78%","83%","80%","85%","42%","84%","83%","90%","91%","71%","87%","87%","88%","89%","90%","94%","85%","76%","60%","88%","84%","83%","87%","94%","61%","60%","71%","94%","83%","91%","94%","80%","92%"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>id<\/th>\n      <th>title<\/th>\n      <th>year<\/th>\n      <th>genre<\/th>\n      <th>genre_1<\/th>\n      <th>genre_2<\/th>\n      <th>runtime<\/th>\n      <th>critics_score<\/th>\n      <th>audience_score<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="writing-file" class="level3">
<h3 class="anchored" data-anchor-id="writing-file">Writing file</h3>
<p>I choose to save the data in an excel file only because the csv will remove the leading zeros in the <code>id</code> column.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1">movies <span class="sc" style="color: #5E5E5E;">%&gt;%</span> writexl<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">write_xlsx</span>(<span class="st" style="color: #20794D;">"datasets/top_200_movies_2010s_rotten_tomatoes.xlsx"</span>)</span></code></pre></div>
</div>
</section>
</section>
<section id="tableau-dashboard" class="level2">
<h2 class="anchored" data-anchor-id="tableau-dashboard">7. Tableau dashboard</h2>
<p>The final dashboard is created in Tableau. It‚Äôs actually a jitter plot, which separates overlapping movies with the same critics‚Äô score.</p>
<p>To avoid two filters, one for primary and one for secondary genre, a list parameter is created that filters movies by primary or secondary genre, or ‚ÄúAll‚Äù values.</p>
<p>For the best viewing experience, please click on the full screen in the bottom right corner.</p>
<p>You can nteract with the embedded dashboard below or go to <a href="https://public.tableau.com/app/profile/sandra.jurela/viz/RottenTomatoes-The200BestMoviesofthe2010s/Dashboard?publish=yes">Tableau Public</a>. Enjoy!</p>

<div class="tableauPlaceholder" id="viz1676446199516" style="position: relative"><noscript><img alt="Dashboard  " src="https://sandrajurela.com/posts/web-scraping-rotten-tomatoes/https:/public.tableau.com/static/images/Ro/RottenTomatoes-The200BestMoviesofthe2010s/Dashboard/1_rss.png" style="border: none"></noscript><object class="tableauViz" style="display:none;"><param name="host_url" value="https%3A%2F%2Fpublic.tableau.com%2F"> <param name="embed_code_version" value="3"> <param name="site_root" value=""><param name="name" value="RottenTomatoes-The200BestMoviesofthe2010s/Dashboard"><param name="tabs" value="no"><param name="toolbar" value="yes"><param name="static_image" value="https://public.tableau.com/static/images/Ro/RottenTomatoes-The200BestMoviesofthe2010s/Dashboard/1.png"> <param name="animate_transition" value="yes"><param name="display_static_image" value="yes"><param name="display_spinner" value="yes"><param name="display_overlay" value="yes"><param name="display_count" value="yes"><param name="language" value="en-US"></object></div>                
<script type="text/javascript">                    
var divElement = document.getElementById('viz1676446199516');                    
var vizElement = divElement.getElementsByTagName('object')[0];                    
if ( divElement.offsetWidth > 800 ) { vizElement.style.width='800px';vizElement.style.height='627px';} 
else if ( divElement.offsetWidth > 500 ) { vizElement.style.width='800px';vizElement.style.height='627px';} 
else { vizElement.style.width='100%';vizElement.style.height='527px';}                     
var scriptElement = document.createElement('script');                    
scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';                    vizElement.parentNode.insertBefore(scriptElement, vizElement);                
</script>


</section>

 ]]></description>
  <category>web scraping</category>
  <category>data wrangling</category>
  <category>rvest</category>
  <category>R</category>
  <category>Tableau</category>
  <guid>https://sandrajurela.com/posts/web-scraping-rotten-tomatoes/rotten-tomatoes.html</guid>
  <pubDate>Wed, 31 Aug 2022 22:00:00 GMT</pubDate>
  <media:content url="https://sandrajurela.com/posts/web-scraping-rotten-tomatoes/images/dashboard.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Titanic Survival Exercises</title>
  <dc:creator>Sandra Jurela</dc:creator>
  <link>https://sandrajurela.com/posts/titanic-survival-exercises/titanic-survival-exercises.html</link>
  <description><![CDATA[ 




<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>After auditing the HarvardX‚Äôs <a href="https://www.edx.org/course/data-science-visualization">Data Science: Visualization</a> course I‚Äôve found this assessment way too interesting and fun. So I decided to put all my new skills together to perform exploratory data analysis on a classic machine learning dataset: Titanic survival! My goal is to provide answers entirely through visualizations.</p>
</section>
<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">Background</h2>
<p>The Titanic was a British ocean liner that struck an iceberg and sunk on its maiden voyage in 1912 from the United Kingdom to New York. More than 1,500 of the estimated 2,224 passengers and crew died in the accident, making this one of the largest maritime disasters ever outside of war. The ship carried a wide range of passengers of all ages and both genders, from luxury travelers in first-class to immigrants in the lower classes. However, not all passengers were equally likely to survive the accident. We use real data about a selection of 891 passengers to learn who was on the Titanic and which passengers were more likely to survive.</p>
</section>
<section id="libraries-customizations-and-data" class="level2">
<h2 class="anchored" data-anchor-id="libraries-customizations-and-data">Libraries, Customizations, and Data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;">library</span>(tidyverse)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;">library</span>(titanic)</span>
<span id="cb1-3"></span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;">options</span>(<span class="at" style="color: #657422;">digits =</span> <span class="dv" style="color: #AD0000;">3</span>)  </span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;">theme_set</span>(<span class="fu" style="color: #4758AB;">theme_classic</span>())</span>
<span id="cb1-6">colors_sex <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"mediumorchid1"</span>, <span class="st" style="color: #20794D;">"dodgerblue"</span>)</span>
<span id="cb1-7">colors_survived <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"gray65"</span>, <span class="st" style="color: #20794D;">"lightgreen"</span>)</span></code></pre></div>
</div>
<p>Defining the <code>titanic</code> dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">titanic <span class="ot" style="color: #003B4F;">&lt;-</span> titanic_train <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb2-2">  <span class="fu" style="color: #4758AB;">select</span>(Survived, Pclass, Sex, Age, SibSp, Parch, Fare) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb2-3">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">Survived =</span> <span class="fu" style="color: #4758AB;">factor</span>(Survived),</span>
<span id="cb2-4">         <span class="at" style="color: #657422;">Pclass =</span> <span class="fu" style="color: #4758AB;">factor</span>(Pclass),</span>
<span id="cb2-5">         <span class="at" style="color: #657422;">Sex =</span> <span class="fu" style="color: #4758AB;">factor</span>(Sex))</span>
<span id="cb2-6"></span>
<span id="cb2-7"><span class="fu" style="color: #4758AB;">head</span>(titanic)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Survived Pclass    Sex Age SibSp Parch  Fare
1        0      3   male  22     1     0  7.25
2        1      1 female  38     1     0 71.28
3        1      3 female  26     0     0  7.92
4        1      1 female  35     1     0 53.10
5        0      3   male  35     0     0  8.05
6        0      3   male  NA     0     0  8.46</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;">str</span>(titanic)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   891 obs. of  7 variables:
 $ Survived: Factor w/ 2 levels "0","1": 1 2 2 2 1 1 1 1 2 2 ...
 $ Pclass  : Factor w/ 3 levels "1","2","3": 3 1 3 1 3 3 1 3 3 2 ...
 $ Sex     : Factor w/ 2 levels "female","male": 2 1 1 1 2 2 2 2 1 1 ...
 $ Age     : num  22 38 26 35 35 NA 54 2 27 14 ...
 $ SibSp   : int  1 1 0 1 0 0 0 3 0 1 ...
 $ Parch   : int  0 0 0 0 0 0 0 1 2 0 ...
 $ Fare    : num  7.25 71.28 7.92 53.1 8.05 ...</code></pre>
</div>
</div>
</section>
<section id="question-1-variable-types" class="level2">
<h2 class="anchored" data-anchor-id="question-1-variable-types">Question 1: Variable Types</h2>
<p>Instructions: Inspect the data and also use <code>?titanic_train</code> to learn more about the variables in the dataset. Match these variables from the dataset to their variable type. There is at least one variable of each type (ordinal categorical, non-ordinal (nominal) categorical, continuous, discrete).</p>
<p>Checking if <code>Age</code> variable is discrete or continuous‚Ä¶</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;">unique</span>(titanic<span class="sc" style="color: #5E5E5E;">$</span>Age)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 22.00 38.00 26.00 35.00    NA 54.00  2.00 27.00 14.00  4.00 58.00 20.00
[13] 39.00 55.00 31.00 34.00 15.00 28.00  8.00 19.00 40.00 66.00 42.00 21.00
[25] 18.00  3.00  7.00 49.00 29.00 65.00 28.50  5.00 11.00 45.00 17.00 32.00
[37] 16.00 25.00  0.83 30.00 33.00 23.00 24.00 46.00 59.00 71.00 37.00 47.00
[49] 14.50 70.50 32.50 12.00  9.00 36.50 51.00 55.50 40.50 44.00  1.00 61.00
[61] 56.00 50.00 36.00 45.50 20.50 62.00 41.00 52.00 63.00 23.50  0.92 43.00
[73] 60.00 10.00 64.00 13.00 48.00  0.75 53.00 57.00 80.00 70.00 24.50  6.00
[85]  0.67 30.50  0.42 34.50 74.00</code></pre>
</div>
</div>
<p><code>Age</code> is a continuous variable.</p>
<table class="table">
<thead>
<tr class="header">
<th>Variable</th>
<th>Description</th>
<th>Variable Type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>Survived</code></td>
<td>Passenger Survival Indicator</td>
<td>nominal categorical</td>
</tr>
<tr class="even">
<td><code>Pclass</code></td>
<td>Passenger Class</td>
<td>ordinal categorical</td>
</tr>
<tr class="odd">
<td><code>Sex</code></td>
<td>Sex</td>
<td>nominal categorical</td>
</tr>
<tr class="even">
<td><code>Age</code></td>
<td>Age</td>
<td>continuous</td>
</tr>
<tr class="odd">
<td><code>SibSp</code></td>
<td>Number of Siblings/Spouses Aboard</td>
<td>discrete</td>
</tr>
<tr class="even">
<td><code>Parch</code></td>
<td>Number of Parents/Children Aboard</td>
<td>discrete</td>
</tr>
<tr class="odd">
<td><code>Fare</code></td>
<td>Passenger Fare</td>
<td>continuous</td>
</tr>
</tbody>
</table>
</section>
<section id="question-2-demographics-of-titanic-passengers" class="level2">
<h2 class="anchored" data-anchor-id="question-2-demographics-of-titanic-passengers">Question 2: Demographics of Titanic Passengers</h2>
<p>Instructions: Make density plots of age grouped by sex. Try experimenting with combinations of faceting, alpha blending, stacking and using variable counts on the y-axis to answer the following questions. Some questions may be easier to answer with different versions of the density plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">titanic <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(Age)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb8-3">  <span class="fu" style="color: #4758AB;">geom_density</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">color =</span> Sex), <span class="at" style="color: #657422;">size =</span> <span class="fl" style="color: #AD0000;">0.7</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb8-4">  <span class="fu" style="color: #4758AB;">scale_color_manual</span>(<span class="at" style="color: #657422;">values =</span> colors_sex) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb8-5">  <span class="fu" style="color: #4758AB;">geom_vline</span>(<span class="at" style="color: #657422;">xintercept =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="dv" style="color: #AD0000;">18</span>, <span class="dv" style="color: #AD0000;">35</span>), <span class="at" style="color: #657422;">linetype =</span> <span class="dv" style="color: #AD0000;">2</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb8-6">  <span class="fu" style="color: #4758AB;">geom_text</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> <span class="dv" style="color: #AD0000;">18</span>, <span class="at" style="color: #657422;">y =</span> <span class="fl" style="color: #AD0000;">0.031</span>, <span class="at" style="color: #657422;">label=</span> <span class="st" style="color: #20794D;">"18"</span>, <span class="at" style="color: #657422;">hjust =</span> <span class="fl" style="color: #AD0000;">1.5</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb8-7">  <span class="fu" style="color: #4758AB;">geom_text</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> <span class="dv" style="color: #AD0000;">35</span>, <span class="at" style="color: #657422;">y =</span> <span class="fl" style="color: #AD0000;">0.031</span>, <span class="at" style="color: #657422;">label=</span> <span class="st" style="color: #20794D;">"35"</span>, <span class="at" style="color: #657422;">hjust =</span> <span class="sc" style="color: #5E5E5E;">-</span><span class="fl" style="color: #AD0000;">0.5</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb8-8">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">legend.position =</span> <span class="st" style="color: #20794D;">"top"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb8-9">  <span class="fu" style="color: #4758AB;">ylab</span>(<span class="st" style="color: #20794D;">"density"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/titanic-survival-exercises/titanic-survival-exercises_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">titanic <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb9-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(Age, <span class="at" style="color: #657422;">fill =</span> Sex)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb9-3">  <span class="fu" style="color: #4758AB;">geom_density</span>(<span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.3</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb9-4">  <span class="fu" style="color: #4758AB;">scale_fill_manual</span>(<span class="at" style="color: #657422;">values =</span> colors_sex) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb9-5">  <span class="fu" style="color: #4758AB;">geom_vline</span>(<span class="at" style="color: #657422;">xintercept =</span> <span class="dv" style="color: #AD0000;">17</span>, <span class="at" style="color: #657422;">linetype =</span> <span class="dv" style="color: #AD0000;">2</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb9-6">  <span class="fu" style="color: #4758AB;">geom_text</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> <span class="dv" style="color: #AD0000;">17</span>, <span class="at" style="color: #657422;">y =</span> <span class="fl" style="color: #AD0000;">0.031</span>, <span class="at" style="color: #657422;">label=</span> <span class="st" style="color: #20794D;">"17"</span>, <span class="at" style="color: #657422;">hjust =</span> <span class="fl" style="color: #AD0000;">1.5</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb9-7">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">legend.position =</span> <span class="st" style="color: #20794D;">"top"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb9-8">  <span class="fu" style="color: #4758AB;">ylab</span>(<span class="st" style="color: #20794D;">"density"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/titanic-survival-exercises/titanic-survival-exercises_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-preview="true">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">titanic <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb10-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(Age, ..count.., <span class="at" style="color: #657422;">fill =</span> Sex)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb10-3">  <span class="fu" style="color: #4758AB;">geom_density</span>(<span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.7</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb10-4">  <span class="fu" style="color: #4758AB;">facet_grid</span>(Sex <span class="sc" style="color: #5E5E5E;">~</span> .) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb10-5">  <span class="fu" style="color: #4758AB;">scale_fill_manual</span>(<span class="at" style="color: #657422;">values =</span> colors_sex) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb10-6">  <span class="fu" style="color: #4758AB;">geom_vline</span>(<span class="at" style="color: #657422;">xintercept =</span> <span class="dv" style="color: #AD0000;">40</span>, <span class="at" style="color: #657422;">linetype =</span> <span class="dv" style="color: #AD0000;">2</span>) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb10-7">  <span class="fu" style="color: #4758AB;">geom_text</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> <span class="dv" style="color: #AD0000;">40</span>, <span class="at" style="color: #657422;">y =</span> <span class="dv" style="color: #AD0000;">14</span>, <span class="at" style="color: #657422;">label=</span> <span class="st" style="color: #20794D;">"40"</span>, <span class="at" style="color: #657422;">hjust =</span> <span class="sc" style="color: #5E5E5E;">-</span><span class="fl" style="color: #AD0000;">0.5</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb10-8">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">legend.position =</span> <span class="st" style="color: #20794D;">"top"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/titanic-survival-exercises/titanic-survival-exercises_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Which of the following are true?</p>
<p>Select all correct answers</p>
<ul>
<li>‚úÖ Females and males had the same general shape of age distribution.</li>
<li>‚úÖ } The age distribution was bimodal, with one mode around 25 years of age and a second - - smaller mode around 5 years of age.</li>
<li>‚ùå There were more females than males.</li>
<li>‚úÖ The count of males of age 40 was higher than the count of females of age 40.</li>
<li>‚úÖ The proportion of males age 18-35 was higher than the proportion of females age 18-35.</li>
<li>‚úÖ The proportion of females under age 17 was higher than the proportion of males under age 17.</li>
<li>‚ùå The oldest passengers were female.</li>
</ul>
</section>
<section id="question-3-qq-plot-of-age-distribution" class="level2">
<h2 class="anchored" data-anchor-id="question-3-qq-plot-of-age-distribution">Question 3: QQ-plot of Age Distribution</h2>
<p>Instructions: Use <code>geom_qq()</code> to make a QQ-plot of passenger age and add an identity line with <code>geom_abline()</code>. Filter out any individuals with an age of NA first.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">params <span class="ot" style="color: #003B4F;">&lt;-</span> titanic <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb11-2">  <span class="fu" style="color: #4758AB;">filter</span>(<span class="sc" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;">is.na</span>(Age)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb11-3">  <span class="fu" style="color: #4758AB;">summarize</span>(<span class="at" style="color: #657422;">mean =</span> <span class="fu" style="color: #4758AB;">mean</span>(Age), <span class="at" style="color: #657422;">sd =</span> <span class="fu" style="color: #4758AB;">sd</span>(Age))</span>
<span id="cb11-4"></span>
<span id="cb11-5">params</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  mean   sd
1 29.7 14.5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">titanic <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">sample =</span> Age)) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb13-2">  <span class="fu" style="color: #4758AB;">geom_qq</span>(<span class="at" style="color: #657422;">dparams =</span> params) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb13-3">  <span class="fu" style="color: #4758AB;">geom_abline</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/titanic-survival-exercises/titanic-survival-exercises_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<p>Which of the following is the correct plot according to the instructions above?</p>
<ul>
<li>‚úÖ The plot above.</li>
</ul>
</section>
<section id="question-4-survival-by-sex" class="level2">
<h2 class="anchored" data-anchor-id="question-4-survival-by-sex">Question 4: Survival by Sex</h2>
<p>Instructions: To answer the following questions, make barplots of the <code>Survived</code> and <code>Sex</code> variables using <code>geom_bar()</code>. Try plotting one variable and filling by the other variable. You may want to try the default plot, then try adding <code>position = position_dodge()</code> to geom_bar() to make separate bars for each group.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">titanic <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb14-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(Survived, <span class="at" style="color: #657422;">fill =</span> Sex)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb14-3">  <span class="fu" style="color: #4758AB;">geom_bar</span>(<span class="at" style="color: #657422;">width =</span> <span class="fl" style="color: #AD0000;">0.7</span>, <span class="at" style="color: #657422;">color =</span> <span class="st" style="color: #20794D;">"white"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb14-4">  <span class="fu" style="color: #4758AB;">scale_fill_manual</span>(<span class="at" style="color: #657422;">values =</span> colors_sex)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/titanic-survival-exercises/titanic-survival-exercises_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">titanic <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb15-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(Sex, <span class="at" style="color: #657422;">fill =</span> Survived)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb15-3">  <span class="fu" style="color: #4758AB;">geom_bar</span>(<span class="at" style="color: #657422;">width =</span>  <span class="fl" style="color: #AD0000;">0.8</span>, <span class="at" style="color: #657422;">position =</span> <span class="fu" style="color: #4758AB;">position_dodge</span>(<span class="fl" style="color: #AD0000;">0.85</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb15-4">  <span class="fu" style="color: #4758AB;">scale_fill_manual</span>(<span class="at" style="color: #657422;">values =</span> colors_survived)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/titanic-survival-exercises/titanic-survival-exercises_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<p>Which of the following are true?</p>
<p>Select all correct answers.</p>
<ul>
<li>‚úÖ Less than half of passengers survived.</li>
<li>‚úÖ Most of the survivors were female.</li>
<li>‚ùå Most of the males survived.</li>
<li>‚úÖ Most of the females survived.</li>
</ul>
</section>
<section id="question-5-survival-by-age" class="level2">
<h2 class="anchored" data-anchor-id="question-5-survival-by-age">Question 5: Survival by Age</h2>
<p>Instructions: Make a density plot of age filled by survival status. Change the y-axis to count and set <code>alpha = 0.2</code>.</p>
<p>The following answers were offered for all three questions:</p>
<ul>
<li>0-8</li>
<li>10-18</li>
<li>18-30</li>
<li>30-50</li>
<li>50-70</li>
<li>70-80</li>
</ul>
<section id="which-age-group-is-the-only-group-more-likely-to-survive-than-die" class="level3">
<h3 class="anchored" data-anchor-id="which-age-group-is-the-only-group-more-likely-to-survive-than-die">Which age group is the only group more likely to survive than die?</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">titanic <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb16-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(Age, <span class="at" style="color: #657422;">y =</span> ..count.., <span class="at" style="color: #657422;">fill =</span> Survived)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb16-3">  <span class="fu" style="color: #4758AB;">geom_density</span>(<span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.5</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb16-4">  <span class="fu" style="color: #4758AB;">scale_fill_manual</span>(<span class="at" style="color: #657422;">values =</span> colors_survived) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb16-5">  <span class="fu" style="color: #4758AB;">geom_vline</span>(<span class="at" style="color: #657422;">xintercept =</span> <span class="dv" style="color: #AD0000;">8</span>, <span class="at" style="color: #657422;">linetype =</span> <span class="dv" style="color: #AD0000;">2</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb16-6">  <span class="fu" style="color: #4758AB;">geom_text</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> <span class="dv" style="color: #AD0000;">8</span>, <span class="at" style="color: #657422;">y =</span> <span class="dv" style="color: #AD0000;">14</span>, <span class="at" style="color: #657422;">label=</span> <span class="st" style="color: #20794D;">"8"</span>, <span class="at" style="color: #657422;">hjust =</span> <span class="sc" style="color: #5E5E5E;">-</span><span class="fl" style="color: #AD0000;">0.5</span>))</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/titanic-survival-exercises/titanic-survival-exercises_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>‚úÖ Age group 0-8.</li>
</ul>
</section>
<section id="which-age-group-had-the-most-deaths" class="level3">
<h3 class="anchored" data-anchor-id="which-age-group-had-the-most-deaths">Which age group had the most deaths?</h3>
<p>It‚Äôs hard to tell from the previews plot I‚Äôll have to make a new column <code>Age group</code> based on the offered answers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1">titanic2 <span class="ot" style="color: #003B4F;">&lt;-</span> titanic <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb17-2">  <span class="fu" style="color: #4758AB;">filter</span>(<span class="sc" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;">is.na</span>(Age)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb17-3">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="st" style="color: #20794D;">`</span><span class="at" style="color: #657422;">Age group</span><span class="st" style="color: #20794D;">`</span> <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">case_when</span>(</span>
<span id="cb17-4">    Age <span class="sc" style="color: #5E5E5E;">&gt;</span><span class="dv" style="color: #AD0000;">0</span> <span class="sc" style="color: #5E5E5E;">&amp;</span> Age <span class="sc" style="color: #5E5E5E;">&lt;=</span><span class="dv" style="color: #AD0000;">8</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"0-8"</span>,</span>
<span id="cb17-5">    Age <span class="sc" style="color: #5E5E5E;">&gt;=</span><span class="dv" style="color: #AD0000;">10</span> <span class="sc" style="color: #5E5E5E;">&amp;</span> Age <span class="sc" style="color: #5E5E5E;">&lt;=</span><span class="dv" style="color: #AD0000;">18</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"10-18"</span>,</span>
<span id="cb17-6">    Age <span class="sc" style="color: #5E5E5E;">&gt;=</span><span class="dv" style="color: #AD0000;">18</span> <span class="sc" style="color: #5E5E5E;">&amp;</span> Age <span class="sc" style="color: #5E5E5E;">&lt;=</span><span class="dv" style="color: #AD0000;">30</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"18-30"</span>,</span>
<span id="cb17-7">    Age <span class="sc" style="color: #5E5E5E;">&gt;=</span><span class="dv" style="color: #AD0000;">30</span> <span class="sc" style="color: #5E5E5E;">&amp;</span> Age <span class="sc" style="color: #5E5E5E;">&lt;=</span><span class="dv" style="color: #AD0000;">50</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"30-50"</span>,</span>
<span id="cb17-8">    Age <span class="sc" style="color: #5E5E5E;">&gt;=</span><span class="dv" style="color: #AD0000;">50</span> <span class="sc" style="color: #5E5E5E;">&amp;</span> Age <span class="sc" style="color: #5E5E5E;">&lt;=</span><span class="dv" style="color: #AD0000;">70</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"50-70"</span>,</span>
<span id="cb17-9">    Age <span class="sc" style="color: #5E5E5E;">&gt;=</span><span class="dv" style="color: #AD0000;">70</span> <span class="sc" style="color: #5E5E5E;">&amp;</span> Age <span class="sc" style="color: #5E5E5E;">&lt;=</span><span class="dv" style="color: #AD0000;">80</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"70-80"</span>))</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">titanic2 <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb18-2">  <span class="fu" style="color: #4758AB;">filter</span>(<span class="sc" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;">is.na</span>(<span class="st" style="color: #20794D;">`</span><span class="at" style="color: #657422;">Age group</span><span class="st" style="color: #20794D;">`</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb18-3">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="st" style="color: #20794D;">`</span><span class="at" style="color: #657422;">Age group</span><span class="st" style="color: #20794D;">`</span>, <span class="at" style="color: #657422;">fill =</span> Survived)) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb18-4">  <span class="fu" style="color: #4758AB;">geom_bar</span>(<span class="at" style="color: #657422;">width =</span> <span class="fl" style="color: #AD0000;">0.7</span>, <span class="at" style="color: #657422;">color =</span> <span class="st" style="color: #20794D;">"white"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb18-5">  <span class="fu" style="color: #4758AB;">scale_fill_manual</span>(<span class="at" style="color: #657422;">values =</span> colors_survived)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/titanic-survival-exercises/titanic-survival-exercises_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<ul>
<li>‚úÖ Age group 18-30.</li>
</ul>
</section>
<section id="which-age-group-had-the-highest-proportion-of-deaths" class="level3">
<h3 class="anchored" data-anchor-id="which-age-group-had-the-highest-proportion-of-deaths">Which age group had the highest proportion of deaths?</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1">titanic2 <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb19-2">  <span class="fu" style="color: #4758AB;">filter</span>(<span class="sc" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;">is.na</span>(<span class="st" style="color: #20794D;">`</span><span class="at" style="color: #657422;">Age group</span><span class="st" style="color: #20794D;">`</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb19-3">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="st" style="color: #20794D;">`</span><span class="at" style="color: #657422;">Age group</span><span class="st" style="color: #20794D;">`</span>, <span class="at" style="color: #657422;">fill =</span> Survived)) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb19-4">  <span class="fu" style="color: #4758AB;">geom_bar</span>(<span class="at" style="color: #657422;">position =</span> <span class="st" style="color: #20794D;">"fill"</span>, <span class="at" style="color: #657422;">width =</span> <span class="fl" style="color: #AD0000;">0.7</span>, <span class="at" style="color: #657422;">color =</span> <span class="st" style="color: #20794D;">"white"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb19-5">  <span class="fu" style="color: #4758AB;">scale_fill_manual</span>(<span class="at" style="color: #657422;">values =</span> colors_survived)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/titanic-survival-exercises/titanic-survival-exercises_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<ul>
<li>‚úÖ Age group 70-80</li>
</ul>
</section>
</section>
<section id="question-6-survival-by-fare" class="level2">
<h2 class="anchored" data-anchor-id="question-6-survival-by-fare">Question 6: Survival by Fare</h2>
<p>Instructions: Filter the data to remove individuals who paid a fare of 0. Make a boxplot of fare grouped by survival status. Try a log2 transformation of fares. Add the data points with jitter and alpha blending.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="fu" style="color: #4758AB;">set.seed</span>(<span class="dv" style="color: #AD0000;">123</span>)</span>
<span id="cb20-2"></span>
<span id="cb20-3">titanic <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(Fare <span class="sc" style="color: #5E5E5E;">!=</span> <span class="dv" style="color: #AD0000;">0</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb20-4">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(Survived, Fare)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb20-5">  <span class="fu" style="color: #4758AB;">geom_boxplot</span>(<span class="at" style="color: #657422;">fill =</span> colors_survived, <span class="at" style="color: #657422;">width =</span> <span class="fl" style="color: #AD0000;">0.5</span>, <span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.5</span>) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb20-6">  <span class="fu" style="color: #4758AB;">geom_jitter</span>(<span class="at" style="color: #657422;">width =</span> <span class="fl" style="color: #AD0000;">0.1</span>, <span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.2</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb20-7">  <span class="fu" style="color: #4758AB;">scale_y_continuous</span>(<span class="at" style="color: #657422;">trans =</span> <span class="st" style="color: #20794D;">"log2"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/titanic-survival-exercises/titanic-survival-exercises_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<p>Which of the following are true?</p>
<p>Select all correct answers.</p>
<ul>
<li>‚úÖ Passengers who survived generally payed higher fares than those who did not survive.</li>
<li>‚ùå The interquartile range for fares was smaller for passengers who survived.</li>
<li>‚úÖ The median fare was lower for passengers who did not survive.</li>
<li>‚ùå Only one individual paid a fare around $500. That individual survived. (3 individuals survived)</li>
<li>‚úÖ Most individuals who paid a fare around $8 did not survive.</li>
</ul>
</section>
<section id="question-7-survival-by-passenger-class" class="level2">
<h2 class="anchored" data-anchor-id="question-7-survival-by-passenger-class">Question 7: Survival by Passenger Class</h2>
<p>Instructions: The <code>Pclass</code> variable corresponds to the passenger class. Make three barplots. For the first, make a basic barplot of passenger class filled by survival. For the second, make the same barplot but use the argument <code>position = position_fill()</code> to show relative proportions in each group instead of counts. For the third, make a barplot of survival filled by passenger class using <code>position = position_fill()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1">titanic <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(Pclass, <span class="at" style="color: #657422;">fill =</span> Pclass)) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb21-3">  <span class="fu" style="color: #4758AB;">geom_bar</span>(<span class="at" style="color: #657422;">width =</span> <span class="fl" style="color: #AD0000;">0.7</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb21-4">  <span class="fu" style="color: #4758AB;">geom_text</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">label =</span> ..count..), <span class="at" style="color: #657422;">stat =</span> <span class="st" style="color: #20794D;">"count"</span>, <span class="at" style="color: #657422;">vjust =</span> <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb21-5">  <span class="fu" style="color: #4758AB;">expand_limits</span>(<span class="at" style="color: #657422;">y =</span> <span class="dv" style="color: #AD0000;">530</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb21-6">  <span class="fu" style="color: #4758AB;">ylab</span>(<span class="st" style="color: #20794D;">"count"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/titanic-survival-exercises/titanic-survival-exercises_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1">titanic <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb22-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(Pclass, <span class="at" style="color: #657422;">fill =</span> Survived)) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb22-3">  <span class="fu" style="color: #4758AB;">geom_bar</span>(<span class="at" style="color: #657422;">width =</span> <span class="fl" style="color: #AD0000;">0.7</span>, <span class="at" style="color: #657422;">position =</span> <span class="fu" style="color: #4758AB;">position_fill</span>(), <span class="at" style="color: #657422;">color =</span> <span class="st" style="color: #20794D;">"white"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb22-4">  <span class="fu" style="color: #4758AB;">scale_fill_manual</span>(<span class="at" style="color: #657422;">values =</span> colors_survived)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/titanic-survival-exercises/titanic-survival-exercises_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1">titanic <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb23-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(Pclass, <span class="at" style="color: #657422;">fill =</span> Survived)) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb23-3">  <span class="fu" style="color: #4758AB;">geom_bar</span>(<span class="at" style="color: #657422;">width =</span> <span class="fl" style="color: #AD0000;">0.8</span>, <span class="at" style="color: #657422;">position =</span> <span class="fu" style="color: #4758AB;">position_dodge</span>(<span class="fl" style="color: #AD0000;">0.85</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb23-4">  <span class="fu" style="color: #4758AB;">scale_fill_manual</span>(<span class="at" style="color: #657422;">values =</span> colors_survived)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/titanic-survival-exercises/titanic-survival-exercises_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1">titanic <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb24-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(Survived, <span class="at" style="color: #657422;">fill =</span> Pclass)) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb24-3">  <span class="fu" style="color: #4758AB;">geom_bar</span>(<span class="at" style="color: #657422;">width =</span> <span class="fl" style="color: #AD0000;">0.7</span>, <span class="at" style="color: #657422;">position =</span> <span class="fu" style="color: #4758AB;">position_fill</span>(), <span class="at" style="color: #657422;">color =</span> <span class="st" style="color: #20794D;">"white"</span>) </span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/titanic-survival-exercises/titanic-survival-exercises_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<p>Which of the following are true?</p>
<p>Select all correct answers.</p>
<ul>
<li>‚úÖ There were more third class passengers than passengers in the first two classes combined.</li>
<li>‚ùå There were the fewest passengers in first class, second-most passengers in second class, and most passengers in third class.</li>
<li>‚úÖ Survival proportion was highest for first class passengers, followed by second class. Third-class had the lowest survival proportion.</li>
<li>‚úÖ Most passengers in first class survived. Most passengers in other classes did not survive.</li>
<li>‚ùå The majority of survivors were from first class.</li>
<li>‚úÖ The majority of those who did not survive were from third class.</li>
</ul>
</section>
<section id="question-8-survival-by-age-sex-and-passenger-class" class="level2">
<h2 class="anchored" data-anchor-id="question-8-survival-by-age-sex-and-passenger-class">Question 8: Survival by Age, Sex and Passenger Class</h2>
<p>Instructions: Create a grid of density plots for age, filled by survival status, with count on the y-axis, faceted by sex and passenger class.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1">titanic <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb25-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(Age, ..count.., <span class="at" style="color: #657422;">fill =</span> Pclass)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb25-3">  <span class="fu" style="color: #4758AB;">geom_density</span>(<span class="at" style="color: #657422;">alpha=</span><span class="fl" style="color: #AD0000;">0.5</span>) </span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/titanic-survival-exercises/titanic-survival-exercises_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1">titanic <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb26-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(Age, ..count.., <span class="at" style="color: #657422;">fill =</span> Survived)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb26-3">  <span class="fu" style="color: #4758AB;">geom_density</span>(<span class="at" style="color: #657422;">alpha=</span><span class="fl" style="color: #AD0000;">0.5</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb26-4">  <span class="fu" style="color: #4758AB;">facet_grid</span>((Sex <span class="sc" style="color: #5E5E5E;">~</span> Pclass)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb26-5">  <span class="fu" style="color: #4758AB;">scale_fill_manual</span>(<span class="at" style="color: #657422;">values =</span> colors_survived) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb26-6">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">panel.border =</span> <span class="fu" style="color: #4758AB;">element_rect</span>(<span class="at" style="color: #657422;">colour =</span> <span class="st" style="color: #20794D;">"black"</span>, <span class="at" style="color: #657422;">fill =</span> <span class="cn" style="color: #8f5902;">NA</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb26-7">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">legend.position =</span> <span class="st" style="color: #20794D;">"top"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/titanic-survival-exercises/titanic-survival-exercises_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Which of the following are true?</p>
<p>Select all correct answers.</p>
<ul>
<li>‚úÖ The largest group of passengers was third-class males.</li>
<li>‚ùå The age distribution is the same across passenger classes.</li>
<li>‚ùå The gender distribution is the same across passenger classes.</li>
<li>‚úÖ Most first-class and second-class females survived.</li>
<li>‚úÖ Almost all second-class males did not survive, with the exception of children.</li>
</ul>
<p><br></p>
<p>That‚Äôs all. Thanks for reading!</p>


</section>

 ]]></description>
  <category>R</category>
  <category>ggplot2</category>
  <category>data visualization</category>
  <guid>https://sandrajurela.com/posts/titanic-survival-exercises/titanic-survival-exercises.html</guid>
  <pubDate>Wed, 08 Jun 2022 22:00:00 GMT</pubDate>
  <media:content url="https://sandrajurela.com/posts/titanic-survival-exercises/images/preview.png" medium="image" type="image/png" height="103" width="144"/>
</item>
<item>
  <title>Customer Analysis ‚Äì Advanced Plots With {ggplot2}</title>
  <dc:creator>Sandra Jurela</dc:creator>
  <link>https://sandrajurela.com/posts/customer-analysis-advanced-plots-with-ggplot2/customer-analysis-advanced-plots-with-ggplot2.html</link>
  <description><![CDATA[ 




<section id="part-i---getting-wrangling-data-from-the-database" class="level2">
<h2 class="anchored" data-anchor-id="part-i---getting-wrangling-data-from-the-database">Part I - Getting &amp; wrangling data from the database</h2>
<p>The <strong>Bike Sales</strong> Database represents a <strong>bicycle manufacturer</strong>, including tables for products (bikes), customers (bike shops), and transactions (orders).</p>
<p>It consists of 3 tables:</p>
<ul>
<li><p><strong><code>bikes</code></strong> table, which includes bicycle models, descriptions, and unit prices that are produced by the manufacturer.</p></li>
<li><p><strong><code>bikeshops</code></strong> table, which includes customers that the bicycle manufacturer has sold to.</p></li>
<li><p><strong><code>orderlines</code></strong> table, which includes transactional data such as order ID, order line, date, customer, product, and quantity sold.</p></li>
</ul>
<p><strong><code>bike_sales</code></strong> database is the local Postgres database stored on my machine.</p>
<section id="entity-relationship-diagram" class="level3">
<h3 class="anchored" data-anchor-id="entity-relationship-diagram">Entity Relationship Diagram</h3>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://sandrajurela.com/posts/customer-analysis-advanced-plots-with-ggplot2/images/bike_sales_erd.png" class="img-fluid figure-img" width="718"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="setting-up-the-programming-environment" class="level3">
<h3 class="anchored" data-anchor-id="setting-up-the-programming-environment">Setting up the programming environment</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;"># loading packages</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;">library</span>(DBI)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;">library</span>(RPostgres)  </span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;">library</span>(tidyverse)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;">library</span>(lubridate)</span></code></pre></div>
</div>
<p>The <code>sql</code> engine uses the <code>DBI</code> package to execute SQL queries, print their results, and optionally assign the results to a data frame. To use the <code>sql</code> engine, we first need to establish a DBI connection to a database.</p>
</section>
<section id="creating-a-connection-to-the-bike_sales-database" class="level3">
<h3 class="anchored" data-anchor-id="creating-a-connection-to-the-bike_sales-database">Creating a connection to the <code>bike_sales</code> database</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">mycon <span class="ot" style="color: #003B4F;">&lt;-</span> DBI<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">dbConnect</span>(RPostgres<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">Postgres</span>(), </span>
<span id="cb2-2">                        <span class="at" style="color: #657422;">dbname =</span> <span class="st" style="color: #20794D;">"bike_sales"</span>, </span>
<span id="cb2-3">                        <span class="at" style="color: #657422;">host =</span> <span class="st" style="color: #20794D;">"localhost"</span>,  </span>
<span id="cb2-4">                        <span class="at" style="color: #657422;">port =</span> <span class="st" style="color: #20794D;">"5432"</span>,  </span>
<span id="cb2-5">                        <span class="at" style="color: #657422;">user =</span> rstudioapi<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">askForPassword</span>(<span class="st" style="color: #20794D;">"Database username"</span>),</span>
<span id="cb2-6">                        <span class="at" style="color: #657422;">password =</span> rstudioapi<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">askForPassword</span>(<span class="st" style="color: #20794D;">"Database password"</span>))</span></code></pre></div>
</div>
<p>There are several options to <a href="https://solutions.posit.co/connections/db/best-practices/managing-credentials/index.html">secure your credentials</a> in R. Here I use prompting for credentials via <code>rstudioapi</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">mycon</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;PqConnection&gt; bike_sales@localhost:5432</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;"># list the database table names</span></span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;">dbListTables</span>(mycon)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "bikeshops"  "bikes"      "orderlines"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;"># read the bikeshops table</span></span>
<span id="cb7-2"><span class="fu" style="color: #4758AB;">dbReadTable</span>(mycon, <span class="st" style="color: #20794D;">"bikeshops"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">head</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  bikeshop.id                bikeshop.name       location
1           1 Pittsburgh Mountain Machines Pittsburgh, PA
2           2     Ithaca Mountain Climbers     Ithaca, NY
3           3      Columbus Race Equipment   Columbus, OH
4           4               Detroit Cycles    Detroit, MI
5           5             Cincinnati Speed Cincinnati, OH
6           6    Louisville Race Equipment Louisville, KY</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="co" style="color: #5E5E5E;"># read the bikes table</span></span>
<span id="cb9-2"><span class="fu" style="color: #4758AB;">dbReadTable</span>(mycon, <span class="st" style="color: #20794D;">"bikes"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">head</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  bike.id                          model                description price
1       1        Supersix Evo Black Inc. Road - Elite Road - Carbon 12790
2       2       Supersix Evo Hi-Mod Team Road - Elite Road - Carbon 10660
3       3 Supersix Evo Hi-Mod Dura Ace 1 Road - Elite Road - Carbon  7990
4       4 Supersix Evo Hi-Mod Dura Ace 2 Road - Elite Road - Carbon  5330
5       5     Supersix Evo Hi-Mod Utegra Road - Elite Road - Carbon  4260
6       6               Supersix Evo Red Road - Elite Road - Carbon  3940</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="co" style="color: #5E5E5E;"># read the orderlines table</span></span>
<span id="cb11-2"><span class="fu" style="color: #4758AB;">dbReadTable</span>(mycon, <span class="st" style="color: #20794D;">"orderlines"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">head</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  order.id order.line order.date customer.id product.id quantity
1        1          1 2011-01-07           2         48        1
2        1          2 2011-01-07           2         52        1
3        2          1 2011-01-10          10         76        1
4        2          2 2011-01-10          10         52        1
5        3          1 2011-01-10           6          2        1
6        3          2 2011-01-10           6         50        1</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="co" style="color: #5E5E5E;"># a simple query example</span></span>
<span id="cb13-2"><span class="fu" style="color: #4758AB;">dbGetQuery</span>(mycon, </span>
<span id="cb13-3">          <span class="st" style="color: #20794D;">"SELECT model, price </span></span>
<span id="cb13-4"><span class="st" style="color: #20794D;">           FROM bikes WHERE price &gt; 10000 </span></span>
<span id="cb13-5"><span class="st" style="color: #20794D;">           ORDER BY price DESC"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                     model price
1  Supersix Evo Black Inc. 12790
2    Scalpel-Si Black Inc. 12790
3  Habit Hi-Mod Black Inc. 12250
4          F-Si Black Inc. 11190
5 Supersix Evo Hi-Mod Team 10660</code></pre>
</div>
</div>
</section>
<section id="joining-the-tables" class="level3">
<h3 class="anchored" data-anchor-id="joining-the-tables">Joining the tables</h3>
<p>In all three tables there are dots in column names. This is not a good practice and I first had to figure out how to join the tables without an error! Here is the solution:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">bike_orderlines_joined <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">dbGetQuery</span>(mycon, </span>
<span id="cb15-2"></span>
<span id="cb15-3"><span class="st" style="color: #20794D;">'SELECT * </span></span>
<span id="cb15-4"><span class="st" style="color: #20794D;">FROM orderlines </span></span>
<span id="cb15-5"><span class="st" style="color: #20794D;">LEFT JOIN bikes</span></span>
<span id="cb15-6"><span class="st" style="color: #20794D;">ON orderlines."product.id" = bikes."bike.id"</span></span>
<span id="cb15-7"><span class="st" style="color: #20794D;">LEFT JOIN bikeshops</span></span>
<span id="cb15-8"><span class="st" style="color: #20794D;">ON orderlines."customer.id" = bikeshops."bikeshop.id"'</span>)</span>
<span id="cb15-9"></span>
<span id="cb15-10"><span class="fu" style="color: #4758AB;">head</span>(bike_orderlines_joined)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  order.id order.line order.date customer.id product.id quantity bike.id
1        1          1 2011-01-07           2         48        1      48
2        1          2 2011-01-07           2         52        1      52
3        2          1 2011-01-10          10         76        1      76
4        2          2 2011-01-10          10         52        1      52
5        3          1 2011-01-10           6          2        1       2
6        3          2 2011-01-10           6         50        1      50
                     model                       description price bikeshop.id
1          Jekyll Carbon 2 Mountain - Over Mountain - Carbon  6070           2
2         Trigger Carbon 2 Mountain - Over Mountain - Carbon  5970           2
3      Beast of the East 1       Mountain - Trail - Aluminum  2770          10
4         Trigger Carbon 2 Mountain - Over Mountain - Carbon  5970          10
5 Supersix Evo Hi-Mod Team        Road - Elite Road - Carbon 10660           6
6          Jekyll Carbon 4 Mountain - Over Mountain - Carbon  3200           6
              bikeshop.name        location
1  Ithaca Mountain Climbers      Ithaca, NY
2  Ithaca Mountain Climbers      Ithaca, NY
3         Kansas City 29ers Kansas City, KS
4         Kansas City 29ers Kansas City, KS
5 Louisville Race Equipment  Louisville, KY
6 Louisville Race Equipment  Louisville, KY</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="fu" style="color: #4758AB;">glimpse</span>(bike_orderlines_joined)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 15,644
Columns: 13
$ order.id      &lt;dbl&gt; 1, 1, 2, 2, 3, 3, 3, 3, 3, 4, 5, 5, 5, 5, 6, 6, 6, 6, 7,‚Ä¶
$ order.line    &lt;dbl&gt; 1, 2, 1, 2, 1, 2, 3, 4, 5, 1, 1, 2, 3, 4, 1, 2, 3, 4, 1,‚Ä¶
$ order.date    &lt;date&gt; 2011-01-07, 2011-01-07, 2011-01-10, 2011-01-10, 2011-01‚Ä¶
$ customer.id   &lt;dbl&gt; 2, 2, 10, 10, 6, 6, 6, 6, 6, 22, 8, 8, 8, 8, 16, 16, 16,‚Ä¶
$ product.id    &lt;dbl&gt; 48, 52, 76, 52, 2, 50, 1, 4, 34, 26, 96, 66, 35, 72, 45,‚Ä¶
$ quantity      &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1,‚Ä¶
$ bike.id       &lt;dbl&gt; 48, 52, 76, 52, 2, 50, 1, 4, 34, 26, 96, 66, 35, 72, 45,‚Ä¶
$ model         &lt;chr&gt; "Jekyll Carbon 2", "Trigger Carbon 2", "Beast of the Eas‚Ä¶
$ description   &lt;chr&gt; "Mountain - Over Mountain - Carbon", "Mountain - Over Mo‚Ä¶
$ price         &lt;dbl&gt; 6070, 5970, 2770, 5970, 10660, 3200, 12790, 5330, 1570, ‚Ä¶
$ bikeshop.id   &lt;dbl&gt; 2, 2, 10, 10, 6, 6, 6, 6, 6, 22, 8, 8, 8, 8, 16, 16, 16,‚Ä¶
$ bikeshop.name &lt;chr&gt; "Ithaca Mountain Climbers", "Ithaca Mountain Climbers", ‚Ä¶
$ location      &lt;chr&gt; "Ithaca, NY", "Ithaca, NY", "Kansas City, KS", "Kansas C‚Ä¶</code></pre>
</div>
</div>
<p>Disconnecting from the database.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><span class="fu" style="color: #4758AB;">dbDisconnect</span>(mycon)</span></code></pre></div>
</div>
</section>
<section id="data-wrangling" class="level3">
<h3 class="anchored" data-anchor-id="data-wrangling">Data wrangling</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1">bike_orderlines <span class="ot" style="color: #003B4F;">&lt;-</span> bike_orderlines_joined <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb20-2">  <span class="co" style="color: #5E5E5E;"># rename columns - replacing "." with "_"</span></span>
<span id="cb20-3">  <span class="fu" style="color: #4758AB;">set_names</span>(<span class="fu" style="color: #4758AB;">names</span>(.) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">str_replace_all</span>(<span class="st" style="color: #20794D;">"</span><span class="sc" style="color: #5E5E5E;">\\</span><span class="st" style="color: #20794D;">."</span>, <span class="st" style="color: #20794D;">"_"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb20-4">  <span class="co" style="color: #5E5E5E;"># remove the unnecessary columns </span></span>
<span id="cb20-5">  <span class="fu" style="color: #4758AB;">select</span>(<span class="sc" style="color: #5E5E5E;">-</span><span class="fu" style="color: #4758AB;">c</span>(customer_id, product_id, bike_id, bikeshop_id)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb20-6">  <span class="co" style="color: #5E5E5E;"># separate description into category_1, category_2, and frame_material</span></span>
<span id="cb20-7">  <span class="fu" style="color: #4758AB;">separate</span>(description, </span>
<span id="cb20-8">           <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"category_1"</span>, <span class="st" style="color: #20794D;">"category_2"</span>, <span class="st" style="color: #20794D;">"frame_material"</span>),</span>
<span id="cb20-9">           <span class="at" style="color: #657422;">sep =</span> <span class="st" style="color: #20794D;">" - "</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb20-10">  <span class="co" style="color: #5E5E5E;"># separate location into city and state</span></span>
<span id="cb20-11">  <span class="fu" style="color: #4758AB;">separate</span>(location,</span>
<span id="cb20-12">           <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"city"</span>, <span class="st" style="color: #20794D;">"state"</span>),</span>
<span id="cb20-13">           <span class="at" style="color: #657422;">sep =</span> <span class="st" style="color: #20794D;">", "</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb20-14">  <span class="co" style="color: #5E5E5E;"># create a new column total_price</span></span>
<span id="cb20-15">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">total_price =</span> price <span class="sc" style="color: #5E5E5E;">*</span> quantity) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb20-16">  <span class="co" style="color: #5E5E5E;"># reorder columns</span></span>
<span id="cb20-17">  <span class="fu" style="color: #4758AB;">select</span>(<span class="fu" style="color: #4758AB;">contains</span>(<span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"date"</span>, <span class="st" style="color: #20794D;">"id"</span>, <span class="st" style="color: #20794D;">"order"</span>)),</span>
<span id="cb20-18">         quantity, price, total_price,</span>
<span id="cb20-19">         <span class="fu" style="color: #4758AB;">everything</span>()) </span>
<span id="cb20-20"></span>
<span id="cb20-21">bike_orderlines <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">head</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  order_date order_id order_line quantity price total_price
1 2011-01-07        1          1        1  6070        6070
2 2011-01-07        1          2        1  5970        5970
3 2011-01-10        2          1        1  2770        2770
4 2011-01-10        2          2        1  5970        5970
5 2011-01-10        3          1        1 10660       10660
6 2011-01-10        3          2        1  3200        3200
                     model category_1    category_2 frame_material
1          Jekyll Carbon 2   Mountain Over Mountain         Carbon
2         Trigger Carbon 2   Mountain Over Mountain         Carbon
3      Beast of the East 1   Mountain         Trail       Aluminum
4         Trigger Carbon 2   Mountain Over Mountain         Carbon
5 Supersix Evo Hi-Mod Team       Road    Elite Road         Carbon
6          Jekyll Carbon 4   Mountain Over Mountain         Carbon
              bikeshop_name        city state
1  Ithaca Mountain Climbers      Ithaca    NY
2  Ithaca Mountain Climbers      Ithaca    NY
3         Kansas City 29ers Kansas City    KS
4         Kansas City 29ers Kansas City    KS
5 Louisville Race Equipment  Louisville    KY
6 Louisville Race Equipment  Louisville    KY</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1">bike_orderlines <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">glimpse</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 15,644
Columns: 13
$ order_date     &lt;date&gt; 2011-01-07, 2011-01-07, 2011-01-10, 2011-01-10, 2011-0‚Ä¶
$ order_id       &lt;dbl&gt; 1, 1, 2, 2, 3, 3, 3, 3, 3, 4, 5, 5, 5, 5, 6, 6, 6, 6, 7‚Ä¶
$ order_line     &lt;dbl&gt; 1, 2, 1, 2, 1, 2, 3, 4, 5, 1, 1, 2, 3, 4, 1, 2, 3, 4, 1‚Ä¶
$ quantity       &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1‚Ä¶
$ price          &lt;dbl&gt; 6070, 5970, 2770, 5970, 10660, 3200, 12790, 5330, 1570,‚Ä¶
$ total_price    &lt;dbl&gt; 6070, 5970, 2770, 5970, 10660, 3200, 12790, 5330, 1570,‚Ä¶
$ model          &lt;chr&gt; "Jekyll Carbon 2", "Trigger Carbon 2", "Beast of the Ea‚Ä¶
$ category_1     &lt;chr&gt; "Mountain", "Mountain", "Mountain", "Mountain", "Road",‚Ä¶
$ category_2     &lt;chr&gt; "Over Mountain", "Over Mountain", "Trail", "Over Mounta‚Ä¶
$ frame_material &lt;chr&gt; "Carbon", "Carbon", "Aluminum", "Carbon", "Carbon", "Ca‚Ä¶
$ bikeshop_name  &lt;chr&gt; "Ithaca Mountain Climbers", "Ithaca Mountain Climbers",‚Ä¶
$ city           &lt;chr&gt; "Ithaca", "Ithaca", "Kansas City", "Kansas City", "Loui‚Ä¶
$ state          &lt;chr&gt; "NY", "NY", "KS", "KS", "KY", "KY", "KY", "KY", "KY", "‚Ä¶</code></pre>
</div>
</div>
</section>
</section>
<section id="part-ii---advanced-plots-with-ggplot2" class="level1">
<h1>Part II - Advanced plots with <code>ggplot2</code></h1>
<p>I will continue to work with the <code>bike_orderlines</code> dataframe and create two useful plots.</p>
<section id="lollipop-chart-top-n-customers" class="level2">
<h2 class="anchored" data-anchor-id="lollipop-chart-top-n-customers">Lollipop Chart: Top N Customers</h2>
<p>Question: How much purchasing power is in top 10 customers?</p>
<p>Goal is to visualize top N customers in terms of Revenue, including cumulative percentage.</p>
<section id="data-manipulation" class="level3">
<h3 class="anchored" data-anchor-id="data-manipulation">Data manipulation</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1">n <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="dv" style="color: #AD0000;">10</span></span>
<span id="cb24-2"></span>
<span id="cb24-3">top_customers <span class="ot" style="color: #003B4F;">&lt;-</span> bike_orderlines <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb24-4">  <span class="fu" style="color: #4758AB;">select</span>(bikeshop_name, total_price) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb24-5">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">bikeshop_name =</span> <span class="fu" style="color: #4758AB;">as_factor</span>(bikeshop_name) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">fct_lump_n</span>(<span class="at" style="color: #657422;">n =</span> n, <span class="at" style="color: #657422;">w =</span> total_price)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb24-6">  <span class="fu" style="color: #4758AB;">group_by</span>(bikeshop_name) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb24-7">  <span class="fu" style="color: #4758AB;">summarise</span>(<span class="at" style="color: #657422;">revenue =</span> <span class="fu" style="color: #4758AB;">sum</span>(total_price)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb24-8">  <span class="fu" style="color: #4758AB;">ungroup</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb24-9">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">bikeshop_name =</span> bikeshop_name <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">fct_reorder</span>(revenue)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb24-10">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">bikeshop_name =</span> bikeshop_name <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">fct_relevel</span>(<span class="st" style="color: #20794D;">"Other"</span>, <span class="at" style="color: #657422;">after =</span> <span class="dv" style="color: #AD0000;">0</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb24-11">  <span class="fu" style="color: #4758AB;">arrange</span>(<span class="fu" style="color: #4758AB;">desc</span>(bikeshop_name)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb24-12">  <span class="co" style="color: #5E5E5E;"># revenue text</span></span>
<span id="cb24-13">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">revenue_text =</span> scales<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">dollar</span>(revenue, <span class="at" style="color: #657422;">scale =</span> <span class="fl" style="color: #AD0000;">1e-06</span>, <span class="at" style="color: #657422;">suffix =</span> <span class="st" style="color: #20794D;">"M"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb24-14">  <span class="co" style="color: #5E5E5E;"># cumulative percent</span></span>
<span id="cb24-15">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">cum_pct =</span> <span class="fu" style="color: #4758AB;">cumsum</span>(revenue) <span class="sc" style="color: #5E5E5E;">/</span> <span class="fu" style="color: #4758AB;">sum</span>(revenue)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb24-16">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">cum_pct_text =</span> scales<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">percent</span>(cum_pct)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb24-17">  <span class="co" style="color: #5E5E5E;"># rank</span></span>
<span id="cb24-18">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">rank =</span> <span class="fu" style="color: #4758AB;">row_number</span>()) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb24-19">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">rank =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(rank <span class="sc" style="color: #5E5E5E;">==</span> <span class="fu" style="color: #4758AB;">max</span>(rank), <span class="cn" style="color: #8f5902;">NA_integer_</span>, rank)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb24-20">  <span class="co" style="color: #5E5E5E;"># label text</span></span>
<span id="cb24-21">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">label_text =</span> <span class="fu" style="color: #4758AB;">str_glue</span>(<span class="st" style="color: #20794D;">"Rank: {rank}</span><span class="sc" style="color: #5E5E5E;">\n</span><span class="st" style="color: #20794D;">Rev: {revenue_text}</span><span class="sc" style="color: #5E5E5E;">\n</span><span class="st" style="color: #20794D;">CumPct: {cum_pct_text}"</span>)) </span>
<span id="cb24-22"></span>
<span id="cb24-23">top_customers</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 √ó 7
   bikeshop_name                 revenue revenue‚Ä¶¬π cum_pct cum_p‚Ä¶¬≤  rank label‚Ä¶¬≥
   &lt;fct&gt;                           &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;   &lt;int&gt; &lt;glue&gt; 
 1 Kansas City 29ers            11535455 $11.54M     0.162 16.2%       1 Rank: ‚Ä¶
 2 Denver Bike Shop              7697670 $7.70M      0.271 27.1%       2 Rank: ‚Ä¶
 3 Ithaca Mountain Climbers      6299335 $6.30M      0.359 35.9%       3 Rank: ‚Ä¶
 4 Phoenix Bi-peds               4168535 $4.17M      0.418 41.8%       4 Rank: ‚Ä¶
 5 Oklahoma City Race Equipment  3450040 $3.45M      0.467 46.7%       5 Rank: ‚Ä¶
 6 Las Vegas Cycles              3073615 $3.07M      0.510 51.0%       6 Rank: ‚Ä¶
 7 New Orleans Velocipedes       2761825 $2.76M      0.549 54.9%       7 Rank: ‚Ä¶
 8 Wichita Speed                 2380385 $2.38M      0.582 58.2%       8 Rank: ‚Ä¶
 9 Miami Race Equipment          2057130 $2.06M      0.611 61.1%       9 Rank: ‚Ä¶
10 Minneapolis Bike Shop         2023220 $2.02M      0.640 64.0%      10 Rank: ‚Ä¶
11 Other                        25585120 $25.59M     1     100.0%     NA Rank: ‚Ä¶
# ‚Ä¶ with abbreviated variable names ¬π‚Äãrevenue_text, ¬≤‚Äãcum_pct_text, ¬≥‚Äãlabel_text</code></pre>
</div>
</div>
</section>
<section id="data-visualization" class="level3">
<h3 class="anchored" data-anchor-id="data-visualization">Data visualization</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1">top_customers <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb26-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(revenue, bikeshop_name)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb26-3">  <span class="co" style="color: #5E5E5E;"># geometries</span></span>
<span id="cb26-4">  <span class="fu" style="color: #4758AB;">geom_segment</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">xend =</span> <span class="dv" style="color: #AD0000;">0</span>, <span class="at" style="color: #657422;">yend =</span> bikeshop_name), </span>
<span id="cb26-5">               <span class="at" style="color: #657422;">color =</span> RColorBrewer<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">brewer.pal</span>(<span class="at" style="color: #657422;">n =</span> <span class="dv" style="color: #AD0000;">9</span>, <span class="at" style="color: #657422;">name =</span> <span class="st" style="color: #20794D;">"Set1"</span>)[<span class="dv" style="color: #AD0000;">1</span>],</span>
<span id="cb26-6">               <span class="at" style="color: #657422;">size =</span> <span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb26-7">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="at" style="color: #657422;">color =</span> RColorBrewer<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">brewer.pal</span>(<span class="at" style="color: #657422;">n =</span> <span class="dv" style="color: #AD0000;">9</span>, <span class="at" style="color: #657422;">name =</span> <span class="st" style="color: #20794D;">"Set1"</span>)[<span class="dv" style="color: #AD0000;">1</span>], </span>
<span id="cb26-8">             <span class="at" style="color: #657422;">size =</span> <span class="dv" style="color: #AD0000;">3</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb26-9">  <span class="fu" style="color: #4758AB;">geom_label</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">label =</span> label_text), </span>
<span id="cb26-10">             <span class="at" style="color: #657422;">hjust =</span> <span class="st" style="color: #20794D;">"left"</span>, </span>
<span id="cb26-11">             <span class="at" style="color: #657422;">size =</span> <span class="dv" style="color: #AD0000;">3</span>,</span>
<span id="cb26-12">             <span class="at" style="color: #657422;">nudge_x =</span> <span class="fl" style="color: #AD0000;">0.8e+06</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb26-13">  <span class="co" style="color: #5E5E5E;"># formatting</span></span>
<span id="cb26-14">  <span class="fu" style="color: #4758AB;">scale_x_continuous</span>(<span class="at" style="color: #657422;">labels =</span> scales<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">dollar_format</span>(<span class="at" style="color: #657422;">scale =</span> <span class="fl" style="color: #AD0000;">1e-06</span>, <span class="at" style="color: #657422;">suffix =</span> <span class="st" style="color: #20794D;">"M"</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb26-15">  <span class="fu" style="color: #4758AB;">labs</span>(<span class="at" style="color: #657422;">title =</span> <span class="fu" style="color: #4758AB;">str_glue</span>(<span class="st" style="color: #20794D;">"Top {n} customers in terms of revenue, with cumulative percentage"</span>),</span>
<span id="cb26-16">       <span class="at" style="color: #657422;">subtitle =</span> <span class="fu" style="color: #4758AB;">str_glue</span>(<span class="st" style="color: #20794D;">"Top {n} customers contribute {top_customers$cum_pct_text[n]} of purchasing power."</span>),</span>
<span id="cb26-17">       <span class="at" style="color: #657422;">x =</span> <span class="st" style="color: #20794D;">"Revenue ($M)"</span>,</span>
<span id="cb26-18">       <span class="at" style="color: #657422;">y =</span> <span class="st" style="color: #20794D;">"Customer"</span>,</span>
<span id="cb26-19">       <span class="at" style="color: #657422;">caption =</span> <span class="fu" style="color: #4758AB;">str_glue</span>(<span class="st" style="color: #20794D;">"Year: {year(min(bike_orderlines$order_date))} - {year(max(bike_orderlines$order_date))}"</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb26-20">  <span class="fu" style="color: #4758AB;">expand_limits</span>(<span class="at" style="color: #657422;">x =</span> <span class="fu" style="color: #4758AB;">max</span>(top_customers<span class="sc" style="color: #5E5E5E;">$</span>revenue) <span class="sc" style="color: #5E5E5E;">+</span> <span class="fl" style="color: #AD0000;">6e+06</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb26-21">  <span class="co" style="color: #5E5E5E;"># theme</span></span>
<span id="cb26-22">  <span class="fu" style="color: #4758AB;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb26-23">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">panel.grid.major =</span> <span class="fu" style="color: #4758AB;">element_blank</span>(),</span>
<span id="cb26-24">        <span class="at" style="color: #657422;">panel.grid.minor =</span> <span class="fu" style="color: #4758AB;">element_blank</span>())</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/customer-analysis-advanced-plots-with-ggplot2/customer-analysis-advanced-plots-with-ggplot2_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="864"></p>
</div>
</div>
</section>
</section>
<section id="heatmap-customers-purchasing-habits" class="level2">
<h2 class="anchored" data-anchor-id="heatmap-customers-purchasing-habits">Heatmap: Customers‚Äô Purchasing Habits</h2>
<p>Question: Do specific customers have a purchasing preference?</p>
<p>Goal is to visualize heatmap of proportion of sales by Secondary Product Category.</p>
<section id="data-manipulation-1" class="level3">
<h3 class="anchored" data-anchor-id="data-manipulation-1">Data manipulation</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1">pct_sales_by_customer <span class="ot" style="color: #003B4F;">&lt;-</span> bike_orderlines <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb27-2">  <span class="fu" style="color: #4758AB;">select</span>(bikeshop_name, category_1, category_2, quantity) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb27-3">  <span class="fu" style="color: #4758AB;">group_by</span>(bikeshop_name, category_1, category_2) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb27-4">  <span class="fu" style="color: #4758AB;">summarise</span>(<span class="at" style="color: #657422;">total_qty =</span> <span class="fu" style="color: #4758AB;">sum</span>(quantity)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb27-5">  <span class="fu" style="color: #4758AB;">ungroup</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb27-6">  <span class="fu" style="color: #4758AB;">group_by</span>(bikeshop_name) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb27-7">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">pct =</span> total_qty <span class="sc" style="color: #5E5E5E;">/</span> <span class="fu" style="color: #4758AB;">sum</span>(total_qty)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb27-8">  <span class="fu" style="color: #4758AB;">ungroup</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb27-9">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">bikeshop_name =</span> <span class="fu" style="color: #4758AB;">as.factor</span>(bikeshop_name) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">fct_rev</span>()) <span class="sc" style="color: #5E5E5E;">%&gt;%</span>  </span>
<span id="cb27-10">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">bikeshop_name_num =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(bikeshop_name))</span>
<span id="cb27-11">    </span>
<span id="cb27-12">pct_sales_by_customer   </span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 270 √ó 6
   bikeshop_name      category_1 category_2         total_qty    pct bikeshop_‚Ä¶¬π
   &lt;fct&gt;              &lt;chr&gt;      &lt;chr&gt;                  &lt;dbl&gt;  &lt;dbl&gt;       &lt;dbl&gt;
 1 Albuquerque Cycles Mountain   Cross Country Race        48 0.168           30
 2 Albuquerque Cycles Mountain   Fat Bike                   9 0.0315          30
 3 Albuquerque Cycles Mountain   Over Mountain             13 0.0455          30
 4 Albuquerque Cycles Mountain   Sport                     35 0.122           30
 5 Albuquerque Cycles Mountain   Trail                     38 0.133           30
 6 Albuquerque Cycles Road       Cyclocross                 7 0.0245          30
 7 Albuquerque Cycles Road       Elite Road                69 0.241           30
 8 Albuquerque Cycles Road       Endurance Road            54 0.189           30
 9 Albuquerque Cycles Road       Triathalon                13 0.0455          30
10 Ann Arbor Speed    Mountain   Cross Country Race        32 0.0532          29
# ‚Ä¶ with 260 more rows, and abbreviated variable name ¬π‚Äãbikeshop_name_num</code></pre>
</div>
</div>
</section>
<section id="data-visualization-1" class="level3">
<h3 class="anchored" data-anchor-id="data-visualization-1">Data visualization</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1">pct_sales_by_customer <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb29-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(category_2, bikeshop_name)) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb29-3">  <span class="co" style="color: #5E5E5E;"># geometries</span></span>
<span id="cb29-4">  <span class="fu" style="color: #4758AB;">geom_tile</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">fill =</span> pct)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb29-5">  <span class="fu" style="color: #4758AB;">geom_text</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">label =</span> scales<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">percent</span>(pct, <span class="at" style="color: #657422;">accuracy =</span> <span class="fl" style="color: #AD0000;">0.1</span>)),</span>
<span id="cb29-6">            <span class="at" style="color: #657422;">size =</span> <span class="dv" style="color: #AD0000;">3</span>,</span>
<span id="cb29-7">            <span class="at" style="color: #657422;">color =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(pct_sales_by_customer<span class="sc" style="color: #5E5E5E;">$</span>pct <span class="sc" style="color: #5E5E5E;">&gt;=</span> <span class="fl" style="color: #AD0000;">0.15</span>, <span class="st" style="color: #20794D;">"white"</span>, <span class="st" style="color: #20794D;">"black"</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb29-8">  <span class="fu" style="color: #4758AB;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;">~</span> category_1, <span class="at" style="color: #657422;">scales =</span> <span class="st" style="color: #20794D;">"free_x"</span>) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb29-9">  <span class="co" style="color: #5E5E5E;"># formatting</span></span>
<span id="cb29-10">  <span class="fu" style="color: #4758AB;">scale_fill_gradient</span>(<span class="at" style="color: #657422;">low =</span> <span class="st" style="color: #20794D;">"white"</span>, <span class="at" style="color: #657422;">high =</span> tidyquant<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">palette_light</span>()[<span class="dv" style="color: #AD0000;">1</span>]) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb29-11">  <span class="fu" style="color: #4758AB;">labs</span>(<span class="at" style="color: #657422;">title =</span> <span class="st" style="color: #20794D;">"Heatmap of Purchasing Habits"</span>, </span>
<span id="cb29-12">       <span class="at" style="color: #657422;">subtitle =</span> <span class="fu" style="color: #4758AB;">str_glue</span>(<span class="st" style="color: #20794D;">"Year: {year(min(bike_orderlines$order_date))} - {year(max(bike_orderlines$order_date))}"</span>),</span>
<span id="cb29-13">       <span class="at" style="color: #657422;">x =</span> <span class="st" style="color: #20794D;">"Bike Type"</span>,</span>
<span id="cb29-14">       <span class="at" style="color: #657422;">y =</span> <span class="st" style="color: #20794D;">"Customer"</span>) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb29-15">  <span class="co" style="color: #5E5E5E;"># theme</span></span>
<span id="cb29-16">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">legend.position =</span> <span class="st" style="color: #20794D;">"none"</span>,</span>
<span id="cb29-17">        <span class="at" style="color: #657422;">axis.text.x =</span> <span class="fu" style="color: #4758AB;">element_text</span>(<span class="at" style="color: #657422;">angle =</span> <span class="dv" style="color: #AD0000;">45</span>, <span class="at" style="color: #657422;">hjust =</span> <span class="dv" style="color: #AD0000;">1</span>),</span>
<span id="cb29-18">        <span class="at" style="color: #657422;">plot.title =</span> <span class="fu" style="color: #4758AB;">element_text</span>(<span class="at" style="color: #657422;">face =</span> <span class="st" style="color: #20794D;">"bold"</span>),</span>
<span id="cb29-19">        <span class="at" style="color: #657422;">strip.background =</span> <span class="fu" style="color: #4758AB;">element_rect</span>(<span class="at" style="color: #657422;">fill =</span> tidyquant<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">palette_light</span>()[<span class="dv" style="color: #AD0000;">1</span>], </span>
<span id="cb29-20">                                        <span class="at" style="color: #657422;">color =</span> <span class="st" style="color: #20794D;">"white"</span>), </span>
<span id="cb29-21">        <span class="at" style="color: #657422;">strip.text =</span> <span class="fu" style="color: #4758AB;">element_text</span>(<span class="at" style="color: #657422;">color =</span> <span class="st" style="color: #20794D;">"white"</span>, <span class="at" style="color: #657422;">size =</span> <span class="dv" style="color: #AD0000;">11</span>), </span>
<span id="cb29-22">        <span class="at" style="color: #657422;">panel.background =</span> <span class="fu" style="color: #4758AB;">element_rect</span>(<span class="at" style="color: #657422;">fill =</span> <span class="st" style="color: #20794D;">"white"</span>))</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/customer-analysis-advanced-plots-with-ggplot2/customer-analysis-advanced-plots-with-ggplot2_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="864"></p>
</div>
</div>
<p>Top 3 customers that prefer mountain bikes:</p>
<ul>
<li>Ithaca Mountain Climbers</li>
<li>Pittsburgh Mountain Machines</li>
<li>Tampa 29ers</li>
</ul>
<p>Top 3 customers that prefer road bikes:</p>
<ul>
<li>Ann Arbor Speed</li>
<li>Austin Cruisers</li>
<li>Indianapolis Velocipedes</li>
</ul>
<p><br></p>
<p>That‚Äôs it! I hope you like it. For those wondering where I learned to make plots like this‚Ä¶ in a fabulous course <a href="https://university.business-science.io/p/ds4b-101-r-business-analysis-r">Data Science for Business Part 1</a> by <a href="https://www.linkedin.com/in/mattdancho/">Matt Dancho</a>. This is probably the best course on R and I highly recommend it.</p>


</section>
</section>
</section>

 ]]></description>
  <category>data wrangling</category>
  <category>data visualization</category>
  <category>SQL</category>
  <category>PostgreSQL</category>
  <category>R</category>
  <guid>https://sandrajurela.com/posts/customer-analysis-advanced-plots-with-ggplot2/customer-analysis-advanced-plots-with-ggplot2.html</guid>
  <pubDate>Thu, 19 May 2022 22:00:00 GMT</pubDate>
  <media:content url="https://sandrajurela.com/posts/customer-analysis-advanced-plots-with-ggplot2/images/preview.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>Answering Business Questions Using SQL</title>
  <dc:creator>Sandra Jurela</dc:creator>
  <link>https://sandrajurela.com/posts/answering-business-questions-using-sql/chinook.html</link>
  <description><![CDATA[ 




<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>The aim of this project is to explore a modified version of the <a href="https://github.com/lerocha/chinook-database">Chinook database</a> using SQL and answer some business questions. The Chinook database represents a fictional digital media shop, based on real data from an iTunes Library and manually generated data. The database is provided as a <strong>SQLite database</strong> file called <strong>chinook.db</strong>.</p>
<p>Here‚Äôs a schema diagram for the Chinook database:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/answering-business-questions-using-sql/images/chinook-schema.svg" class="img-fluid"></p>
</div>
</div>
</section>
<section id="connecting-to-the-database-and-data-overview" class="level2">
<h2 class="anchored" data-anchor-id="connecting-to-the-database-and-data-overview">Connecting to the Database and Data Overview</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;">library</span>(DBI)</span>
<span id="cb1-2"></span>
<span id="cb1-3">db <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">dbConnect</span>(RSQLite<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">SQLite</span>(), <span class="at" style="color: #657422;">dbname =</span> <span class="st" style="color: #20794D;">"data/chinook.db"</span>)</span></code></pre></div>
</div>
<p>Listing all tables in the Chinook database.</p>
<div class="cell" data-max.print="null">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb2-1"><span class="kw" style="color: #003B4F;">SELECT</span></span>
<span id="cb2-2">  name,</span>
<span id="cb2-3">  <span class="kw" style="color: #003B4F;">type</span></span>
<span id="cb2-4"><span class="kw" style="color: #003B4F;">FROM</span> sqlite_master</span>
<span id="cb2-5"><span class="kw" style="color: #003B4F;">WHERE</span> <span class="kw" style="color: #003B4F;">type</span> <span class="kw" style="color: #003B4F;">IN</span> (<span class="ot" style="color: #003B4F;">"table"</span>, <span class="ot" style="color: #003B4F;">"view"</span>)</span></code></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>11 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">album</td>
<td style="text-align: left;">table</td>
</tr>
<tr class="even">
<td style="text-align: left;">artist</td>
<td style="text-align: left;">table</td>
</tr>
<tr class="odd">
<td style="text-align: left;">customer</td>
<td style="text-align: left;">table</td>
</tr>
<tr class="even">
<td style="text-align: left;">employee</td>
<td style="text-align: left;">table</td>
</tr>
<tr class="odd">
<td style="text-align: left;">genre</td>
<td style="text-align: left;">table</td>
</tr>
<tr class="even">
<td style="text-align: left;">invoice</td>
<td style="text-align: left;">table</td>
</tr>
<tr class="odd">
<td style="text-align: left;">invoice_line</td>
<td style="text-align: left;">table</td>
</tr>
<tr class="even">
<td style="text-align: left;">media_type</td>
<td style="text-align: left;">table</td>
</tr>
<tr class="odd">
<td style="text-align: left;">playlist</td>
<td style="text-align: left;">table</td>
</tr>
<tr class="even">
<td style="text-align: left;">playlist_track</td>
<td style="text-align: left;">table</td>
</tr>
<tr class="odd">
<td style="text-align: left;">track</td>
<td style="text-align: left;">table</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The database consists of 11 tables containing information about artists, albums, media tracks, playlists, invoices, customers, and shop employees. Let‚Äôs start by getting familiar with our data from the main tables:</p>
<p><code>employee</code> table</p>
<div class="cell" data-output.var="employee">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb3-1"><span class="kw" style="color: #003B4F;">SELECT</span> <span class="op" style="color: #5E5E5E;">*</span></span>
<span id="cb3-2"><span class="kw" style="color: #003B4F;">FROM</span> employee</span>
<span id="cb3-3"><span class="kw" style="color: #003B4F;">LIMIT</span> <span class="dv" style="color: #AD0000;">5</span></span></code></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["employee_id"],"name":[1],"type":["int"],"align":["right"]},{"label":["last_name"],"name":[2],"type":["chr"],"align":["left"]},{"label":["first_name"],"name":[3],"type":["chr"],"align":["left"]},{"label":["title"],"name":[4],"type":["chr"],"align":["left"]},{"label":["reports_to"],"name":[5],"type":["int"],"align":["right"]},{"label":["birthdate"],"name":[6],"type":["chr"],"align":["left"]},{"label":["hire_date"],"name":[7],"type":["chr"],"align":["left"]},{"label":["address"],"name":[8],"type":["chr"],"align":["left"]},{"label":["city"],"name":[9],"type":["chr"],"align":["left"]},{"label":["state"],"name":[10],"type":["chr"],"align":["left"]},{"label":["country"],"name":[11],"type":["chr"],"align":["left"]},{"label":["postal_code"],"name":[12],"type":["chr"],"align":["left"]},{"label":["phone"],"name":[13],"type":["chr"],"align":["left"]},{"label":["fax"],"name":[14],"type":["chr"],"align":["left"]},{"label":["email"],"name":[15],"type":["chr"],"align":["left"]}],"data":[{"1":"1","2":"Adams","3":"Andrew","4":"General Manager","5":"NA","6":"1962-02-18 00:00:00","7":"2016-08-14 00:00:00","8":"11120 Jasper Ave NW","9":"Edmonton","10":"AB","11":"Canada","12":"T5K 2N1","13":"+1 (780) 428-9482","14":"+1 (780) 428-3457","15":"andrew@chinookcorp.com"},{"1":"2","2":"Edwards","3":"Nancy","4":"Sales Manager","5":"1","6":"1958-12-08 00:00:00","7":"2016-05-01 00:00:00","8":"825 8 Ave SW","9":"Calgary","10":"AB","11":"Canada","12":"T2P 2T3","13":"+1 (403) 262-3443","14":"+1 (403) 262-3322","15":"nancy@chinookcorp.com"},{"1":"3","2":"Peacock","3":"Jane","4":"Sales Support Agent","5":"2","6":"1973-08-29 00:00:00","7":"2017-04-01 00:00:00","8":"1111 6 Ave SW","9":"Calgary","10":"AB","11":"Canada","12":"T2P 5M5","13":"+1 (403) 262-3443","14":"+1 (403) 262-6712","15":"jane@chinookcorp.com"},{"1":"4","2":"Park","3":"Margaret","4":"Sales Support Agent","5":"2","6":"1947-09-19 00:00:00","7":"2017-05-03 00:00:00","8":"683 10 Street SW","9":"Calgary","10":"AB","11":"Canada","12":"T2P 5G3","13":"+1 (403) 263-4423","14":"+1 (403) 263-4289","15":"margaret@chinookcorp.com"},{"1":"5","2":"Johnson","3":"Steve","4":"Sales Support Agent","5":"2","6":"1965-03-03 00:00:00","7":"2017-10-17 00:00:00","8":"7727B 41 Ave","9":"Calgary","10":"AB","11":"Canada","12":"T3B 1Y7","13":"1 (780) 836-9987","14":"1 (780) 836-9543","15":"steve@chinookcorp.com"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p><code>customer</code> table</p>
<div class="cell" data-output.var="customer">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb4-1"><span class="kw" style="color: #003B4F;">SELECT</span> <span class="op" style="color: #5E5E5E;">*</span></span>
<span id="cb4-2"><span class="kw" style="color: #003B4F;">FROM</span> customer</span>
<span id="cb4-3"><span class="kw" style="color: #003B4F;">LIMIT</span> <span class="dv" style="color: #AD0000;">5</span></span></code></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["customer_id"],"name":[1],"type":["int"],"align":["right"]},{"label":["first_name"],"name":[2],"type":["chr"],"align":["left"]},{"label":["last_name"],"name":[3],"type":["chr"],"align":["left"]},{"label":["company"],"name":[4],"type":["chr"],"align":["left"]},{"label":["address"],"name":[5],"type":["chr"],"align":["left"]},{"label":["city"],"name":[6],"type":["chr"],"align":["left"]},{"label":["state"],"name":[7],"type":["chr"],"align":["left"]},{"label":["country"],"name":[8],"type":["chr"],"align":["left"]},{"label":["postal_code"],"name":[9],"type":["chr"],"align":["left"]},{"label":["phone"],"name":[10],"type":["chr"],"align":["left"]},{"label":["fax"],"name":[11],"type":["chr"],"align":["left"]},{"label":["email"],"name":[12],"type":["chr"],"align":["left"]},{"label":["support_rep_id"],"name":[13],"type":["int"],"align":["right"]}],"data":[{"1":"1","2":"Lu√≠s","3":"Gon√ßalves","4":"Embraer - Empresa Brasileira de Aeron√°utica S.A.","5":"Av. Brigadeiro Faria Lima, 2170","6":"S√£o Jos√© dos Campos","7":"SP","8":"Brazil","9":"12227-000","10":"+55 (12) 3923-5555","11":"+55 (12) 3923-5566","12":"luisg@embraer.com.br","13":"3"},{"1":"2","2":"Leonie","3":"K√∂hler","4":"NA","5":"Theodor-Heuss-Stra√üe 34","6":"Stuttgart","7":"NA","8":"Germany","9":"70174","10":"+49 0711 2842222","11":"NA","12":"leonekohler@surfeu.de","13":"5"},{"1":"3","2":"Fran√ßois","3":"Tremblay","4":"NA","5":"1498 rue B√©langer","6":"Montr√©al","7":"QC","8":"Canada","9":"H2G 1A7","10":"+1 (514) 721-4711","11":"NA","12":"ftremblay@gmail.com","13":"3"},{"1":"4","2":"Bj√∏rn","3":"Hansen","4":"NA","5":"Ullev√•lsveien 14","6":"Oslo","7":"NA","8":"Norway","9":"0171","10":"+47 22 44 22 22","11":"NA","12":"bjorn.hansen@yahoo.no","13":"4"},{"1":"5","2":"Franti≈°ek","3":"Wichterlov√°","4":"JetBrains s.r.o.","5":"Klanova 9/506","6":"Prague","7":"NA","8":"Czech Republic","9":"14700","10":"+420 2 4172 5555","11":"+420 2 4172 5555","12":"frantisekw@jetbrains.com","13":"4"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p><code>invoice</code> table</p>
<div class="cell" data-output.var="invoice">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb5-1"><span class="kw" style="color: #003B4F;">SELECT</span> <span class="op" style="color: #5E5E5E;">*</span></span>
<span id="cb5-2"><span class="kw" style="color: #003B4F;">FROM</span> invoice</span>
<span id="cb5-3"><span class="kw" style="color: #003B4F;">LIMIT</span> <span class="dv" style="color: #AD0000;">5</span></span></code></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["invoice_id"],"name":[1],"type":["int"],"align":["right"]},{"label":["customer_id"],"name":[2],"type":["int"],"align":["right"]},{"label":["invoice_date"],"name":[3],"type":["chr"],"align":["left"]},{"label":["billing_address"],"name":[4],"type":["chr"],"align":["left"]},{"label":["billing_city"],"name":[5],"type":["chr"],"align":["left"]},{"label":["billing_state"],"name":[6],"type":["chr"],"align":["left"]},{"label":["billing_country"],"name":[7],"type":["chr"],"align":["left"]},{"label":["billing_postal_code"],"name":[8],"type":["chr"],"align":["left"]},{"label":["total"],"name":[9],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"18","3":"2017-01-03 00:00:00","4":"627 Broadway","5":"New York","6":"NY","7":"USA","8":"10012-2612","9":"15.84"},{"1":"2","2":"30","3":"2017-01-03 00:00:00","4":"230 Elgin Street","5":"Ottawa","6":"ON","7":"Canada","8":"K2P 1L7","9":"9.90"},{"1":"3","2":"40","3":"2017-01-05 00:00:00","4":"8, Rue Hanovre","5":"Paris","6":"None","7":"France","8":"75002","9":"1.98"},{"1":"4","2":"18","3":"2017-01-06 00:00:00","4":"627 Broadway","5":"New York","6":"NY","7":"USA","8":"10012-2612","9":"7.92"},{"1":"5","2":"27","3":"2017-01-07 00:00:00","4":"1033 N Park Ave","5":"Tucson","6":"AZ","7":"USA","8":"85719","9":"16.83"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p><code>invoice_line</code> table</p>
<div class="cell" data-output.var="invoice_line">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb6-1"><span class="kw" style="color: #003B4F;">SELECT</span> <span class="op" style="color: #5E5E5E;">*</span></span>
<span id="cb6-2"><span class="kw" style="color: #003B4F;">FROM</span> invoice_line</span>
<span id="cb6-3"><span class="kw" style="color: #003B4F;">LIMIT</span> <span class="dv" style="color: #AD0000;">30</span></span></code></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["invoice_line_id"],"name":[1],"type":["int"],"align":["right"]},{"label":["invoice_id"],"name":[2],"type":["int"],"align":["right"]},{"label":["track_id"],"name":[3],"type":["int"],"align":["right"]},{"label":["unit_price"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["quantity"],"name":[5],"type":["int"],"align":["right"]}],"data":[{"1":"1","2":"1","3":"1158","4":"0.99","5":"1"},{"1":"2","2":"1","3":"1159","4":"0.99","5":"1"},{"1":"3","2":"1","3":"1160","4":"0.99","5":"1"},{"1":"4","2":"1","3":"1161","4":"0.99","5":"1"},{"1":"5","2":"1","3":"1162","4":"0.99","5":"1"},{"1":"6","2":"1","3":"1163","4":"0.99","5":"1"},{"1":"7","2":"1","3":"1164","4":"0.99","5":"1"},{"1":"8","2":"1","3":"1165","4":"0.99","5":"1"},{"1":"9","2":"1","3":"1166","4":"0.99","5":"1"},{"1":"10","2":"1","3":"1167","4":"0.99","5":"1"},{"1":"11","2":"1","3":"1168","4":"0.99","5":"1"},{"1":"12","2":"1","3":"1169","4":"0.99","5":"1"},{"1":"13","2":"1","3":"1170","4":"0.99","5":"1"},{"1":"14","2":"1","3":"1171","4":"0.99","5":"1"},{"1":"15","2":"1","3":"1172","4":"0.99","5":"1"},{"1":"16","2":"1","3":"1173","4":"0.99","5":"1"},{"1":"17","2":"2","3":"3476","4":"0.99","5":"1"},{"1":"18","2":"2","3":"482","4":"0.99","5":"1"},{"1":"19","2":"2","3":"2701","4":"0.99","5":"1"},{"1":"20","2":"2","3":"1641","4":"0.99","5":"1"},{"1":"21","2":"2","3":"1119","4":"0.99","5":"1"},{"1":"22","2":"2","3":"2324","4":"0.99","5":"1"},{"1":"23","2":"2","3":"201","4":"0.99","5":"1"},{"1":"24","2":"2","3":"819","4":"0.99","5":"1"},{"1":"25","2":"2","3":"392","4":"0.99","5":"1"},{"1":"26","2":"2","3":"2651","4":"0.99","5":"1"},{"1":"27","2":"3","3":"2516","4":"0.99","5":"1"},{"1":"28","2":"3","3":"2646","4":"0.99","5":"1"},{"1":"29","2":"4","3":"3448","4":"0.99","5":"1"},{"1":"30","2":"4","3":"2560","4":"0.99","5":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p><code>track</code> table</p>
<div class="cell" data-output.var="track">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb7-1"><span class="kw" style="color: #003B4F;">SELECT</span> <span class="op" style="color: #5E5E5E;">*</span></span>
<span id="cb7-2"><span class="kw" style="color: #003B4F;">FROM</span> track</span>
<span id="cb7-3"><span class="kw" style="color: #003B4F;">LIMIT</span> <span class="dv" style="color: #AD0000;">20</span></span></code></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["track_id"],"name":[1],"type":["int"],"align":["right"]},{"label":["name"],"name":[2],"type":["chr"],"align":["left"]},{"label":["album_id"],"name":[3],"type":["int"],"align":["right"]},{"label":["media_type_id"],"name":[4],"type":["int"],"align":["right"]},{"label":["genre_id"],"name":[5],"type":["int"],"align":["right"]},{"label":["composer"],"name":[6],"type":["chr"],"align":["left"]},{"label":["milliseconds"],"name":[7],"type":["int"],"align":["right"]},{"label":["bytes"],"name":[8],"type":["int"],"align":["right"]},{"label":["unit_price"],"name":[9],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"For Those About To Rock (We Salute You)","3":"1","4":"1","5":"1","6":"Angus Young, Malcolm Young, Brian Johnson","7":"343719","8":"11170334","9":"0.99"},{"1":"2","2":"Balls to the Wall","3":"2","4":"2","5":"1","6":"NA","7":"342562","8":"5510424","9":"0.99"},{"1":"3","2":"Fast As a Shark","3":"3","4":"2","5":"1","6":"F. Baltes, S. Kaufman, U. Dirkscneider & W. Hoffman","7":"230619","8":"3990994","9":"0.99"},{"1":"4","2":"Restless and Wild","3":"3","4":"2","5":"1","6":"F. Baltes, R.A. Smith-Diesel, S. Kaufman, U. Dirkscneider & W. Hoffman","7":"252051","8":"4331779","9":"0.99"},{"1":"5","2":"Princess of the Dawn","3":"3","4":"2","5":"1","6":"Deaffy & R.A. Smith-Diesel","7":"375418","8":"6290521","9":"0.99"},{"1":"6","2":"Put The Finger On You","3":"1","4":"1","5":"1","6":"Angus Young, Malcolm Young, Brian Johnson","7":"205662","8":"6713451","9":"0.99"},{"1":"7","2":"Let's Get It Up","3":"1","4":"1","5":"1","6":"Angus Young, Malcolm Young, Brian Johnson","7":"233926","8":"7636561","9":"0.99"},{"1":"8","2":"Inject The Venom","3":"1","4":"1","5":"1","6":"Angus Young, Malcolm Young, Brian Johnson","7":"210834","8":"6852860","9":"0.99"},{"1":"9","2":"Snowballed","3":"1","4":"1","5":"1","6":"Angus Young, Malcolm Young, Brian Johnson","7":"203102","8":"6599424","9":"0.99"},{"1":"10","2":"Evil Walks","3":"1","4":"1","5":"1","6":"Angus Young, Malcolm Young, Brian Johnson","7":"263497","8":"8611245","9":"0.99"},{"1":"11","2":"C.O.D.","3":"1","4":"1","5":"1","6":"Angus Young, Malcolm Young, Brian Johnson","7":"199836","8":"6566314","9":"0.99"},{"1":"12","2":"Breaking The Rules","3":"1","4":"1","5":"1","6":"Angus Young, Malcolm Young, Brian Johnson","7":"263288","8":"8596840","9":"0.99"},{"1":"13","2":"Night Of The Long Knives","3":"1","4":"1","5":"1","6":"Angus Young, Malcolm Young, Brian Johnson","7":"205688","8":"6706347","9":"0.99"},{"1":"14","2":"Spellbound","3":"1","4":"1","5":"1","6":"Angus Young, Malcolm Young, Brian Johnson","7":"270863","8":"8817038","9":"0.99"},{"1":"15","2":"Go Down","3":"4","4":"1","5":"1","6":"AC/DC","7":"331180","8":"10847611","9":"0.99"},{"1":"16","2":"Dog Eat Dog","3":"4","4":"1","5":"1","6":"AC/DC","7":"215196","8":"7032162","9":"0.99"},{"1":"17","2":"Let There Be Rock","3":"4","4":"1","5":"1","6":"AC/DC","7":"366654","8":"12021261","9":"0.99"},{"1":"18","2":"Bad Boy Boogie","3":"4","4":"1","5":"1","6":"AC/DC","7":"267728","8":"8776140","9":"0.99"},{"1":"19","2":"Problem Child","3":"4","4":"1","5":"1","6":"AC/DC","7":"325041","8":"10617116","9":"0.99"},{"1":"20","2":"Overdose","3":"4","4":"1","5":"1","6":"AC/DC","7":"369319","8":"12066294","9":"0.99"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="selecting-albums-to-purchase" class="level2">
<h2 class="anchored" data-anchor-id="selecting-albums-to-purchase">1. Selecting Albums to Purchase</h2>
<p>The Chinook record store has just signed a deal with a new record label, and you‚Äôve been tasked with selecting the first three albums that will be added to the store, from a list of four. All four albums are by artists that don‚Äôt have any tracks in the store right now - we have the artist names, and the genre of music they produce:</p>
<table class="table">
<thead>
<tr class="header">
<th>Artist Name</th>
<th>Genre</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Regal</td>
<td>Hip-Hop</td>
</tr>
<tr class="even">
<td>Red Tone</td>
<td>Punk</td>
</tr>
<tr class="odd">
<td>Meteor and the Girls</td>
<td>Pop</td>
</tr>
<tr class="even">
<td>Slim Jim Bites</td>
<td>Blues</td>
</tr>
</tbody>
</table>
<p>The record label specializes in artists from the USA, and they have given Chinook some money to advertise the new albums in the USA, so we‚Äôre interested in finding out which genres sell the best in the USA.</p>
<p>You‚Äôll need to write a query to find out which genres sell the most tracks in the USA, write up a summary of your findings, and make a recommendation for the three artists whose albums we should purchase for the store.</p>
<p><strong>Instructions</strong></p>
<ol type="1">
<li><p>Write a query that returns each genre, with the number of tracks sold in the USA:</p>
<ul>
<li>in absolute numbers</li>
<li>in percentages.</li>
</ul></li>
<li><p>Write a paragraph that interprets the data and makes a recommendation for the three artists whose albums we should purchase for the store, based on sales of tracks from their genres.</p></li>
</ol>
<div class="cell" data-max.print="null" data-output.var="genre_perc">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb8-1"><span class="kw" style="color: #003B4F;">SELECT</span> </span>
<span id="cb8-2">  g.name <span class="kw" style="color: #003B4F;">AS</span> genre,</span>
<span id="cb8-3">  <span class="fu" style="color: #4758AB;">SUM</span>(il.quantity) <span class="kw" style="color: #003B4F;">AS</span> tracks_sold,</span>
<span id="cb8-4">  <span class="fu" style="color: #4758AB;">ROUND</span>(<span class="fu" style="color: #4758AB;">CAST</span>(<span class="fu" style="color: #4758AB;">SUM</span>(il.quantity) <span class="kw" style="color: #003B4F;">AS</span> <span class="dt" style="color: #AD0000;">FLOAT</span>)<span class="op" style="color: #5E5E5E;">/</span></span>
<span id="cb8-5">  (</span>
<span id="cb8-6">    <span class="kw" style="color: #003B4F;">SELECT</span> <span class="fu" style="color: #4758AB;">SUM</span>(il.quantity) </span>
<span id="cb8-7">    <span class="kw" style="color: #003B4F;">FROM</span> invoice i</span>
<span id="cb8-8">    <span class="kw" style="color: #003B4F;">INNER</span> <span class="kw" style="color: #003B4F;">JOIN</span> invoice_line il</span>
<span id="cb8-9">    <span class="kw" style="color: #003B4F;">ON</span> i.invoice_id <span class="op" style="color: #5E5E5E;">=</span> il.invoice_id</span>
<span id="cb8-10">    <span class="kw" style="color: #003B4F;">WHERE</span> i.billing_country <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'USA'</span></span>
<span id="cb8-11">  ) </span>
<span id="cb8-12">  , <span class="dv" style="color: #AD0000;">4</span>) <span class="kw" style="color: #003B4F;">AS</span> percentage_sold</span>
<span id="cb8-13"><span class="kw" style="color: #003B4F;">FROM</span> invoice i</span>
<span id="cb8-14"><span class="kw" style="color: #003B4F;">INNER</span> <span class="kw" style="color: #003B4F;">JOIN</span> invoice_line il</span>
<span id="cb8-15"><span class="kw" style="color: #003B4F;">ON</span> i.invoice_id <span class="op" style="color: #5E5E5E;">=</span> il.invoice_id</span>
<span id="cb8-16"><span class="kw" style="color: #003B4F;">INNER</span> <span class="kw" style="color: #003B4F;">JOIN</span> track t </span>
<span id="cb8-17"><span class="kw" style="color: #003B4F;">ON</span> il.track_id <span class="op" style="color: #5E5E5E;">=</span> t.track_id</span>
<span id="cb8-18"><span class="kw" style="color: #003B4F;">INNER</span> <span class="kw" style="color: #003B4F;">JOIN</span> genre g</span>
<span id="cb8-19"><span class="kw" style="color: #003B4F;">ON</span> t.genre_id <span class="op" style="color: #5E5E5E;">=</span> g.genre_id</span>
<span id="cb8-20"><span class="kw" style="color: #003B4F;">WHERE</span> i.billing_country <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'USA'</span></span>
<span id="cb8-21"><span class="kw" style="color: #003B4F;">GROUP</span> <span class="kw" style="color: #003B4F;">BY</span> genre</span>
<span id="cb8-22"><span class="kw" style="color: #003B4F;">ORDER</span> <span class="kw" style="color: #003B4F;">BY</span> tracks_sold <span class="kw" style="color: #003B4F;">DESC</span></span></code></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">genre</th>
<th style="text-align: right;">tracks_sold</th>
<th style="text-align: right;">percentage_sold</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Rock</td>
<td style="text-align: right;">561</td>
<td style="text-align: right;">0.5338</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alternative &amp; Punk</td>
<td style="text-align: right;">130</td>
<td style="text-align: right;">0.1237</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Metal</td>
<td style="text-align: right;">124</td>
<td style="text-align: right;">0.1180</td>
</tr>
<tr class="even">
<td style="text-align: left;">R&amp;B/Soul</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">0.0504</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Blues</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">0.0343</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alternative</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">0.0333</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pop</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">0.0209</td>
</tr>
<tr class="even">
<td style="text-align: left;">Latin</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">0.0209</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Hip Hop/Rap</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0.0190</td>
</tr>
<tr class="even">
<td style="text-align: left;">Jazz</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">0.0133</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Easy Listening</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">0.0124</td>
</tr>
<tr class="even">
<td style="text-align: left;">Reggae</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0.0057</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Electronica/Dance</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0.0048</td>
</tr>
<tr class="even">
<td style="text-align: left;">Classical</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0.0038</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Heavy Metal</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.0029</td>
</tr>
<tr class="even">
<td style="text-align: left;">Soundtrack</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.0019</td>
</tr>
<tr class="odd">
<td style="text-align: left;">TV Shows</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0010</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;">library</span>(tidyverse)</span>
<span id="cb9-2"><span class="fu" style="color: #4758AB;">theme_set</span>(<span class="fu" style="color: #4758AB;">theme_classic</span>())</span>
<span id="cb9-3"></span>
<span id="cb9-4">genre_of_interest <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"Alternative &amp; Punk"</span>, <span class="st" style="color: #20794D;">"Hip Hop/Rap"</span>, <span class="st" style="color: #20794D;">"Pop"</span>, <span class="st" style="color: #20794D;">"Blues"</span>)</span>
<span id="cb9-5"></span>
<span id="cb9-6">genre_perc <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb9-7">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">of_interest =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(genre <span class="sc" style="color: #5E5E5E;">%in%</span> genre_of_interest, <span class="st" style="color: #20794D;">"yes"</span>, <span class="st" style="color: #20794D;">"no"</span>),</span>
<span id="cb9-8">         <span class="at" style="color: #657422;">perc_text =</span> scales<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">percent</span>(percentage_sold, <span class="at" style="color: #657422;">accuracy =</span> <span class="fl" style="color: #AD0000;">0.1</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb9-9">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x=</span>tracks_sold, <span class="at" style="color: #657422;">y=</span><span class="fu" style="color: #4758AB;">reorder</span>(genre, tracks_sold, sum), <span class="at" style="color: #657422;">fill=</span>of_interest)) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb9-10">  <span class="fu" style="color: #4758AB;">geom_bar</span>(<span class="at" style="color: #657422;">stat =</span> <span class="st" style="color: #20794D;">'identity'</span>, <span class="at" style="color: #657422;">width =</span> <span class="fl" style="color: #AD0000;">0.7</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb9-11">  <span class="fu" style="color: #4758AB;">geom_text</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">label =</span> perc_text), <span class="at" style="color: #657422;">hjust =</span> <span class="sc" style="color: #5E5E5E;">-</span><span class="fl" style="color: #AD0000;">0.2</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb9-12">  <span class="fu" style="color: #4758AB;">labs</span>(<span class="at" style="color: #657422;">title =</span> <span class="st" style="color: #20794D;">"Sold Tracks by Genre, USA"</span>, <span class="at" style="color: #657422;">x =</span> <span class="st" style="color: #20794D;">"Tracks Sold"</span>, <span class="at" style="color: #657422;">y =</span> <span class="st" style="color: #20794D;">"Genre"</span>, </span>
<span id="cb9-13">       <span class="at" style="color: #657422;">fill =</span> <span class="st" style="color: #20794D;">"Genre of Interest"</span>) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb9-14">  <span class="fu" style="color: #4758AB;">scale_fill_manual</span>(<span class="at" style="color: #657422;">values =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"gray74"</span>, <span class="st" style="color: #20794D;">"orange"</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb9-15">  <span class="fu" style="color: #4758AB;">scale_x_continuous</span>(<span class="at" style="color: #657422;">limits =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="dv" style="color: #AD0000;">0</span>, <span class="dv" style="color: #AD0000;">600</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb9-16">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">legend.position =</span> <span class="st" style="color: #20794D;">"top"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/answering-business-questions-using-sql/chinook_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The most popular genres in the USA are <strong>Rock</strong>, <strong>Alternative &amp; Punk</strong>, and <strong>Metal</strong>, followed with a big gap by all the others. Since our choice is limited by Hip-Hop, Punk, Pop, and Blues genres, and since we have to choose 3 out of 4 albums, we should purchase the new albums by the following artists:</p>
<ul>
<li>Red Tone (Punk)</li>
<li>Slim Jim Bites (Blues)</li>
<li>Meteor and the Girls (Pop)</li>
</ul>
</section>
<section id="analyzing-employee-sales-performance" class="level2">
<h2 class="anchored" data-anchor-id="analyzing-employee-sales-performance">2. Analyzing Employee Sales Performance</h2>
<p>Each customer for the Chinook store gets assigned to a sales support agent within the company when they first make a purchase. You have been asked to analyze the purchases of customers belonging to each employee to see if any sales support agent is performing either better or worse than the others.</p>
<p>You might like to consider whether any extra columns from the employee table explain any variance you see, or whether the variance might instead be indicative of employee performance.</p>
<p><strong>Instructions</strong></p>
<ol type="1">
<li><p>Write a query that finds the total dollar amount of sales assigned to each sales support agent within the company. Add any extra attributes for that employee that you find are relevant to the analysis.</p></li>
<li><p>Write a short statement describing your results, and providing a possible interpretation.</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb10-1"><span class="kw" style="color: #003B4F;">SELECT</span> </span>
<span id="cb10-2">  e.first_name <span class="op" style="color: #5E5E5E;">||</span> <span class="st" style="color: #20794D;">' '</span> <span class="op" style="color: #5E5E5E;">||</span> e.last_name <span class="kw" style="color: #003B4F;">AS</span> sales_support_agent,</span>
<span id="cb10-3">  e.hire_date,</span>
<span id="cb10-4">  <span class="fu" style="color: #4758AB;">COUNT</span>(<span class="kw" style="color: #003B4F;">DISTINCT</span> c.customer_id) <span class="kw" style="color: #003B4F;">AS</span> customers,</span>
<span id="cb10-5">  <span class="fu" style="color: #4758AB;">SUM</span>(i.total) <span class="kw" style="color: #003B4F;">AS</span> total_sales</span>
<span id="cb10-6"><span class="kw" style="color: #003B4F;">FROM</span> employee e</span>
<span id="cb10-7"><span class="kw" style="color: #003B4F;">INNER</span> <span class="kw" style="color: #003B4F;">JOIN</span> customer c</span>
<span id="cb10-8"><span class="kw" style="color: #003B4F;">ON</span> e.employee_id <span class="op" style="color: #5E5E5E;">=</span> c.support_rep_id</span>
<span id="cb10-9"><span class="kw" style="color: #003B4F;">INNER</span> <span class="kw" style="color: #003B4F;">JOIN</span> invoice i</span>
<span id="cb10-10"><span class="kw" style="color: #003B4F;">ON</span> c.customer_id <span class="op" style="color: #5E5E5E;">=</span> i.customer_id</span>
<span id="cb10-11"><span class="kw" style="color: #003B4F;">GROUP</span> <span class="kw" style="color: #003B4F;">BY</span> sales_support_agent</span></code></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>3 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">sales_support_agent</th>
<th style="text-align: left;">hire_date</th>
<th style="text-align: right;">customers</th>
<th style="text-align: right;">total_sales</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Jane Peacock</td>
<td style="text-align: left;">2017-04-01 00:00:00</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">1731.51</td>
</tr>
<tr class="even">
<td style="text-align: left;">Margaret Park</td>
<td style="text-align: left;">2017-05-03 00:00:00</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">1584.00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Steve Johnson</td>
<td style="text-align: left;">2017-10-17 00:00:00</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">1393.92</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>While there is a <strong>20% difference in sales</strong> between Jane (the top employee) and Steve (the bottom employee), the difference roughly corresponds with the differences in their hiring dates.</p>
</section>
<section id="analyzing-sales-by-country" class="level2">
<h2 class="anchored" data-anchor-id="analyzing-sales-by-country">3. Analyzing Sales by Country</h2>
<p>Your next task is to analyze the sales data for customers from each different country. You have been given guidance to use the country value from the customers table, and ignore the country from the billing address in the invoice table.</p>
<p><strong>Instructions</strong></p>
<ol type="1">
<li><p>Write a query that collates data on purchases from different countries.</p></li>
<li><p>Where a country has only one customer, collect them into an ‚ÄúOther‚Äù group.</p></li>
<li><p>The results should be sorted by the total sales from highest to lowest, with the ‚ÄúOther‚Äù group at the very bottom.</p></li>
<li><p>For each country, include:</p>
<ul>
<li>total number of customers</li>
<li>total value of sales</li>
<li>average value of sales per customer</li>
<li>average order value</li>
</ul></li>
</ol>
<div class="cell" data-max.print="null" data-output.var="sales_by_country">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb11-1"><span class="kw" style="color: #003B4F;">WITH</span> t1 <span class="kw" style="color: #003B4F;">AS</span> (</span>
<span id="cb11-2">  <span class="kw" style="color: #003B4F;">SELECT</span></span>
<span id="cb11-3">    <span class="cf" style="color: #003B4F;">CASE</span></span>
<span id="cb11-4">      <span class="cf" style="color: #003B4F;">WHEN</span> <span class="fu" style="color: #4758AB;">COUNT</span>(<span class="kw" style="color: #003B4F;">DISTINCT</span> c.customer_id) <span class="op" style="color: #5E5E5E;">=</span> <span class="dv" style="color: #AD0000;">1</span> <span class="cf" style="color: #003B4F;">THEN</span> <span class="st" style="color: #20794D;">'Other'</span></span>
<span id="cb11-5">      <span class="cf" style="color: #003B4F;">ELSE</span> c.country</span>
<span id="cb11-6">      <span class="cf" style="color: #003B4F;">END</span> <span class="kw" style="color: #003B4F;">AS</span> country,</span>
<span id="cb11-7">    <span class="fu" style="color: #4758AB;">COUNT</span>(<span class="kw" style="color: #003B4F;">DISTINCT</span> c.customer_id) <span class="kw" style="color: #003B4F;">AS</span> customers,</span>
<span id="cb11-8">    <span class="fu" style="color: #4758AB;">SUM</span>(i.total) <span class="kw" style="color: #003B4F;">AS</span> total_sales,</span>
<span id="cb11-9">    <span class="fu" style="color: #4758AB;">SUM</span>(i.total)<span class="op" style="color: #5E5E5E;">/</span><span class="fu" style="color: #4758AB;">COUNT</span>(<span class="kw" style="color: #003B4F;">DISTINCT</span> c.customer_id) <span class="kw" style="color: #003B4F;">AS</span> avg_sales_per_cust,</span>
<span id="cb11-10">    <span class="fu" style="color: #4758AB;">AVG</span>(i.total) <span class="kw" style="color: #003B4F;">AS</span> avg_order</span>
<span id="cb11-11">  <span class="kw" style="color: #003B4F;">FROM</span> customer c</span>
<span id="cb11-12">  <span class="kw" style="color: #003B4F;">INNER</span> <span class="kw" style="color: #003B4F;">JOIN</span> invoice i</span>
<span id="cb11-13">  <span class="kw" style="color: #003B4F;">ON</span> c.customer_id <span class="op" style="color: #5E5E5E;">=</span> i.customer_id</span>
<span id="cb11-14">  <span class="kw" style="color: #003B4F;">GROUP</span> <span class="kw" style="color: #003B4F;">BY</span> country</span>
<span id="cb11-15">)</span>
<span id="cb11-16"></span>
<span id="cb11-17"><span class="kw" style="color: #003B4F;">SELECT</span> </span>
<span id="cb11-18">  country,</span>
<span id="cb11-19">  <span class="fu" style="color: #4758AB;">SUM</span>(customers) <span class="kw" style="color: #003B4F;">AS</span> customers,</span>
<span id="cb11-20">  <span class="fu" style="color: #4758AB;">SUM</span>(total_sales) <span class="kw" style="color: #003B4F;">AS</span> total_sales,</span>
<span id="cb11-21">  <span class="fu" style="color: #4758AB;">AVG</span>(avg_sales_per_cust) <span class="kw" style="color: #003B4F;">AS</span> avg_sales_per_cust,</span>
<span id="cb11-22">  <span class="fu" style="color: #4758AB;">AVG</span>(avg_order) <span class="kw" style="color: #003B4F;">AS</span> avg_order</span>
<span id="cb11-23"><span class="kw" style="color: #003B4F;">FROM</span> </span>
<span id="cb11-24">  (</span>
<span id="cb11-25">    <span class="kw" style="color: #003B4F;">SELECT</span></span>
<span id="cb11-26">      t1.<span class="op" style="color: #5E5E5E;">*</span>,</span>
<span id="cb11-27">      <span class="cf" style="color: #003B4F;">CASE</span> </span>
<span id="cb11-28">        <span class="cf" style="color: #003B4F;">WHEN</span> country <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'Other'</span> <span class="cf" style="color: #003B4F;">THEN</span> <span class="dv" style="color: #AD0000;">1</span></span>
<span id="cb11-29">        <span class="cf" style="color: #003B4F;">ELSE</span> <span class="dv" style="color: #AD0000;">0</span></span>
<span id="cb11-30">        <span class="cf" style="color: #003B4F;">END</span> <span class="kw" style="color: #003B4F;">AS</span> sorted</span>
<span id="cb11-31">    <span class="kw" style="color: #003B4F;">FROM</span> t1</span>
<span id="cb11-32">  )</span>
<span id="cb11-33"><span class="kw" style="color: #003B4F;">GROUP</span> <span class="kw" style="color: #003B4F;">BY</span> country</span>
<span id="cb11-34"><span class="kw" style="color: #003B4F;">ORDER</span> <span class="kw" style="color: #003B4F;">BY</span> sorted, total_sales <span class="kw" style="color: #003B4F;">DESC</span></span></code></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">country</th>
<th style="text-align: right;">customers</th>
<th style="text-align: right;">total_sales</th>
<th style="text-align: right;">avg_sales_per_cust</th>
<th style="text-align: right;">avg_order</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">USA</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1040.49</td>
<td style="text-align: right;">80.03769</td>
<td style="text-align: right;">7.942672</td>
</tr>
<tr class="even">
<td style="text-align: left;">Canada</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">535.59</td>
<td style="text-align: right;">66.94875</td>
<td style="text-align: right;">7.047237</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Brazil</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">427.68</td>
<td style="text-align: right;">85.53600</td>
<td style="text-align: right;">7.011147</td>
</tr>
<tr class="even">
<td style="text-align: left;">France</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">389.07</td>
<td style="text-align: right;">77.81400</td>
<td style="text-align: right;">7.781400</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Germany</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">334.62</td>
<td style="text-align: right;">83.65500</td>
<td style="text-align: right;">8.161463</td>
</tr>
<tr class="even">
<td style="text-align: left;">Czech Republic</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">273.24</td>
<td style="text-align: right;">136.62000</td>
<td style="text-align: right;">9.108000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">United Kingdom</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">245.52</td>
<td style="text-align: right;">81.84000</td>
<td style="text-align: right;">8.768571</td>
</tr>
<tr class="even">
<td style="text-align: left;">Portugal</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">185.13</td>
<td style="text-align: right;">92.56500</td>
<td style="text-align: right;">6.383793</td>
</tr>
<tr class="odd">
<td style="text-align: left;">India</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">183.15</td>
<td style="text-align: right;">91.57500</td>
<td style="text-align: right;">8.721429</td>
</tr>
<tr class="even">
<td style="text-align: left;">Other</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">1094.94</td>
<td style="text-align: right;">72.99600</td>
<td style="text-align: right;">7.445071</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">sales_by_country <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb12-2">  <span class="fu" style="color: #4758AB;">select</span>(country, customers, total_sales) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb12-3">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">country =</span> <span class="fu" style="color: #4758AB;">factor</span>(country, <span class="at" style="color: #657422;">levels =</span> <span class="fu" style="color: #4758AB;">c</span>(country)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">fct_rev</span>()) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb12-4">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">customers =</span> customers<span class="sc" style="color: #5E5E5E;">/</span><span class="fu" style="color: #4758AB;">sum</span>(customers),</span>
<span id="cb12-5">         <span class="at" style="color: #657422;">total_sales =</span> total_sales<span class="sc" style="color: #5E5E5E;">/</span><span class="fu" style="color: #4758AB;">sum</span>(total_sales)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb12-6">  <span class="fu" style="color: #4758AB;">pivot_longer</span>(<span class="sc" style="color: #5E5E5E;">-</span>country, <span class="at" style="color: #657422;">names_to =</span> <span class="st" style="color: #20794D;">"variable"</span>, <span class="at" style="color: #657422;">values_to =</span> <span class="st" style="color: #20794D;">"value"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb12-7">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x=</span>value, <span class="at" style="color: #657422;">y=</span>country, <span class="at" style="color: #657422;">fill=</span>variable)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb12-8">  <span class="fu" style="color: #4758AB;">geom_bar</span>(<span class="at" style="color: #657422;">stat =</span> <span class="st" style="color: #20794D;">"identity"</span>, <span class="at" style="color: #657422;">width =</span> <span class="fl" style="color: #AD0000;">0.65</span>, <span class="at" style="color: #657422;">position =</span> <span class="fu" style="color: #4758AB;">position_dodge</span>(<span class="fl" style="color: #AD0000;">0.8</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb12-9">  <span class="fu" style="color: #4758AB;">labs</span>(<span class="at" style="color: #657422;">title=</span><span class="st" style="color: #20794D;">"Share of Customers and Sales by Country"</span>, <span class="at" style="color: #657422;">x=</span><span class="st" style="color: #20794D;">"share"</span>, <span class="at" style="color: #657422;">fill=</span><span class="st" style="color: #20794D;">""</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb12-10">  <span class="fu" style="color: #4758AB;">scale_x_continuous</span>(<span class="at" style="color: #657422;">labels =</span> scales<span class="sc" style="color: #5E5E5E;">::</span>percent) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb12-11">  <span class="fu" style="color: #4758AB;">scale_fill_manual</span>(<span class="at" style="color: #657422;">values =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"gray77"</span>, <span class="st" style="color: #20794D;">"seagreen3"</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb12-12">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">legend.position =</span> <span class="st" style="color: #20794D;">"top"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/answering-business-questions-using-sql/chinook_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">sales_by_country <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb13-2">  <span class="fu" style="color: #4758AB;">select</span>(country, avg_order, avg_sales_per_cust) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb13-3">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">country =</span> <span class="fu" style="color: #4758AB;">factor</span>(country, <span class="at" style="color: #657422;">levels =</span> <span class="fu" style="color: #4758AB;">c</span>(country)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">fct_rev</span>()) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb13-4">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">avg_order =</span> (avg_order <span class="sc" style="color: #5E5E5E;">-</span> <span class="fu" style="color: #4758AB;">mean</span>(avg_order)) <span class="sc" style="color: #5E5E5E;">/</span> <span class="fu" style="color: #4758AB;">mean</span>(avg_order),</span>
<span id="cb13-5">         <span class="at" style="color: #657422;">avg_sales_per_cust =</span> (avg_sales_per_cust <span class="sc" style="color: #5E5E5E;">-</span> <span class="fu" style="color: #4758AB;">mean</span>(avg_sales_per_cust)) <span class="sc" style="color: #5E5E5E;">/</span> </span>
<span id="cb13-6">                                 <span class="fu" style="color: #4758AB;">mean</span>(avg_sales_per_cust)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb13-7">  <span class="fu" style="color: #4758AB;">rename</span>(<span class="st" style="color: #20794D;">`</span><span class="at" style="color: #657422;">Average Order</span><span class="st" style="color: #20794D;">`</span> <span class="ot" style="color: #003B4F;">=</span> avg_order,</span>
<span id="cb13-8">         <span class="st" style="color: #20794D;">`</span><span class="at" style="color: #657422;">Average Sales per Customer</span><span class="st" style="color: #20794D;">`</span> <span class="ot" style="color: #003B4F;">=</span> avg_sales_per_cust) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb13-9">  <span class="fu" style="color: #4758AB;">pivot_longer</span>(<span class="sc" style="color: #5E5E5E;">-</span>country, <span class="at" style="color: #657422;">names_to =</span> <span class="st" style="color: #20794D;">"variable"</span>, <span class="at" style="color: #657422;">values_to =</span> <span class="st" style="color: #20794D;">"pct_diff_from_mean"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb13-10">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x=</span>pct_diff_from_mean, <span class="at" style="color: #657422;">y=</span>country, <span class="at" style="color: #657422;">fill=</span>variable)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb13-11">  <span class="fu" style="color: #4758AB;">geom_col</span>(<span class="at" style="color: #657422;">width =</span> <span class="fl" style="color: #AD0000;">0.65</span>, <span class="at" style="color: #657422;">position =</span> <span class="fu" style="color: #4758AB;">position_dodge</span>(<span class="fl" style="color: #AD0000;">0.8</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb13-12">  <span class="fu" style="color: #4758AB;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;">~</span> variable, <span class="at" style="color: #657422;">scales =</span> <span class="st" style="color: #20794D;">"free_x"</span>) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb13-13">  <span class="fu" style="color: #4758AB;">labs</span>(<span class="at" style="color: #657422;">title=</span><span class="st" style="color: #20794D;">"Average Order &amp; Average Sales per Customer"</span>, </span>
<span id="cb13-14">       <span class="at" style="color: #657422;">subtitle =</span> <span class="st" style="color: #20794D;">"(Percent Difference from Mean)"</span>, <span class="at" style="color: #657422;">x=</span><span class="st" style="color: #20794D;">"pct diff from mean"</span>, <span class="at" style="color: #657422;">fill=</span><span class="st" style="color: #20794D;">""</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb13-15">  <span class="fu" style="color: #4758AB;">scale_fill_manual</span>(<span class="at" style="color: #657422;">values =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"steelblue"</span>, <span class="st" style="color: #20794D;">"lightskyblue2"</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb13-16">  <span class="fu" style="color: #4758AB;">scale_x_continuous</span>(<span class="at" style="color: #657422;">labels =</span> scales<span class="sc" style="color: #5E5E5E;">::</span>percent) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb13-17">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">legend.position =</span> <span class="st" style="color: #20794D;">"top"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/answering-business-questions-using-sql/chinook_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The USA has the largest customer base and, consequently, the highest total sales.</p>
<p>Based on the data, there may be opportunity in the following countries:</p>
<ul>
<li>Czech Republic</li>
<li>United Kingdom</li>
<li>India</li>
</ul>
<p>It‚Äôs worth keeping in mind that the amount of data from each of these countries is relatively low. Because of this, we should be cautious spending too much money on new marketing campaigns, as the sample size is not large enough to give us high confidence. A better approach would be to run small campaigns in these countries, collecting and analyzing the new customers to make sure that these trends hold with new customers.</p>
</section>
<section id="albums-vs-individual-tracks" class="level2">
<h2 class="anchored" data-anchor-id="albums-vs-individual-tracks">4. Albums vs Individual Tracks</h2>
<p>The Chinook store is setup in a way that allows customer to make purchases in one of the two ways:</p>
<ul>
<li>purchase a whole album</li>
<li>purchase a collection of one or more individual tracks.</li>
</ul>
<p>The store does not let customers purchase a whole album, and then add individual tracks to that same purchase (unless they do that by choosing each track manually). When customers purchase albums they are charged the same price as if they had purchased each of those tracks separately.</p>
<p>Management are currently considering changing their purchasing strategy to save money. The strategy they are considering is to purchase only the most popular tracks from each album from record companies, instead of purchasing every track from an album.</p>
<p>We have been asked to find out what percentage of purchases are individual tracks vs whole albums, so that management can use this data to understand the effect this decision might have on overall revenue.</p>
<p><strong>Instructions</strong></p>
<ol type="1">
<li><p>Write a query that categorizes each invoice as either an album purchase or not, and calculates the following summary statistics:</p>
<ul>
<li>Number of invoices</li>
<li>Percentage of invoices</li>
</ul></li>
<li><p>Write one to two sentences explaining your findings, and making a prospective recommendation on whether the Chinook store should continue to buy full albums from record companies</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb14-1"><span class="kw" style="color: #003B4F;">WITH</span> cat_purchase <span class="kw" style="color: #003B4F;">AS</span> (</span>
<span id="cb14-2">  <span class="kw" style="color: #003B4F;">SELECT</span></span>
<span id="cb14-3">    il.invoice_id,</span>
<span id="cb14-4">    <span class="cf" style="color: #003B4F;">CASE</span></span>
<span id="cb14-5">      <span class="cf" style="color: #003B4F;">WHEN</span></span>
<span id="cb14-6">      <span class="fu" style="color: #4758AB;">COUNT</span>(<span class="kw" style="color: #003B4F;">DISTINCT</span> t.album_id) <span class="op" style="color: #5E5E5E;">=</span> <span class="dv" style="color: #AD0000;">1</span></span>
<span id="cb14-7">      <span class="kw" style="color: #003B4F;">AND</span> </span>
<span id="cb14-8">      <span class="fu" style="color: #4758AB;">COUNT</span>(<span class="kw" style="color: #003B4F;">DISTINCT</span> t.track_id) <span class="op" style="color: #5E5E5E;">=</span> c.count_album_tracks</span>
<span id="cb14-9">      <span class="cf" style="color: #003B4F;">THEN</span> <span class="st" style="color: #20794D;">'album'</span></span>
<span id="cb14-10">      <span class="cf" style="color: #003B4F;">ELSE</span> <span class="st" style="color: #20794D;">'individual track(s)'</span></span>
<span id="cb14-11">      <span class="cf" style="color: #003B4F;">END</span> <span class="kw" style="color: #003B4F;">AS</span> purchase_type,</span>
<span id="cb14-12">      c.count_album_tracks</span>
<span id="cb14-13">    <span class="kw" style="color: #003B4F;">FROM</span> track t</span>
<span id="cb14-14">    <span class="kw" style="color: #003B4F;">JOIN</span> invoice_line il</span>
<span id="cb14-15">    <span class="kw" style="color: #003B4F;">ON</span> il.track_id <span class="op" style="color: #5E5E5E;">=</span> t.track_id</span>
<span id="cb14-16">    <span class="kw" style="color: #003B4F;">JOIN</span> (<span class="kw" style="color: #003B4F;">SELECT</span> <span class="fu" style="color: #4758AB;">COUNT</span>(<span class="op" style="color: #5E5E5E;">*</span>) <span class="kw" style="color: #003B4F;">AS</span> count_album_tracks, album_id</span>
<span id="cb14-17">          <span class="kw" style="color: #003B4F;">FROM</span> track</span>
<span id="cb14-18">          <span class="kw" style="color: #003B4F;">GROUP</span> <span class="kw" style="color: #003B4F;">BY</span> album_id) c</span>
<span id="cb14-19">    <span class="kw" style="color: #003B4F;">ON</span> c.album_id <span class="op" style="color: #5E5E5E;">=</span> t.album_id</span>
<span id="cb14-20">    <span class="kw" style="color: #003B4F;">GROUP</span> <span class="kw" style="color: #003B4F;">BY</span> invoice_id</span>
<span id="cb14-21">)</span>
<span id="cb14-22"></span>
<span id="cb14-23"><span class="kw" style="color: #003B4F;">SELECT</span></span>
<span id="cb14-24">  purchase_type,</span>
<span id="cb14-25">  <span class="fu" style="color: #4758AB;">COUNT</span>(<span class="op" style="color: #5E5E5E;">*</span>) <span class="kw" style="color: #003B4F;">AS</span> number_of_invoices,</span>
<span id="cb14-26">  <span class="fu" style="color: #4758AB;">ROUND</span>(<span class="fu" style="color: #4758AB;">CAST</span>(<span class="fu" style="color: #4758AB;">COUNT</span>(<span class="op" style="color: #5E5E5E;">*</span>) <span class="kw" style="color: #003B4F;">AS</span> <span class="dt" style="color: #AD0000;">float</span>) <span class="op" style="color: #5E5E5E;">/</span> <span class="fu" style="color: #4758AB;">CAST</span>(</span>
<span id="cb14-27">    (<span class="kw" style="color: #003B4F;">SELECT</span> <span class="fu" style="color: #4758AB;">COUNT</span>(<span class="op" style="color: #5E5E5E;">*</span>)</span>
<span id="cb14-28">    <span class="kw" style="color: #003B4F;">FROM</span> invoice) <span class="kw" style="color: #003B4F;">AS</span> <span class="dt" style="color: #AD0000;">FLOAT</span>), <span class="dv" style="color: #AD0000;">2</span>) <span class="kw" style="color: #003B4F;">AS</span> percentage_of_invoices</span>
<span id="cb14-29"><span class="kw" style="color: #003B4F;">FROM</span> cat_purchase</span>
<span id="cb14-30"><span class="kw" style="color: #003B4F;">GROUP</span> <span class="kw" style="color: #003B4F;">BY</span> purchase_type</span></code></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>2 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">purchase_type</th>
<th style="text-align: right;">number_of_invoices</th>
<th style="text-align: right;">percentage_of_invoices</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">album</td>
<td style="text-align: right;">114</td>
<td style="text-align: right;">0.19</td>
</tr>
<tr class="even">
<td style="text-align: left;">individual track(s)</td>
<td style="text-align: right;">500</td>
<td style="text-align: right;">0.81</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Album purchases account for 19% of all purchases. Based on this data, I would recommend against purchasing only the most popular tracks from each album from record companies, since there is a potential of losing a significant portion of revenue.</p>
</section>
<section id="which-artist-is-used-in-the-most-playlists" class="level2">
<h2 class="anchored" data-anchor-id="which-artist-is-used-in-the-most-playlists">5. Which artist is used in the most playlists?</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb15-1"><span class="kw" style="color: #003B4F;">SELECT</span> </span>
<span id="cb15-2">  ar.name <span class="kw" style="color: #003B4F;">AS</span> artist,</span>
<span id="cb15-3">  g.name <span class="kw" style="color: #003B4F;">AS</span> genre,</span>
<span id="cb15-4">  <span class="fu" style="color: #4758AB;">COUNT</span>(<span class="kw" style="color: #003B4F;">DISTINCT</span> pt.playlist_id) <span class="kw" style="color: #003B4F;">AS</span> number_of_playlists,</span>
<span id="cb15-5">  <span class="fu" style="color: #4758AB;">COUNT</span>(<span class="kw" style="color: #003B4F;">DISTINCT</span> t.track_id) <span class="kw" style="color: #003B4F;">AS</span> unique_tracks</span>
<span id="cb15-6"><span class="kw" style="color: #003B4F;">FROM</span> artist ar</span>
<span id="cb15-7"><span class="kw" style="color: #003B4F;">JOIN</span> album al <span class="kw" style="color: #003B4F;">ON</span> ar.artist_id<span class="op" style="color: #5E5E5E;">=</span>al.artist_id</span>
<span id="cb15-8"><span class="kw" style="color: #003B4F;">JOIN</span> track t <span class="kw" style="color: #003B4F;">ON</span> al.album_id<span class="op" style="color: #5E5E5E;">=</span>t.album_id</span>
<span id="cb15-9"><span class="kw" style="color: #003B4F;">JOIN</span> playlist_track pt <span class="kw" style="color: #003B4F;">ON</span> pt.track_id <span class="op" style="color: #5E5E5E;">=</span> t.track_id</span>
<span id="cb15-10"><span class="kw" style="color: #003B4F;">JOIN</span> genre g <span class="kw" style="color: #003B4F;">ON</span> g.genre_id <span class="op" style="color: #5E5E5E;">=</span> t.genre_id</span>
<span id="cb15-11"><span class="kw" style="color: #003B4F;">GROUP</span> <span class="kw" style="color: #003B4F;">BY</span> artist, genre</span>
<span id="cb15-12"><span class="kw" style="color: #003B4F;">ORDER</span> <span class="kw" style="color: #003B4F;">BY</span> number_of_playlists <span class="kw" style="color: #003B4F;">DESC</span>, unique_tracks <span class="kw" style="color: #003B4F;">DESC</span></span></code></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>Displaying records 1 - 10</caption>
<colgroup>
<col style="width: 57%">
<col style="width: 9%">
<col style="width: 19%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">artist</th>
<th style="text-align: left;">genre</th>
<th style="text-align: right;">number_of_playlists</th>
<th style="text-align: right;">unique_tracks</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Eugene Ormandy</td>
<td style="text-align: left;">Classical</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">Berliner Philharmoniker &amp; Herbert Von Karajan</td>
<td style="text-align: left;">Classical</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">The King‚Äôs Singers</td>
<td style="text-align: left;">Classical</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">English Concert &amp; Trevor Pinnock</td>
<td style="text-align: left;">Classical</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Academy of St.&nbsp;Martin in the Fields &amp; Sir Neville Marriner</td>
<td style="text-align: left;">Classical</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">Michael Tilson Thomas &amp; San Francisco Symphony</td>
<td style="text-align: left;">Classical</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Yo-Yo Ma</td>
<td style="text-align: left;">Classical</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Wilhelm Kempff</td>
<td style="text-align: left;">Classical</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Ton Koopman</td>
<td style="text-align: left;">Classical</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sir Georg Solti, Sumi Jo &amp; Wiener Philharmoniker</td>
<td style="text-align: left;">Opera</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><a href="https://en.wikipedia.org/wiki/Eugene_Ormandy">Eugene Ormandy</a> takes the first place with only 3 unique tracks in 7 different playlists. His music belongs to the classical genre, which we have previously seen is one of the least popular genres in the USA.</p>
<p>If we order this table by number of unique tracks, we get a completely different list.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb16-1"><span class="kw" style="color: #003B4F;">SELECT</span> </span>
<span id="cb16-2">  ar.name <span class="kw" style="color: #003B4F;">AS</span> artist,</span>
<span id="cb16-3">  g.name <span class="kw" style="color: #003B4F;">AS</span> genre,</span>
<span id="cb16-4">  <span class="fu" style="color: #4758AB;">COUNT</span>(<span class="kw" style="color: #003B4F;">DISTINCT</span> pt.playlist_id) <span class="kw" style="color: #003B4F;">AS</span> number_of_playlists,</span>
<span id="cb16-5">  <span class="fu" style="color: #4758AB;">COUNT</span>(<span class="kw" style="color: #003B4F;">DISTINCT</span> t.track_id) <span class="kw" style="color: #003B4F;">AS</span> unique_tracks</span>
<span id="cb16-6"><span class="kw" style="color: #003B4F;">FROM</span> artist ar</span>
<span id="cb16-7"><span class="kw" style="color: #003B4F;">JOIN</span> album al <span class="kw" style="color: #003B4F;">ON</span> ar.artist_id<span class="op" style="color: #5E5E5E;">=</span>al.artist_id</span>
<span id="cb16-8"><span class="kw" style="color: #003B4F;">JOIN</span> track t <span class="kw" style="color: #003B4F;">ON</span> al.album_id<span class="op" style="color: #5E5E5E;">=</span>t.album_id</span>
<span id="cb16-9"><span class="kw" style="color: #003B4F;">JOIN</span> playlist_track pt <span class="kw" style="color: #003B4F;">ON</span> pt.track_id <span class="op" style="color: #5E5E5E;">=</span> t.track_id</span>
<span id="cb16-10"><span class="kw" style="color: #003B4F;">JOIN</span> genre g <span class="kw" style="color: #003B4F;">ON</span> g.genre_id <span class="op" style="color: #5E5E5E;">=</span> t.genre_id</span>
<span id="cb16-11"><span class="kw" style="color: #003B4F;">GROUP</span> <span class="kw" style="color: #003B4F;">BY</span> artist, genre</span>
<span id="cb16-12"><span class="kw" style="color: #003B4F;">ORDER</span> <span class="kw" style="color: #003B4F;">BY</span> unique_tracks <span class="kw" style="color: #003B4F;">DESC</span>, number_of_playlists <span class="kw" style="color: #003B4F;">DESC</span></span></code></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th style="text-align: left;">artist</th>
<th style="text-align: left;">genre</th>
<th style="text-align: right;">number_of_playlists</th>
<th style="text-align: right;">unique_tracks</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Led Zeppelin</td>
<td style="text-align: left;">Rock</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">114</td>
</tr>
<tr class="even">
<td style="text-align: left;">Metallica</td>
<td style="text-align: left;">Metal</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">112</td>
</tr>
<tr class="odd">
<td style="text-align: left;">U2</td>
<td style="text-align: left;">Rock</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">112</td>
</tr>
<tr class="even">
<td style="text-align: left;">Iron Maiden</td>
<td style="text-align: left;">Metal</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">95</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Deep Purple</td>
<td style="text-align: left;">Rock</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">92</td>
</tr>
<tr class="even">
<td style="text-align: left;">Iron Maiden</td>
<td style="text-align: left;">Rock</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">81</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pearl Jam</td>
<td style="text-align: left;">Rock</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">54</td>
</tr>
<tr class="even">
<td style="text-align: left;">Van Halen</td>
<td style="text-align: left;">Rock</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">52</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Os Paralamas Do Sucesso</td>
<td style="text-align: left;">Latin</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">49</td>
</tr>
<tr class="even">
<td style="text-align: left;">Lost</td>
<td style="text-align: left;">TV Shows</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">48</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="how-many-tracks-have-been-purchased-vs-not-purchased" class="level2">
<h2 class="anchored" data-anchor-id="how-many-tracks-have-been-purchased-vs-not-purchased">6. How many tracks have been purchased vs not purchased?</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb17-1"><span class="kw" style="color: #003B4F;">WITH</span> all_and_purchased_tracks <span class="kw" style="color: #003B4F;">AS</span> (</span>
<span id="cb17-2">  <span class="kw" style="color: #003B4F;">SELECT</span> </span>
<span id="cb17-3">    t.track_id <span class="kw" style="color: #003B4F;">AS</span> all_tracks,</span>
<span id="cb17-4">    il.track_id <span class="kw" style="color: #003B4F;">AS</span> purch_tracks</span>
<span id="cb17-5">  <span class="kw" style="color: #003B4F;">FROM</span> track t</span>
<span id="cb17-6">  <span class="kw" style="color: #003B4F;">LEFT</span> <span class="kw" style="color: #003B4F;">JOIN</span> invoice_line il</span>
<span id="cb17-7">  <span class="kw" style="color: #003B4F;">ON</span> t.track_id <span class="op" style="color: #5E5E5E;">=</span> il.track_id</span>
<span id="cb17-8">)</span>
<span id="cb17-9">  </span>
<span id="cb17-10"><span class="kw" style="color: #003B4F;">SELECT</span></span>
<span id="cb17-11">  <span class="fu" style="color: #4758AB;">COUNT</span>(<span class="kw" style="color: #003B4F;">DISTINCT</span> all_tracks) <span class="kw" style="color: #003B4F;">AS</span> total_tracks,</span>
<span id="cb17-12">  <span class="fu" style="color: #4758AB;">COUNT</span>(<span class="kw" style="color: #003B4F;">DISTINCT</span> purch_tracks) <span class="kw" style="color: #003B4F;">AS</span> pirchased,</span>
<span id="cb17-13">  <span class="fu" style="color: #4758AB;">COUNT</span>(<span class="kw" style="color: #003B4F;">DISTINCT</span> all_tracks) <span class="op" style="color: #5E5E5E;">-</span> <span class="fu" style="color: #4758AB;">COUNT</span>(<span class="kw" style="color: #003B4F;">DISTINCT</span> purch_tracks) <span class="kw" style="color: #003B4F;">AS</span> not_purchased,</span>
<span id="cb17-14">  <span class="fu" style="color: #4758AB;">ROUND</span>(<span class="fu" style="color: #4758AB;">CAST</span>(<span class="fu" style="color: #4758AB;">COUNT</span>(<span class="kw" style="color: #003B4F;">DISTINCT</span> purch_tracks) <span class="kw" style="color: #003B4F;">AS</span> <span class="dt" style="color: #AD0000;">FLOAT</span>)<span class="op" style="color: #5E5E5E;">/</span><span class="fu" style="color: #4758AB;">COUNT</span>(<span class="kw" style="color: #003B4F;">DISTINCT</span> all_tracks), <span class="dv" style="color: #AD0000;">3</span>)</span>
<span id="cb17-15">    <span class="kw" style="color: #003B4F;">AS</span> perc_purchased,</span>
<span id="cb17-16">  <span class="fu" style="color: #4758AB;">ROUND</span>(<span class="fu" style="color: #4758AB;">CAST</span>(<span class="fu" style="color: #4758AB;">COUNT</span>(<span class="kw" style="color: #003B4F;">DISTINCT</span> all_tracks) <span class="op" style="color: #5E5E5E;">-</span> <span class="fu" style="color: #4758AB;">COUNT</span>(<span class="kw" style="color: #003B4F;">DISTINCT</span> purch_tracks) </span>
<span id="cb17-17">    <span class="kw" style="color: #003B4F;">AS</span> <span class="dt" style="color: #AD0000;">FLOAT</span>)<span class="op" style="color: #5E5E5E;">/</span><span class="fu" style="color: #4758AB;">COUNT</span>(<span class="kw" style="color: #003B4F;">DISTINCT</span> all_tracks), <span class="dv" style="color: #AD0000;">3</span>)</span>
<span id="cb17-18">    <span class="kw" style="color: #003B4F;">AS</span> perc_not_purchased</span>
<span id="cb17-19"><span class="kw" style="color: #003B4F;">FROM</span> all_and_purchased_tracks</span></code></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>1 records</caption>
<colgroup>
<col style="width: 18%">
<col style="width: 14%">
<col style="width: 19%">
<col style="width: 21%">
<col style="width: 26%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">total_tracks</th>
<th style="text-align: right;">pirchased</th>
<th style="text-align: right;">not_purchased</th>
<th style="text-align: right;">perc_purchased</th>
<th style="text-align: right;">perc_not_purchased</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">3503</td>
<td style="text-align: right;">1806</td>
<td style="text-align: right;">1697</td>
<td style="text-align: right;">0.516</td>
<td style="text-align: right;">0.484</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><span class="fu" style="color: #4758AB;">pie</span>(<span class="fu" style="color: #4758AB;">c</span>(<span class="fl" style="color: #AD0000;">51.6</span>, <span class="fl" style="color: #AD0000;">48.4</span>), <span class="at" style="color: #657422;">labels =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"purchased"</span>, <span class="st" style="color: #20794D;">"not purchased"</span>), </span>
<span id="cb18-2">    <span class="at" style="color: #657422;">main =</span> <span class="st" style="color: #20794D;">"Purchased vs not purchased tracks"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://sandrajurela.com/posts/answering-business-questions-using-sql/chinook_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Almost half of all the unique tracks available in the Chinook store were never bought, probably being of unpopular genre or unpopular artists.</p>
</section>
<section id="do-protected-vs-non-protected-media-types-have-an-effect-on-popularity" class="level2">
<h2 class="anchored" data-anchor-id="do-protected-vs-non-protected-media-types-have-an-effect-on-popularity">7. Do protected vs non-protected media types have an effect on popularity?</h2>
<p>Let‚Äôs take a look at the <code>media_type</code> table.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb19-1"><span class="kw" style="color: #003B4F;">SELECT</span> <span class="op" style="color: #5E5E5E;">*</span></span>
<span id="cb19-2"><span class="kw" style="color: #003B4F;">FROM</span> media_type</span></code></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>5 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">media_type_id</th>
<th style="text-align: left;">name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">MPEG audio file</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: left;">Protected AAC audio file</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: left;">Protected MPEG-4 video file</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: left;">Purchased AAC audio file</td>
</tr>
<tr class="odd">
<td style="text-align: left;">5</td>
<td style="text-align: left;">AAC audio file</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>There are 2 out of 5 media types that are protected.</p>
<div class="cell" data-output.var="by_media_type">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb20-1"><span class="kw" style="color: #003B4F;">WITH</span> t <span class="kw" style="color: #003B4F;">AS</span> (</span>
<span id="cb20-2">  <span class="kw" style="color: #003B4F;">SELECT</span> </span>
<span id="cb20-3">    t.track_id,</span>
<span id="cb20-4">    <span class="cf" style="color: #003B4F;">CASE</span></span>
<span id="cb20-5">      <span class="cf" style="color: #003B4F;">WHEN</span> mt.name <span class="kw" style="color: #003B4F;">LIKE</span> <span class="ot" style="color: #003B4F;">"%protected%"</span> <span class="cf" style="color: #003B4F;">THEN</span> <span class="ot" style="color: #003B4F;">"yes"</span> <span class="cf" style="color: #003B4F;">ELSE</span> <span class="ot" style="color: #003B4F;">"no"</span></span>
<span id="cb20-6">      <span class="cf" style="color: #003B4F;">END</span> <span class="kw" style="color: #003B4F;">AS</span> protected</span>
<span id="cb20-7">  <span class="kw" style="color: #003B4F;">FROM</span> track t</span>
<span id="cb20-8">  <span class="kw" style="color: #003B4F;">JOIN</span> media_type mt <span class="kw" style="color: #003B4F;">ON</span> mt.media_type_id <span class="op" style="color: #5E5E5E;">=</span> t.media_type_id</span>
<span id="cb20-9">)</span>
<span id="cb20-10"></span>
<span id="cb20-11"><span class="kw" style="color: #003B4F;">SELECT</span> </span>
<span id="cb20-12">  protected,</span>
<span id="cb20-13">  <span class="fu" style="color: #4758AB;">COUNT</span>(<span class="kw" style="color: #003B4F;">DISTINCT</span> t.track_id) <span class="kw" style="color: #003B4F;">AS</span> unique_tracks,</span>
<span id="cb20-14">  <span class="fu" style="color: #4758AB;">ROUND</span>(<span class="fu" style="color: #4758AB;">CAST</span>(<span class="fu" style="color: #4758AB;">COUNT</span>(<span class="kw" style="color: #003B4F;">DISTINCT</span> t.track_id) <span class="kw" style="color: #003B4F;">AS</span> <span class="dt" style="color: #AD0000;">FLOAT</span>) <span class="op" style="color: #5E5E5E;">/</span> (<span class="kw" style="color: #003B4F;">SELECT</span> <span class="fu" style="color: #4758AB;">COUNT</span>(<span class="op" style="color: #5E5E5E;">*</span>) <span class="kw" style="color: #003B4F;">FROM</span> track), <span class="dv" style="color: #AD0000;">2</span>)</span>
<span id="cb20-15">    <span class="kw" style="color: #003B4F;">AS</span> <span class="st" style="color: #20794D;">'unique_tracks_%'</span>,</span>
<span id="cb20-16">  <span class="fu" style="color: #4758AB;">COUNT</span>(<span class="kw" style="color: #003B4F;">DISTINCT</span> il.track_id) <span class="kw" style="color: #003B4F;">AS</span> sold_unique_tracks,</span>
<span id="cb20-17">  <span class="fu" style="color: #4758AB;">COUNT</span>(il.track_id) <span class="kw" style="color: #003B4F;">AS</span> sold_tracks,</span>
<span id="cb20-18">  <span class="fu" style="color: #4758AB;">ROUND</span>(<span class="fu" style="color: #4758AB;">CAST</span>(<span class="fu" style="color: #4758AB;">COUNT</span>(il.track_id) <span class="kw" style="color: #003B4F;">AS</span> <span class="dt" style="color: #AD0000;">FLOAT</span>) <span class="op" style="color: #5E5E5E;">/</span> (<span class="kw" style="color: #003B4F;">SELECT</span> <span class="fu" style="color: #4758AB;">COUNT</span>(<span class="op" style="color: #5E5E5E;">*</span>) <span class="kw" style="color: #003B4F;">FROM</span> invoice_line), <span class="dv" style="color: #AD0000;">2</span>)</span>
<span id="cb20-19">    <span class="kw" style="color: #003B4F;">AS</span> <span class="st" style="color: #20794D;">'sold_tracks_%'</span></span>
<span id="cb20-20"><span class="kw" style="color: #003B4F;">FROM</span> t</span>
<span id="cb20-21"><span class="kw" style="color: #003B4F;">LEFT</span> <span class="kw" style="color: #003B4F;">JOIN</span> invoice_line il <span class="kw" style="color: #003B4F;">ON</span> t.track_id <span class="op" style="color: #5E5E5E;">=</span> il.track_id</span>
<span id="cb20-22"><span class="kw" style="color: #003B4F;">GROUP</span> <span class="kw" style="color: #003B4F;">BY</span> protected</span></code></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 11%">
<col style="width: 16%">
<col style="width: 18%">
<col style="width: 22%">
<col style="width: 14%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">protected</th>
<th style="text-align: right;">unique_tracks</th>
<th style="text-align: right;">unique_tracks_%</th>
<th style="text-align: right;">sold_unique_tracks</th>
<th style="text-align: right;">sold_tracks</th>
<th style="text-align: right;">sold_tracks_%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">no</td>
<td style="text-align: right;">3052</td>
<td style="text-align: right;">0.87</td>
<td style="text-align: right;">1652</td>
<td style="text-align: right;">4315</td>
<td style="text-align: right;">0.91</td>
</tr>
<tr class="even">
<td style="text-align: left;">yes</td>
<td style="text-align: right;">451</td>
<td style="text-align: right;">0.13</td>
<td style="text-align: right;">154</td>
<td style="text-align: right;">442</td>
<td style="text-align: right;">0.09</td>
</tr>
</tbody>
</table>
</div>
</div>
<div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1">by_media_type <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-2">  <span class="fu" style="color: #4758AB;">select</span>(protected, unique_tracks, sold_tracks) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-3">  <span class="fu" style="color: #4758AB;">rename</span>(<span class="at" style="color: #657422;">unique =</span> unique_tracks, </span>
<span id="cb21-4">         <span class="at" style="color: #657422;">sold =</span> sold_tracks) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-5">  <span class="fu" style="color: #4758AB;">pivot_longer</span>(<span class="sc" style="color: #5E5E5E;">-</span>protected, <span class="at" style="color: #657422;">names_to =</span> <span class="st" style="color: #20794D;">"tracks"</span>, <span class="at" style="color: #657422;">values_to =</span> <span class="st" style="color: #20794D;">"count"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-6">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">tracks =</span> <span class="fu" style="color: #4758AB;">as.factor</span>(tracks) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">fct_rev</span>()) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-7">  <span class="fu" style="color: #4758AB;">group_by</span>(tracks) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-8">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">pct =</span> count<span class="sc" style="color: #5E5E5E;">/</span><span class="fu" style="color: #4758AB;">sum</span>(count) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">round</span>(<span class="dv" style="color: #AD0000;">2</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-9">  <span class="fu" style="color: #4758AB;">ungroup</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-10">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x=</span>tracks, <span class="at" style="color: #657422;">y=</span>count, <span class="at" style="color: #657422;">fill=</span>protected)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb21-11">  <span class="fu" style="color: #4758AB;">geom_col</span>(<span class="at" style="color: #657422;">width =</span> <span class="fl" style="color: #AD0000;">0.5</span>, <span class="at" style="color: #657422;">position =</span> <span class="st" style="color: #20794D;">"stack"</span>, <span class="at" style="color: #657422;">color =</span> <span class="st" style="color: #20794D;">"white"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb21-12">  <span class="fu" style="color: #4758AB;">geom_text</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">label =</span> count), <span class="at" style="color: #657422;">position =</span> <span class="fu" style="color: #4758AB;">position_stack</span>(<span class="at" style="color: #657422;">vjust =</span> .<span class="dv" style="color: #AD0000;">5</span>),</span>
<span id="cb21-13">            <span class="at" style="color: #657422;">color =</span> <span class="st" style="color: #20794D;">"white"</span>, <span class="at" style="color: #657422;">fontface =</span> <span class="st" style="color: #20794D;">"bold"</span>)<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb21-14">  <span class="fu" style="color: #4758AB;">scale_fill_manual</span>(<span class="at" style="color: #657422;">values =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"#fbc02d"</span>, <span class="st" style="color: #20794D;">"#03a9f4"</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb21-15">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">legend.position =</span> <span class="st" style="color: #20794D;">"top"</span>)</span>
<span id="cb21-16">by_media_type <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-17">  <span class="fu" style="color: #4758AB;">select</span>(protected, unique_tracks, sold_unique_tracks) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-18">  <span class="fu" style="color: #4758AB;">rename</span>(<span class="at" style="color: #657422;">unique =</span> unique_tracks, </span>
<span id="cb21-19">         <span class="at" style="color: #657422;">unique_sold =</span> sold_unique_tracks) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-20">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">unique_unsold =</span> unique <span class="sc" style="color: #5E5E5E;">-</span> unique_sold) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-21">  <span class="fu" style="color: #4758AB;">pivot_longer</span>(<span class="sc" style="color: #5E5E5E;">-</span>protected, <span class="at" style="color: #657422;">names_to =</span> <span class="st" style="color: #20794D;">"tracks"</span>, <span class="at" style="color: #657422;">values_to =</span> <span class="st" style="color: #20794D;">"count"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-22">  <span class="fu" style="color: #4758AB;">filter</span>(tracks <span class="sc" style="color: #5E5E5E;">!=</span> <span class="st" style="color: #20794D;">"unique"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-23">  <span class="fu" style="color: #4758AB;">group_by</span>(protected) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-24">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">percentage =</span> scales<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">percent</span>(count<span class="sc" style="color: #5E5E5E;">/</span><span class="fu" style="color: #4758AB;">sum</span>(count), <span class="at" style="color: #657422;">accuracy =</span> <span class="fl" style="color: #AD0000;">0.1</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-25">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x=</span>protected, <span class="at" style="color: #657422;">y=</span>count, <span class="at" style="color: #657422;">fill=</span>tracks)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb21-26">  <span class="fu" style="color: #4758AB;">geom_col</span>(<span class="at" style="color: #657422;">width =</span> <span class="fl" style="color: #AD0000;">0.5</span>, <span class="at" style="color: #657422;">position =</span> <span class="st" style="color: #20794D;">"fill"</span>, <span class="at" style="color: #657422;">color =</span> <span class="st" style="color: #20794D;">"white"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb21-27">  <span class="fu" style="color: #4758AB;">scale_fill_manual</span>(<span class="at" style="color: #657422;">values =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"seagreen3"</span>, <span class="st" style="color: #20794D;">"tomato"</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb21-28">  <span class="fu" style="color: #4758AB;">geom_text</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">label =</span> percentage), <span class="at" style="color: #657422;">position =</span> <span class="fu" style="color: #4758AB;">position_fill</span>(<span class="at" style="color: #657422;">vjust =</span> .<span class="dv" style="color: #AD0000;">5</span>), </span>
<span id="cb21-29">            <span class="at" style="color: #657422;">color =</span> <span class="st" style="color: #20794D;">"white"</span>, <span class="at" style="color: #657422;">fontface =</span> <span class="st" style="color: #20794D;">"bold"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb21-30">  <span class="fu" style="color: #4758AB;">labs</span>(<span class="at" style="color: #657422;">y=</span><span class="st" style="color: #20794D;">"proportion"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb21-31">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">legend.position =</span> <span class="st" style="color: #20794D;">"top"</span>)</span></code></pre></div>
</details>
<div class="cell quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="https://sandrajurela.com/posts/answering-business-questions-using-sql/chinook_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="384"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="https://sandrajurela.com/posts/answering-business-questions-using-sql/chinook_files/figure-html/unnamed-chunk-28-2.png" class="img-fluid" width="384"></p>
</div>
</div>
</div>
</div>
<p>We can make the following observations:</p>
<ul>
<li>Only 13% of all the unique tracks available in the Chinook store are of protected media types.</li>
<li>Among all the tracks that were sold, those of protected media types amounts only to 9%.</li>
<li>From all the unique tracks of protected media types, only 34,1% were sold, while from those of non-protected ones 54,1%.</li>
</ul>
<p>We can conclude that the <strong>tracks of protected media types are much less popular</strong> than those of non-protected.</p>


</section>

 ]]></description>
  <category>SQL</category>
  <category>SQLite</category>
  <category>data visualization</category>
  <category>R</category>
  <guid>https://sandrajurela.com/posts/answering-business-questions-using-sql/chinook.html</guid>
  <pubDate>Mon, 14 Feb 2022 23:00:00 GMT</pubDate>
  <media:content url="https://sandrajurela.com/posts/answering-business-questions-using-sql/images/media_type.png" medium="image" type="image/png" height="87" width="144"/>
</item>
</channel>
</rss>
